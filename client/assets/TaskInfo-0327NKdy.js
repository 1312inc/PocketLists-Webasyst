import{_ as N,a as V,b as z}from"./TaskListItemPopupMenu.vue_vue_type_script_setup_true_lang-HA70a1t6.js";import{d as $,u as S,a as B,r as y,c as g,o,b as n,e as t,f as _,g as x,w as R,h as L,t as f,i as M,j,n as T,k as A,l as E,m as I,p as K,q as F,T as H,s as q,v as G,x as O,F as D,y as U,z as Y,A as J,B as P,C as Q,D as W,E as X}from"./index-VXkmTHtp.js";import{C as Z}from"./ContenteditableBlock-uz2jl8LQ.js";import"./rangy-5rxgwlWZ.js";const tt={key:0,class:"tw-hidden group-hover:tw-block"},et={class:"smaller tw-flex tw-items-center tw-gap-2"},st={key:0},at={class:"icon userpic"},ot=["src"],nt={key:1,class:"tw-truncate"},lt={class:"tw-whitespace-nowrap opacity-60"},ct={key:2,class:"opacity-60"},it=$({__name:"TaskInfoChatItem",props:{message:{}},setup(k){const c=k,h=S(),i=B(),d=y(),u=y(!1),e=g(()=>c.message.contact_id===A.contact_id),l=g(()=>h.getItemById(c.message.contact_id)),v=async()=>{confirm("Are You sure?")&&await i.deleteItem(c.message)},r=async()=>{u.value=!0,await E(),d.value.focus()},p=async s=>{await i.updateItem(c.message,{comment:s})};return(s,a)=>{var w;return o(),n("div",{class:T(["tw-group tw-flex tw-gap-2",{"tw-justify-end":e.value}])},[e.value?(o(),n("div",tt,[t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:v},a[2]||(a[2]=[t("i",{class:"fas fa-trash-alt"},null,-1)])),t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:r},a[3]||(a[3]=[t("i",{class:"fas fa-edit"},null,-1)]))])):_("",!0),t("div",{class:T(["blank box rounded tw-flex-none tw-w-[80%] tw-flex tw-flex-col tw-gap-2",{"tw-bg-[var(--accent-color)] text-white":e.value}])},[x(Z,{ref_key:"contenteditableRef",ref:d,editable:u.value,focusable:!0,value:c.message.comment||"",tag:"div",class:"small",onBlur:a[0]||(a[0]=m=>u.value=!1),onUpdate:p,onKeydown:a[1]||(a[1]=R(L(m=>{var b,C;return(C=(b=m.target)==null?void 0:b.blur)==null?void 0:C.call(b)},["stop"]),["esc"]))},null,8,["editable","value"]),t("div",et,[l.value&&!e.value?(o(),n("div",st,[t("span",at,[t("img",{src:(w=l.value)==null?void 0:w.photo_url,alt:""},null,8,ot)])])):_("",!0),l.value&&!e.value?(o(),n("div",nt,f(l.value.name),1)):_("",!0),t("div",lt,f(M(j)(c.message.create_datetime).format("ll")),1),typeof c.message.id=="number"?(o(),n("div",ct,a[4]||(a[4]=[t("i",{class:"fas fa-check fa-xs"},null,-1)]))):_("",!0)])],2)],2)}}}),rt={class:"tw-flex tw-flex-col tw-h-full"},ut={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},dt={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},mt={class:"state-with-inner-icon right width-100"},pt=["placeholder"],ft=$({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(k,{emit:c}){const h=c,i=k,d=B(),u=y(),e=y(""),l=g(()=>d.getComentsByTaskId(i.taskId));I(()=>i.taskId,r=>O(r)&&d.fetch({item_id:r}),{immediate:!0}),I(l,async()=>{l.value.length&&(await E(),h("update"))},{immediate:!0}),K(()=>{u.value.focus()}),I(()=>i.taskId,()=>{u.value.focus()});const v=async()=>{if(!e.value)return;const r=await d.insert(i.taskId);r&&(d.updateItem(r,{comment:e.value}),e.value="",u.value.focus())};return(r,p)=>(o(),n("div",rt,[t("div",ut,[x(H,{name:"list"},{default:F(()=>[(o(!0),n(D,null,U(l.value,s=>(o(),Y(it,{key:s.uuid||s.id,message:s},null,8,["message"]))),128))]),_:1})]),t("div",dt,[t("div",mt,[q(t("input",{ref_key:"inputRef",ref:u,"onUpdate:modelValue":p[0]||(p[0]=s=>e.value=s),type:"text",placeholder:r.$t("Message"),class:"width-100 blank",onKeydown:R(v,["enter"])},null,40,pt),[[G,e.value,void 0,{trim:!0}]]),t("button",{class:"icon",onClick:v},p[1]||(p[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),_t={key:0,class:"tw-h-full tw-flex tw-flex-col"},vt={class:"pl-bg-block tw-flex-none custom-px-20 custom-pt-16"},wt={class:"hint"},ht={key:0,class:"custom-mb-12"},kt={class:"flexbox middle space-8 wrap",title:"{{ $t('Created by') }}"},yt={class:"wide"},gt={class:"small"},bt={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},xt={class:"custom-mb-12"},It={key:1,class:"custom-mb-12"},$t=["href"],Ct=["src"],Tt=["href"],St={class:"hint custom-ml-4"},Dt=$({__name:"TaskInfo",props:{taskId:{}},setup(k){const c=k,h=J(),i=y(),d=P(),u=S(),e=g(()=>d.getItemById(c.taskId)),l=g(()=>u.getItemById(e.value.contact_id));Q(document,"keydown",s=>{s.code==="Escape"&&v()});const v=()=>{var a;const s=(a=[...h.currentRoute.value.matched].reverse().find(w=>w.meta.isListView))==null?void 0:a.name;s?h.push({name:s}):console.error("Cant find back route")},r=()=>{setTimeout(()=>{i.value.scrollTo({top:i.value.scrollHeight})},100)};function p(s){return new URL(Object.assign({"../assets/apps/shop.svg":V,"../assets/apps/tasks.svg":z})[`../assets/apps/${s}.svg`],import.meta.url).href}return(s,a)=>{var w;return e.value?(o(),n("div",_t,[t("div",{class:"tw-flex-none custom-p-12"},[t("a",{class:"back larger",onClick:v},a[0]||(a[0]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t("div",vt,[t("h3",null,f(e.value.name),1),t("p",wt,f(s.$t("addNote")),1),l.value?(o(),n("div",ht,[t("div",kt,[t("span",{class:"icon userpic userpic-20",style:W({backgroundImage:`url(${l.value.photo_url})`})},null,4),t("span",yt,[t("span",gt,f(l.value.name),1),e.value.create_datetime?(o(),n("span",bt,f(M(X)(e.value.create_datetime)),1)):_("",!0)])])])):_("",!0),t("div",xt,[x(N,{task:e.value},null,8,["task"])]),(w=e.value.external_links)!=null&&w.length?(o(),n("div",It,[(o(!0),n(D,null,U(e.value.external_links,m=>(o(),n("div",{key:m.id},[t("a",{href:m.entity_link,class:"icon size-20",target:"_blank"},[t("img",{src:p(m.app)},null,8,Ct)],8,$t),t("a",{class:"custom-ml-4",href:m.entity_link},f(m.entity_title),9,Tt),t("span",St,f(m.app),1)]))),128))])):_("",!0)]),t("div",{ref_key:"containerRef",ref:i,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[x(ft,{"task-id":s.taskId,onUpdate:r},null,8,["task-id"])],512)])):_("",!0)}}});export{Dt as default};
