import{_ as Pe,t as ke,a as Fe,b as Be}from"./textToHtmlWithLinks-AZMVpaOO.js";import{r as S,ad as Ee,m as j,ae as B,d as L,a5 as Ne,c as P,af as Ue,o,e as c,n as H,t as b,j as _,k as Ae,L as O,g as w,f as m,K as z,A as pe,G as me,y as te,ag as J,ah as fe,a6 as be,ai as oe,aj as Re,ak as Oe,al as Ie,am as He,an as ze,ao as We,ap as je,aq as Ke,ar as qe,as as Ve,B as q,F as A,x as se,i as X,u as Qe,D as Te,a2 as Je,h as M,q as U,at as Ye,R as Xe,U as Ge,Q as Ze,au as et,av as ve,aw as le,p as tt,M as $e,s as st,w as W,ax as at,ay as xe,az as nt,l as ot,aA as lt,S as K,aB as it,aC as rt,aD as ut,H as ct,a8 as he,aE as _e}from"./index-xj7yyGP6.js";import{m as ie,g as ee,a as dt,s as ye}from"./sanitizer-qTkizPqY.js";import{_ as ft}from"./SortableList.vue_vue_type_style_index_0_lang-77U69H-H.js";function pt(s){const t=S([]),e=new Set;Ee(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),j(t,()=>{for(const[p]of e.entries())typeof p=="function"&&p(),e.delete(p)});const n=p=>{e.add(p)},l=p=>t.value.findIndex(h=>h.isEqualNode(p)),f=p=>t.value[l(p)-1],a=p=>t.value[l(p)+1],i=(p,h)=>{if(p){const u=a(p);if(u instanceof HTMLElement)return u.focus(),h&&ie(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},r=(p,h,u)=>{if(p.target instanceof HTMLElement){const v=p.target,T=ee(v),C=h==="up"?f(v):a(v);C instanceof HTMLElement&&(p.preventDefault(),C.focus(),dt(C,T),typeof u=="function"&&u())}};return{getPreviousElementSibling:f,getNextElementSibling:a,getCurrentPositionInNavigationList:l,focusNextTask:i,focusTaskById:(p,h)=>{const u=t.value.find(v=>{var T;return v instanceof HTMLElement&&((T=v.dataset)==null?void 0:T.id)==p});u instanceof HTMLElement&&(u.focus(),h&&ie(u))},onUp:(p,h)=>{r(p,"up",h)},onDown:(p,h)=>{r(p,"down",h)},onLeft:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===0){const v=f(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),ie(v),typeof h=="function"&&h())}}},onRight:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===u.innerText.length){const v=a(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),typeof h=="function"&&h())}}},nextUpdate:n}}const mt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},kt={class:"flexbox space-12 smaller empty:tw-hidden"},vt={key:2},ht=L({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Ne(),e=P(()=>Ue(s.task)),n=P(()=>({"text-red":e.value===3,"text-yellow":e.value===2,"text-green":e.value===1,grey:e.value===0}));return(l,f)=>{var a;return o(),c("div",kt,[l.task.due_datetime&&!l.task.status?(o(),c("div",{key:0,class:H(["semibold",n.value])},b(_(Ae)(l.task.due_datetime).format("LLL")),3)):l.task.due_date&&!l.task.status?(o(),c("div",{key:1,class:H(["semibold",n.value])},b(_(O)(l.task.due_date).format("LL")),3)):w("",!0),l.task.location_id?(o(),c("div",vt,[f[0]||(f[0]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),z(" "+b((a=_(t).getItemById(l.task.location_id))==null?void 0:a.name)+" "+b(_(mt)(_(t).distanceById(l.task.location_id))),1)])):w("",!0)])}}}),_t={class:"icon"},yt=["src"],gt=L({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=pe(),e=me(),n=P(()=>!t.currentRoute.value.params.listId),l=P(()=>s.task.list_id&&n.value?e.itemsMap[s.task.list_id]:null),f=()=>{if(!l.value)return;const a=t.resolve({name:"list",params:{listId:l.value.id}});window.open(a.href,"_blank")};return(a,i)=>(o(),c("div",{class:H(["flexbox middle",{"space-12":!a.isFocused}])},[a.isFocused?(o(),te(Pe,{key:0,task:a.task,input:a.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(o(),te(ht,{key:1,task:a.task},null,8,["task"])),l.value?(o(),c("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:f},[m("div",_t,[m("img",{src:l.value.icon_url,loading:"lazy"},null,8,yt)]),z(" "+b(l.value.name),1)])):w("",!0)],2))}}),Se=ze?window:void 0;function Z(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Y(...s){const t=[],e=()=>{t.forEach(i=>i()),t.length=0},n=(i,r,d,y)=>(i.addEventListener(r,d,y),()=>i.removeEventListener(r,d,y)),l=P(()=>{const i=oe(B(s[0])).filter(r=>r!=null);return i.every(r=>typeof r!="string")?i:void 0}),f=Re(()=>{var i,r;return[(r=(i=l.value)==null?void 0:i.map(d=>Z(d)))!=null?r:[Se].filter(d=>d!=null),oe(B(l.value?s[1]:s[0])),oe(_(l.value?s[2]:s[1])),B(l.value?s[3]:s[2])]},([i,r,d,y])=>{if(e(),!(i!=null&&i.length)||!(r!=null&&r.length)||!(d!=null&&d.length))return;const $=Oe(y)?{...y}:y;t.push(...i.flatMap(I=>r.flatMap(x=>d.map(p=>n(I,x,p,$)))))},{flush:"post"}),a=()=>{f(),e()};return Ie(e),a}let ge=!1;function we(s,t,e={}){const{window:n=Se,ignore:l=[],capture:f=!0,detectIframe:a=!1,controls:i=!1}=e;if(!n)return i?{stop:J,cancel:J,trigger:J}:J;if(fe&&!ge){ge=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(v=>Y(v,"click",J,u)),Y(n.document.documentElement,"click",J,u)}let r=!0;const d=u=>B(l).some(v=>{if(typeof v=="string")return Array.from(n.document.querySelectorAll(v)).some(T=>T===u.target||u.composedPath().includes(T));{const T=Z(v);return T&&(u.target===T||u.composedPath().includes(T))}});function y(u){const v=B(u);return v&&v.$.subTree.shapeFlag===16}function $(u,v){const T=B(u),C=T.$.subTree&&T.$.subTree.children;return C==null||!Array.isArray(C)?!1:C.some(V=>V.el===v.target||v.composedPath().includes(V.el))}const I=u=>{const v=Z(s);if(u.target!=null&&!(!(v instanceof Element)&&y(s)&&$(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(r=!d(u)),!r){r=!0;return}t(u)}};let x=!1;const p=[Y(n,"click",u=>{x||(x=!0,setTimeout(()=>{x=!1},0),I(u))},{passive:!0,capture:f}),Y(n,"pointerdown",u=>{const v=Z(s);r=!d(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),a&&Y(n,"blur",u=>{setTimeout(()=>{var v;const T=Z(s);((v=n.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(T!=null&&T.contains(n.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),h=()=>p.forEach(u=>u());return i?{stop:h,cancel:()=>{r=!1},trigger:u=>{r=!0,I(u),r=!1}}:h}const wt={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=we(s,t.value,{capture:e});else{const[n,l]=t.value;s.__onClickOutside_stop=we(s,n,Object.assign({capture:e},l))}},unmounted(s){s.__onClickOutside_stop()}};function re(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Le(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Le(e)}}function bt(s){const t=s||window.event,e=t.target;return Le(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const ue=new WeakMap;function It(s,t=!1){const e=be(t);let n=null,l="";j(He(s),i=>{const r=re(B(i));if(r){const d=r;if(ue.get(d)||ue.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(l=d.style.overflow),d.style.overflow==="hidden")return e.value=!0;if(e.value)return d.style.overflow="hidden"}},{immediate:!0});const f=()=>{const i=re(B(s));!i||e.value||(fe&&(n=Y(i,"touchmove",r=>{bt(r)},{passive:!1})),i.style.overflow="hidden",e.value=!0)},a=()=>{const i=re(B(s));!i||!e.value||(fe&&(n==null||n()),i.style.overflow=l,ue.delete(i),e.value=!1)};return Ie(a),P({get(){return e.value},set(i){i?f():a()}})}function Tt(){let s=!1;const t=be(!1);return(e,n)=>{if(t.value=n.value,s)return;s=!0;const l=It(e,n.value);j(t,f=>l.value=f)}}Tt();const $t=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},xt=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},St=We("syncError",()=>{const s=je(Ke(qe(()=>Ve.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Lt(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Ct={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Mt=["href"],Dt=["src"],Pt={class:"bold"},Ft={key:0,class:"hint custom-ml-4 nowrap"},Bt=["onClick"],Et=L({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=q(),e=n=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[n])};return(n,l)=>{var f;return(f=n.task.attachments)!=null&&f.length?(o(),c("div",Ct,[(o(!0),c(A,null,se(n.task.attachments,a=>(o(),c("div",{key:a.uuid||a.id,class:"pl-attachments__item small"},[m("a",{href:a.download_url,target:"_blank"},[a.preview_url?(o(),c("img",{key:0,src:a.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Dt)):(o(),c(A,{key:1},[m("span",Pt,b(a.file_name),1),a.size?(o(),c("span",Ft,b(_(Lt)(a.size)),1)):w("",!0)],64))],8,Mt),n.isFocused?(o(),c("div",{key:0,class:H(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":a.preview_url}])},[m("a",{class:H(a.preview_url?"button circle white":"custom-ml-8"),onClick:X(i=>e(a.id),["prevent"])},l[0]||(l[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,Bt)],2)):w("",!0)]))),128))])):w("",!0)}}}),ce=L({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Qe(),n=P(()=>e.getItemById(t.userId));return(l,f)=>{var a;return(a=n.value)!=null&&a.photo_url?(o(),c("span",{key:0,class:"icon userpic",style:Te({backgroundImage:`url(${n.value.photo_url})`})},null,4)):w("",!0)}}}),Nt={key:0,class:"tw-cursor-pointer"},Ut={key:0,class:"pl-list-item-firedBullet"},At={key:1,class:"tw-cursor-pointer"},Rt=L({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,n=t,l=S(e.task.status===1);j(()=>e.task.status,i=>{l.value=i===1});const f=P(()=>Je(e.task)),a=()=>{l.value=!l.value,n("complete")};return(i,r)=>(o(),c("div",{class:"tw-w-5 tw-flex-none",onClick:a},[M(Ge,{name:"bounce",mode:"out-in"},{default:U(()=>{var d;return[l.value?(o(),c("div",At,r[0]||(r[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(o(),c("div",Nt,[f.value===_(Ye)?(o(),c("div",Ut)):(o(),c("div",{key:1,class:"pl-list-item-bullet",style:Te(`background-color: ${(d=_(Xe).get(f.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),Ot=new WeakMap;function Ht(){const s=Ze(),t=pe(),e=()=>{var r;const f=[...s.matched].reverse().find(d=>{var y;return(y=d.meta)==null?void 0:y.isListView})||null,a=((r=f==null?void 0:f.children)==null?void 0:r.find(d=>{var y;return(y=d.meta)==null?void 0:y.isTaskInfoView}))||null,i={listViewRoute:f,taskInfoRoute:a};return Ot.set(s,i),i};return{navigateToTaskInfo:async l=>{const{listViewRoute:f,taskInfoRoute:a}=e();if(!f||!(a!=null&&a.name))return console.warn("Required routes not found"),!1;try{const i=await t.push({name:a.name,params:{taskId:l}});return!et(i)}catch(i){return console.error("Navigation failed:",i),!1}}}}const zt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Wt={class:"hint"},jt={class:"hint"},Kt={class:"hint"},qt={class:"tw-clear-both tw-inline-block"},Vt=["placeholder","data-id","innerHTML"],Qt=["innerHTML"],Jt={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Yt={key:0},Xt={key:1},Gt={key:2,class:"tw-flex-none"},Zt=["title"],es=["title"],ts={class:"bold small"},ss={key:5,class:"hint tw-flex-none custom-mt-2"},as={key:6,class:"hint tw-flex-none custom-mt-2"},ns={key:0},os={key:1},ls={key:7,class:"hint tw-flex-none custom-mt-2"},is={key:8,class:"flexbox middle tw-flex-none"},rs={key:9,class:"flexbox middle tw-flex-none"},us={key:10,class:"flexbox middle tw-flex-none"},cs={key:11,class:"flexbox middle space-4 tw-flex-none"},ds=["href"],fs=["src"],ps=L({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,n=t,l=q(),f=St(),{navigateToTaskInfo:a}=Ht(),i=ve(xe),r=ve(nt),d=S(!1),y=S(!1),$=S(e.task.name),I=S(e.task.status);j(()=>e.task.status,g=>{I.value=g});const x=S();let p=null;j(d,()=>{if(d.value)return;const g=x.value.innerText.trim();if(le(e.task)&&!g){y.value=!0,n("delete",e.task);return}e.task.name!==g&&n("update",e.task,{name:g})}),tt(()=>{le(e.task)&&(x.value.focus(),d.value=!0)}),$e(()=>{p&&(clearTimeout(p),p=null,h())});const h=()=>{n("complete",e.task)},u=()=>{I.value=I.value?0:1,x.value.classList.toggle("opacity-50"),!(p&&(clearTimeout(p),p=null,e.task.status===I.value))&&(p=setTimeout(h,1e3))},v=g=>{if(g.target instanceof HTMLAnchorElement){const k=g.target.href;g.preventDefault(),setTimeout(()=>{window.open(k,"_blank")})}},T=g=>{var R;g.preventDefault();const k=(R=g.clipboardData)==null?void 0:R.getData("text/plain");if(!k)return;if(x.value.innerText){document.execCommand("insertText",!1,k);return}const E=k.split(`
`).filter(N=>N);E.length&&n("insertMany",e.task,E.map(N=>({name:$t(N),...e.addableProps,...xt(N)?{status:1}:{}})))},C=g=>{ee(g.target)===0&&(i==null||i.onLeft(g),y.value=!0,n("delete",e.task))},V=async g=>{if(g.shiftKey)return;if(g.preventDefault(),e.isEnterDisabled){Q(!0),await ot(),n("insertFirst",{...e.addableProps});return}const k=g.target,E=k.innerText.trim(),R=ee(k);let N="",G=!0;R===0&&E||(k.innerText=E.substring(0,R).trim(),N=E.substring(R,E.length).trim(),G=!1),n("insert",e.task,{...e.addableProps,name:N},{isBefore:G}),Q()},ae=g=>{$.value=g.target.innerText},Q=(g=!1)=>{const k=()=>{x.value.blur(),d.value=!1};if(g){k();return}setTimeout(()=>{k()})},Me=()=>{n("update",e.task,{favorite:e.task.favorite?0:1})},ne=async g=>{g.target.closest("[contenteditable], .chips li, a")===null&&await a(e.task.id)};function De(g){return new URL(Object.assign({"../../assets/apps/shop.svg":Fe,"../../assets/apps/tasks.svg":Be})[`../../assets/apps/${g}.svg`],import.meta.url).href}return(g,k)=>{var E,R,N,G;return y.value?w("",!0):(o(),c("div",{key:0,class:H(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":g.$route.meta.isTaskInfoView&&((E=g.$route.params)==null?void 0:E.taskId)==e.task.id,highlighted:_(l).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(o(),c("div",zt,k[6]||(k[6]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):w("",!0),M(Rt,{task:e.task,onComplete:u},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:ne},[(R=_(r))!=null&&R.is_debug_mode?(o(),c(A,{key:0},[m("span",Wt,"list_id: "+b(String(e.task.list_id)),1),k[7]||(k[7]=z(" | ")),m("span",jt,"id: "+b(e.task.id),1),k[8]||(k[8]=z(" | ")),m("span",Kt,"srank: "+b(String(e.task.sort))+" | "+b(String(e.task.rank)),1)],64)):w("",!0),st((o(),c("div",null,[m("div",qt,[m("div",{ref_key:"contenteditableRef",ref:x,contenteditable:"",class:H(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(V,["enter"]),k[0]||(k[0]=W(D=>{var F;(F=_(i))==null||F.onLeft(D,()=>{d.value=!1})},["left"])),k[1]||(k[1]=W(D=>{var F;(F=_(i))==null||F.onUp(D,()=>{d.value=!1})},["up"])),k[2]||(k[2]=W(D=>{var F;(F=_(i))==null||F.onRight(D,()=>{d.value=!1})},["right"])),k[3]||(k[3]=W(D=>{var F;(F=_(i))==null||F.onDown(D,()=>{d.value=!1})},["down"])),W(C,["delete"]),W(Q,["esc"]),k[4]||(k[4]=W(()=>{d.value=!1},["tab"]))],onMousedown:v,onFocus:k[5]||(k[5]=D=>d.value=!0),onPaste:T,onInput:ae,innerHTML:_(ye)(d.value?e.task.name:_(ke)(e.task.name))},null,42,Vt)]),e.task.note?(o(),c("div",{key:0,class:"hint tw-break-all tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(ye)(_(ke)(e.task.note))},null,8,Qt)):w("",!0),M(gt,{task:g.task,input:$.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[_(wt),()=>{d.value=!1}]]),M(Et,{task:e.task,"is-focused":d.value},null,8,["task","is-focused"])]),m("div",Jt,[e.showInfoLink?(o(),c("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:X(ne,["prevent"])},k[9]||(k[9]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):w("",!0),I.value?w("",!0):(o(),c("div",{key:1,class:H(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:Me},[e.task.favorite?(o(),c("span",Yt,k[10]||(k[10]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(o(),c("span",Xt,k[11]||(k[11]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(f).taskErrorMap.get(e.task.id)?(o(),c("div",Gt,[m("span",{class:"icon",style:{color:"orange"},title:_(f).taskErrorMap.get(e.task.id)},k[12]||(k[12]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,Zt)])):w("",!0),!_(at)(e.task)&&!_(le)(e.task)?(o(),c("div",{key:3,class:"tw-flex-none",title:g.$t("syncing")},k[13]||(k[13]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,es)):w("",!0),(N=e.task.extended_data)!=null&&N.comments_count?(o(),c("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:X(ne,["prevent"])},[k[14]||(k[14]=m("i",{class:"fas fa-comment"},null,-1)),m("span",ts,b(e.task.extended_data.comments_count),1)])):w("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(o(),c("div",ss,b(_(O)().to(_(O)(e.task.create_datetime),!0)),1)):w("",!0),!I.value&&e.task.assigned_contact_id?(o(),c("div",as,[e.task.update_datetime?(o(),c("span",ns,b(_(O)().to(_(O)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(o(),c("span",os,b(_(O)().to(_(O)(e.task.create_datetime),!0)),1)):w("",!0)])):w("",!0),e.task.complete_datetime?(o(),c("div",ls,b(_(O)().to(_(O)(e.task.complete_datetime),!0)),1)):w("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.contact_id?(o(),c("div",is,[M(ce,{"user-id":e.task.contact_id},null,8,["user-id"])])):w("",!0),!I.value&&e.task.assigned_contact_id?(o(),c("div",rs,[M(ce,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):w("",!0),I.value&&e.task.complete_contact_id?(o(),c("div",us,[M(ce,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):w("",!0),(G=e.task.external_links)!=null&&G.length?(o(),c("div",cs,[(o(!0),c(A,null,se(e.task.external_links,D=>(o(),c("a",{key:D.id,href:D.entity_link,class:"icon size-20",target:"_blank"},[m("img",{src:De(D.app)},null,8,fs)],8,ds))),128))])):w("",!0)])],2))}}}),ms=L({__name:"ListNavigationProvider",setup(s){const t=S();return lt(xe,pt(t)),(e,n)=>(o(),c("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[K(e.$slots,"default")],512))}}),ks=L({__name:"TaskListItemStoreProvider",setup(s){const t=q(),e=r=>t.completeTask(r),n=(r,d)=>t.updateItem(r,d),l=async(r,d,y)=>{await t.insert(y.isBefore?"before":"after",r,{...d})},f=async(r,d)=>{await t.insertMany(r,d)},a=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},i=async r=>{await t.deleteItem(r)};return(r,d)=>K(r.$slots,"default",{onComplete:e,onUpdate:n,onInsert:l,onInsertMany:f,onInsertFirst:a,onDelete:i})}}),vs=L({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,n=t,l=S(null),{stop:f}=it(l,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"200px"});return $e(()=>{f()}),(a,i)=>(o(),c("div",{ref_key:"elRef",ref:l},[K(a.$slots,"default")],512))}}),hs={key:0,class:"skeleton custom-m-24"},_s={key:0},ys={class:"box custom-py-24 small align-center gray"},de=30,gs=L({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=q(),n=me(),l=ut(),f=S(de),a=S([]),i=S(!1),r=S(0),d=S(!1),y=P(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:a.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),$=P(()=>y.value.source.slice(0,f.value));j(()=>t,()=>{f.value=de,x()},{deep:!0,immediate:!0});const I=()=>{var h;((h=y.value.source)==null?void 0:h.length)>$.value.length&&(f.value+=de)};async function x(){const{isFetchStream:h,fetchParams:u,disableCheckin:v}=y.value;if(!u||!p(u))return;if(i.value=!1,a.value=[],t.filter==="list"){const C=l.task.value.get(JSON.stringify({list_id:t.listId})),V=l.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ae=l.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),Q=C||V;if(Q)if(t.shouldFilterUncompleted){if(ae)return}else delete u.status,u.starting_from=rt(new Date(Q))}if(r.value=8,t.filter==="list"){const C=n.getItemById(t.listId);r.value=C==null?void 0:C.extended_data.items_count}d.value=!l.task.value.get(JSON.stringify(y.value.fetchParams))&&("status"in y.value.fetchParams?y.value.fetchParams.status!=="0":!0);const T=await e[h?"fetchStream":"fetch"]({...u},{disableCheckin:v});d.value=!1,T&&T.value&&T.value.status_code==="ok"&&t.filter==="search"&&(a.value=[...a.value,...T.value.data],i.value=!a.value.length)}function p(h){return!(!h||h.list_id&&typeof h.list_id!="number"||h.location_id&&typeof h.location_id!="number")}return(h,u)=>d.value?(o(),c("div",hs,[(o(!0),c(A,null,se(r.value,v=>(o(),c("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(o(),c(A,{key:1},[K(h.$slots,"default",{tasks:$.value}),t.filter==="search"&&i.value?(o(),c("div",_s,[m("p",ys,[z(b(h.$t("searchNoMatches"))+" ",1),m("strong",null,b(t.searchQuery),1)])])):w("",!0),(o(),te(vs,{key:h.$route.fullPath,onIntersecting:I}))],64))}}),ws=L({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=q(),n=pe();j(n.currentRoute,async f=>{const a={...f.query};"addNewTask"in a&&(await l(),delete a.addNewTask,n.replace({path:f.path,query:a}))},{immediate:!0});async function l(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(f,a)=>(o(),c("div",{class:"text-gray pl-list-item-title",onClick:l},[a[0]||(a[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),z(" "+b(f.$t("newToDo")),1)]))}}),bs={class:"dialog-header"},Is={class:"dialog-content empty:tw-hidden"},Ts={class:"dialog-footer tw-flex tw-gap-2"},Ce=L({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(t,e)=>(o(),c(A,null,[m("header",bs,[m("h3",null,b(t.$props.title),1),t.hideCloseIcon?w("",!0):(o(),c("a",{key:0,class:"dialog-close",onClick:e[0]||(e[0]=X(n=>t.$emit("close"),["prevent"]))},e[2]||(e[2]=[m("i",{class:"fas fa-times"},null,-1)])))]),m("div",Is,[K(t.$slots,"default")]),m("footer",Ts,[K(t.$slots,"submit"),t.hideCloseButton?w("",!0):(o(),c("button",{key:0,class:"button light-gray",onClick:e[1]||(e[1]=n=>t.$emit("close"))}," Close "))])],64))}}),$s=L({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(o(),te(Ce,{title:t.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...n)=>t.onDelete&&t.onDelete(...n))}," Delete ")]),default:U(()=>[z(b(t.text)+" ",1)]),_:1},8,["title"]))}}),xs={class:"tw-w-68"},Ss={class:"menu"},Ls={href:"javascript:void(0);"},Cs={class:"menu"},Ms=["onClick"],Ds=["disabled"],Ps=L({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=ct(),e=me(),n=S(),l=()=>{n.value&&s.onMove(n.value)};return(f,a)=>(o(),te(Ce,{title:f.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{disabled:!n.value,onClick:X(l,["prevent"])}," Move ",8,Ds)]),default:U(()=>[m("div",xs,[m("ul",Ss,[(o(!0),c(A,null,se(_(t).items,i=>(o(),c("li",{key:i.uuid||i.id},[m("a",Ls,b(i.name),1),m("ul",Cs,[(o(!0),c(A,null,se(_(e).getListsInPocket(i.id),r=>(o(),c("li",{key:r.uuid||r.id,class:H(n.value===r.id&&"selected rounded")},[m("a",{href:"#",onClick:X(()=>{n.value=n.value===r.id?void 0:r.id},["prevent"])},b(r.name),9,Ms)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Fs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Bs={class:"hint"},Es={class:"hint"},Ns=L({__name:"TaskListMultiselect",setup(s){const t=q(),e=S(new Set),{show:n,hide:l}=he($s,{title:"Delete",text:_e(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),l()}}),{show:f,hide:a}=he(Ps,{title:"Move Items",text:_e(()=>`Delete ${e.value.size} selected items?`),onMove:async $=>{await t.sort($,null,[...e.value]),e.value.clear(),a()}}),i=$=>{e.value.add($)},r=$=>{e.value.delete($)},d=()=>{f()},y=()=>{n()};return($,I)=>(o(),c(A,null,[e.value.size?(o(),c("div",Fs,[m("button",{class:"button light-gray smaller",onClick:d},[I[0]||(I[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),z(" "+b($.$t("Move"))+" ",1),m("span",Bs,b(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:y},[I[1]||(I[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),z(" "+b($.$t("Delete"))+" ",1),m("span",Es,b(e.value.size),1)])])):w("",!0),K($.$slots,"default",{onSelect:i,onDeselect:r})],64))}}),Us={class:"pl-bg-block custom-pb-4"},As={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Rs={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Os={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},Hs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},qs=L({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=q(),n=P(()=>t.filter!=="list");return(l,f)=>(o(),c("div",Us,[t.header?(o(),c("div",As,[m("h1",null,b(t.header),1)])):w("",!0),M(ms,null,{default:U(()=>[M(gs,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:U(({tasks:a})=>[!a.length&&t.startMessage&&_(e).isPreFilled?(o(),c("div",Rs,b(t.startMessage),1)):w("",!0),t.hideAddNewTask?w("",!0):(o(),c("div",Os,[M(ws,{"addable-props":t.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])])),l.shouldFilterUncompleted&&!l.hideUncompletedLabel&&a.length?(o(),c("div",Hs,b(l.$t("completed")),1)):w("",!0),M(Ns,null,{default:U(({onSelect:i,onDeselect:r})=>[M(ft,{items:a,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:i,onDeselect:r},{default:U(({item:d})=>[M(ks,null,{default:U(({onUpdate:y,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u})=>[M(ps,{task:d,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:y,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{qs as _,Ce as a};
