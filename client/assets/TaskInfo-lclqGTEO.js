import{d as k,u as I,a as x,r as p,o as m,c as w,b as e,w as g,e as y,f as T,t as v,g as h,h as C,i as S,F as b,j as $,k as _,l as B,m as R,v as V,n as N,p as U,q as D,s as M,x as E,y as A}from"./index-Rdm4BGM5.js";import{C as F}from"./ContenteditableBlock-EBrVyF2k.js";import"./rangy-5rxgwlWZ.js";const K={class:"tw-flex tw-flex-col tw-gap-2 blank box rounded tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},L={class:"tw-flex tw-gap-2"},W={class:"tw-truncate smaller"},j={class:"gray"},q={class:"gray"},H=k({__name:"TaskInfoChatItem",props:{message:{}},setup(f){const s=f,c=I(),i=x(),a=p(!1),o=()=>{i.deleteItem(s.message)},t=r=>{i.updateItem(s.message,{comment:r})};return(r,l)=>{var n;return m(),w(b,null,[e("div",K,[e("div",L,[e("a",{onClick:g(o,["prevent"])},l[1]||(l[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:l[0]||(l[0]=g(u=>a.value=!0,["prevent"]))},l[2]||(l[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),y(F,{editable:a.value,focusable:!0,value:s.message.comment,tag:"div",onUpdate:t},null,8,["editable","value"])]),e("div",W,[T(v((n=h(c).getItemById(s.message.contact_id))==null?void 0:n.name)+" ",1),e("span",j,v(h(C)(h(S)(s.message)).format("ll")),1),e("span",q,v(typeof s.message.id=="number"?"delivered":"not delivered"),1)])],64)}}}),P={class:"tw-flex tw-flex-col tw-h-full"},z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},G={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},J={class:"state-with-inner-icon right width-100"},O=k({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(f,{emit:s}){const c=s,i=f,a=x(),o=p(),t=p(""),r=$(()=>a.getComentsByTaskId(i.taskId));_(()=>i.taskId,n=>U(n)&&a.fetch({item_id:n}),{immediate:!0}),_(r,async()=>{r.value.length&&(await D(),c("update"))},{immediate:!0});const l=async()=>{const n=await a.insert(i.taskId);n&&(a.updateItem(n,{comment:t.value}),t.value="",o.value.focus())};return(n,u)=>(m(),w("div",P,[e("div",z,[(m(!0),w(b,null,B(r.value,d=>(m(),M(H,{key:d.uuid||d.id,message:d},null,8,["message"]))),128))]),e("div",G,[e("div",J,[R(e("input",{ref_key:"inputRef",ref:o,"onUpdate:modelValue":u[0]||(u[0]=d=>t.value=d),type:"text",placeholder:"Type a message",class:"width-100 blank",onKeydown:N(l,["enter"])},null,544),[[V,t.value]]),e("button",{class:"icon",onClick:l},u[1]||(u[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),Q={class:"tw-h-full tw-flex tw-flex-col"},ee=k({__name:"TaskInfo",props:{taskId:{}},setup(f){const s=E(),c=p(),i=()=>{setTimeout(()=>{c.value.scrollTo({top:c.value.scrollHeight})},100)},a=()=>{var t;const o=(t=[...s.currentRoute.value.matched].reverse().find(r=>r.meta.isListView))==null?void 0:t.name;o?s.push({name:o}):console.error("Cant find back route")};return(o,t)=>(m(),w("div",Q,[e("div",{class:"tw-flex-none custom-p-12"},[e("a",{class:"back larger",onClick:a},t[0]||(t[0]=[e("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t[1]||(t[1]=A('<div class="tw-flex-none custom-px-12"><h3 class="custom-my-0"> taskname </h3><ul class="chips smaller"><li><a href="#">When</a></li><li><a href="#">Where</a></li><li><a href="#">Priority</a></li><li><a href="#">Assign</a></li><li><a href="#">Attach</a></li><li><a href="#">Tags</a></li></ul><p class="hint custom-mt-0"> note / sublist / created / updated / last actor / more </p></div>',1)),e("div",{ref_key:"containerRef",ref:c,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[y(O,{"task-id":o.taskId,onUpdate:i},null,8,["task-id"])],512)]))}});export{ee as default};
