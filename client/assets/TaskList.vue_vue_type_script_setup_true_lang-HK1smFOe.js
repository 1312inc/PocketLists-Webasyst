import{ad as ne,d as P,ae as K,o as c,x as N,l as L,A as R,b as t,e as w,S as B,af as Y,_ as se,w as E,ag as oe,a6 as ae,c as b,J as V,t as $,f as le,a0 as ie,N as re,a9 as de,aa as ue,X as O,ah as W,ai as me,r as h,k as q,aj as U,K as fe,F as Z,D as F,n as S,h as M,ak as pe,i as ee,q as te,al as ce,am as ve,H as ke,j,an as z,B as we,s as ge,ao as _e,ap as ye}from"./index-dkudGc25.js";import{m as A,g as H,s as J}from"./rangy-5rxgwlWZ.js";import{_ as be}from"./SortableList.vue_vue_type_style_index_0_lang-_d_xV-KO.js";function Le(g){let a=[];ne(g,()=>{g.value&&(a=[...g.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=o=>a.findIndex(m=>m.isEqualNode(o)),s=o=>a[e(o)-1],n=o=>a[e(o)+1],i=(o,m)=>{if(o){const p=n(o);if(p instanceof HTMLElement)return p.focus(),m&&A(p),p}else{const p=a[0];p instanceof HTMLElement&&p.focus()}},u=(o,m)=>{if(o.target instanceof HTMLElement){const p=o.target,_=H(p),f=m==="up"?s(p):n(p);f instanceof HTMLElement&&(o.preventDefault(),f.focus(),J(f,_))}};return{getPreviousElementSibling:s,getNextElementSibling:n,getCurrentPositionInNavigationList:e,focusNextTask:i,focusTaskById:o=>{const m=a.find(p=>{var _;return p instanceof HTMLElement&&((_=p.dataset)==null?void 0:_.id)==o});m instanceof HTMLElement&&m.focus()},onUp:o=>{u(o,"up")},onDown:o=>{u(o,"down")},onLeft:(o,m)=>{if(o.target instanceof HTMLElement){const p=o.target;if(H(p)===0){const _=s(p);_ instanceof HTMLElement&&(o.preventDefault(),m&&(_.innerText+=m),_.focus(),A(_),m&&J(_,_.innerText.length-m.length))}}},onRight:o=>{if(o.target instanceof HTMLElement){const m=o.target;if(H(m)===m.innerText.length){const p=n(m);p instanceof HTMLElement&&(o.preventDefault(),p.focus())}}}}}const Te={class:"menu"},Ce=P({__name:"PopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=K(g,"modelValue"),e=s=>{a.value=s};return(s,n)=>(c(),N(Y,null,{default:L(({handler:i,setRef:u})=>[R(s.$slots,"default",{handler:i,setRef:u},void 0,!0)]),body:L(()=>[t("ul",Te,[t("li",null,[t("a",{onClick:n[0]||(n[0]=i=>e(w(B)().startOf("day").format()))}," Today ")]),t("li",null,[t("a",{onClick:n[1]||(n[1]=i=>e(w(B)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),t("li",null,[t("a",{onClick:n[2]||(n[2]=i=>e(w(B)().add(2,"day").startOf("day").format()))}," In 2 days ")]),t("li",null,[t("a",{onClick:n[3]||(n[3]=i=>e(w(B)().endOf("week").startOf("day").format()))}," This weekend ")]),n[4]||(n[4]=t("li",null,null,-1))])]),_:3}))}}),xe=se(Ce,[["__scopeId","data-v-ba661900"]]),$e={class:"menu"},Ve=P({__name:"PopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=K(g,"modelValue");return(e,s)=>(c(),N(Y,null,{default:L(({handler:n,setRef:i})=>[R(e.$slots,"default",{handler:n,setRef:i})]),body:L(()=>[t("ul",$e,[t("li",null,[t("a",{onClick:s[0]||(s[0]=E(n=>a.value=0,["prevent"]))},s[3]||(s[3]=[t("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),t("span",null,"Without priority",-1)]))]),t("li",null,[t("a",{onClick:s[1]||(s[1]=E(n=>a.value=1,["prevent"]))},s[4]||(s[4]=[t("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),t("span",null,"Normal",-1)]))]),t("li",null,[t("a",{onClick:s[2]||(s[2]=E(n=>a.value=2,["prevent"]))},s[5]||(s[5]=[t("i",{class:"fas fa-star",style:{color:"red"}},null,-1),t("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Me={key:1},Ee={key:2},Ie=["onClick"],Pe={key:4},Se=["onClick"],Ne=P({__name:"PopupMenu",props:oe({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const a=g,e=K(g,"modelValue"),s=ae(null);{const n=de(()=>ue(()=>import("./PopupMenuWhere-YOGOH4iJ.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));s.value=n}return(n,i)=>(c(),b("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:i[3]||(i[3]=E(()=>{},["prevent"]))},[a.isFocused?(c(),N(xe,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":i[0]||(i[0]=u=>e.value.due_date=u)},{default:L(({handler:u,setRef:y})=>[t("a",{ref:y,onClick:E(u,["prevent"])},i[4]||(i[4]=[t("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):V("",!0),e.value.due_datetime?(c(),b("div",Me,$(w(le)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(c(),b("div",Ee,$(w(B)(e.value.due_date).format("LL")),1)):V("",!0),a.isFocused||e.value.priority?(c(),N(Ve,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":i[1]||(i[1]=u=>e.value.priority=u)},{default:L(({handler:u,setRef:y})=>[t("a",{ref:y,style:ie(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:E(u,["prevent"])},i[5]||(i[5]=[t("i",{class:"fas fa-star"},null,-1)]),12,Ie)]),_:1},8,["modelValue"])):V("",!0),e.value.location_id?(c(),b("div",Pe," Location: "+$(e.value.location_id),1)):V("",!0),a.isFocused&&s.value?(c(),N(re(s.value),{key:5,modelValue:e.value.location_id,"onUpdate:modelValue":i[2]||(i[2]=u=>e.value.location_id=u)},{default:L(({handler:u,setRef:y})=>[t("a",{ref:y,onClick:E(u,["prevent"])},i[6]||(i[6]=[t("i",{class:"fas fa-map-pin"},null,-1)]),8,Se)]),_:1},8,["modelValue"])):V("",!0)],32))}}),Be={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},He={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},he={class:"tw-flex-auto"},Ue={class:"hint"},Re={class:"hint"},Fe={class:"hint"},Oe=["contenteditable","placeholder","data-id","textContent"],qe={key:1},X=P({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{}},emits:["delete","update","insert","blur","complete"],setup(g,{emit:a}){const e=g,s=a,n=O(W),i=O(me),u=h(!1);let y=!1,d={name:e.task.name,due_date:e.task.due_date,due_datetime:e.task.due_datetime,priority:e.task.priority,location_id:e.task.location_id};const r=h({...d});let k;q([()=>e.task,()=>e.addableProps],async([f])=>{k&&k(),d=U.pick(f,Object.keys(d)),r.value={...d},k=q(r,async()=>{const l=U.reduce(r.value,(T,D,v)=>U.isEqual(D,d[v])?T:[...T,v],[]);l.length&&s("update",e.task,U.pick(r.value,l))},{deep:!0})},{immediate:!0});const I=async f=>{y||(f.target instanceof HTMLElement&&(f.target.innerText=f.target.innerText.trim(),r.value.name=f.target.innerText),s("blur",e.task,r.value))},o=f=>{var T;f.preventDefault();const l=(T=f.clipboardData)==null?void 0:T.getData("text/plain");l&&document.execCommand("insertText",!1,l)},m=f=>{f.target instanceof HTMLElement&&H(f.target)===0&&(y=!0,n==null||n.onLeft(f,f.target.innerText.trim()),s("delete",e.task,r.value))},p=async f=>{if(f.preventDefault(),f.target instanceof HTMLElement){const l=f.target,T=l.innerText.trim(),D=H(l),v={};D!==0&&(v.currentName=T.substring(0,D).trim(),v.newName=T.substring(D,T.length).trim(),l.innerText=v.currentName),s("insert",e.task,{...r.value,...e.addableProps},v)}},_=()=>{s("complete",e.task,r.value)};return(f,l)=>{var T,D;return c(),b("div",Be,[e.sortable?(c(),b("div",He,l[7]||(l[7]=[t("i",{class:"fas fa-grip-vertical"},null,-1)]))):V("",!0),t("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:_},[t("div",{class:fe(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),t("div",he,[(T=w(i))!=null&&T.is_debug_mode?(c(),b(Z,{key:0},[t("span",Ue,"id: "+$(e.task.id),1),l[8]||(l[8]=F(" | ")),t("span",Re,"prev_id: "+$(String(e.task.prev_item_id)),1),l[9]||(l[9]=F(" | ")),t("span",Fe,"srank: "+$(String(e.task.sort))+" | "+$(String(e.task.rank)),1)],64)):V("",!0),t("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[S(p,["enter"]),l[0]||(l[0]=S((...v)=>{var C,x;return((C=w(n))==null?void 0:C.onLeft)&&((x=w(n))==null?void 0:x.onLeft(...v))},["left"])),l[1]||(l[1]=S((...v)=>{var C,x;return((C=w(n))==null?void 0:C.onUp)&&((x=w(n))==null?void 0:x.onUp(...v))},["up"])),l[2]||(l[2]=S((...v)=>{var C,x;return((C=w(n))==null?void 0:C.onRight)&&((x=w(n))==null?void 0:x.onRight(...v))},["right"])),l[3]||(l[3]=S((...v)=>{var C,x;return((C=w(n))==null?void 0:C.onDown)&&((x=w(n))==null?void 0:x.onDown(...v))},["down"])),S(m,["delete"])],onBlur:I,onFocus:l[4]||(l[4]=v=>u.value=!0),onFocusout:l[5]||(l[5]=v=>u.value=!1),onPaste:o,textContent:$(e.task.name)},null,40,Oe),M(Ne,{modelValue:r.value,"onUpdate:modelValue":l[6]||(l[6]=v=>r.value=v),"is-focused":u.value},null,8,["modelValue","is-focused"])]),(D=e.task.extended_data)!=null&&D.comments_count?(c(),b("div",qe,[l[10]||(l[10]=t("i",{class:"far fa-comment"},null,-1)),F(" "+$(e.task.extended_data.comments_count),1)])):V("",!0)])}}}),G=P({__name:"ListNavigationProvider",setup(g){const a=h();return pe(W,Le(a)),(e,s)=>(c(),b("div",{ref_key:"navigatableRef",ref:a},[R(e.$slots,"default")],512))}}),Q=P({__name:"TaskListItemStoreProvider",setup(g){const a=O(W),e=ee(),s=d=>e.completeTask(d),n=(d,r)=>e.updateItem(d,r),i=async(d,r,k)=>{if(!k.currentName)await e.insert("before",r,d.list_id,d.id);else{const I=await e.insert("after",{...r,name:k.newName},d.list_id,d.id);await te(),I&&(a==null||a.focusTaskById(I.id))}},u=d=>e.deleteItem(d),y=d=>{ce(d)&&(d.name?e.updateItem(d,{client_touch_datetime:ve()}):e.deleteItem(d))};return(d,r)=>R(d.$slots,"default",{onComplete:s,onUpdate:n,onInsert:i,onDelete:u,onBlur:y})}}),Ke={key:0,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6 align-center"},We={key:0,class:"lg:tw-hidden tw-mb-4"},je={class:"tw-m-0"},ze={class:"tw-my-6"},Ae={key:1,class:"tw-flex tw-flex-col"},Qe=P({__name:"TaskList",props:{items:{},addableProps:{},sortableListId:{},isFetching:{type:Boolean}},setup(g){const a=g,e=ke(),s=ee(),n=h(),i=h(!1),u=j(()=>a.items.filter(r=>_e(r))),y=j(()=>a.items.filter(r=>ye(r))),d=async()=>{await s.insertDummy({...a.addableProps}),await te();const r=document.querySelector(`[contenteditable][data-id="${u.value[0].id}"]`);r instanceof HTMLElement&&r.focus()};return q(z.currentRoute,r=>{const k={...r.query};"addNewTask"in k&&(d(),delete k.addNewTask,z.replace({path:r.path,query:k}))},{immediate:!0}),(r,k)=>{const I=we("RouterLink");return a.isFetching?(c(),b("div",Ke,k[1]||(k[1]=[t("div",{class:"spinner custom-p-16"},null,-1)]))):(c(),b("div",{key:1,ref_key:"navigatableRef",ref:n,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},[a.sortableListId?(c(),b("div",We,[M(I,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:L(()=>{var o;return[k[2]||(k[2]=t("i",{class:"fas fa-chevron-left gray"},null,-1)),t("h3",je,$((o=w(e).getItemById(a.sortableListId))==null?void 0:o.name),1)]}),_:1})])):V("",!0),t("div",{class:"tw-mb-4",onClick:d}," + New To-Do "),M(G,null,{default:L(()=>[M(be,{"sortable-list-id":a.sortableListId,"sortable-group-name":"tasks",items:u.value,onSort:w(s).sort},{default:L(({item:o})=>[M(Q,null,{default:L(({onUpdate:m,onComplete:p,onInsert:_,onDelete:f,onBlur:l})=>[M(X,{task:o,sortable:!!a.sortableListId,editable:!0,"addable-props":a.addableProps,onUpdate:m,onComplete:p,onInsert:_,onDelete:f,onBlur:l},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onDelete","onBlur"])]),_:2},1024)]),_:1},8,["sortable-list-id","items","onSort"])]),_:1}),t("div",ze,[t("a",{class:"gray",onClick:k[0]||(k[0]=E(o=>i.value=!i.value,["prevent"]))},"Completed ("+$(y.value.length)+")",1)]),i.value?(c(),b("div",Ae,[M(G,null,{default:L(()=>[M(Q,null,{default:L(({onComplete:o})=>[(c(!0),b(Z,null,ge(y.value,m=>(c(),N(X,{key:m.uuid||m.id,task:m,onComplete:o},null,8,["task","onComplete"]))),128))]),_:1})]),_:1})])):V("",!0)],512))}}});export{Qe as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./PopupMenuWhere-YOGOH4iJ.js","./index-dkudGc25.js","./index-3GJYBzeD.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-iaaYSdsN.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
