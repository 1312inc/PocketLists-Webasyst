import{h as w,r as k,G as M,L as y,o as c,j as d,M as P,N as $,u as R,E as H,B as z,D as V,v as x,k as s,O as N,q as p,z as K,w as b,I as C,t as g,m as f,P as S,Q as O,R as I,H as q,S as F,F as h,s as U,C as j}from"./index-j-63ksNh.js";import{C as D}from"./ContenteditableBlock-ythY3w3H.js";import{u as G,p as J,_ as Q}from"./SortableList.vue_vue_type_style_index_0_lang-2a9FQtli.js";import{_ as W}from"./SearchForm.vue_vue_type_script_setup_true_lang-6FugIpWV.js";import"./rangy-5rxgwlWZ.js";const Y=w({__name:"WaDropOnElement",props:{draggableEntityName:{}},emits:["drop"],setup(_,{emit:o}){const t=o,r=_,a=k(),{getDraggingEntityName:u}=G();return M(()=>{y(a,"dragenter",e=>{r.draggableEntityName===u()&&e.currentTarget instanceof HTMLElement&&e.currentTarget.classList.add("dragover")}),y(a,"dragleave",e=>{if(e.currentTarget instanceof HTMLElement){if(e.relatedTarget&&e.currentTarget.contains(e.relatedTarget))return;e.currentTarget.classList.remove("dragover")}}),y(a,"dragover",e=>{e.preventDefault()}),y(a,"drop",e=>{if(r.draggableEntityName===u()&&e.currentTarget instanceof HTMLElement&&(e.preventDefault(),e.currentTarget.classList.remove("dragover"),e.dataTransfer))try{const l=JSON.parse(e.dataTransfer.getData("text/plain")).taskIds;t("drop",l)}catch{}})}),(e,l)=>(c(),d("div",{ref_key:"menuItemElementRef",ref:a},[P(e.$slots,"default")],512))}}),A={class:"image sortable-handle"},X={class:"details"},Z={class:"tablebox"},ee={class:"count align-right tw-flex tw-gap-1"},te={key:0,class:"hint tw-flex"},se={class:"tw-w-14 tw-truncate"},ae=w({__name:"ListsListItem",props:{item:{}},setup(_,{expose:o}){const t=_,r=$(),a=R(),u=H(),e=k(),l=k(!1);o({focus:L});const T=async i=>{l.value=!1,await r.updateItemName(t.item,i)},m=async i=>{await a.sort(t.item.id,null,i)},n=async i=>{i.target instanceof HTMLElement&&i.target.innerText&&u.push({name:"list",params:{id:t.item.id},query:{addNewTask:1}})};async function L(){l.value=!0,await z(),e.value.focus()}return(i,E)=>(c(),V(Y,{"draggable-entity-name":"tasks",onDrop:m},{default:x(()=>{var v;return[s("a",A,[s("i",{class:"userpic userpic32",style:N(`background-image: url(${t.item.icon_url||"/wa-apps/pocketlists/img/listicons/li-list@2x.png"})`)},null,4)]),s("a",X,[s("div",Z,[p(D,{ref_key:"contenteditableBlockRef",ref:e,value:i.item.name,editable:l.value,focusable:!0,placeholder:"New list",tag:"strong",onUpdate:T,onKeydown:K(b(n,["prevent"]),["enter"])},null,8,["value","editable","onKeydown"]),s("span",ee,[C(g(t.item.extended_data.items_count>0?t.item.extended_data.items_count:0)+" ",1),t.item.extended_data.items_priority_count?(c(),d("span",{key:0,class:"badge",style:N(`background-color: ${(v=f(J).get(t.item.extended_data.items_priority_value))==null?void 0:v.color}`)},g(t.item.extended_data.items_priority_count),5)):S("",!0)])]),f(O).is_debug_mode?(c(),d("p",te,[s("span",se,"id: "+g(t.item.id),1),C(" | srank: "+g(t.item.sort)+" | "+g(t.item.rank),1)])):S("",!0)])]}),_:1}))}}),ne={class:"heading black custom-m-0 custom-mb-8"},oe={class:"pl-bg-block"},re={key:0,class:"custom-px-16 custom-py-12 gray"},ie=w({__name:"ListsList",props:{pocket:{}},setup(_){const o=_,t=I(),r=$(),a=k(!1),u=k(new Set),e=async()=>{U(u,m=>{var n;m.size>0&&((n=[...m].at(-1))==null||n.focus())},{deep:!0,once:!0}),await r.createList({pocket_id:o.pocket.id})},l=async m=>{await t.updateItemName(o.pocket,m)},T=async()=>{await t.deleteItem(o.pocket)};return(m,n)=>{const L=q("router-link");return c(),d(h,null,[s("h5",ne,[p(D,{value:o.pocket.name,tag:"span",editable:a.value,focusable:!0,placeholder:"New Pocket",onBlur:n[0]||(n[0]=i=>a.value=!1),onUpdate:l},null,8,["value","editable"]),s("a",{class:"count",onClick:n[1]||(n[1]=b(i=>a.value=!a.value,["prevent"]))},n[2]||(n[2]=[s("i",{class:"fas fa-pen"},null,-1)])),s("a",{class:"count action",onClick:b(e,["prevent"])},n[3]||(n[3]=[s("i",{class:"fas fa-plus-circle"},null,-1)])),s("a",{class:"count action",onClick:b(T,["prevent"])},n[4]||(n[4]=[s("i",{class:"fas fa-trash-alt"},null,-1)]))]),s("div",oe,[p(Q,{items:f(r).getListsInPocket([o.pocket.id]),"sortable-list-id":o.pocket.id,"sortable-group-name":"lists","class-name":"list",onSort:f(r).sort},{default:x(({item:i})=>[p(L,{to:{name:"list",params:{id:i.id}},custom:""},{default:x(({isActive:E,navigate:v})=>[p(ae,{ref:B=>u.value.add(B),item:i,class:F(["item",E&&"selected"]),"data-id":i.id,onClick:v},null,8,["item","class","data-id","onClick"])]),_:2},1032,["to"])]),_:1},8,["items","sortable-list-id","onSort"]),f(r).getListsInPocket([o.pocket.id]).length?S("",!0):(c(),d("div",re," No Lists Yet "))])],64)}}}),le={class:"custom-mb-24"},ce={class:"align-center"},_e=w({__name:"SidebarInner",setup(_){const o=I();return(t,r)=>(c(),d(h,null,[s("div",le,[p(W)]),(c(!0),d(h,null,j(f(o).items,a=>(c(),d("div",{key:a.uuid||a.id},[p(ie,{pocket:a},null,8,["pocket"])]))),128)),s("div",ce,[s("button",{class:"gray",onClick:r[0]||(r[0]=a=>f(o).createPocket())},r[1]||(r[1]=[s("i",{class:"fa fa-plus"},null,-1)]))])],64))}});export{_e as default};
