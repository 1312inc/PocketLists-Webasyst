import{u as Fe,_ as Be,t as ve,a as Ee,b as Ne}from"./textToHtmlWithLinks-VNbOlr3V.js";import{r as S,ae as Ue,m as q,af as B,d as L,a6 as Ae,c as P,ag as Re,o,e as r,j as _,D as pe,t as b,g as y,n as A,f as m,K as R,k as Oe,L as z,A as me,G as ke,y as te,ah as J,ai as fe,a7 as Ie,aj as oe,ak as He,al as ze,am as Te,an as We,ao as qe,ap as je,aq as Ke,ar as Ve,as as Qe,at as Je,B as V,F as O,x as se,i as X,u as Ye,a3 as Xe,h as M,q as U,au as Ge,R as Ze,U as et,Q as tt,av as st,aw as $e,ax as he,ay as xe,az as at,aA as le,p as nt,M as Se,s as ot,w as W,aB as lt,l as it,S as K,aC as rt,aD as ut,aE as ct,H as dt,a9 as _e,aF as ye}from"./index-VoPyQb5i.js";import{m as ie,g as ee,a as ft,s as ge}from"./sanitizer-TiisBOmJ.js";import{_ as pt}from"./SortableList.vue_vue_type_style_index_0_lang-QF6fnJo9.js";function mt(s){const t=S([]),e=new Set;Ue(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),q(t,()=>{for(const[p]of e.entries())typeof p=="function"&&p(),e.delete(p)});const n=p=>{e.add(p)},d=p=>t.value.findIndex(h=>h.isEqualNode(p)),c=p=>t.value[d(p)-1],a=p=>t.value[d(p)+1],l=(p,h)=>{if(p){const u=a(p);if(u instanceof HTMLElement)return u.focus(),h&&ie(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},i=(p,h,u)=>{if(p.target instanceof HTMLElement){const v=p.target,T=ee(v),C=h==="up"?c(v):a(v);C instanceof HTMLElement&&(p.preventDefault(),C.focus(),ft(C,T),typeof u=="function"&&u())}};return{getPreviousElementSibling:c,getNextElementSibling:a,getCurrentPositionInNavigationList:d,focusNextTask:l,focusTaskById:(p,h)=>{const u=t.value.find(v=>{var T;return v instanceof HTMLElement&&((T=v.dataset)==null?void 0:T.id)==p});u instanceof HTMLElement&&(u.focus(),h&&ie(u))},onUp:(p,h)=>{i(p,"up",h)},onDown:(p,h)=>{i(p,"down",h)},onLeft:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===0){const v=c(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),ie(v),typeof h=="function"&&h())}}},onRight:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===u.innerText.length){const v=a(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),typeof h=="function"&&h())}}},nextUpdate:n}}const kt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},vt={class:"flexbox space-8 middle smaller empty:tw-hidden"},ht={key:4},_t=L({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Ae(),{currentLabel:e}=Fe(()=>s.task),n=P(()=>Re(s.task)),d=P(()=>({"text-red":n.value===3,"text-yellow":n.value===2,"text-green":n.value===1,grey:n.value===0}));return(c,a)=>{var l;return o(),r("div",vt,[_(e)?(o(),r("div",{key:0,class:"badge squared",style:pe(`background: #${_(e).color};`)},b(_(e).name),5)):y("",!0),c.task.due_date&&c.task.repeat_frequency?(o(),r("div",{key:1,class:A(d.value)},[a[0]||(a[0]=m("i",{class:"fas fa-redo text-light-gray"},null,-1)),R(" "+b(c.$t(`${c.task.repeat_frequency}_${c.task.repeat_interval}`)),1)],2)):y("",!0),c.task.due_datetime&&!c.task.status?(o(),r("div",{key:2,class:A(["semibold",d.value])},b(_(Oe)(c.task.due_datetime).format("LLL")),3)):c.task.due_date&&!c.task.status?(o(),r("div",{key:3,class:A(["semibold",d.value])},b(_(z)(c.task.due_date).format("LL")),3)):y("",!0),c.task.location_id?(o(),r("div",ht,[a[1]||(a[1]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),R(" "+b((l=_(t).getItemById(c.task.location_id))==null?void 0:l.name)+" "+b(_(kt)(_(t).distanceById(c.task.location_id))),1)])):y("",!0)])}}}),yt={class:"icon"},gt=["src"],wt=L({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=me(),e=ke(),n=P(()=>!t.currentRoute.value.params.listId),d=P(()=>s.task.list_id&&n.value?e.itemsMap[s.task.list_id]:null),c=()=>{if(!d.value)return;const a=t.resolve({name:"list",params:{listId:d.value.id}});window.open(a.href,"_blank")};return(a,l)=>(o(),r("div",{class:A(["flexbox middle",{"space-12":!a.isFocused}])},[a.isFocused?(o(),te(Be,{key:0,task:a.task,input:a.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(o(),te(_t,{key:1,task:a.task},null,8,["task"])),d.value?(o(),r("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:c},[m("div",yt,[m("img",{src:d.value.icon_url,loading:"lazy"},null,8,gt)]),R(" "+b(d.value.name),1)])):y("",!0)],2))}}),Le=qe?window:void 0;function Z(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Y(...s){const t=[],e=()=>{t.forEach(l=>l()),t.length=0},n=(l,i,f,g)=>(l.addEventListener(i,f,g),()=>l.removeEventListener(i,f,g)),d=P(()=>{const l=oe(B(s[0])).filter(i=>i!=null);return l.every(i=>typeof i!="string")?l:void 0}),c=He(()=>{var l,i;return[(i=(l=d.value)==null?void 0:l.map(f=>Z(f)))!=null?i:[Le].filter(f=>f!=null),oe(B(d.value?s[1]:s[0])),oe(_(d.value?s[2]:s[1])),B(d.value?s[3]:s[2])]},([l,i,f,g])=>{if(e(),!(l!=null&&l.length)||!(i!=null&&i.length)||!(f!=null&&f.length))return;const $=ze(g)?{...g}:g;t.push(...l.flatMap(I=>i.flatMap(x=>f.map(p=>n(I,x,p,$)))))},{flush:"post"}),a=()=>{c(),e()};return Te(e),a}let we=!1;function be(s,t,e={}){const{window:n=Le,ignore:d=[],capture:c=!0,detectIframe:a=!1,controls:l=!1}=e;if(!n)return l?{stop:J,cancel:J,trigger:J}:J;if(fe&&!we){we=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(v=>Y(v,"click",J,u)),Y(n.document.documentElement,"click",J,u)}let i=!0;const f=u=>B(d).some(v=>{if(typeof v=="string")return Array.from(n.document.querySelectorAll(v)).some(T=>T===u.target||u.composedPath().includes(T));{const T=Z(v);return T&&(u.target===T||u.composedPath().includes(T))}});function g(u){const v=B(u);return v&&v.$.subTree.shapeFlag===16}function $(u,v){const T=B(u),C=T.$.subTree&&T.$.subTree.children;return C==null||!Array.isArray(C)?!1:C.some(Q=>Q.el===v.target||v.composedPath().includes(Q.el))}const I=u=>{const v=Z(s);if(u.target!=null&&!(!(v instanceof Element)&&g(s)&&$(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(i=!f(u)),!i){i=!0;return}t(u)}};let x=!1;const p=[Y(n,"click",u=>{x||(x=!0,setTimeout(()=>{x=!1},0),I(u))},{passive:!0,capture:c}),Y(n,"pointerdown",u=>{const v=Z(s);i=!f(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),a&&Y(n,"blur",u=>{setTimeout(()=>{var v;const T=Z(s);((v=n.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(T!=null&&T.contains(n.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),h=()=>p.forEach(u=>u());return l?{stop:h,cancel:()=>{i=!1},trigger:u=>{i=!0,I(u),i=!1}}:h}const bt={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=be(s,t.value,{capture:e});else{const[n,d]=t.value;s.__onClickOutside_stop=be(s,n,Object.assign({capture:e},d))}},unmounted(s){s.__onClickOutside_stop()}};function re(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Ce(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Ce(e)}}function It(s){const t=s||window.event,e=t.target;return Ce(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const ue=new WeakMap;function Tt(s,t=!1){const e=Ie(t);let n=null,d="";q(We(s),l=>{const i=re(B(l));if(i){const f=i;if(ue.get(f)||ue.set(f,f.style.overflow),f.style.overflow!=="hidden"&&(d=f.style.overflow),f.style.overflow==="hidden")return e.value=!0;if(e.value)return f.style.overflow="hidden"}},{immediate:!0});const c=()=>{const l=re(B(s));!l||e.value||(fe&&(n=Y(l,"touchmove",i=>{It(i)},{passive:!1})),l.style.overflow="hidden",e.value=!0)},a=()=>{const l=re(B(s));!l||!e.value||(fe&&(n==null||n()),l.style.overflow=d,ue.delete(l),e.value=!1)};return Te(a),P({get(){return e.value},set(l){l?c():a()}})}function $t(){let s=!1;const t=Ie(!1);return(e,n)=>{if(t.value=n.value,s)return;s=!0;const d=Tt(e,n.value);q(t,c=>d.value=c)}}$t();const xt=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},St=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Lt=je("syncError",()=>{const s=Ke(Ve(Qe(()=>Je.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Ct(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Mt={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Dt=["href"],Pt=["src"],Ft={class:"bold"},Bt={key:0,class:"hint custom-ml-4 nowrap"},Et=["onClick"],Nt=L({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=V(),e=n=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[n])};return(n,d)=>{var c;return(c=n.task.attachments)!=null&&c.length?(o(),r("div",Mt,[(o(!0),r(O,null,se(n.task.attachments,a=>(o(),r("div",{key:a.uuid||a.id,class:"pl-attachments__item small"},[m("a",{href:a.download_url,target:"_blank"},[a.preview_url?(o(),r("img",{key:0,src:a.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Pt)):(o(),r(O,{key:1},[m("span",Ft,b(a.file_name),1),a.size?(o(),r("span",Bt,b(_(Ct)(a.size)),1)):y("",!0)],64))],8,Dt),n.isFocused?(o(),r("div",{key:0,class:A(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":a.preview_url}])},[m("a",{class:A(a.preview_url?"button circle white":"custom-ml-8"),onClick:X(l=>e(a.id),["prevent"])},d[0]||(d[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,Et)],2)):y("",!0)]))),128))])):y("",!0)}}}),ce=L({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Ye(),n=P(()=>e.getItemById(t.userId));return(d,c)=>{var a;return(a=n.value)!=null&&a.photo_url?(o(),r("span",{key:0,class:"icon userpic",style:pe({backgroundImage:`url(${n.value.photo_url})`})},null,4)):y("",!0)}}}),Ut={key:0,class:"tw-cursor-pointer"},At={key:0,class:"pl-list-item-firedBullet"},Rt={key:1,class:"tw-cursor-pointer"},Ot=L({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,n=t,d=S(e.task.status===1);q(()=>e.task.status,l=>{d.value=l===1});const c=P(()=>Xe(e.task)),a=()=>{d.value=!d.value,n("complete")};return(l,i)=>(o(),r("div",{class:"tw-w-5 tw-flex-none",onClick:a},[M(et,{name:"bounce",mode:"out-in"},{default:U(()=>{var f;return[d.value?(o(),r("div",Rt,i[0]||(i[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(o(),r("div",Ut,[c.value===_(Ge)?(o(),r("div",At)):(o(),r("div",{key:1,class:"pl-list-item-bullet",style:pe(`background-color: ${(f=_(Ze).get(c.value))==null?void 0:f.color}`)},null,4))]))]}),_:1})]))}}),Ht=new WeakMap;function zt(){const s=tt(),t=me(),e=()=>{var i;const c=[...s.matched].reverse().find(f=>{var g;return(g=f.meta)==null?void 0:g.isListView})||null,a=((i=c==null?void 0:c.children)==null?void 0:i.find(f=>{var g;return(g=f.meta)==null?void 0:g.isTaskInfoView}))||null,l={listViewRoute:c,taskInfoRoute:a};return Ht.set(s,l),l};return{navigateToTaskInfo:async d=>{const{listViewRoute:c,taskInfoRoute:a}=e();if(!c||!(a!=null&&a.name))return console.warn("Required routes not found"),!1;try{const l=await t.push({name:a.name,params:{taskId:d}});return!st(l)}catch(l){return console.error("Navigation failed:",l),!1}}}}const Wt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},qt={class:"hint"},jt={class:"hint"},Kt={class:"hint"},Vt={class:"tw-clear-both tw-inline-block"},Qt=["placeholder","data-id","innerHTML"],Jt=["innerHTML"],Yt={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Xt={key:0},Gt={key:1},Zt={key:2,class:"tw-flex-none"},es=["title"],ts=["title"],ss={class:"bold small"},as={key:5,class:"hint tw-flex-none custom-mt-2"},ns={key:6,class:"hint tw-flex-none custom-mt-2"},os={key:0},ls={key:1},is={key:7,class:"hint tw-flex-none custom-mt-2"},rs={key:8,class:"flexbox middle tw-flex-none"},us={key:9,class:"flexbox middle tw-flex-none"},cs={key:10,class:"flexbox middle tw-flex-none"},ds={key:11,class:"flexbox middle space-4 tw-flex-none"},fs=["href"],ps=["src"],ms=L({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,n=t;$e("onEscape",j);const d=V(),c=Lt(),{navigateToTaskInfo:a}=zt(),l=he(xe),i=he(at),f=S(!1),g=S(!1),$=S(e.task.name),I=S(e.task.status);q(()=>e.task.status,w=>{I.value=w});const x=S();let p=null;q(f,()=>{if(f.value)return;const w=x.value.innerText.trim();if(le(e.task)&&!w){g.value=!0,n("delete",e.task);return}e.task.name!==w&&n("update",e.task,{name:w})}),nt(()=>{le(e.task)&&(x.value.focus(),f.value=!0)}),Se(()=>{p&&(clearTimeout(p),p=null,h())});const h=()=>{n("complete",e.task)},u=()=>{I.value=I.value?0:1,x.value.classList.toggle("opacity-50"),!(p&&(clearTimeout(p),p=null,e.task.status===I.value))&&(p=setTimeout(h,1e3))},v=w=>{if(w.target instanceof HTMLAnchorElement){const k=w.target.href;w.preventDefault(),setTimeout(()=>{window.open(k,"_blank")})}},T=w=>{var H;w.preventDefault();const k=(H=w.clipboardData)==null?void 0:H.getData("text/plain");if(!k)return;if(x.value.innerText){document.execCommand("insertText",!1,k);return}const E=k.split(`
`).filter(N=>N);E.length&&n("insertMany",e.task,E.map(N=>({name:xt(N),...e.addableProps,...St(N)?{status:1}:{}})))},C=w=>{ee(w.target)===0&&(l==null||l.onLeft(w),g.value=!0,n("delete",e.task))},Q=async w=>{if(w.shiftKey)return;if(w.preventDefault(),e.isEnterDisabled){j(!0),await it(),n("insertFirst",{...e.addableProps});return}const k=w.target,E=k.innerText.trim(),H=ee(k);let N="",G=!0;H===0&&E||(k.innerText=E.substring(0,H).trim(),N=E.substring(H,E.length).trim(),G=!1),n("insert",e.task,{...e.addableProps,name:N},{isBefore:G}),j()},ae=w=>{$.value=w.target.innerText};function j(w=!1){const k=()=>{x.value.blur(),f.value=!1};if(w){k();return}setTimeout(()=>{k()})}const De=()=>{n("update",e.task,{favorite:e.task.favorite?0:1})},ne=async w=>{w.target.closest("[contenteditable], .chips li, a")===null&&await a(e.task.id)};function Pe(w){return new URL(Object.assign({"../../assets/apps/shop.svg":Ee,"../../assets/apps/tasks.svg":Ne})[`../../assets/apps/${w}.svg`],import.meta.url).href}return(w,k)=>{var E,H,N,G;return g.value?y("",!0):(o(),r("div",{key:0,class:A(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":w.$route.meta.isTaskInfoView&&((E=w.$route.params)==null?void 0:E.taskId)==e.task.id,highlighted:_(d).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(o(),r("div",Wt,k[7]||(k[7]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):y("",!0),M(Ot,{task:e.task,onComplete:u},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:ne},[(H=_(i))!=null&&H.is_debug_mode?(o(),r(O,{key:0},[m("span",qt,"list_id: "+b(String(e.task.list_id)),1),k[8]||(k[8]=R(" | ")),m("span",jt,"id: "+b(e.task.id),1),k[9]||(k[9]=R(" | ")),m("span",Kt,"srank: "+b(String(e.task.sort))+" | "+b(String(e.task.rank)),1)],64)):y("",!0),ot((o(),r("div",null,[m("div",Vt,[m("div",{ref_key:"contenteditableRef",ref:x,contenteditable:"",class:A(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(Q,["enter"]),k[0]||(k[0]=W(D=>{var F;(F=_(l))==null||F.onLeft(D,()=>{f.value=!1})},["left"])),k[1]||(k[1]=W(D=>{var F;(F=_(l))==null||F.onUp(D,()=>{f.value=!1})},["up"])),k[2]||(k[2]=W(D=>{var F;(F=_(l))==null||F.onRight(D,()=>{f.value=!1})},["right"])),k[3]||(k[3]=W(D=>{var F;(F=_(l))==null||F.onDown(D,()=>{f.value=!1})},["down"])),W(C,["delete"]),k[4]||(k[4]=W(()=>{j()},["esc"])),k[5]||(k[5]=W(()=>{f.value=!1},["tab"]))],onMousedown:v,onFocus:k[6]||(k[6]=D=>f.value=!0),onPaste:T,onInput:ae,innerHTML:_(ge)(f.value?e.task.name:_(ve)(e.task.name))},null,42,Qt)]),e.task.note?(o(),r("div",{key:0,class:"hint break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(ge)(_(ve)(e.task.note))},null,8,Jt)):y("",!0),M(wt,{task:w.task,input:$.value,"is-focused":f.value},null,8,["task","input","is-focused"])])),[[_(bt),()=>{f.value=!1}]]),M(Nt,{task:e.task,"is-focused":f.value},null,8,["task","is-focused"])]),m("div",Yt,[e.showInfoLink?(o(),r("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:X(ne,["prevent"])},k[10]||(k[10]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):y("",!0),I.value?y("",!0):(o(),r("div",{key:1,class:A(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:De},[e.task.favorite?(o(),r("span",Xt,k[11]||(k[11]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(o(),r("span",Gt,k[12]||(k[12]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(c).taskErrorMap.get(e.task.id)?(o(),r("div",Zt,[m("span",{class:"icon",style:{color:"orange"},title:_(c).taskErrorMap.get(e.task.id)},k[13]||(k[13]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,es)])):y("",!0),!_(lt)(e.task)&&!_(le)(e.task)?(o(),r("div",{key:3,class:"tw-flex-none",title:w.$t("syncing")},k[14]||(k[14]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,ts)):y("",!0),(N=e.task.extended_data)!=null&&N.comments_count?(o(),r("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:X(ne,["prevent"])},[k[15]||(k[15]=m("i",{class:"fas fa-comment"},null,-1)),m("span",ss,b(e.task.extended_data.comments_count),1)])):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(o(),r("div",as,b(_(z)().to(_(z)(e.task.create_datetime),!0)),1)):y("",!0),!I.value&&e.task.assigned_contact_id?(o(),r("div",ns,[e.task.update_datetime?(o(),r("span",os,b(_(z)().to(_(z)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(o(),r("span",ls,b(_(z)().to(_(z)(e.task.create_datetime),!0)),1)):y("",!0)])):y("",!0),e.task.complete_datetime?(o(),r("div",is,b(_(z)().to(_(z)(e.task.complete_datetime),!0)),1)):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.contact_id?(o(),r("div",rs,[M(ce,{"user-id":e.task.contact_id},null,8,["user-id"])])):y("",!0),!I.value&&e.task.assigned_contact_id?(o(),r("div",us,[M(ce,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):y("",!0),I.value&&e.task.complete_contact_id?(o(),r("div",cs,[M(ce,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):y("",!0),(G=e.task.external_links)!=null&&G.length?(o(),r("div",ds,[(o(!0),r(O,null,se(e.task.external_links,D=>(o(),r("a",{key:D.id,href:D.entity_link,class:"icon size-20",target:"_blank"},[m("img",{src:Pe(D.app)},null,8,ps)],8,fs))),128))])):y("",!0)])],2))}}}),ks=L({__name:"ListNavigationProvider",setup(s){const t=S();return $e(xe,mt(t)),(e,n)=>(o(),r("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[K(e.$slots,"default")],512))}}),vs=L({__name:"TaskListItemStoreProvider",setup(s){const t=V(),e=i=>t.completeTask(i),n=(i,f)=>t.updateItem(i,f),d=async(i,f,g)=>{await t.insert(g.isBefore?"before":"after",i,{...f})},c=async(i,f)=>{await t.insertMany(i,f)},a=async i=>{await t.insert("before",null,i,{shouldPinNewTask:!0})},l=async i=>{await t.deleteItem(i)};return(i,f)=>K(i.$slots,"default",{onComplete:e,onUpdate:n,onInsert:d,onInsertMany:c,onInsertFirst:a,onDelete:l})}}),hs=L({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,n=t,d=S(null),{stop:c}=rt(d,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"200px"});return Se(()=>{c()}),(a,l)=>(o(),r("div",{ref_key:"elRef",ref:d},[K(a.$slots,"default")],512))}}),_s={key:0,class:"skeleton custom-m-24"},ys={key:0},gs={class:"box custom-py-24 small align-center gray"},de=30,ws=L({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=V(),n=ke(),d=ct(),c=S(de),a=S([]),l=S(!1),i=S(0),f=S(!1),g=P(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:a.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),$=P(()=>g.value.source.slice(0,c.value));q(()=>t,()=>{c.value=de,x()},{deep:!0,immediate:!0});const I=()=>{var h;((h=g.value.source)==null?void 0:h.length)>$.value.length&&(c.value+=de)};async function x(){const{isFetchStream:h,fetchParams:u,disableCheckin:v}=g.value;if(!u||!p(u))return;if(l.value=!1,a.value=[],t.filter==="list"){const C=d.task.value.get(JSON.stringify({list_id:t.listId})),Q=d.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ae=d.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),j=C||Q;if(j)if(t.shouldFilterUncompleted){if(ae)return}else delete u.status,u.starting_from=ut(new Date(j))}if(i.value=8,t.filter==="list"){const C=n.getItemById(t.listId);i.value=C==null?void 0:C.extended_data.items_count}f.value=!d.task.value.get(JSON.stringify(g.value.fetchParams))&&("status"in g.value.fetchParams?g.value.fetchParams.status!=="0":!0);const T=await e[h?"fetchStream":"fetch"]({...u},{disableCheckin:v});f.value=!1,T&&T.value&&T.value.status_code==="ok"&&t.filter==="search"&&(a.value=[...a.value,...T.value.data],l.value=!a.value.length)}function p(h){return!(!h||h.list_id&&typeof h.list_id!="number"||h.location_id&&typeof h.location_id!="number")}return(h,u)=>f.value?(o(),r("div",_s,[(o(!0),r(O,null,se(i.value,v=>(o(),r("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(o(),r(O,{key:1},[K(h.$slots,"default",{tasks:$.value}),t.filter==="search"&&l.value?(o(),r("div",ys,[m("p",gs,[R(b(h.$t("searchNoMatches"))+" ",1),m("strong",null,b(t.searchQuery),1)])])):y("",!0),(o(),te(hs,{key:h.$route.fullPath,onIntersecting:I}))],64))}}),bs=L({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=V(),n=me();q(n.currentRoute,async c=>{const a={...c.query};"addNewTask"in a&&(await d(),delete a.addNewTask,n.replace({path:c.path,query:a}))},{immediate:!0});async function d(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(c,a)=>(o(),r("div",{class:"text-gray pl-list-item-title",onClick:d},[a[0]||(a[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),R(" "+b(c.$t("newToDo")),1)]))}}),Is={class:"dialog-header"},Ts={class:"dialog-content empty:tw-hidden"},$s={class:"dialog-footer tw-flex tw-gap-2"},Me=L({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(t,e)=>(o(),r(O,null,[m("header",Is,[m("h3",null,b(t.$props.title),1),t.hideCloseIcon?y("",!0):(o(),r("a",{key:0,class:"dialog-close",onClick:e[0]||(e[0]=X(n=>t.$emit("close"),["prevent"]))},e[2]||(e[2]=[m("i",{class:"fas fa-times"},null,-1)])))]),m("div",Ts,[K(t.$slots,"default")]),m("footer",$s,[K(t.$slots,"submit"),t.hideCloseButton?y("",!0):(o(),r("button",{key:0,class:"button light-gray",onClick:e[1]||(e[1]=n=>t.$emit("close"))}," Close "))])],64))}}),xs=L({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(o(),te(Me,{title:t.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...n)=>t.onDelete&&t.onDelete(...n))}," Delete ")]),default:U(()=>[R(b(t.text)+" ",1)]),_:1},8,["title"]))}}),Ss={class:"tw-w-68"},Ls={class:"menu"},Cs={href:"javascript:void(0);"},Ms={class:"menu"},Ds=["onClick"],Ps=["disabled"],Fs=L({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=dt(),e=ke(),n=S(),d=()=>{n.value&&s.onMove(n.value)};return(c,a)=>(o(),te(Me,{title:c.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{disabled:!n.value,onClick:X(d,["prevent"])}," Move ",8,Ps)]),default:U(()=>[m("div",Ss,[m("ul",Ls,[(o(!0),r(O,null,se(_(t).items,l=>(o(),r("li",{key:l.uuid||l.id},[m("a",Cs,b(l.name),1),m("ul",Ms,[(o(!0),r(O,null,se(_(e).getListsInPocket(l.id),i=>(o(),r("li",{key:i.uuid||i.id,class:A(n.value===i.id&&"selected rounded")},[m("a",{href:"#",onClick:X(()=>{n.value=n.value===i.id?void 0:i.id},["prevent"])},b(i.name),9,Ds)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Bs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Es={class:"hint"},Ns={class:"hint"},Us=L({__name:"TaskListMultiselect",setup(s){const t=V(),e=S(new Set),{show:n,hide:d}=_e(xs,{title:"Delete",text:ye(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),d()}}),{show:c,hide:a}=_e(Fs,{title:"Move Items",text:ye(()=>`Delete ${e.value.size} selected items?`),onMove:async $=>{await t.sort($,null,[...e.value]),e.value.clear(),a()}}),l=$=>{e.value.add($)},i=$=>{e.value.delete($)},f=()=>{c()},g=()=>{n()};return($,I)=>(o(),r(O,null,[e.value.size?(o(),r("div",Bs,[m("button",{class:"button light-gray smaller",onClick:f},[I[0]||(I[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),R(" "+b($.$t("Move"))+" ",1),m("span",Es,b(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:g},[I[1]||(I[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),R(" "+b($.$t("Delete"))+" ",1),m("span",Ns,b(e.value.size),1)])])):y("",!0),K($.$slots,"default",{onSelect:l,onDeselect:i})],64))}}),As={class:"pl-bg-block custom-pb-4"},Rs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Os={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Hs={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},zs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Vs=L({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=V(),n=P(()=>t.filter!=="list");return(d,c)=>(o(),r("div",As,[t.header?(o(),r("div",Rs,[m("h1",null,b(t.header),1)])):y("",!0),M(ks,null,{default:U(()=>[M(ws,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:U(({tasks:a})=>[!a.length&&t.startMessage&&_(e).isPreFilled?(o(),r("div",Os,b(t.startMessage),1)):y("",!0),t.hideAddNewTask?y("",!0):(o(),r("div",Hs,[M(bs,{"addable-props":t.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])])),d.shouldFilterUncompleted&&!d.hideUncompletedLabel&&a.length?(o(),r("div",zs,b(d.$t("completed")),1)):y("",!0),M(Us,null,{default:U(({onSelect:l,onDeselect:i})=>[M(pt,{items:a,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:l,onDeselect:i},{default:U(({item:f})=>[M(vs,null,{default:U(({onUpdate:g,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u})=>[M(ms,{task:f,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:g,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Vs as _,Me as a};
