import{d as R,r as D,c as b,m as _,o as g,b as w,e as r,t as M,i as p,J as k,F as Y,y as T,n as L,D as $,R as B,Z as H,$ as N,p as V,l as E,a0 as I,a1 as O,B as F,I as P,g as S,q as A,h as q,H as W,f as x,O as U,a2 as j,a3 as G}from"./index-ux3jP22C.js";import{_ as z}from"./TaskList.vue_vue_type_script_setup_true_lang-RxsY6b-_.js";import"./TaskListItemPopupMenu.vue_vue_type_script_setup_true_lang-cvo5EsCD.js";import"./rangy-5rxgwlWZ.js";import"./SortableList.vue_vue_type_style_index_0_lang-H_cm6lIe.js";const J=typeof window<"u"&&typeof document<"u"?window:void 0,Z=(u,o)=>{const d=new Date(Date.UTC(2017,0,2)),i=[];for(let c=0;c<7;c++)i.push(d.toLocaleDateString(u,{weekday:"short"})),d.setDate(d.getDate()+1);return o||i.unshift(i.pop()),i};function K(u,o,d){let i=0,c=!1,f=0,l=null;const e=10,m=10;function h(n){const y=-n.deltaY,C=Math.abs(y);C<m||n.timeStamp-f<300&&c||(f=n.timeStamp,i<C&&!c?(y<-e?o():y>e&&d(),v(C),l&&clearTimeout(l),l=setTimeout(()=>{i===C&&s()},1e3)):C<e&&s())}function v(n){i=n,c=!0}function s(){i=e,c=!1}const t=()=>{u.value&&u.value.removeEventListener("wheel",h)},a=_(u,n=>{t(),n&&n.addEventListener("wheel",h)},{immediate:!0,flush:"post"});I()&&O(()=>{t(),a()})}function Q(u,o={width:0,height:0}){const d=J;let i;const c=d&&"ResizeObserver"in d,f=D(o.width),l=D(o.height),e=([v])=>{const s=v.contentBoxSize;if(s){const t=Array.isArray(s)?s:[s];f.value=t.reduce((a,{inlineSize:n})=>a+n,0),l.value=t.reduce((a,{blockSize:n})=>a+n,0)}else f.value=v.contentRect.width,l.value=v.contentRect.height},m=()=>{i&&(i.disconnect(),i=void 0)},h=_(u,v=>{m(),c&&d&&(i=new ResizeObserver(e),v&&i.observe(v))},{immediate:!0,flush:"post"});return V(()=>{u.value&&(f.value="offsetWidth"in u.value?u.value.offsetWidth:o.width,l.value="offsetHeight"in u.value?u.value.offsetHeight:o.height)}),I()&&O(()=>{m(),h()}),{width:f,height:l}}function X(u,o,d){const i=D(1),c=D(!0),f=D(!0),{height:l}=Q(u),e=b(()=>l.value/6),m=D(k()),h=b(()=>{const t=m.value.startOf("M"),a=t.get("d")+-d,n=a<0?7+a:a;return t.add(-(6*7+n),"d")}),v=b(()=>new Array(6*7*3).fill(null).map((t,a)=>{const n=h.value.add(a,"d").toDate(),y=n.toLocaleDateString();return{localeDate:y,timestamp:n.getTime(),isWeekend:[0,6].includes(n.getDay()),isCurrent:new Date().toLocaleDateString()===y,isFirstDay:n.getDate()===1,isCurrentMonth:n.getMonth()===m.value.get("M")}}));V(()=>{o.value&&(f.value=!1,o.value.style.transform=`translate3d(0px, ${-o.value.clientHeight}px, 0px)`)}),K(u,()=>{c.value&&i.value<2&&i.value++},()=>{c.value&&i.value>0&&i.value--});const s=t=>{if(o.value){const a=o.value.querySelectorAll(".icg-months-grid-day--first-day")[t];a instanceof HTMLElement&&(o.value.style.transform=`translate3d(0px, ${-a.offsetTop}px, 0px)`)}};return _(i,t=>{t===1?s(t):o.value&&(f.value=!0,c.value=!1,o.value.addEventListener("transitionend",()=>{f.value=!1,c.value=!0,m.value=m.value.add(t===0?-1:1,"month"),E(()=>{i.value=1})},{once:!0}),s(t))}),_(f,t=>{o.value&&(o.value.style.transitionProperty=t?"transform":"none")}),_(e,()=>{s(1)},{flush:"post"}),{cellHeight:e,activeMonth:m,daysInCalendar:v}}const ee={class:"icg"},te={class:"icg-header"},ae={class:"icg-month"},se={class:"icg-controls"},le=r("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[r("path",{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"})],-1),ie=[le],oe=r("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[r("path",{d:"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"})],-1),ne=[oe],re={class:"icg-weekdays"},de=R({__name:"InfiniteCalendarGrid",props:{firstDayOfWeek:{default:0},locale:{default:"en-US"},todayLabel:{default:"Today"},items:{},fieldWithDate:{}},emits:["changeInterval"],setup(u,{emit:o}){const d=u,i=o,c=D(null),f=D(null),{cellHeight:l,activeMonth:e,daysInCalendar:m}=X(c,f,d.firstDayOfWeek),h=Z(d.locale,d.firstDayOfWeek),v=b(()=>{const s={};for(const t of d.items){const a=t[d.fieldWithDate];if(typeof a=="string"||typeof a=="number"){const n=new Date(a);if(!isNaN(n.getTime())){const y=n.toLocaleDateString();s[y]?s[y].push(t):s[y]=[t]}}}return s});return _(m,s=>{i("changeInterval",{start:s[0].timestamp,end:s[s.length-1].timestamp})},{immediate:!0,flush:"post"}),(s,t)=>(g(),w("div",ee,[r("div",te,[r("div",ae,M(p(e).toDate().toLocaleDateString(d.locale,{year:"numeric",month:"long"}).replace("Ð³.","")),1),r("div",se,[r("button",{onClick:t[0]||(t[0]=a=>e.value=p(e).add(-1,"M"))},ie),r("button",{onClick:t[1]||(t[1]=a=>e.value=p(k)())},M(d.todayLabel),1),r("button",{onClick:t[2]||(t[2]=a=>e.value=p(e).add(1,"M"))},ne)])]),r("div",re,[(g(!0),w(Y,null,T(p(h),(a,n)=>(g(),w("div",{key:a,class:L(["icg-weekdays-cell",{"icg-weekdays-cell--weekend":n===(d.firstDayOfWeek?5:0)||n===6}])},M(a),3))),128))]),r("div",{ref_key:"wrapperRef",ref:c,class:"icg-wrapper"},[r("div",{ref_key:"containerRef",ref:f,class:"icg-months-grid"},[(g(!0),w(Y,null,T(p(m),a=>(g(),w("div",{key:a.timestamp,class:L(["icg-months-grid-day",{"icg-months-grid-day--active-month":a.isCurrentMonth,"icg-months-grid-day--first-day":a.isFirstDay,"icg-months-grid-day--weekend":a.isWeekend,"icg-months-grid-day--current":a.isCurrent}]),style:$({height:`${p(l)}px`})},[B(s.$slots,"default",H(N({date:a,items:v.value[a.localeDate]})))],6))),128))],512)],512)]))}}),ce={class:"tw-flex tw-flex-col lg:tw-flex-row tw-h-full lg:tw-gap-4"},ue={class:"lg:tw-flex-auto lt-lg:tw-h-1/2 tw-relative"},me=["onClick"],fe={class:"pl-calendar-day"},he={key:0},pe={class:"pl-calendar-items custom-p-8 custom-pt-32 lt-lg:tw-flex lt-lg:tw-gap-.5"},ve={key:0},ge={key:0,class:"lg:tw-w-80 lt-lg:tw-h-1/2 empty:tw-hidden tw-flex tw-flex-col tw-gap-4 tw-overflow-y-auto hide-scrollbar"},we={class:"flexbox space-12 middle custom-pt-12 tw-flex-none"},ye={class:"wide"},De={key:1,class:"lg:tw-w-80 lt-lg:tw-h-1/2 empty:tw-hidden"},Se=R({__name:"CalendarView",props:{selectedDate:{}},setup(u){const o=F(),d=D(),i=D(),c=b(()=>[...o.getDue(),...o.getTasksCompleted].map(e=>({...e,filterDate:e.complete_datetime||e.due_date})).filter(e=>{if(!e.filterDate)return!1;const m=new Date(e.filterDate).getTime();return m>d.value&&m<i.value})),f=({start:l,end:e})=>{d.value=l,i.value=e,o.fetch({status:1}),o.fetchStream({filter:`due/${k(l).format("YYYY-MM-DD")},${k(e).format("YYYY-MM-DD")}`},{disableCheckin:!0})};return(l,e)=>{const m=P("RouterView");return g(),w("div",ce,[r("div",ue,[S(p(de),{items:c.value,"field-with-date":"filterDate","first-day-of-week":1,"today-label":l.$t("today"),locale:p(G),onChangeInterval:f},{default:A(({date:h,items:v})=>[r("div",{class:"tw-h-full",style:$(l.selectedDate===p(k)(h.timestamp).format("YYYY-MM-DD")&&"background: var(--highlighted-green)"),onClick:s=>l.$router.push({name:"calendarDate",params:{date:p(k)(h.timestamp).format("YYYY-MM-DD")}})},[r("div",fe,[W(M(new Date(h.timestamp).getDate())+" ",1),new Date(h.timestamp).getDate()===1?(g(),w("span",he,M(p(k)(h.timestamp).format("MMM")),1)):x("",!0)]),r("div",pe,[(g(!0),w(Y,null,T(v,s=>{var t;return g(),w("div",{key:s.uuid||s.id,class:"flexbox middle space-4"},[s.complete_datetime?(g(),w("div",ve,e[1]||(e[1]=[r("i",{class:"smaller gray fas fa-check"},null,-1)]))):(g(),w("span",{key:1,style:$(`color: ${(t=p(U).get(p(j)(s)))==null?void 0:t.color}`)},e[2]||(e[2]=[r("i",{class:"smaller fas fa-circle"},null,-1)]),4)),r("div",{class:L(["smaller lt-lg:tw-hidden tw-truncate",{"opacity-50":s.complete_datetime}])},M(s.name),3)])}),128))])],12,me)]),_:1},8,["items","today-label","locale"])]),l.$route.name==="calendarDate"?(g(),w("div",ge,[l.selectedDate?(g(),w(Y,{key:0},[r("div",we,[r("a",{class:"back larger",onClick:e[0]||(e[0]=q(h=>l.$router.push({name:"calendar"}),["prevent"]))},e[3]||(e[3]=[r("i",{class:"fas fa-arrow-circle-left"},null,-1)])),W(" "+M(p(k)(l.selectedDate).format("LL")),1)]),r("div",ye,[r("div",null,[S(z,{filter:"date",date:l.selectedDate,"addable-props":{due_date:l.selectedDate}},null,8,["date","addable-props"]),S(z,{filter:"date","should-filter-uncompleted":!0,date:l.selectedDate,"hide-add-new-task":!0,"disable-sort":!0},null,8,["date"])])])],64)):x("",!0)])):x("",!0),l.$route.meta.isTaskInfoView?(g(),w("div",De,[S(m)])):x("",!0)])}}});export{Se as default};
