import{_ as He,p as ze,t as me,a as We,b as je}from"./textToHtmlWithLinks-ePzTn8in.js";import{r as S,ad as Ke,m as H,ae as N,d as C,a5 as qe,c as M,af as Ve,o,e as u,n as z,t as w,j as h,k as Qe,L as O,g as y,f as p,K as W,z as de,E as be,y as se,ag as Y,ah as ce,a6 as Te,ai as oe,aj as Ye,ak as Je,al as Ie,am as Xe,an as Ge,ao as Ze,ap as et,aq as tt,ar as st,as as at,A as Q,F as U,x as X,i as G,u as nt,C as xe,a2 as ot,h as L,q as F,at as lt,R as it,U as $e,Q as rt,au as ut,av as ke,aw as ae,ax as ct,p as dt,M as Se,s as ft,w as j,ay as pt,az as Ce,aA as mt,l as kt,aB as vt,S as V,aC as ht,aD as _t,aE as yt,G as gt,a8 as ve,aF as he}from"./index-genqiC86.js";import{m as le,g as te,a as wt,s as _e}from"./sanitizer-qTkizPqY.js";import{_ as bt}from"./SortableList.vue_vue_type_style_index_0_lang-PS1G6Y75.js";function Tt(s){const t=S([]),e=new Set;Ke(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),H(t,()=>{for(const[m]of e.entries())typeof m=="function"&&m(),e.delete(m)});const a=m=>{e.add(m)},i=m=>t.value.findIndex(_=>_.isEqualNode(m)),f=m=>t.value[i(m)-1],n=m=>t.value[i(m)+1],l=(m,_)=>{if(m){const d=n(m);if(d instanceof HTMLElement)return d.focus(),_&&le(d),d}else{const d=t.value[0];d instanceof HTMLElement&&d.focus()}},r=(m,_,d)=>{if(m.target instanceof HTMLElement){const k=m.target,x=te(k),P=_==="up"?f(k):n(k);P instanceof HTMLElement&&(m.preventDefault(),P.focus(),wt(P,x),typeof d=="function"&&d())}};return{getPreviousElementSibling:f,getNextElementSibling:n,getCurrentPositionInNavigationList:i,focusNextTask:l,focusTaskById:(m,_)=>{const d=t.value.find(k=>{var x;return k instanceof HTMLElement&&((x=k.dataset)==null?void 0:x.id)==m});d instanceof HTMLElement&&(d.focus(),_&&le(d))},onUp:(m,_)=>{r(m,"up",_)},onDown:(m,_)=>{r(m,"down",_)},onLeft:(m,_)=>{if(m.target instanceof HTMLElement){const d=m.target;if(te(d)===0){const k=f(d);k instanceof HTMLElement&&(m.preventDefault(),k.focus(),le(k),typeof _=="function"&&_())}}},onRight:(m,_)=>{if(m.target instanceof HTMLElement){const d=m.target;if(te(d)===d.innerText.length){const k=n(d);k instanceof HTMLElement&&(m.preventDefault(),k.focus(),typeof _=="function"&&_())}}},nextUpdate:a}}const It=s=>{const t=N(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},xt={class:"flexbox space-12 smaller empty:tw-hidden"},$t={key:2},St=C({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=qe(),e=M(()=>Ve(s.task)),a=M(()=>({"text-red":e.value===3,"text-yellow":e.value===2,"text-green":e.value===1,grey:e.value===0}));return(i,f)=>{var n;return o(),u("div",xt,[i.task.due_datetime&&!i.task.status?(o(),u("div",{key:0,class:z(["semibold",a.value])},w(h(Qe)(i.task.due_datetime).format("LLL")),3)):i.task.due_date&&!i.task.status?(o(),u("div",{key:1,class:z(["semibold",a.value])},w(h(O)(i.task.due_date).format("LL")),3)):y("",!0),i.task.location_id?(o(),u("div",$t,[f[0]||(f[0]=p("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),W(" "+w((n=h(t).getItemById(i.task.location_id))==null?void 0:n.name)+" "+w(h(It)(h(t).distanceById(i.task.location_id))),1)])):y("",!0)])}}}),Ct={class:"icon"},Lt=["src"],Mt=C({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=de(),e=be(),a=M(()=>!t.currentRoute.value.params.listId),i=M(()=>s.task.list_id&&a.value?e.itemsMap[s.task.list_id]:null),f=()=>{if(!i.value)return;const n=t.resolve({name:"list",params:{listId:i.value.id}});window.open(n.href,"_blank")};return(n,l)=>(o(),u("div",{class:z(["flexbox middle",{"space-12":!n.isFocused}])},[n.isFocused?(o(),se(He,{key:0,task:n.task,input:n.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(o(),se(St,{key:1,task:n.task},null,8,["task"])),i.value?(o(),u("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:f},[p("div",Ct,[p("img",{src:i.value.icon_url,loading:"lazy"},null,8,Lt)]),W(" "+w(i.value.name),1)])):y("",!0)],2))}}),Le=Ge?window:void 0;function ee(s){var t;const e=N(s);return(t=e==null?void 0:e.$el)!=null?t:e}function J(...s){const t=[],e=()=>{t.forEach(l=>l()),t.length=0},a=(l,r,c,T)=>(l.addEventListener(r,c,T),()=>l.removeEventListener(r,c,T)),i=M(()=>{const l=oe(N(s[0])).filter(r=>r!=null);return l.every(r=>typeof r!="string")?l:void 0}),f=Ye(()=>{var l,r;return[(r=(l=i.value)==null?void 0:l.map(c=>ee(c)))!=null?r:[Le].filter(c=>c!=null),oe(N(i.value?s[1]:s[0])),oe(h(i.value?s[2]:s[1])),N(i.value?s[3]:s[2])]},([l,r,c,T])=>{if(e(),!(l!=null&&l.length)||!(r!=null&&r.length)||!(c!=null&&c.length))return;const $=Je(T)?{...T}:T;t.push(...l.flatMap(I=>r.flatMap(b=>c.map(m=>a(I,b,m,$)))))},{flush:"post"}),n=()=>{f(),e()};return Ie(e),n}let ye=!1;function ge(s,t,e={}){const{window:a=Le,ignore:i=[],capture:f=!0,detectIframe:n=!1,controls:l=!1}=e;if(!a)return l?{stop:Y,cancel:Y,trigger:Y}:Y;if(ce&&!ye){ye=!0;const d={passive:!0};Array.from(a.document.body.children).forEach(k=>J(k,"click",Y,d)),J(a.document.documentElement,"click",Y,d)}let r=!0;const c=d=>N(i).some(k=>{if(typeof k=="string")return Array.from(a.document.querySelectorAll(k)).some(x=>x===d.target||d.composedPath().includes(x));{const x=ee(k);return x&&(d.target===x||d.composedPath().includes(x))}});function T(d){const k=N(d);return k&&k.$.subTree.shapeFlag===16}function $(d,k){const x=N(d),P=x.$.subTree&&x.$.subTree.children;return P==null||!Array.isArray(P)?!1:P.some(K=>K.el===k.target||k.composedPath().includes(K.el))}const I=d=>{const k=ee(s);if(d.target!=null&&!(!(k instanceof Element)&&T(s)&&$(s,d))&&!(!k||k===d.target||d.composedPath().includes(k))){if("detail"in d&&d.detail===0&&(r=!c(d)),!r){r=!0;return}t(d)}};let b=!1;const m=[J(a,"click",d=>{b||(b=!0,setTimeout(()=>{b=!1},0),I(d))},{passive:!0,capture:f}),J(a,"pointerdown",d=>{const k=ee(s);r=!c(d)&&!!(k&&!d.composedPath().includes(k))},{passive:!0}),n&&J(a,"blur",d=>{setTimeout(()=>{var k;const x=ee(s);((k=a.document.activeElement)==null?void 0:k.tagName)==="IFRAME"&&!(x!=null&&x.contains(a.document.activeElement))&&t(d)},0)},{passive:!0})].filter(Boolean),_=()=>m.forEach(d=>d());return l?{stop:_,cancel:()=>{r=!1},trigger:d=>{r=!0,I(d),r=!1}}:_}const Dt={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=ge(s,t.value,{capture:e});else{const[a,i]=t.value;s.__onClickOutside_stop=ge(s,a,Object.assign({capture:e},i))}},unmounted(s){s.__onClickOutside_stop()}};function ie(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Me(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Me(e)}}function Ft(s){const t=s||window.event,e=t.target;return Me(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const re=new WeakMap;function Pt(s,t=!1){const e=Te(t);let a=null,i="";H(Xe(s),l=>{const r=ie(N(l));if(r){const c=r;if(re.get(c)||re.set(c,c.style.overflow),c.style.overflow!=="hidden"&&(i=c.style.overflow),c.style.overflow==="hidden")return e.value=!0;if(e.value)return c.style.overflow="hidden"}},{immediate:!0});const f=()=>{const l=ie(N(s));!l||e.value||(ce&&(a=J(l,"touchmove",r=>{Ft(r)},{passive:!1})),l.style.overflow="hidden",e.value=!0)},n=()=>{const l=ie(N(s));!l||!e.value||(ce&&(a==null||a()),l.style.overflow=i,re.delete(l),e.value=!1)};return Ie(n),M({get(){return e.value},set(l){l?f():n()}})}function Et(){let s=!1;const t=Te(!1);return(e,a)=>{if(t.value=a.value,s)return;s=!0;const i=Pt(e,a.value);H(t,f=>i.value=f)}}Et();const Bt=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},Nt=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Ut=Ze("syncError",()=>{const s=et(tt(st(()=>at.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:M(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function At(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Rt={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Ot=["href"],Ht=["src"],zt={class:"bold"},Wt={key:0,class:"hint custom-ml-4 nowrap"},jt=["onClick"],Kt=C({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=Q(),e=a=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[a])};return(a,i)=>{var f;return(f=a.task.attachments)!=null&&f.length?(o(),u("div",Rt,[(o(!0),u(U,null,X(a.task.attachments,n=>(o(),u("div",{key:n.uuid||n.id,class:"pl-attachments__item small"},[p("a",{href:n.download_url,target:"_blank"},[n.preview_url?(o(),u("img",{key:0,src:n.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Ht)):(o(),u(U,{key:1},[p("span",zt,w(n.file_name),1),n.size?(o(),u("span",Wt,w(h(At)(n.size)),1)):y("",!0)],64))],8,Ot),a.isFocused?(o(),u("div",{key:0,class:z(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":n.preview_url}])},[p("a",{class:z(n.preview_url?"button circle white":"custom-ml-8"),onClick:G(l=>e(n.id),["prevent"])},i[0]||(i[0]=[p("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,jt)],2)):y("",!0)]))),128))])):y("",!0)}}}),ue=C({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=nt(),a=M(()=>e.getItemById(t.userId));return(i,f)=>{var n;return(n=a.value)!=null&&n.photo_url?(o(),u("span",{key:0,class:"icon userpic",style:xe({backgroundImage:`url(${a.value.photo_url})`})},null,4)):y("",!0)}}}),qt={key:0,class:"tw-cursor-pointer"},Vt={key:0,class:"pl-list-item-firedBullet"},Qt={key:1,class:"tw-cursor-pointer"},Yt=C({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,a=t,i=S(e.task.status===1);H(()=>e.task.status,l=>{i.value=l===1});const f=M(()=>ot(e.task)),n=()=>{i.value=!i.value,a("complete")};return(l,r)=>(o(),u("div",{class:"tw-w-5 tw-flex-none",onClick:n},[L($e,{name:"bounce",mode:"out-in"},{default:F(()=>{var c;return[i.value?(o(),u("div",Qt,r[0]||(r[0]=[p("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(o(),u("div",qt,[f.value===h(lt)?(o(),u("div",Vt)):(o(),u("div",{key:1,class:"pl-list-item-bullet",style:xe(`background-color: ${(c=h(it).get(f.value))==null?void 0:c.color}`)},null,4))]))]}),_:1})]))}}),Jt=new WeakMap;function Xt(){const s=rt(),t=de(),e=()=>{var r;const f=[...s.matched].reverse().find(c=>{var T;return(T=c.meta)==null?void 0:T.isListView})||null,n=((r=f==null?void 0:f.children)==null?void 0:r.find(c=>{var T;return(T=c.meta)==null?void 0:T.isTaskInfoView}))||null,l={listViewRoute:f,taskInfoRoute:n};return Jt.set(s,l),l};return{navigateToTaskInfo:async i=>{const{listViewRoute:f,taskInfoRoute:n}=e();if(!f||!(n!=null&&n.name))return console.warn("Required routes not found"),!1;try{const l=await t.push({name:n.name,params:{taskId:i}});return!ut(l)}catch(l){return console.error("Navigation failed:",l),!1}}}}const Gt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Zt={class:"hint"},es={class:"hint"},ts={class:"hint"},ss={class:"tw-clear-both tw-inline-block"},as=["placeholder","data-id","innerHTML"],ns=["innerHTML"],os={class:"flexbox space-8 custom-pt-2 tw-flex-none"},ls={key:0},is={key:1},rs={key:2,class:"tw-flex-none"},us=["title"],cs=["title"],ds={class:"bold small"},fs={key:5,class:"hint tw-flex-none custom-mt-2"},ps={key:6,class:"hint tw-flex-none custom-mt-2"},ms={key:0},ks={key:1},vs={key:7,class:"hint tw-flex-none custom-mt-2"},hs={key:8,class:"flexbox middle tw-flex-none"},_s={key:9,class:"flexbox middle tw-flex-none"},ys={key:10,class:"flexbox middle tw-flex-none"},gs={key:11,class:"flexbox middle space-4 tw-flex-none"},ws=["href"],bs=["src"],Ts=C({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,a=t,i=Q(),f=Ut(),{navigateToTaskInfo:n}=Xt(),l=ke(Ce),r=ke(mt),c=S(!1),T=S(!1),$=S(e.task.name),I=S(e.task.status);H(()=>e.task.status,g=>{I.value=g});const b=S();M(()=>ae(e.task));const m=["name","due_date","due_datetime","priority","location_id"],_=S({});H(()=>e.task,()=>{_.value=ze(m,e.task)},{immediate:!0});const{history:d,clear:k,pause:x,resume:P,commit:K}=ct(_,{deep:!0});x(),H(c,()=>{if(c.value)P();else{const g=b.value.innerText.trim();if(ae(e.task)&&!g){a("delete",e.task,_.value);return}K(),x(),e.task.name!==g&&a("update",e.task,{name:g}),k()}});let q=null;const fe=()=>{a("complete",e.task,_.value)};dt(()=>{ae(e.task)&&(b.value.focus(),c.value=!0)}),Se(()=>{q&&(clearTimeout(q),q=null,fe())});const Fe=g=>{if(g.target instanceof HTMLAnchorElement){const v=g.target.href;g.preventDefault(),setTimeout(()=>{window.open(v,"_blank")})}},Pe=()=>{I.value=I.value?0:1,b.value.classList.toggle("opacity-50"),!(q&&(clearTimeout(q),q=null,e.task.status===I.value))&&(q=setTimeout(fe,1e3))},pe=()=>{T.value||a("blur",e.task,_.value)},Ee=g=>{var R;g.preventDefault();const v=(R=g.clipboardData)==null?void 0:R.getData("text/plain");if(!v)return;if(b.value.innerText){document.execCommand("insertText",!1,v);return}const A=v.split(`
`).filter(E=>E);A.length&&a("insertMany",e.task,A.map(E=>({name:Bt(E),...e.addableProps,...Nt(E)?{status:1}:{}})))},Be=g=>{te(g.target)===0&&(T.value=!0,l==null||l.onLeft(g),a("delete",e.task,_.value))},Ne=async g=>{if(g.shiftKey)return;if(g.preventDefault(),e.isEnterDisabled){pe(),b.value.blur(),c.value=!1,await kt(),a("insertFirst",{...e.addableProps});return}const v=g.target,A=v.innerText.trim(),R=te(v);let E,Z;R!==0&&(E=A.substring(0,R).trim(),Z=A.substring(R,A.length).trim(),v.innerText=E),A&&a("insert",e.task,{...e.addableProps},{currentName:E,newName:Z}),b.value.blur(),c.value=!1},Ue=g=>{$.value=g.target.innerText},Ae=()=>{setTimeout(()=>{b.value.blur(),c.value=!1})},Re=()=>{a("update",e.task,{favorite:e.task.favorite?0:1})},ne=async g=>{g.target.closest("[contenteditable], .chips li, a")===null&&await n(e.task.id)};function Oe(g){return new URL(Object.assign({"../../assets/apps/shop.svg":We,"../../assets/apps/tasks.svg":je})[`../../assets/apps/${g}.svg`],import.meta.url).href}return(g,v)=>{var A,R,E,Z;return T.value?y("",!0):(o(),u("div",{key:0,class:z(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":g.$route.meta.isTaskInfoView&&((A=g.$route.params)==null?void 0:A.taskId)==e.task.id,highlighted:h(i).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(o(),u("div",Gt,v[6]||(v[6]=[p("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):y("",!0),L(Yt,{task:e.task,onComplete:Pe},null,8,["task"]),p("div",{class:"tw-flex-auto",onClick:ne},[(R=h(r))!=null&&R.is_debug_mode?(o(),u(U,{key:0},[p("span",Zt,"list_id: "+w(String(e.task.list_id)),1),v[7]||(v[7]=W(" | ")),p("span",es,"id: "+w(e.task.id),1),v[8]||(v[8]=W(" | ")),p("span",ts,"srank: "+w(String(e.task.sort))+" | "+w(String(e.task.rank)),1)],64)):y("",!0),ft((o(),u("div",null,[p("div",ss,[p("div",{ref_key:"contenteditableRef",ref:b,contenteditable:"",class:z(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[j(Ne,["enter"]),v[0]||(v[0]=j(D=>{var B;(B=h(l))==null||B.onLeft(D,()=>{c.value=!1})},["left"])),v[1]||(v[1]=j(D=>{var B;(B=h(l))==null||B.onUp(D,()=>{c.value=!1})},["up"])),v[2]||(v[2]=j(D=>{var B;(B=h(l))==null||B.onRight(D,()=>{c.value=!1})},["right"])),v[3]||(v[3]=j(D=>{var B;(B=h(l))==null||B.onDown(D,()=>{c.value=!1})},["down"])),j(Be,["delete"]),j(Ae,["esc"]),v[4]||(v[4]=j(()=>{c.value=!1},["tab"]))],onMousedown:Fe,onFocus:v[5]||(v[5]=D=>c.value=!0),onBlur:pe,onPaste:Ee,onInput:Ue,innerHTML:h(_e)(c.value?e.task.name:h(me)(e.task.name))},null,42,as)]),e.task.note?(o(),u("div",{key:0,class:"hint tw-break-all tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:h(_e)(h(me)(e.task.note))},null,8,ns)):y("",!0),L(Mt,{task:g.task,input:$.value,"is-focused":c.value},null,8,["task","input","is-focused"])])),[[h(Dt),()=>{c.value=!1}]]),L(Kt,{task:e.task,"is-focused":c.value},null,8,["task","is-focused"])]),p("div",os,[e.showInfoLink?(o(),u("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:G(ne,["prevent"])},v[9]||(v[9]=[p("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):y("",!0),I.value?y("",!0):(o(),u("div",{key:1,class:z(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:Re},[e.task.favorite?(o(),u("span",ls,v[10]||(v[10]=[p("i",{class:"fas fa-star text-yellow"},null,-1)]))):(o(),u("span",is,v[11]||(v[11]=[p("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),h(f).taskErrorMap.get(e.task.id)?(o(),u("div",rs,[p("span",{class:"icon",style:{color:"orange"},title:h(f).taskErrorMap.get(e.task.id)},v[12]||(v[12]=[p("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,us)])):y("",!0),!h(pt)(e.task)&&!h(ae)(e.task)?(o(),u("div",{key:3,class:"tw-flex-none",title:g.$t("syncing")},v[13]||(v[13]=[p("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,cs)):y("",!0),(E=e.task.extended_data)!=null&&E.comments_count?(o(),u("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:G(ne,["prevent"])},[v[14]||(v[14]=p("i",{class:"fas fa-comment"},null,-1)),p("span",ds,w(e.task.extended_data.comments_count),1)])):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(o(),u("div",fs,w(h(O)().to(h(O)(e.task.create_datetime),!0)),1)):y("",!0),!I.value&&e.task.assigned_contact_id?(o(),u("div",ps,[e.task.update_datetime?(o(),u("span",ms,w(h(O)().to(h(O)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(o(),u("span",ks,w(h(O)().to(h(O)(e.task.create_datetime),!0)),1)):y("",!0)])):y("",!0),e.task.complete_datetime?(o(),u("div",vs,w(h(O)().to(h(O)(e.task.complete_datetime),!0)),1)):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.contact_id?(o(),u("div",hs,[L(ue,{"user-id":e.task.contact_id},null,8,["user-id"])])):y("",!0),!I.value&&e.task.assigned_contact_id?(o(),u("div",_s,[L(ue,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):y("",!0),I.value&&e.task.complete_contact_id?(o(),u("div",ys,[L(ue,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):y("",!0),(Z=e.task.external_links)!=null&&Z.length?(o(),u("div",gs,[(o(!0),u(U,null,X(e.task.external_links,D=>(o(),u("a",{key:D.id,href:D.entity_link,class:"icon size-20",target:"_blank"},[p("img",{src:Oe(D.app)},null,8,bs)],8,ws))),128))])):y("",!0)])],2))}}}),Is=C({__name:"ListNavigationProvider",setup(s){const t=S();return vt(Ce,Tt(t)),(e,a)=>(o(),u("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[V(e.$slots,"default")],512))}}),xs=C({__name:"TaskListItemStoreProvider",setup(s){const t=Q(),e=r=>t.completeTask(r),a=(r,c)=>t.updateItem(r,c),i=async(r,c,T)=>{await t.insert(T.currentName?"after":"before",r,{...c,name:T.newName})},f=(r,c)=>{t.insertMany(r,c)},n=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},l=r=>t.deleteItem(r);return(r,c)=>V(r.$slots,"default",{onComplete:e,onUpdate:a,onInsert:i,onInsertMany:f,onInsertFirst:n,onDelete:l})}}),$s=C({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,a=t,i=S(null),{stop:f}=ht(i,([{isIntersecting:n}])=>{n&&!e.disabled&&a("intersecting")},{rootMargin:"200px"});return Se(()=>{f()}),(n,l)=>(o(),u("div",{ref_key:"elRef",ref:i},[V(n.$slots,"default")],512))}}),Ss={key:0,class:"skeleton custom-m-24"},Cs={key:0},Ls={class:"box custom-py-24 small align-center gray"},Ms={class:"skeleton custom-m-24"},we=30,Ds=C({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=Q(),a=yt(),i=S(we),f=S([]),n=S(!1),l=S(!1),r=M(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:f.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),c=M(()=>r.value.source.slice(0,i.value));H(()=>t,$,{deep:!0,immediate:!0});const T=()=>{i.value+=we};async function $(){const{isFetchStream:b,fetchParams:m,disableCheckin:_}=r.value;if(!m||!I(m))return;if(n.value=!1,f.value=[],t.filter==="list"){const k=a.task.value.get(JSON.stringify({list_id:t.listId})),x=a.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),P=a.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),K=k||x;if(K)if(t.shouldFilterUncompleted){if(P)return}else delete m.status,m.starting_from=_t(new Date(K))}l.value="starting_from"in m?!m.starting_from:!1;const d=await e[b?"fetchStream":"fetch"]({...m},{disableCheckin:_});l.value=!1,d&&d.value&&d.value.status_code==="ok"&&t.filter==="search"&&(f.value=[...f.value,...d.value.data],n.value=!f.value.length)}function I(b){return!(!b||b.list_id&&typeof b.list_id!="number"||b.location_id&&typeof b.location_id!="number")}return(b,m)=>l.value?(o(),u("div",Ss,[(o(),u(U,null,X(5,_=>p("span",{key:_,class:"skeleton-custom-box",style:{height:"40px"}})),64))])):(o(),u(U,{key:1},[V(b.$slots,"default",{tasks:c.value}),t.filter==="search"&&n.value?(o(),u("div",Cs,[p("p",Ls,[W(w(b.$t("searchNoMatches"))+" ",1),p("strong",null,w(t.searchQuery),1)])])):y("",!0),L($e,{name:"fade"},{default:F(()=>[c.value.length&&c.value.length<r.value.source.length?(o(),se($s,{key:0,onIntersecting:T},{default:F(()=>[p("div",Ms,[(o(),u(U,null,X(5,_=>p("span",{key:_,class:"skeleton-custom-box",style:{height:"40px"}})),64))])]),_:1})):y("",!0)]),_:1})],64))}}),Fs=C({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=Q(),a=de();H(a.currentRoute,async f=>{const n={...f.query};"addNewTask"in n&&(await i(),delete n.addNewTask,a.replace({path:f.path,query:n}))},{immediate:!0});async function i(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(f,n)=>(o(),u("div",{class:"text-gray pl-list-item-title",onClick:i},[n[0]||(n[0]=p("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),W(" "+w(f.$t("newToDo")),1)]))}}),Ps={class:"dialog-header"},Es={class:"dialog-content empty:tw-hidden"},Bs={class:"dialog-footer tw-flex tw-gap-2"},De=C({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(t,e)=>(o(),u(U,null,[p("header",Ps,[p("h3",null,w(t.$props.title),1),t.hideCloseIcon?y("",!0):(o(),u("a",{key:0,class:"dialog-close",onClick:e[0]||(e[0]=G(a=>t.$emit("close"),["prevent"]))},e[2]||(e[2]=[p("i",{class:"fas fa-times"},null,-1)])))]),p("div",Es,[V(t.$slots,"default")]),p("footer",Bs,[V(t.$slots,"submit"),t.hideCloseButton?y("",!0):(o(),u("button",{key:0,class:"button light-gray",onClick:e[1]||(e[1]=a=>t.$emit("close"))}," Close "))])],64))}}),Ns=C({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(o(),se(De,{title:t.title,"hide-close-icon":!0},{submit:F(()=>[p("button",{class:"danger",onClick:e[0]||(e[0]=(...a)=>t.onDelete&&t.onDelete(...a))}," Delete ")]),default:F(()=>[W(w(t.text)+" ",1)]),_:1},8,["title"]))}}),Us={class:"tw-w-68"},As={class:"menu"},Rs={href:"javascript:void(0);"},Os={class:"menu"},Hs=["onClick"],zs=["disabled"],Ws=C({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=gt(),e=be(),a=S(),i=()=>{a.value&&s.onMove(a.value)};return(f,n)=>(o(),se(De,{title:f.title,"hide-close-icon":!0},{submit:F(()=>[p("button",{disabled:!a.value,onClick:G(i,["prevent"])}," Move ",8,zs)]),default:F(()=>[p("div",Us,[p("ul",As,[(o(!0),u(U,null,X(h(t).items,l=>(o(),u("li",{key:l.uuid||l.id},[p("a",Rs,w(l.name),1),p("ul",Os,[(o(!0),u(U,null,X(h(e).getListsInPocket(l.id),r=>(o(),u("li",{key:r.uuid||r.id,class:z(a.value===r.id&&"selected rounded")},[p("a",{href:"#",onClick:G(()=>{a.value=a.value===r.id?void 0:r.id},["prevent"])},w(r.name),9,Hs)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),js={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Ks={class:"hint"},qs={class:"hint"},Vs=C({__name:"TaskListMultiselect",setup(s){const t=Q(),e=S(new Set),{show:a,hide:i}=ve(Ns,{title:"Delete",text:he(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),i()}}),{show:f,hide:n}=ve(Ws,{title:"Move Items",text:he(()=>`Delete ${e.value.size} selected items?`),onMove:async $=>{await t.sort($,null,[...e.value]),e.value.clear(),n()}}),l=$=>{e.value.add($)},r=$=>{e.value.delete($)},c=()=>{f()},T=()=>{a()};return($,I)=>(o(),u(U,null,[e.value.size?(o(),u("div",js,[p("button",{class:"button light-gray smaller",onClick:c},[I[0]||(I[0]=p("i",{class:"fas fa-list text-blue"},null,-1)),W(" "+w($.$t("Move"))+" ",1),p("span",Ks,w(e.value.size),1)]),p("button",{class:"button light-gray smaller",onClick:T},[I[1]||(I[1]=p("i",{class:"fas fa-trash-alt text-red"},null,-1)),W(" "+w($.$t("Delete"))+" ",1),p("span",qs,w(e.value.size),1)])])):y("",!0),V($.$slots,"default",{onSelect:l,onDeselect:r})],64))}}),Qs={class:"pl-bg-block custom-pb-4"},Ys={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Js={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Xs={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},Gs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},aa=C({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=Q(),a=M(()=>["upnext","due","priority","nearby","user"].includes(t.filter));return(i,f)=>(o(),u("div",Qs,[t.header?(o(),u("div",Ys,[p("h1",null,w(t.header),1)])):y("",!0),L(Is,null,{default:F(()=>[L(Ds,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:F(({tasks:n})=>[!n.length&&t.startMessage&&h(e).isPreFilled?(o(),u("div",Js,w(t.startMessage),1)):y("",!0),t.hideAddNewTask?y("",!0):(o(),u("div",Xs,[L(Fs,{"addable-props":t.addableProps,"should-pin-new-task":a.value},null,8,["addable-props","should-pin-new-task"])])),i.shouldFilterUncompleted&&!i.hideUncompletedLabel&&n.length?(o(),u("div",Gs,w(i.$t("completed")),1)):y("",!0),L(Vs,null,{default:F(({onSelect:l,onDeselect:r})=>[L(bt,{items:n,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:h(e).sort,onSelect:l,onDeselect:r},{default:F(({item:c})=>[L(xs,null,{default:F(({onUpdate:T,onComplete:$,onInsert:I,onInsertMany:b,onInsertFirst:m,onDelete:_,onBlur:d})=>[L(Ts,{task:c,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:T,onComplete:$,onInsert:I,onInsertMany:b,onInsertFirst:m,onDelete:_,onBlur:d},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{aa as _,De as a};
