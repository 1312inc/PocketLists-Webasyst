import{d as P,aJ as S,r as Y,K as $,m as T,o as c,z as I,q as y,W as b,ai as O,S as A,f as e,j as k,t as f,e as v,s as N,v as x,g as j,y as F,i as g,D as q,R as W,F as B,B as J,aK as G,a5 as K,u as Q,c as U,h as V,n as H,af as X,J as D,k as E,b as R}from"./index-9lyX9db-.js";const Se=""+new URL("img/shop.svg",import.meta.url).href,be="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.85619%2017.2942L5.86319%2020.6332L22.1312%201.06423C24.3722%200.898238%2026.6255%201.05688%2028.8212%201.53523L6.56619%2028.3052L0.867188%2023.5572C0.908188%2021.3822%201.25019%2019.2812%201.85619%2017.2942Z'%20fill='%23E80A8A'/%3e%3cpath%20d='M35.4942%204.15186C38.9684%206.19305%2041.8486%209.10706%2043.8492%2012.6049L25.3792%2034.8219L3.36719%2016.4809L10.9402%207.39386L23.8532%2018.1539L35.4932%204.15186H35.4942Z'%20fill='%2329ABE2'/%3e%3cpath%20d='M18.6278%2013.798L11.0658%2022.894L6.88281%2019.409L14.4448%2010.313L18.6278%2013.798V13.798Z'%20fill='%23292A76'/%3e%3cpath%20d='M4.01953%2035.6338L18.9695%2017.6138L27.3515%2024.5658L11.6495%2043.4918C8.51344%2041.5215%205.89666%2038.8265%204.01953%2035.6338V35.6338Z'%20fill='%23F7EA34'/%3e%3cpath%20d='M23.8675%2047C36.5705%2047%2046.8685%2036.703%2046.8685%2024C46.8685%2023.142%2046.8215%2022.294%2046.7305%2021.46L30.0085%2041.574L18.5015%2032.07L12.5215%2039.308L21.7155%2046.902C22.4235%2046.967%2023.1415%2047.001%2023.8675%2047.001V47Z'%20fill='%2349B749'/%3e%3cpath%20d='M44.8763%2033.3699C46.2421%2030.3102%2046.9204%2026.9882%2046.8633%2023.6379L44.1153%2026.9429L35.6863%2019.9829L32.6973%2023.6029L44.7343%2033.5419L44.8763%2033.3709V33.3699Z'%20fill='%23F1B61C'/%3e%3cpath%20d='M36.8902%2020.9769L33.8892%2024.5869L32.6992%2023.6029L35.6872%2019.9829L36.8892%2020.9769H36.8902Z'%20fill='%23097D3F'/%3e%3cpath%20d='M17.0791%2045.9832L28.7711%2031.8892L32.3841%2034.8862L22.3731%2046.9522C20.5762%2046.8379%2018.7989%2046.5123%2017.0781%2045.9822L17.0791%2045.9832Z'%20fill='%23F05323'/%3e%3cpath%20d='M22.3757%2046.9518L28.1267%2040.0198L24.5077%2037.0298L18.5137%2044.2548L21.7157%2046.8998C21.9347%2046.9198%2022.1547%2046.9378%2022.3757%2046.9518V46.9518Z'%20fill='%232B3F1B'/%3e%3cpath%20d='M24.5635%2029.7328L36.5855%2015.2658L33.7695%2012.9258L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4738L24.5635%2029.7338V29.7328Z'%20fill='%23292A76'/%3e%3cpath%20d='M21.5154%2031.6018L13.1484%2024.6308L18.9704%2017.6128L27.3524%2024.5658L21.5154%2031.6018V31.6018Z'%20fill='%2313A149'/%3e%3cpath%20d='M25.4245%2022.9678L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4748L23.6815%2028.9888L27.3515%2024.5658L25.4245%2022.9678V22.9678Z'%20fill='%230C0D1B'/%3e%3cpath%20d='M42.9619%2025.9902L44.1159%2026.9442L46.8639%2023.6392C46.9212%2026.9897%2046.2429%2030.3121%2044.8769%2033.3722L44.7349%2033.5422L39.9609%2029.6002L42.9609%2025.9902H42.9619Z'%20fill='%23269145'/%3e%3c/svg%3e",ee={class:"menu"},te=["onClick"],ae=["onClick"],le=["onClick"],se=["onClick"],oe={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ne={key:0},ie={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ue=P({__name:"TaskListItemPopupMenuWhen",props:{dueDate:{},dueDateModifiers:{},dueDatetime:{},dueDatetimeModifiers:{}},emits:["update:dueDate","update:dueDatetime"],setup(i){const l=S(i,"dueDate"),o=S(i,"dueDatetime"),u=Y(l.value),t=Y(o.value?$(o.value).format("HH:mm"):""),s=Y(!1),a=Y(!1);T([l,o],()=>{s.value=!!(l.value||o.value),a.value=!!o.value},{immediate:!0}),T(t,()=>{!u.value&&t.value&&(u.value=$().format("YYYY-MM-DD"))}),T([u,t],([L,p])=>{l.value=L||null,o.value=p?O(`${L||$().format("YYYY-MM-DD")}T${p}`):null});const d=L=>{u.value=L,t.value=""},C=()=>{u.value="",t.value="",s.value=!1},h=()=>{t.value=""};return(L,p)=>(c(),I(b,null,{default:y(({handler:m,setRef:n})=>[A(L.$slots,"default",{handler:m,setRef:n})]),body:y(({handler:m})=>[e("ul",ee,[e("li",null,[e("a",{onClick:()=>{d(k($)().format("YYYY-MM-DD")),m()}},f(L.$t("datePicker.today")),9,te)]),e("li",null,[e("a",{onClick:()=>{d(k($)().add(1,"day").format("YYYY-MM-DD")),m()}},f(L.$t("datePicker.tomorrow")),9,ae)]),e("li",null,[e("a",{onClick:()=>{d(k($)().add(2,"day").format("YYYY-MM-DD")),m()}},f(L.$t("datePicker.in2days")),9,le)]),e("li",null,[e("a",{onClick:()=>{d(k($)().endOf("week").format("YYYY-MM-DD")),m()}},f(L.$t("datePicker.thisWeekend")),9,se)]),e("li",null,[s.value?(c(),v("div",oe,[N(e("input",{"onUpdate:modelValue":p[1]||(p[1]=n=>u.value=n),type:"date",class:"width-100"},null,512),[[x,u.value]]),e("a",{onClick:C},p[4]||(p[4]=[e("i",{class:"fas fa-times"},null,-1)]))])):(c(),v("a",{key:0,onClick:p[0]||(p[0]=n=>s.value=!s.value)},f(L.$t("datePicker.selectDate")),1))]),s.value?(c(),v("li",ne,[a.value?(c(),v("div",ie,[N(e("input",{"onUpdate:modelValue":p[3]||(p[3]=n=>t.value=n),type:"time",class:"width-100"},null,512),[[x,t.value]]),e("a",{onClick:h},p[5]||(p[5]=[e("i",{class:"fas fa-times"},null,-1)]))])):(c(),v("a",{key:0,onClick:p[2]||(p[2]=n=>a.value=!a.value)},f(L.$t("datePicker.selectTime")),1))])):j("",!0)])]),_:3}))}}),re={class:"menu"},de=["onClick"],ce=P({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const l=S(i,"modelValue");return(o,u)=>(c(),I(b,null,{default:y(({handler:t,setRef:s})=>[A(o.$slots,"default",{handler:t,setRef:s})]),body:y(({handler:t})=>[e("ul",re,[(c(!0),v(B,null,F([...k(W).values()],s=>(c(),v("li",{key:s.priority},[e("a",{onClick:g(()=>{l.value=s.priority,t()},["prevent"])},[e("i",{class:"fas fa-exclamation-circle",style:q(`color: ${s.color}`)},null,4),e("span",null,f(s.name),1)],8,de)]))),128))])]),_:3}))}}),pe=P({__name:"TaskListItemPopupMenuAttachment",props:{task:{}},setup(i){const l=i,o=J(),{files:u,open:t,reset:s,onCancel:a,onChange:d}=G({});return d(async C=>{C&&(await o.addAttachments(l.task,[...C]),s())}),a(()=>{s()}),(C,h)=>A(C.$slots,"default",{open:k(t)})}}),me={class:"menu"},fe=["onClick"],ve=P({__name:"TaskListItemPopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const l=S(i,"modelValue"),o=K(),u=t=>{l.value=t};return(t,s)=>(c(),I(b,null,{default:y(({handler:a,setRef:d})=>[A(t.$slots,"default",{handler:a,setRef:d})]),body:y(({handler:a})=>[e("ul",me,[e("li",null,[e("a",{onClick:s[0]||(s[0]=g(d=>u(null),["prevent"]))},[e("span",null,f(t.$t("None")),1)])]),e("li",null,[e("a",{onClick:s[1]||(s[1]=g(d=>t.$router.push({name:"map"}),["prevent"]))},[e("span",null,f(t.$t("New address")),1),s[2]||(s[2]=e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1))])]),(c(!0),v(B,null,F(k(o).items,d=>(c(),v("li",{key:d.uuid||d.id},[e("a",{onClick:g(()=>{u(d.id),a()},["prevent"])},f(d.name),9,fe)]))),128))])]),_:3}))}});function M(i){return i!=null&&typeof i=="object"&&i["@@functional/placeholder"]===!0}function Z(i){return function l(o){return arguments.length===0||M(o)?l:i.apply(this,arguments)}}function ke(i){return function l(o,u){switch(arguments.length){case 0:return l;case 1:return M(o)?l:Z(function(t){return i(o,t)});default:return M(o)&&M(u)?l:M(o)?Z(function(t){return i(t,u)}):M(u)?Z(function(t){return i(o,t)}):i(o,u)}}}var Le=ke(function(l,o){for(var u={},t=0;t<l.length;)l[t]in o&&(u[l[t]]=o[l[t]]),t+=1;return u});const _e=["onClick"],ye=["onClick"],ge=["onClick"],Ce={key:0},he=["onClick"],$e={class:"icon"},De=["src"],Me={class:"menu"},we=["onClick"],Ve=["onClick"],Ye={class:"icon"},Te=["src"],Be=["onClick"],Ae=P({__name:"TaskListItemPopupMenu",props:{task:{},isSmall:{type:Boolean},hideAssign:{type:Boolean}},setup(i){const l=i,o=J(),u=K(),t=Q(),s=["name","due_date","due_datetime","priority","location_id"],a=Y({});let d=[];const C=U(()=>l.task.assigned_contact_id&&t.getItemById(l.task.assigned_contact_id)),h=U(()=>X(l.task)),L=U(()=>({"text-red":h.value===3,"text-yellow":h.value===2,"text-green":h.value===1,grey:h.value===0}));T(()=>l.task,m=>{d.forEach(n=>n()),a.value=Le(s,m),d=s.map(n=>T(()=>a.value[n],async r=>{await o.updateItem(l.task,{[n]:r})}))},{immediate:!0});const p=async m=>{await o.updateItem(l.task.id,{assigned_contact_id:m})};return(m,n)=>(c(),v("ul",{class:H([l.isSmall?"smaller":"small","chips custom-m-0"])},[V(ue,{dueDate:a.value.due_date,"onUpdate:dueDate":n[0]||(n[0]=r=>a.value.due_date=r),dueDatetime:a.value.due_datetime,"onUpdate:dueDatetime":n[1]||(n[1]=r=>a.value.due_datetime=r)},{default:y(({handler:r,setRef:_})=>[e("li",null,[e("a",{ref:_,class:H(L.value),onClick:g(r,["prevent"])},[n[4]||(n[4]=e("i",{class:"fas fa-calendar-alt"},null,-1)),D(" "+f(a.value.due_datetime?k(E)(a.value.due_datetime).format("LLL"):a.value.due_date?k(E)(a.value.due_date).format("LL"):m.$t("When")),1)],10,_e)])]),_:1},8,["dueDate","dueDatetime"]),V(ve,{modelValue:a.value.location_id,"onUpdate:modelValue":n[2]||(n[2]=r=>a.value.location_id=r)},{default:y(({handler:r,setRef:_})=>{var w;return[e("li",null,[e("a",{ref:_,onClick:g(r,["prevent"])},[n[5]||(n[5]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),D(" "+f(a.value.location_id?(w=k(u).getItemById(a.value.location_id))==null?void 0:w.name:m.$t("Where")),1)],8,ye)])]}),_:1},8,["modelValue"]),V(ce,{modelValue:a.value.priority,"onUpdate:modelValue":n[3]||(n[3]=r=>a.value.priority=r)},{default:y(({handler:r,setRef:_})=>{var w,z;return[e("li",null,[e("a",{ref:_,onClick:g(r,["prevent"])},[(c(),v("span",{key:a.value.priority},[e("i",{style:q(`color: ${a.value.priority&&((w=k(W).get(a.value.priority))==null?void 0:w.color)}`),class:"fas fa-exclamation-circle"},null,4)])),D(" "+f(a.value.priority?(z=k(W).get(a.value.priority))==null?void 0:z.name:m.$t("Priority")),1)],8,ge)])]}),_:1},8,["modelValue"]),!m.hideAssign&&(k(R).user_rights.canassign||k(R).user_rights.backend==="FULL")?(c(),v("li",Ce,[V(b,null,{default:y(({handler:r,setRef:_})=>[e("a",{ref:_,onClick:g(r,["prevent"])},[C.value?(c(),v(B,{key:0},[e("span",$e,[e("img",{src:C.value.photo_url,class:"userpic"},null,8,De)]),D(" "+f(C.value.name),1)],64)):(c(),v(B,{key:1},[n[6]||(n[6]=e("i",{class:"fas fa-arrow-right"},null,-1)),D(" "+f(m.$t("Assign to-do")),1)],64))],8,he)]),body:y(({handler:r})=>[e("ul",Me,[e("li",null,[e("a",{onClick:g(()=>{p(null),r()},["prevent"])},f(m.$t("No assignment")),9,we)]),(c(!0),v(B,null,F(k(t).items,_=>(c(),v("li",{key:_.id,class:"item"},[e("a",{onClick:g(()=>{p(_.id),r()},["prevent"])},[e("span",Ye,[e("img",{src:_.photo_url,class:"userpic"},null,8,Te)]),e("span",null,f(_.name),1)],8,Ve)]))),128))])]),_:1})])):j("",!0),V(pe,{task:l.task},{default:y(({open:r})=>[e("li",null,[e("a",{onClick:g(()=>{r()},["prevent"])},[n[7]||(n[7]=e("i",{class:"fas fa-paperclip"},null,-1)),D(" "+f(m.$t("Attach")),1)],8,Be)])]),_:1},8,["task"])],2))}});function Ue(i){const l=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),o=/(https?:\/\/[^\s<"']{2,}|ftp:\/\/[^\s<"']{2,}|www\.[^\s<"']+\.[a-z]{2,}(?:\/[^\s<"']*)?|[\w.+-]+@[a-z\d-]+\.[a-z]{2,}(?:\.[a-z]{2,})*)/gi;return l.replace(o,t=>{let s=t,a=t;return t.includes("@")?t.startsWith("mailto:")||(s=`mailto:${t}`):/^(https?|ftp):\/\//i.test(t)||(s=`https://${t}`,a=t.replace(/^www\./i,"")),/^(https?|ftp|mailto):/i.test(s)?`<a href="${s.replace(/"/g,"%22").replace(/'/g,"%27")}" target="_blank" rel="noopener noreferrer nofollow">${a}</a>`:a})}export{Ae as _,Se as a,be as b,Z as c,ke as d,Le as p,Ue as t};
