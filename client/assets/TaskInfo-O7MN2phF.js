import{d as w,u as h,a as g,r as p,o as d,c as m,b as t,w as k,t as f,e as u,f as x,g as b,h as v,i as I,j as y,T as C,k as T,v as $,l as B,m as S,F as R,n as D,p as M,q as V}from"./index-9V6UU8C7.js";import{C as E}from"./ContenteditableBlock-k5FtfrIS.js";import"./rangy-5rxgwlWZ.js";const N={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background custom-p-16 tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},U={class:"tw-flex tw-gap-2"},F={class:"tw-flex tw-gap-2"},K={class:"tw-truncate"},L={class:"hint"},j={class:"hint"},q=w({__name:"TaskInfoChatItem",props:{message:{}},setup(r){const e=r,l=h(),i=g(),o=p(!1),a=()=>{i.deleteItem(e.message)},n=c=>{i.updateItem(e.message,{comment:c})};return(c,s)=>{var _;return d(),m("div",N,[t("div",U,[t("a",{onClick:k(a,["prevent"])},s[1]||(s[1]=[t("i",{class:"fas fa-times"},null,-1)])),t("a",{onClick:s[0]||(s[0]=k(Q=>o.value=!0,["prevent"]))},s[2]||(s[2]=[t("i",{class:"fas fa-edit"},null,-1)]))]),t("div",F,[t("div",K,f((_=u(l).getItemById(e.message.contact_id))==null?void 0:_.name),1),t("div",L,f(u(x)(u(b)(e.message)).format("ll")),1)]),v(E,{editable:o.value,focusable:!0,value:e.message.comment,tag:"div",onUpdate:n},null,8,["editable","value"]),t("div",j,f(typeof e.message.id=="number"?"delivered":"not delivered"),1)])}}}),G={class:"tw-flex tw-flex-col tw-h-full"},z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},A={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-bg-block"},H={class:"state-with-inner-icon right width-100"},J=w({__name:"TaskInfoChat",props:{taskId:{}},setup(r){const e=r,l=g(),i=p(),o=p("");I(()=>e.taskId,n=>S(n)&&l.fetch({item_id:n}),{immediate:!0});const a=async()=>{const n=await l.insert(e.taskId);n&&(l.updateItem(n,{comment:o.value}),o.value="",i.value.focus())};return(n,c)=>(d(),m("div",G,[t("div",z,[v(C,{name:"slide-right"},{default:y(()=>[(d(!0),m(R,null,D(u(l).getComentsByTaskId(e.taskId),s=>(d(),M(q,{key:s.uuid||s.id,message:s},null,8,["message"]))),128))]),_:1})]),t("div",A,[t("div",H,[T(t("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":c[0]||(c[0]=s=>o.value=s),type:"text",placeholder:"Type a message",class:"width-100",onKeydown:B(a,["enter"])},null,544),[[$,o.value]]),t("button",{class:"icon",onClick:a},c[1]||(c[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),O={class:"pl-bg-block tw-h-full tw-flex tw-flex-col"},P={class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},Z=w({__name:"TaskInfo",props:{taskId:{}},setup(r){const e=r,l=V(),i=()=>{var a;const o=(a=[...l.currentRoute.value.matched].reverse().find(n=>n.meta.isListView))==null?void 0:a.name;o?l.push({name:o}):console.error("Cant find back route")};return(o,a)=>(d(),m("div",O,[t("div",{class:"tw-flex-none custom-p-12"},[t("button",{class:"circle gray",onClick:i},a[0]||(a[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",P,[v(J,{"task-id":e.taskId},null,8,["task-id"])])]))}});export{Z as default};
