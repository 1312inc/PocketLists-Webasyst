import{d as z,r as D,j as S,k as M,o as p,c as g,b as r,t as _,g as w,D as k,F as L,m as x,J as T,P as V,Q as I,V as N,W as O,l as R,s as E,X as B,Y as H,L as F,B as P,e as Y,C as A,w as j,f as $,H as b,Z as U}from"./index-3Ct8lKGU.js";import{_ as W}from"./TaskList.vue_vue_type_script_setup_true_lang-j50Q8r9z.js";import"./SortableList.vue_vue_type_style_index_0_lang-Cs6lL7z4.js";import"./rangy-5rxgwlWZ.js";const q=typeof window<"u"&&typeof document<"u"?window:void 0,G=(u,o)=>{const d=new Date(Date.UTC(2017,0,2)),i=[];for(let c=0;c<7;c++)i.push(d.toLocaleDateString(u,{weekday:"short"})),d.setDate(d.getDate()+1);return o||i.unshift(i.pop()),i};function J(u,o,d){let i=0,c=!1,f=0,a=null;const e=10,m=10;function v(n){const y=-n.deltaY,C=Math.abs(y);C<m||n.timeStamp-f<300&&c||(f=n.timeStamp,i<C&&!c?(y<-e?o():y>e&&d(),h(C),a&&clearTimeout(a),a=setTimeout(()=>{i===C&&s()},1e3)):C<e&&s())}function h(n){i=n,c=!0}function s(){i=e,c=!1}const l=()=>{u.value&&u.value.removeEventListener("wheel",v)},t=M(u,n=>{l(),n&&n.addEventListener("wheel",v)},{immediate:!0,flush:"post"});B()&&H(()=>{l(),t()})}function Q(u,o={width:0,height:0}){const d=q;let i;const c=d&&"ResizeObserver"in d,f=D(o.width),a=D(o.height),e=([h])=>{const s=h.contentBoxSize;if(s){const l=Array.isArray(s)?s:[s];f.value=l.reduce((t,{inlineSize:n})=>t+n,0),a.value=l.reduce((t,{blockSize:n})=>t+n,0)}else f.value=h.contentRect.width,a.value=h.contentRect.height},m=()=>{i&&(i.disconnect(),i=void 0)},v=M(u,h=>{m(),c&&d&&(i=new ResizeObserver(e),h&&i.observe(h))},{immediate:!0,flush:"post"});return R(()=>{u.value&&(f.value="offsetWidth"in u.value?u.value.offsetWidth:o.width,a.value="offsetHeight"in u.value?u.value.offsetHeight:o.height)}),B()&&H(()=>{m(),v()}),{width:f,height:a}}function X(u,o,d){const i=D(1),c=D(!0),f=D(!0),{height:a}=Q(u),e=S(()=>a.value/6),m=D(k()),v=S(()=>{const l=m.value.startOf("M"),t=l.get("d")+-d,n=t<0?7+t:t;return l.add(-(6*7+n),"d")}),h=S(()=>new Array(6*7*3).fill(null).map((l,t)=>{const n=v.value.add(t,"d").toDate(),y=n.toLocaleDateString();return{localeDate:y,timestamp:n.getTime(),isWeekend:[0,6].includes(n.getDay()),isCurrent:new Date().toLocaleDateString()===y,isFirstDay:n.getDate()===1,isCurrentMonth:n.getMonth()===m.value.get("M")}}));R(()=>{o.value&&(f.value=!1,o.value.style.transform=`translate3d(0px, ${-o.value.clientHeight}px, 0px)`)}),J(u,()=>{c.value&&i.value<2&&i.value++},()=>{c.value&&i.value>0&&i.value--});const s=l=>{if(o.value){const t=o.value.querySelectorAll(".icg-months-grid-day--first-day")[l];t instanceof HTMLElement&&(o.value.style.transform=`translate3d(0px, ${-t.offsetTop}px, 0px)`)}};return M(i,l=>{l===1?s(l):o.value&&(f.value=!0,c.value=!1,o.value.addEventListener("transitionend",()=>{f.value=!1,c.value=!0,m.value=m.value.add(l===0?-1:1,"month"),E(()=>{i.value=1})},{once:!0}),s(l))}),M(f,l=>{o.value&&(o.value.style.transitionProperty=l?"transform":"none")}),M(e,()=>{s(1)},{flush:"post"}),{cellHeight:e,activeMonth:m,daysInCalendar:h}}const Z={class:"icg"},K={class:"icg-header"},ee={class:"icg-month"},te={class:"icg-controls"},ae=r("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[r("path",{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"})],-1),se=[ae],le=r("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[r("path",{d:"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"})],-1),ie=[le],oe={class:"icg-weekdays"},ne=z({__name:"InfiniteCalendarGrid",props:{firstDayOfWeek:{default:0},locale:{default:"en-US"},todayLabel:{default:"Today"},items:{},fieldWithDate:{}},emits:["changeInterval"],setup(u,{emit:o}){const d=u,i=o,c=D(null),f=D(null),{cellHeight:a,activeMonth:e,daysInCalendar:m}=X(c,f,d.firstDayOfWeek),v=G(d.locale,d.firstDayOfWeek),h=S(()=>{const s={};for(const l of d.items){const t=l[d.fieldWithDate];if(typeof t=="string"||typeof t=="number"){const n=new Date(t);if(!isNaN(n.getTime())){const y=n.toLocaleDateString();s[y]?s[y].push(l):s[y]=[l]}}}return s});return M(m,s=>{i("changeInterval",{start:s[0].timestamp,end:s[s.length-1].timestamp})},{immediate:!0,flush:"post"}),(s,l)=>(p(),g("div",Z,[r("div",K,[r("div",ee,_(w(e).toDate().toLocaleDateString(d.locale,{year:"numeric",month:"long"}).replace("Ð³.","")),1),r("div",te,[r("button",{onClick:l[0]||(l[0]=t=>e.value=w(e).add(-1,"M"))},se),r("button",{onClick:l[1]||(l[1]=t=>e.value=w(k)())},_(d.todayLabel),1),r("button",{onClick:l[2]||(l[2]=t=>e.value=w(e).add(1,"M"))},ie)])]),r("div",oe,[(p(!0),g(L,null,x(w(v),(t,n)=>(p(),g("div",{key:t,class:T(["icg-weekdays-cell",{"icg-weekdays-cell--weekend":n===(d.firstDayOfWeek?5:0)||n===6}])},_(t),3))),128))]),r("div",{ref_key:"wrapperRef",ref:c,class:"icg-wrapper"},[r("div",{ref_key:"containerRef",ref:f,class:"icg-months-grid"},[(p(!0),g(L,null,x(w(m),t=>(p(),g("div",{key:t.timestamp,class:T(["icg-months-grid-day",{"icg-months-grid-day--active-month":t.isCurrentMonth,"icg-months-grid-day--first-day":t.isFirstDay,"icg-months-grid-day--weekend":t.isWeekend,"icg-months-grid-day--current":t.isCurrent}]),style:V({height:`${w(a)}px`})},[I(s.$slots,"default",N(O({date:t,items:h.value[t.localeDate]})))],6))),128))],512)],512)]))}}),re={class:"flexbox space-12 tw-h-full"},de={class:"wide tw-relative"},ce=["onClick"],ue={class:"pl-calendar-day"},me={key:0},fe={class:"custom-p-8 custom-pt-40"},ve={key:0,class:"opacity-50"},he={key:0,class:"tw-w-80 empty:tw-hidden tw-flex tw-flex-col tw-gap-4 tw-h-full tw-overflow-y-auto hide-scrollbar"},pe={class:"flexbox space-12 middle custom-pt-12 tw-flex-none"},ge={class:"tw-flex-auto"},we={class:"custom-my-16 tw-cursor-pointer heading"},ye={key:1,class:"tw-w-80 empty:tw-hidden"},Ce=z({__name:"CalendarView",props:{selectedDate:{}},setup(u){const o=F(),d=D(),i=D(),c=S(()=>{const a=o.items.filter(e=>e.due_date);return[...o.getTasksCompleted,...a].map(e=>({...e,filterDate:e.complete_datetime||e.due_date})).filter(e=>{if(!e.filterDate)return!1;const m=new Date(e.filterDate).getTime();return m>d.value&&m<i.value})}),f=({start:a,end:e})=>{d.value=a,i.value=e,o.fetch({status:1}),o.fetchStream({filter:`due/${k(a).format("YYYY-MM-DD")},${k(e).format("YYYY-MM-DD")}`},{disableCheckin:!0})};return(a,e)=>{const m=P("RouterView");return p(),g("div",re,[r("div",de,[Y(w(ne),{items:c.value,"field-with-date":"filterDate",locale:w(U),onChangeInterval:f},{default:A(({date:v,items:h})=>[r("div",{class:"tw-h-full",style:V(a.selectedDate===w(k)(v.timestamp).format("YYYY-MM-DD")&&"background: var(--highlighted-green)"),onClick:s=>a.$router.push({name:"calendarDate",params:{date:w(k)(v.timestamp).format("YYYY-MM-DD")}})},[r("div",ue,[$(_(new Date(v.timestamp).getDate())+" ",1),new Date(v.timestamp).getDate()===1?(p(),g("span",me,_(w(k)(v.timestamp).format("MMM")),1)):b("",!0)]),r("div",fe,[(p(!0),g(L,null,x(h,s=>(p(),g("div",{key:s.uuid||s.id,class:"flexbox middle space-4"},[s.complete_datetime?(p(),g("div",ve,e[1]||(e[1]=[r("i",{class:"small gray fas fa-check"},null,-1)]))):b("",!0),r("div",{class:T(["small tw-truncate",{"opacity-50":s.complete_datetime}])},_(s.name),3)]))),128))])],12,ce)]),_:1},8,["items","locale"])]),a.$route.name==="calendarDate"?(p(),g("div",he,[a.selectedDate?(p(),g(L,{key:0},[r("div",pe,[r("a",{class:"back larger",onClick:e[0]||(e[0]=j(v=>a.$router.push({name:"calendar"}),["prevent"]))},e[2]||(e[2]=[r("i",{class:"fas fa-arrow-circle-left"},null,-1)])),$(" "+_(w(k)(a.selectedDate).format("LL")),1)]),r("div",ge,[r("div",null,[Y(W,{filter:"date",date:a.selectedDate,"addable-props":{due_date:a.selectedDate}},null,8,["date","addable-props"]),r("div",we,_(a.$t("completed")),1),Y(W,{filter:"date","should-filter-uncompleted":!0,date:a.selectedDate,"hide-add-new-task":!0,"disable-sort":!0},null,8,["date"])])])],64)):b("",!0)])):b("",!0),a.$route.meta.isTaskInfoView?(p(),g("div",ye,[Y(m)])):b("",!0)])}}});export{Ce as default};
