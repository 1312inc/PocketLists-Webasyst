import{d as h,u as C,a as I,r as f,o as m,c as p,b as e,w as x,t as _,e as g,f as T,g as S,h as k,i as $,j as y,k as b,l as B,T as R,m as D,v as M,n as V,p as N,q as U,F as E,s as F,x as K,y as L}from"./index-Xwy3HY2b.js";import{C as j}from"./ContenteditableBlock-2o44Eyd6.js";import"./rangy-5rxgwlWZ.js";const q={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background custom-p-16 tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},A={class:"tw-flex tw-gap-2"},G={class:"tw-flex tw-gap-2"},H={class:"tw-truncate"},z={class:"hint"},J={class:"hint"},O=h({__name:"TaskInfoChatItem",props:{message:{}},setup(r){const s=r,c=C(),l=I(),t=f(!1),a=()=>{l.deleteItem(s.message)},n=u=>{l.updateItem(s.message,{comment:u})};return(u,o)=>{var i;return m(),p("div",q,[e("div",A,[e("a",{onClick:x(a,["prevent"])},o[1]||(o[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:o[0]||(o[0]=x(v=>t.value=!0,["prevent"]))},o[2]||(o[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),e("div",G,[e("div",H,_((i=g(c).getItemById(s.message.contact_id))==null?void 0:i.name),1),e("div",z,_(g(T)(g(S)(s.message)).format("ll")),1)]),k(j,{editable:t.value,focusable:!0,value:s.message.comment,tag:"div",onUpdate:n},null,8,["editable","value"]),e("div",J,_(typeof s.message.id=="number"?"delivered":"not delivered"),1)])}}}),P={class:"tw-h-full tw-flex tw-flex-col"},Q={class:"tw-flex-none tw-sticky custom-py-12 pl-bg-block"},W={class:"state-with-inner-icon right width-100"},X=h({__name:"TaskInfoChat",props:{taskId:{}},setup(r){const s=r,c=$(),l=I(),t=y(()=>c.getItemById(s.taskId)),a=y(()=>t.value?l.getComentsByTaskId(t.value.id):[]),n=f(),u=f(),o=f(!1),i=f("");b(()=>s.taskId,()=>{t.value&&N(t.value)&&l.fetch({item_id:t.value.id})},{immediate:!0}),b(a,async()=>{await U(),n.value&&(n.value.scrollTop=n.value.scrollHeight),o.value=!0});const v=async()=>{t.value&&(await l.insert(t.value.id,i.value),i.value="",u.value.focus())};return(te,w)=>(m(),p("div",P,[e("div",{ref_key:"chatContainerRef",ref:n,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[k(R,{name:"slide-right",css:o.value},{default:B(()=>[(m(!0),p(E,null,F(a.value,d=>(m(),K(O,{key:d.uuid||d.id,message:d},null,8,["message"]))),128))]),_:1},8,["css"])],512),e("div",Q,[e("div",W,[D(e("input",{ref_key:"inputRef",ref:u,"onUpdate:modelValue":w[0]||(w[0]=d=>i.value=d),type:"text",placeholder:"Type a message",class:"width-100",onKeydown:V(v,["enter"])},null,544),[[M,i.value]]),e("button",{class:"icon",onClick:v},w[1]||(w[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),Y={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},Z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden custom-p-12 custom-pb-0"},ee={class:"tw-flex-auto tw-min-h-0"},le=h({__name:"TaskInfo",props:{taskId:{}},setup(r){const s=r,c=L(),l=()=>{var a;const t=(a=c.currentRoute.value.matched.find(n=>n.meta.isListView))==null?void 0:a.name;t?c.push({name:t}):console.error("Cant find back route")};return(t,a)=>(m(),p("div",Y,[e("div",{class:"tw-flex-none custom-p-12"},[e("button",{class:"circle gray",onClick:l},a[0]||(a[0]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Z,[e("div",ee,[k(X,{"task-id":s.taskId},null,8,["task-id"])])])]))}});export{le as default};
