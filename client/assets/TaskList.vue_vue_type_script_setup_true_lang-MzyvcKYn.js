import{c as de,d as Be,_ as at,p as ot,t as ke,a as rt,b as lt}from"./textToHtmlWithLinks-SuBm0PdO.js";import{r as C,af as it,m as q,ag as N,d as x,a5 as ut,c as P,ah as ct,o as c,e as f,n as j,t as w,j as _,k as dt,L as R,g as y,f as p,K as z,A as pe,G as Ne,z as ee,ai as Q,aj as fe,a6 as Ae,ak as oe,al as ft,am as pt,an as Ue,ao as mt,ap as vt,aq as ht,ar as _t,as as kt,at as yt,au as gt,B as V,F as A,y as te,i as se,u as wt,D as Re,a2 as bt,h as L,q as O,av as St,R as It,U as qe,Q as Tt,aw as $t,ax as ye,ay as X,az as xt,p as Lt,M as je,s as Ct,w as H,aA as Mt,aB as ze,aC as Dt,l as Pt,aD as Et,S as K,aE as Ot,aF as Ft,aG as Bt,H as Nt,a8 as ge,aH as we}from"./index-h5GcCylm.js";import{m as re,g as Z,a as At,s as be}from"./sanitizer-qTkizPqY.js";import{_ as Ut}from"./SortableList.vue_vue_type_style_index_0_lang-l8wwkU28.js";function Rt(s){const e=C([]),t=new Set;it(s,()=>{s.value&&(e.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),q(e,()=>{for(const[v]of t.entries())typeof v=="function"&&v(),t.delete(v)});const n=v=>{t.add(v)},a=v=>e.value.findIndex(b=>b.isEqualNode(v)),i=v=>e.value[a(v)-1],o=v=>e.value[a(v)+1],r=(v,b)=>{if(v){const u=o(v);if(u instanceof HTMLElement)return u.focus(),b&&re(u),u}else{const u=e.value[0];u instanceof HTMLElement&&u.focus()}},l=(v,b,u)=>{if(v.target instanceof HTMLElement){const m=v.target,$=Z(m),M=b==="up"?i(m):o(m);M instanceof HTMLElement&&(v.preventDefault(),M.focus(),At(M,$),typeof u=="function"&&u())}};return{getPreviousElementSibling:i,getNextElementSibling:o,getCurrentPositionInNavigationList:a,focusNextTask:r,focusTaskById:(v,b)=>{const u=e.value.find(m=>{var $;return m instanceof HTMLElement&&(($=m.dataset)==null?void 0:$.id)==v});u instanceof HTMLElement&&(u.focus(),b&&re(u))},onUp:(v,b)=>{l(v,"up",b)},onDown:(v,b)=>{l(v,"down",b)},onLeft:(v,b)=>{if(v.target instanceof HTMLElement){const u=v.target;if(Z(u)===0){const m=i(u);m instanceof HTMLElement&&(v.preventDefault(),m.focus(),re(m),typeof b=="function"&&b())}}},onRight:(v,b)=>{if(v.target instanceof HTMLElement){const u=v.target;if(Z(u)===u.innerText.length){const m=o(u);m instanceof HTMLElement&&(v.preventDefault(),m.focus(),typeof b=="function"&&b())}}},nextUpdate:n}}function Se(s){for(var e=[],t;!(t=s.next()).done;)e.push(t.value);return e}function Ie(s,e,t){for(var n=0,a=t.length;n<a;){if(s(e,t[n]))return!0;n+=1}return!1}function qt(s){var e=String(s).match(/^function (\w*)/);return e==null?"":e[1]}function ae(s,e){return Object.prototype.hasOwnProperty.call(e,s)}function jt(s,e){return s===e?s!==0||1/s===1/e:s!==s&&e!==e}const le=typeof Object.is=="function"?Object.is:jt;var Te=Object.prototype.toString,zt=function(){return Te.call(arguments)==="[object Arguments]"?function(e){return Te.call(e)==="[object Arguments]"}:function(e){return ae("callee",e)}}(),Ht=!{toString:null}.propertyIsEnumerable("toString"),$e=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],xe=function(){return arguments.propertyIsEnumerable("length")}(),Wt=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},Le=typeof Object.keys=="function"&&!xe?de(function(e){return Object(e)!==e?[]:Object.keys(e)}):de(function(e){if(Object(e)!==e)return[];var t,n,a=[],i=xe&&zt(e);for(t in e)ae(t,e)&&(!i||t!=="length")&&(a[a.length]=t);if(Ht)for(n=$e.length-1;n>=0;)t=$e[n],ae(t,e)&&!Wt(a,t)&&(a[a.length]=t),n-=1;return a}),Ce=de(function(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function Me(s,e,t,n){var a=Se(s),i=Se(e);function o(r,l){return me(r,l,t.slice(),n.slice())}return!Ie(function(r,l){return!Ie(o,l,r)},i,a)}function me(s,e,t,n){if(le(s,e))return!0;var a=Ce(s);if(a!==Ce(e))return!1;if(typeof s["fantasy-land/equals"]=="function"||typeof e["fantasy-land/equals"]=="function")return typeof s["fantasy-land/equals"]=="function"&&s["fantasy-land/equals"](e)&&typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](s);if(typeof s.equals=="function"||typeof e.equals=="function")return typeof s.equals=="function"&&s.equals(e)&&typeof e.equals=="function"&&e.equals(s);switch(a){case"Arguments":case"Array":case"Object":if(typeof s.constructor=="function"&&qt(s.constructor)==="Promise")return s===e;break;case"Boolean":case"Number":case"String":if(!(typeof s==typeof e&&le(s.valueOf(),e.valueOf())))return!1;break;case"Date":if(!le(s.valueOf(),e.valueOf()))return!1;break;case"Error":return s.name===e.name&&s.message===e.message;case"RegExp":if(!(s.source===e.source&&s.global===e.global&&s.ignoreCase===e.ignoreCase&&s.multiline===e.multiline&&s.sticky===e.sticky&&s.unicode===e.unicode))return!1;break}for(var i=t.length-1;i>=0;){if(t[i]===s)return n[i]===e;i-=1}switch(a){case"Map":return s.size!==e.size?!1:Me(s.entries(),e.entries(),t.concat([s]),n.concat([e]));case"Set":return s.size!==e.size?!1:Me(s.values(),e.values(),t.concat([s]),n.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=Le(s);if(o.length!==Le(e).length)return!1;var r=t.concat([s]),l=n.concat([e]);for(i=o.length-1;i>=0;){var d=o[i];if(!(ae(d,e)&&me(e[d],s[d],r,l)))return!1;i-=1}return!0}var Kt=Be(function(e,t){return me(e,t,[],[])});function Vt(s,e,t){var n,a;if(typeof s.indexOf=="function")switch(typeof e){case"number":if(e===0){for(n=1/e;t<s.length;){if(a=s[t],a===0&&1/a===n)return t;t+=1}return-1}else if(e!==e){for(;t<s.length;){if(a=s[t],typeof a=="number"&&a!==a)return t;t+=1}return-1}return s.indexOf(e,t);case"string":case"boolean":case"function":case"undefined":return s.indexOf(e,t);case"object":if(e===null)return s.indexOf(e,t)}for(;t<s.length;){if(Kt(s[t],e))return t;t+=1}return-1}function De(s,e){return Vt(e,s,0)>=0}var Qt=function(){function s(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return s.prototype.add=function(e){return!Pe(e,!0,this)},s.prototype.has=function(e){return Pe(e,!1,this)},s}();function Pe(s,e,t){var n=typeof s,a,i;switch(n){case"string":case"number":return s===0&&1/s===-1/0?t._items["-0"]?!0:(e&&(t._items["-0"]=!0),!1):t._nativeSet!==null?e?(a=t._nativeSet.size,t._nativeSet.add(s),i=t._nativeSet.size,i===a):t._nativeSet.has(s):n in t._items?s in t._items[n]?!0:(e&&(t._items[n][s]=!0),!1):(e&&(t._items[n]={},t._items[n][s]=!0),!1);case"boolean":if(n in t._items){var o=s?1:0;return t._items[n][o]?!0:(e&&(t._items[n][o]=!0),!1)}else return e&&(t._items[n]=s?[!1,!0]:[!0,!1]),!1;case"function":return t._nativeSet!==null?e?(a=t._nativeSet.size,t._nativeSet.add(s),i=t._nativeSet.size,i===a):t._nativeSet.has(s):n in t._items?De(s,t._items[n])?!0:(e&&t._items[n].push(s),!1):(e&&(t._items[n]=[s]),!1);case"undefined":return t._items[n]?!0:(e&&(t._items[n]=!0),!1);case"object":if(s===null)return t._items.null?!0:(e&&(t._items.null=!0),!1);default:return n=Object.prototype.toString.call(s),n in t._items?De(s,t._items[n])?!0:(e&&t._items[n].push(s),!1):(e&&(t._items[n]=[s]),!1)}}var Yt=Be(function(e,t){for(var n=[],a=0,i=e.length,o=t.length,r=new Qt,l=0;l<o;l+=1)r.add(t[l]);for(;a<i;)r.add(e[a])&&(n[n.length]=e[a]),a+=1;return n});const Jt=s=>{const e=N(s);return typeof e=="number"&&!isNaN(e)?`${e.toFixed(2)}km`:""},Xt={class:"flexbox space-12 smaller empty:tw-hidden"},Gt={key:2},Zt=x({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const e=ut(),t=P(()=>ct(s.task)),n=P(()=>({"text-red":t.value===3,"text-yellow":t.value===2,"text-green":t.value===1,grey:t.value===0}));return(a,i)=>{var o;return c(),f("div",Xt,[a.task.due_datetime&&!a.task.status?(c(),f("div",{key:0,class:j(["semibold",n.value])},w(_(dt)(a.task.due_datetime).format("LLL")),3)):a.task.due_date&&!a.task.status?(c(),f("div",{key:1,class:j(["semibold",n.value])},w(_(R)(a.task.due_date).format("LL")),3)):y("",!0),a.task.location_id?(c(),f("div",Gt,[i[0]||(i[0]=p("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),z(" "+w((o=_(e).getItemById(a.task.location_id))==null?void 0:o.name)+" "+w(_(Jt)(_(e).distanceById(a.task.location_id))),1)])):y("",!0)])}}}),es={class:"icon"},ts=["src"],ss=x({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const e=pe(),t=Ne(),n=P(()=>!e.currentRoute.value.params.listId),a=P(()=>s.task.list_id&&n.value?t.itemsMap[s.task.list_id]:null),i=()=>{if(!a.value)return;const o=e.resolve({name:"list",params:{listId:a.value.id}});window.open(o.href,"_blank")};return(o,r)=>(c(),f("div",{class:j(["flexbox middle",{"space-12":!o.isFocused}])},[o.isFocused?(c(),ee(at,{key:0,task:o.task,input:o.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(c(),ee(Zt,{key:1,task:o.task},null,8,["task"])),a.value?(c(),f("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:i},[p("div",es,[p("img",{src:a.value.icon_url,loading:"lazy"},null,8,ts)]),z(" "+w(a.value.name),1)])):y("",!0)],2))}}),He=vt?window:void 0;function G(s){var e;const t=N(s);return(e=t==null?void 0:t.$el)!=null?e:t}function Y(...s){const e=[],t=()=>{e.forEach(r=>r()),e.length=0},n=(r,l,d,S)=>(r.addEventListener(l,d,S),()=>r.removeEventListener(l,d,S)),a=P(()=>{const r=oe(N(s[0])).filter(l=>l!=null);return r.every(l=>typeof l!="string")?r:void 0}),i=ft(()=>{var r,l;return[(l=(r=a.value)==null?void 0:r.map(d=>G(d)))!=null?l:[He].filter(d=>d!=null),oe(N(a.value?s[1]:s[0])),oe(_(a.value?s[2]:s[1])),N(a.value?s[3]:s[2])]},([r,l,d,S])=>{if(t(),!(r!=null&&r.length)||!(l!=null&&l.length)||!(d!=null&&d.length))return;const T=pt(S)?{...S}:S;e.push(...r.flatMap(k=>l.flatMap(I=>d.map(v=>n(k,I,v,T)))))},{flush:"post"}),o=()=>{i(),t()};return Ue(t),o}let Ee=!1;function Oe(s,e,t={}){const{window:n=He,ignore:a=[],capture:i=!0,detectIframe:o=!1,controls:r=!1}=t;if(!n)return r?{stop:Q,cancel:Q,trigger:Q}:Q;if(fe&&!Ee){Ee=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(m=>Y(m,"click",Q,u)),Y(n.document.documentElement,"click",Q,u)}let l=!0;const d=u=>N(a).some(m=>{if(typeof m=="string")return Array.from(n.document.querySelectorAll(m)).some($=>$===u.target||u.composedPath().includes($));{const $=G(m);return $&&(u.target===$||u.composedPath().includes($))}});function S(u){const m=N(u);return m&&m.$.subTree.shapeFlag===16}function T(u,m){const $=N(u),M=$.$.subTree&&$.$.subTree.children;return M==null||!Array.isArray(M)?!1:M.some(ne=>ne.el===m.target||m.composedPath().includes(ne.el))}const k=u=>{const m=G(s);if(u.target!=null&&!(!(m instanceof Element)&&S(s)&&T(s,u))&&!(!m||m===u.target||u.composedPath().includes(m))){if("detail"in u&&u.detail===0&&(l=!d(u)),!l){l=!0;return}e(u)}};let I=!1;const v=[Y(n,"click",u=>{I||(I=!0,setTimeout(()=>{I=!1},0),k(u))},{passive:!0,capture:i}),Y(n,"pointerdown",u=>{const m=G(s);l=!d(u)&&!!(m&&!u.composedPath().includes(m))},{passive:!0}),o&&Y(n,"blur",u=>{setTimeout(()=>{var m;const $=G(s);((m=n.document.activeElement)==null?void 0:m.tagName)==="IFRAME"&&!($!=null&&$.contains(n.document.activeElement))&&e(u)},0)},{passive:!0})].filter(Boolean),b=()=>v.forEach(u=>u());return r?{stop:b,cancel:()=>{l=!1},trigger:u=>{l=!0,k(u),l=!1}}:b}const ns={mounted(s,e){const t=!e.modifiers.bubble;if(typeof e.value=="function")s.__onClickOutside_stop=Oe(s,e.value,{capture:t});else{const[n,a]=e.value;s.__onClickOutside_stop=Oe(s,n,Object.assign({capture:t},a))}},unmounted(s){s.__onClickOutside_stop()}};function ie(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function We(s){const e=window.getComputedStyle(s);if(e.overflowX==="scroll"||e.overflowY==="scroll"||e.overflowX==="auto"&&s.clientWidth<s.scrollWidth||e.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const t=s.parentNode;return!t||t.tagName==="BODY"?!1:We(t)}}function as(s){const e=s||window.event,t=e.target;return We(t)?!1:e.touches.length>1?!0:(e.preventDefault&&e.preventDefault(),!1)}const ue=new WeakMap;function os(s,e=!1){const t=Ae(e);let n=null,a="";q(mt(s),r=>{const l=ie(N(r));if(l){const d=l;if(ue.get(d)||ue.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(a=d.style.overflow),d.style.overflow==="hidden")return t.value=!0;if(t.value)return d.style.overflow="hidden"}},{immediate:!0});const i=()=>{const r=ie(N(s));!r||t.value||(fe&&(n=Y(r,"touchmove",l=>{as(l)},{passive:!1})),r.style.overflow="hidden",t.value=!0)},o=()=>{const r=ie(N(s));!r||!t.value||(fe&&(n==null||n()),r.style.overflow=a,ue.delete(r),t.value=!1)};return Ue(o),P({get(){return t.value},set(r){r?i():o()}})}function rs(){let s=!1;const e=Ae(!1);return(t,n)=>{if(e.value=n.value,s)return;s=!0;const a=os(t,n.value);q(e,i=>a.value=i)}}rs();const ls=s=>{const e=["\\- \\[ \\]","\\- \\[x\\]","\\* "],t=new RegExp(`^(${e.join("|")})`,"gm");return s.replace(t,"")},is=s=>{const e="\\- \\[x\\]";return new RegExp(`^${e}`,"gm").test(s)},us=ht("syncError",()=>{const s=_t(kt(yt(()=>gt.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(t=>t.entity==="task"&&t.error).map(t=>[t.id,t.error])))}});function cs(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const ds={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},fs=["href"],ps=["src"],ms={class:"bold"},vs={key:0,class:"hint custom-ml-4 nowrap"},hs=["onClick"],_s=x({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const e=V(),t=n=>{window.confirm("Delete the file permanently?")&&e.deleteAttachments(s.task,[n])};return(n,a)=>{var i;return(i=n.task.attachments)!=null&&i.length?(c(),f("div",ds,[(c(!0),f(A,null,te(n.task.attachments,o=>(c(),f("div",{key:o.uuid||o.id,class:"pl-attachments__item small"},[p("a",{href:o.download_url,target:"_blank"},[o.preview_url?(c(),f("img",{key:0,src:o.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,ps)):(c(),f(A,{key:1},[p("span",ms,w(o.file_name),1),o.size?(c(),f("span",vs,w(_(cs)(o.size)),1)):y("",!0)],64))],8,fs),n.isFocused?(c(),f("div",{key:0,class:j(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":o.preview_url}])},[p("a",{class:j(o.preview_url?"button circle white":"custom-ml-8"),onClick:se(r=>t(o.id),["prevent"])},a[0]||(a[0]=[p("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,hs)],2)):y("",!0)]))),128))])):y("",!0)}}}),ce=x({__name:"UserPic",props:{userId:{}},setup(s){const e=s,t=wt(),n=P(()=>t.getItemById(e.userId));return(a,i)=>{var o;return(o=n.value)!=null&&o.photo_url?(c(),f("span",{key:0,class:"icon userpic",style:Re({backgroundImage:`url(${n.value.photo_url})`})},null,4)):y("",!0)}}}),ks={key:0,class:"tw-cursor-pointer"},ys={key:0,class:"pl-list-item-firedBullet"},gs={key:1,class:"tw-cursor-pointer"},ws=x({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:e}){const t=s,n=e,a=C(t.task.status===1);q(()=>t.task.status,r=>{a.value=r===1});const i=P(()=>bt(t.task)),o=()=>{a.value=!a.value,n("complete")};return(r,l)=>(c(),f("div",{class:"tw-w-5 tw-flex-none",onClick:o},[L(qe,{name:"bounce",mode:"out-in"},{default:O(()=>{var d;return[a.value?(c(),f("div",gs,l[0]||(l[0]=[p("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(c(),f("div",ks,[i.value===_(St)?(c(),f("div",ys)):(c(),f("div",{key:1,class:"pl-list-item-bullet",style:Re(`background-color: ${(d=_(It).get(i.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),bs=new WeakMap;function Ss(){const s=Tt(),e=pe(),t=()=>{var l;const i=[...s.matched].reverse().find(d=>{var S;return(S=d.meta)==null?void 0:S.isListView})||null,o=((l=i==null?void 0:i.children)==null?void 0:l.find(d=>{var S;return(S=d.meta)==null?void 0:S.isTaskInfoView}))||null,r={listViewRoute:i,taskInfoRoute:o};return bs.set(s,r),r};return{navigateToTaskInfo:async a=>{const{listViewRoute:i,taskInfoRoute:o}=t();if(!i||!(o!=null&&o.name))return console.warn("Required routes not found"),!1;try{const r=await e.push({name:o.name,params:{taskId:a}});return!$t(r)}catch(r){return console.error("Navigation failed:",r),!1}}}}const Is={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Ts={class:"hint"},$s={class:"hint"},xs={class:"hint"},Ls={class:"tw-clear-both tw-inline-block"},Cs=["placeholder","data-id","innerHTML"],Ms=["innerHTML"],Ds={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Ps={key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100"},Es={key:0},Os={key:1},Fs={key:2,class:"tw-flex-none"},Bs=["title"],Ns=["title"],As={key:4,class:"flexbox middle space-4 tw-flex-none link"},Us={class:"bold small"},Rs={key:5,class:"hint tw-flex-none custom-mt-2"},qs={key:6,class:"hint tw-flex-none custom-mt-2"},js={key:0},zs={key:1},Hs={key:7,class:"hint tw-flex-none custom-mt-2"},Ws={key:8,class:"flexbox middle tw-flex-none"},Ks={key:9,class:"flexbox middle tw-flex-none"},Vs={key:10,class:"flexbox middle tw-flex-none"},Qs={key:11,class:"flexbox middle space-4 tw-flex-none"},Ys=["href"],Js=["src"],Xs=x({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:e}){const t=s,n=e,a=V(),i=us(),{navigateToTaskInfo:o}=Ss(),r=ye(ze),l=ye(Dt),d=C(!1),S=C(!1),T=C(t.task.name),k=C(t.task.status);q(()=>t.task.status,g=>{k.value=g});const I=C(),v=P(()=>X(t.task)),b=["name","due_date","due_datetime","priority","location_id"],u=C({});q(()=>t.task,()=>{u.value=ot(b,t.task)},{immediate:!0});const{history:m,clear:$,pause:M,resume:ne,commit:Ve}=xt(u,{deep:!0});M(),q(d,()=>{if(d.value)ne();else{const g=I.value.innerText.trim();if(X(t.task)&&!g){n("delete",t.task,u.value);return}u.value.name=g,Ve(),M(),tt(),$()}});let W=null;const ve=()=>{n("complete",t.task,u.value)};Lt(()=>{X(t.task)&&(I.value.focus(),d.value=!0)}),je(()=>{W&&(clearTimeout(W),W=null,ve())});const Qe=g=>{if(g.target instanceof HTMLAnchorElement){const h=g.target.href;g.preventDefault(),setTimeout(()=>{window.open(h,"_blank")})}},Ye=()=>{k.value=k.value?0:1,I.value.classList.toggle("opacity-50"),!(W&&(clearTimeout(W),W=null,t.task.status===k.value))&&(W=setTimeout(ve,1e3))},he=()=>{S.value||n("blur",t.task,u.value)},Je=g=>{var U;g.preventDefault();const h=(U=g.clipboardData)==null?void 0:U.getData("text/plain");if(!h)return;if(I.value.innerText){document.execCommand("insertText",!1,h);return}const D=h.split(`
`).filter(F=>F);D.length&&n("insertMany",t.task,D.map(F=>({name:ls(F),...t.addableProps,...is(F)?{status:1}:{}})))},Xe=g=>{Z(g.target)===0&&(S.value=!0,r==null||r.onLeft(g),n("delete",t.task,u.value))},Ge=async g=>{if(g.shiftKey)return;if(g.preventDefault(),t.isEnterDisabled){he(),I.value.blur(),d.value=!1,await Pt(),n("insertFirst",{...t.addableProps});return}const h=g.target,D=h.innerText.trim(),U=Z(h);let F,J;U!==0&&(F=D.substring(0,U).trim(),J=D.substring(U,D.length).trim(),h.innerText=F),D&&n("insert",t.task,{...t.addableProps},{currentName:F,newName:J}),I.value.blur(),d.value=!1},Ze=g=>{T.value=g.target.innerText},et=()=>{v.value&&(u.value.due_date=m.value[m.value.length-1].snapshot.due_date||null,u.value.due_datetime=m.value[m.value.length-1].snapshot.due_datetime||null),I.value.blur(),d.value=!1};function tt(){const g=X(t.task)?Object.entries({}):Object.entries(m.value[m.value.length-1].snapshot),h=Object.entries(m.value[0].snapshot),D=Yt(h,g);D.length&&n("update",t.task,Object.fromEntries(D))}const st=()=>{n("update",t.task,{favorite:t.task.favorite?0:1})},_e=async g=>{g.target.closest("[contenteditable], .chips li, a")===null&&await o(t.task.id)};function nt(g){return new URL(Object.assign({"../../assets/apps/shop.svg":rt,"../../assets/apps/tasks.svg":lt})[`../../assets/apps/${g}.svg`],import.meta.url).href}return(g,h)=>{var D,U,F,J;return S.value?y("",!0):(c(),f("div",{key:0,class:j(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":g.$route.meta.isTaskInfoView&&((D=g.$route.params)==null?void 0:D.taskId)==t.task.id,highlighted:_(a).pinnedTaskUUIDs.has(t.task.uuid)}])},[t.sortable?(c(),f("div",Is,h[6]||(h[6]=[p("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):y("",!0),L(ws,{task:t.task,onComplete:Ye},null,8,["task"]),p("div",{class:"tw-flex-auto",onClick:_e},[(U=_(l))!=null&&U.is_debug_mode?(c(),f(A,{key:0},[p("span",Ts,"list_id: "+w(String(t.task.list_id)),1),h[7]||(h[7]=z(" | ")),p("span",$s,"id: "+w(t.task.id),1),h[8]||(h[8]=z(" | ")),p("span",xs,"srank: "+w(String(t.task.sort))+" | "+w(String(t.task.rank)),1)],64)):y("",!0),Ct((c(),f("div",null,[p("div",Ls,[p("div",{ref_key:"contenteditableRef",ref:I,contenteditable:"",class:j(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":t.task.status===1}]),placeholder:t.placeholder,"data-id":t.task.id,onKeydown:[H(Ge,["enter"]),h[0]||(h[0]=H(E=>{var B;(B=_(r))==null||B.onLeft(E,()=>{d.value=!1})},["left"])),h[1]||(h[1]=H(E=>{var B;(B=_(r))==null||B.onUp(E,()=>{d.value=!1})},["up"])),h[2]||(h[2]=H(E=>{var B;(B=_(r))==null||B.onRight(E,()=>{d.value=!1})},["right"])),h[3]||(h[3]=H(E=>{var B;(B=_(r))==null||B.onDown(E,()=>{d.value=!1})},["down"])),H(Xe,["delete"]),H(et,["esc"]),h[4]||(h[4]=H(()=>{d.value=!1},["tab"]))],onMousedown:Qe,onFocus:h[5]||(h[5]=E=>d.value=!0),onBlur:he,onPaste:Je,onInput:Ze,innerHTML:_(be)(d.value?t.task.name:_(ke)(t.task.name))},null,42,Cs)]),t.task.note?(c(),f("div",{key:0,class:"hint tw-break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(be)(_(ke)(t.task.note))},null,8,Ms)):y("",!0),L(ss,{task:g.task,input:T.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[_(ns),()=>{d.value=!1}]]),L(_s,{task:t.task,"is-focused":d.value},null,8,["task","is-focused"])]),p("div",Ds,[t.showInfoLink?(c(),f("div",Ps,[p("a",{onClick:se(_e,["prevent"])},h[9]||(h[9]=[p("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))])):y("",!0),k.value?y("",!0):(c(),f("div",{key:1,class:j(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!t.task.favorite}]),onClick:st},[t.task.favorite?(c(),f("span",Es,h[10]||(h[10]=[p("i",{class:"fas fa-star text-yellow"},null,-1)]))):(c(),f("span",Os,h[11]||(h[11]=[p("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(i).taskErrorMap.get(t.task.id)?(c(),f("div",Fs,[p("span",{class:"icon",style:{color:"orange"},title:_(i).taskErrorMap.get(t.task.id)},h[12]||(h[12]=[p("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,Bs)])):y("",!0),!_(Mt)(t.task)&&!_(X)(t.task)?(c(),f("div",{key:3,class:"tw-flex-none",title:g.$t("syncing")},h[13]||(h[13]=[p("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,Ns)):y("",!0),(F=t.task.extended_data)!=null&&F.comments_count?(c(),f("div",As,[h[14]||(h[14]=p("i",{class:"fas fa-comment"},null,-1)),p("span",Us,w(t.task.extended_data.comments_count),1)])):y("",!0),!k.value&&!t.task.assigned_contact_id&&t.task.create_datetime?(c(),f("div",Rs,w(_(R)().to(_(R)(t.task.create_datetime),!0)),1)):y("",!0),!k.value&&t.task.assigned_contact_id?(c(),f("div",qs,[t.task.update_datetime?(c(),f("span",js,w(_(R)().to(_(R)(t.task.update_datetime),!0)),1)):y("",!0),t.task.create_datetime&&!t.task.update_datetime?(c(),f("span",zs,w(_(R)().to(_(R)(t.task.create_datetime),!0)),1)):y("",!0)])):y("",!0),t.task.complete_datetime?(c(),f("div",Hs,w(_(R)().to(_(R)(t.task.complete_datetime),!0)),1)):y("",!0),!k.value&&!t.task.assigned_contact_id&&t.task.contact_id?(c(),f("div",Ws,[L(ce,{"user-id":t.task.contact_id},null,8,["user-id"])])):y("",!0),!k.value&&t.task.assigned_contact_id?(c(),f("div",Ks,[L(ce,{"user-id":t.task.assigned_contact_id},null,8,["user-id"])])):y("",!0),k.value&&t.task.complete_contact_id?(c(),f("div",Vs,[L(ce,{"user-id":t.task.complete_contact_id},null,8,["user-id"])])):y("",!0),(J=t.task.external_links)!=null&&J.length?(c(),f("div",Qs,[(c(!0),f(A,null,te(t.task.external_links,E=>(c(),f("a",{key:E.id,href:E.entity_link,class:"icon size-20",target:"_blank"},[p("img",{src:nt(E.app)},null,8,Js)],8,Ys))),128))])):y("",!0)])],2))}}}),Gs=x({__name:"ListNavigationProvider",setup(s){const e=C();return Et(ze,Rt(e)),(t,n)=>(c(),f("div",{ref_key:"navigatableRef",ref:e,class:"tw-relative"},[K(t.$slots,"default")],512))}}),Zs=x({__name:"TaskListItemStoreProvider",setup(s){const e=V(),t=l=>e.completeTask(l),n=(l,d)=>e.updateItem(l,d),a=async(l,d,S)=>{await e.insert(S.currentName?"after":"before",l,{...d,name:S.newName})},i=(l,d)=>{e.insertMany(l,d)},o=async l=>{await e.insert("before",null,l,{shouldPinNewTask:!0})},r=l=>e.deleteItem(l);return(l,d)=>K(l.$slots,"default",{onComplete:t,onUpdate:n,onInsert:a,onInsertMany:i,onInsertFirst:o,onDelete:r})}}),en=x({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:e}){const t=s,n=e,a=C(null),{stop:i}=Ot(a,([{isIntersecting:o}])=>{o&&!t.disabled&&n("intersecting")},{rootMargin:"200px"});return je(()=>{i()}),(o,r)=>(c(),f("div",{ref_key:"elRef",ref:a},[K(o.$slots,"default")],512))}}),tn={key:0},sn={class:"box custom-py-24 small align-center gray"},nn={class:"skeleton custom-m-24"},Fe=30,an=x({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const e=s,t=V(),n=Bt(),a=C(Fe),i=C([]),o=C(!1),r=P(()=>({list:{source:e.listId?t.getTasksInList(e.listId,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:e.listId?{list_id:e.listId,status:e.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:t.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:t.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:t.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:t.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:i.value,isFetchStream:!0,fetchParams:{filter:`search/${e.searchQuery}`},disableCheckin:!0},location:{source:e.locationId?t.getTasksInLocation(e.locationId,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:e.locationId?{location_id:e.locationId,status:e.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:e.userId?e.shouldFilterUncompleted?t.getTasksCompletedByUser(e.userId):t.getTasksByUser(e.userId):[],isFetchStream:!e.shouldFilterUncompleted,fetchParams:e.userId?e.shouldFilterUncompleted?{complete_contact_id:e.userId,status:"1"}:{filter:`user/${e.userId}`}:{},disableCheckin:!1},completed:{source:t.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:e.date?t.getTasksInDate(e.date,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:e.externalAppId?t.getTasksByApp(e.externalAppId):[],isFetchStream:!1,fetchParams:e.externalAppId?{external_app_id:e.externalAppId}:null,disableCheckin:!1}})[e.filter]),l=P(()=>r.value.source.slice(0,a.value));q(()=>e,S,{deep:!0,immediate:!0});const d=()=>{a.value+=Fe};async function S(){const{isFetchStream:k,fetchParams:I,disableCheckin:v}=r.value;if(!I||!T(I))return;if(o.value=!1,i.value=[],e.filter==="list"){const u=n.task.value.get(JSON.stringify({list_id:e.listId})),m=n.task.value.get(JSON.stringify({list_id:e.listId,status:"0"})),$=n.task.value.get(JSON.stringify({list_id:e.listId,status:"1"})),M=u||m;if(M)if(e.shouldFilterUncompleted){if($)return}else delete I.status,I.starting_from=Ft(new Date(M))}const b=await t[k?"fetchStream":"fetch"]({...I},{disableCheckin:v});b&&b.value&&b.value.status_code==="ok"&&e.filter==="search"&&(i.value=[...i.value,...b.value.data],o.value=!i.value.length)}function T(k){return!(!k||k.list_id&&typeof k.list_id!="number"||k.location_id&&typeof k.location_id!="number")}return(k,I)=>(c(),f(A,null,[K(k.$slots,"default",{tasks:l.value}),e.filter==="search"&&o.value?(c(),f("div",tn,[p("p",sn,[z(w(k.$t("searchNoMatches"))+" ",1),p("strong",null,w(e.searchQuery),1)])])):y("",!0),L(qe,{name:"fade"},{default:O(()=>[l.value.length&&l.value.length<r.value.source.length?(c(),ee(en,{key:0,onIntersecting:d},{default:O(()=>[p("div",nn,[(c(),f(A,null,te(5,v=>p("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}})),64))])]),_:1})):y("",!0)]),_:1})],64))}}),on=x({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const e=s,t=V(),n=pe();q(n.currentRoute,async i=>{const o={...i.query};"addNewTask"in o&&(await a(),delete o.addNewTask,n.replace({path:i.path,query:o}))},{immediate:!0});async function a(){await t.insert("before",null,{...e.addableProps},{shouldPinNewTask:e.shouldPinNewTask})}return(i,o)=>(c(),f("div",{class:"text-gray pl-list-item-title",onClick:a},[o[0]||(o[0]=p("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),z(" "+w(i.$t("newToDo")),1)]))}}),rn={class:"dialog-header"},ln={class:"dialog-content empty:tw-hidden"},un={class:"dialog-footer tw-flex tw-gap-2"},Ke=x({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(e,t)=>(c(),f(A,null,[p("header",rn,[p("h3",null,w(e.$props.title),1),e.hideCloseIcon?y("",!0):(c(),f("a",{key:0,class:"dialog-close",onClick:t[0]||(t[0]=se(n=>e.$emit("close"),["prevent"]))},t[2]||(t[2]=[p("i",{class:"fas fa-times"},null,-1)])))]),p("div",ln,[K(e.$slots,"default")]),p("footer",un,[K(e.$slots,"submit"),e.hideCloseButton?y("",!0):(c(),f("button",{key:0,class:"button light-gray",onClick:t[1]||(t[1]=n=>e.$emit("close"))}," Close "))])],64))}}),cn=x({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(e,t)=>(c(),ee(Ke,{title:e.title,"hide-close-icon":!0},{submit:O(()=>[p("button",{class:"danger",onClick:t[0]||(t[0]=(...n)=>e.onDelete&&e.onDelete(...n))}," Delete ")]),default:O(()=>[z(w(e.text)+" ",1)]),_:1},8,["title"]))}}),dn={class:"tw-w-68"},fn={class:"menu"},pn={href:"javascript:void(0);"},mn={class:"menu"},vn=["onClick"],hn=["disabled"],_n=x({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const e=Nt(),t=Ne(),n=C(),a=()=>{n.value&&s.onMove(n.value)};return(i,o)=>(c(),ee(Ke,{title:i.title,"hide-close-icon":!0},{submit:O(()=>[p("button",{disabled:!n.value,onClick:se(a,["prevent"])}," Move ",8,hn)]),default:O(()=>[p("div",dn,[p("ul",fn,[(c(!0),f(A,null,te(_(e).items,r=>(c(),f("li",{key:r.uuid||r.id},[p("a",pn,w(r.name),1),p("ul",mn,[(c(!0),f(A,null,te(_(t).getListsInPocket(r.id),l=>(c(),f("li",{key:l.uuid||l.id,class:j(n.value===l.id&&"selected rounded")},[p("a",{href:"#",onClick:se(()=>{n.value=n.value===l.id?void 0:l.id},["prevent"])},w(l.name),9,vn)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),kn={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},yn={class:"hint"},gn={class:"hint"},wn=x({__name:"TaskListMultiselect",setup(s){const e=V(),t=C(new Set),{show:n,hide:a}=ge(cn,{title:"Delete",text:we(()=>`Delete ${t.value.size} selected items?`),onDelete:async()=>{await e.deleteItems([...t.value]),t.value.clear(),a()}}),{show:i,hide:o}=ge(_n,{title:"Move Items",text:we(()=>`Delete ${t.value.size} selected items?`),onMove:async T=>{await e.sort(T,null,[...t.value]),t.value.clear(),o()}}),r=T=>{t.value.add(T)},l=T=>{t.value.delete(T)},d=()=>{i()},S=()=>{n()};return(T,k)=>(c(),f(A,null,[t.value.size?(c(),f("div",kn,[p("button",{class:"button light-gray smaller",onClick:d},[k[0]||(k[0]=p("i",{class:"fas fa-list text-blue"},null,-1)),z(" "+w(T.$t("Move"))+" ",1),p("span",yn,w(t.value.size),1)]),p("button",{class:"button light-gray smaller",onClick:S},[k[1]||(k[1]=p("i",{class:"fas fa-trash-alt text-red"},null,-1)),z(" "+w(T.$t("Delete"))+" ",1),p("span",gn,w(t.value.size),1)])])):y("",!0),K(T.$slots,"default",{onSelect:r,onDeselect:l})],64))}}),bn={class:"pl-bg-block"},Sn={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},In={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Tn={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},$n={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Dn=x({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const e=s,t=V(),n=P(()=>["upnext","due","priority","nearby","user"].includes(e.filter));return(a,i)=>(c(),f("div",bn,[e.header?(c(),f("div",Sn,[p("h1",null,w(e.header),1)])):y("",!0),L(Gs,null,{default:O(()=>[L(an,{filter:e.filter,"should-filter-uncompleted":e.shouldFilterUncompleted,"list-id":e.listId,"location-id":e.locationId,"user-id":e.userId,date:e.date,"external-app-id":e.externalAppId,"search-query":e.searchQuery},{default:O(({tasks:o})=>[!o.length&&e.startMessage&&_(t).isPreFilled?(c(),f("div",In,w(e.startMessage),1)):y("",!0),e.hideAddNewTask?y("",!0):(c(),f("div",Tn,[L(on,{"addable-props":e.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])])),a.shouldFilterUncompleted&&!a.hideUncompletedLabel&&o.length?(c(),f("div",$n,w(a.$t("completed")),1)):y("",!0),L(wn,null,{default:O(({onSelect:r,onDeselect:l})=>[L(Ut,{items:o,"sortable-list-id":e.disableSort?void 0:e.listId,"sortable-group-name":"tasks",onSort:_(t).sort,onSelect:r,onDeselect:l},{default:O(({item:d})=>[L(Zs,null,{default:O(({onUpdate:S,onComplete:T,onInsert:k,onInsertMany:I,onInsertFirst:v,onDelete:b,onBlur:u})=>[L(Xs,{task:d,sortable:!!e.listId&&!e.disableSort,"addable-props":e.addableProps,"is-enter-disabled":!e.listId||e.disableSort,"show-info-link":"",onUpdate:S,onComplete:T,onInsert:k,onInsertMany:I,onInsertFirst:v,onDelete:b,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Dn as _,Ke as a};
