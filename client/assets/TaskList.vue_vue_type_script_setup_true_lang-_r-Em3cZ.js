import{c as fe,d as Be,_ as at,p as ot,t as _e,a as rt,b as lt}from"./textToHtmlWithLinks-i-XoUndA.js";import{r as $,ae as it,m as q,af as N,d as C,a6 as ut,c as D,ag as ct,o as c,e as f,n as j,t as w,j as k,k as dt,M as R,g as _,f as p,L as z,A as me,G as Ne,z as ne,ah as Y,ai as pe,a7 as Ae,aj as re,ak as ft,al as pt,am as Ue,an as mt,ao as vt,ap as ht,aq as kt,ar as _t,as as yt,at as gt,B as Q,F as A,y as X,i as G,u as wt,D as Re,a3 as bt,h as L,q as O,au as St,S as It,V as qe,R as Tt,av as xt,aw as ye,ax as ee,ay as $t,p as Ct,N as je,s as Lt,w as H,az as Mt,aA as ze,aB as Dt,l as Pt,aC as Et,U as V,aD as Ot,aE as Ft,aF as Bt,H as Nt,a9 as ge,aG as we}from"./index-VHW-JnuE.js";import{m as le,g as se,a as At,s as be}from"./sanitizer-qTkizPqY.js";import{_ as Ut}from"./SortableList.vue_vue_type_style_index_0_lang-rJLuw8Q5.js";function Rt(s){const e=$([]),t=new Set;it(s,()=>{s.value&&(e.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),q(e,()=>{for(const[m]of t.entries())typeof m=="function"&&m(),t.delete(m)});const n=m=>{t.add(m)},a=m=>e.value.findIndex(g=>g.isEqualNode(m)),i=m=>e.value[a(m)-1],o=m=>e.value[a(m)+1],r=(m,g)=>{if(m){const u=o(m);if(u instanceof HTMLElement)return u.focus(),g&&le(u),u}else{const u=e.value[0];u instanceof HTMLElement&&u.focus()}},l=(m,g,u)=>{if(m.target instanceof HTMLElement){const v=m.target,x=se(v),P=g==="up"?i(v):o(v);P instanceof HTMLElement&&(m.preventDefault(),P.focus(),At(P,x),typeof u=="function"&&u())}};return{getPreviousElementSibling:i,getNextElementSibling:o,getCurrentPositionInNavigationList:a,focusNextTask:r,focusTaskById:(m,g)=>{const u=e.value.find(v=>{var x;return v instanceof HTMLElement&&((x=v.dataset)==null?void 0:x.id)==m});u instanceof HTMLElement&&(u.focus(),g&&le(u))},onUp:(m,g)=>{l(m,"up",g)},onDown:(m,g)=>{l(m,"down",g)},onLeft:(m,g)=>{if(m.target instanceof HTMLElement){const u=m.target;if(se(u)===0){const v=i(u);v instanceof HTMLElement&&(m.preventDefault(),v.focus(),le(v),typeof g=="function"&&g())}}},onRight:(m,g)=>{if(m.target instanceof HTMLElement){const u=m.target;if(se(u)===u.innerText.length){const v=o(u);v instanceof HTMLElement&&(m.preventDefault(),v.focus(),typeof g=="function"&&g())}}},nextUpdate:n}}function Se(s){for(var e=[],t;!(t=s.next()).done;)e.push(t.value);return e}function Ie(s,e,t){for(var n=0,a=t.length;n<a;){if(s(e,t[n]))return!0;n+=1}return!1}function qt(s){var e=String(s).match(/^function (\w*)/);return e==null?"":e[1]}function ae(s,e){return Object.prototype.hasOwnProperty.call(e,s)}function jt(s,e){return s===e?s!==0||1/s===1/e:s!==s&&e!==e}const ie=typeof Object.is=="function"?Object.is:jt;var Te=Object.prototype.toString,zt=function(){return Te.call(arguments)==="[object Arguments]"?function(e){return Te.call(e)==="[object Arguments]"}:function(e){return ae("callee",e)}}(),Ht=!{toString:null}.propertyIsEnumerable("toString"),xe=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],$e=function(){return arguments.propertyIsEnumerable("length")}(),Wt=function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1},Ce=typeof Object.keys=="function"&&!$e?fe(function(e){return Object(e)!==e?[]:Object.keys(e)}):fe(function(e){if(Object(e)!==e)return[];var t,n,a=[],i=$e&&zt(e);for(t in e)ae(t,e)&&(!i||t!=="length")&&(a[a.length]=t);if(Ht)for(n=xe.length-1;n>=0;)t=xe[n],ae(t,e)&&!Wt(a,t)&&(a[a.length]=t),n-=1;return a}),Le=fe(function(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function Me(s,e,t,n){var a=Se(s),i=Se(e);function o(r,l){return ve(r,l,t.slice(),n.slice())}return!Ie(function(r,l){return!Ie(o,l,r)},i,a)}function ve(s,e,t,n){if(ie(s,e))return!0;var a=Le(s);if(a!==Le(e))return!1;if(typeof s["fantasy-land/equals"]=="function"||typeof e["fantasy-land/equals"]=="function")return typeof s["fantasy-land/equals"]=="function"&&s["fantasy-land/equals"](e)&&typeof e["fantasy-land/equals"]=="function"&&e["fantasy-land/equals"](s);if(typeof s.equals=="function"||typeof e.equals=="function")return typeof s.equals=="function"&&s.equals(e)&&typeof e.equals=="function"&&e.equals(s);switch(a){case"Arguments":case"Array":case"Object":if(typeof s.constructor=="function"&&qt(s.constructor)==="Promise")return s===e;break;case"Boolean":case"Number":case"String":if(!(typeof s==typeof e&&ie(s.valueOf(),e.valueOf())))return!1;break;case"Date":if(!ie(s.valueOf(),e.valueOf()))return!1;break;case"Error":return s.name===e.name&&s.message===e.message;case"RegExp":if(!(s.source===e.source&&s.global===e.global&&s.ignoreCase===e.ignoreCase&&s.multiline===e.multiline&&s.sticky===e.sticky&&s.unicode===e.unicode))return!1;break}for(var i=t.length-1;i>=0;){if(t[i]===s)return n[i]===e;i-=1}switch(a){case"Map":return s.size!==e.size?!1:Me(s.entries(),e.entries(),t.concat([s]),n.concat([e]));case"Set":return s.size!==e.size?!1:Me(s.values(),e.values(),t.concat([s]),n.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=Ce(s);if(o.length!==Ce(e).length)return!1;var r=t.concat([s]),l=n.concat([e]);for(i=o.length-1;i>=0;){var d=o[i];if(!(ae(d,e)&&ve(e[d],s[d],r,l)))return!1;i-=1}return!0}var Kt=Be(function(e,t){return ve(e,t,[],[])});function Vt(s,e,t){var n,a;if(typeof s.indexOf=="function")switch(typeof e){case"number":if(e===0){for(n=1/e;t<s.length;){if(a=s[t],a===0&&1/a===n)return t;t+=1}return-1}else if(e!==e){for(;t<s.length;){if(a=s[t],typeof a=="number"&&a!==a)return t;t+=1}return-1}return s.indexOf(e,t);case"string":case"boolean":case"function":case"undefined":return s.indexOf(e,t);case"object":if(e===null)return s.indexOf(e,t)}for(;t<s.length;){if(Kt(s[t],e))return t;t+=1}return-1}function De(s,e){return Vt(e,s,0)>=0}var Qt=function(){function s(){this._nativeSet=typeof Set=="function"?new Set:null,this._items={}}return s.prototype.add=function(e){return!Pe(e,!0,this)},s.prototype.has=function(e){return Pe(e,!1,this)},s}();function Pe(s,e,t){var n=typeof s,a,i;switch(n){case"string":case"number":return s===0&&1/s===-1/0?t._items["-0"]?!0:(e&&(t._items["-0"]=!0),!1):t._nativeSet!==null?e?(a=t._nativeSet.size,t._nativeSet.add(s),i=t._nativeSet.size,i===a):t._nativeSet.has(s):n in t._items?s in t._items[n]?!0:(e&&(t._items[n][s]=!0),!1):(e&&(t._items[n]={},t._items[n][s]=!0),!1);case"boolean":if(n in t._items){var o=s?1:0;return t._items[n][o]?!0:(e&&(t._items[n][o]=!0),!1)}else return e&&(t._items[n]=s?[!1,!0]:[!0,!1]),!1;case"function":return t._nativeSet!==null?e?(a=t._nativeSet.size,t._nativeSet.add(s),i=t._nativeSet.size,i===a):t._nativeSet.has(s):n in t._items?De(s,t._items[n])?!0:(e&&t._items[n].push(s),!1):(e&&(t._items[n]=[s]),!1);case"undefined":return t._items[n]?!0:(e&&(t._items[n]=!0),!1);case"object":if(s===null)return t._items.null?!0:(e&&(t._items.null=!0),!1);default:return n=Object.prototype.toString.call(s),n in t._items?De(s,t._items[n])?!0:(e&&t._items[n].push(s),!1):(e&&(t._items[n]=[s]),!1)}}var Yt=Be(function(e,t){for(var n=[],a=0,i=e.length,o=t.length,r=new Qt,l=0;l<o;l+=1)r.add(t[l]);for(;a<i;)r.add(e[a])&&(n[n.length]=e[a]),a+=1;return n});const Jt=s=>{const e=N(s);return typeof e=="number"&&!isNaN(e)?`${e.toFixed(2)}km`:""},Xt={class:"flexbox space-12 smaller empty:tw-hidden"},Gt={key:2},Zt=C({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const e=ut(),t=D(()=>ct(s.task)),n=D(()=>({"text-red":t.value===3,"text-yellow":t.value===2,"text-green":t.value===1,grey:t.value===0}));return(a,i)=>{var o;return c(),f("div",Xt,[a.task.due_datetime&&!a.task.status?(c(),f("div",{key:0,class:j(["semibold",n.value])},w(k(dt)(a.task.due_datetime).format("LLL")),3)):a.task.due_date&&!a.task.status?(c(),f("div",{key:1,class:j(["semibold",n.value])},w(k(R)(a.task.due_date).format("LL")),3)):_("",!0),a.task.location_id?(c(),f("div",Gt,[i[0]||(i[0]=p("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),z(" "+w((o=k(e).getItemById(a.task.location_id))==null?void 0:o.name)+" "+w(k(Jt)(k(e).distanceById(a.task.location_id))),1)])):_("",!0)])}}}),es={class:"icon"},ts=["src"],ss=C({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const e=me(),t=Ne(),n=D(()=>!e.currentRoute.value.params.listId),a=D(()=>s.task.list_id&&n.value?t.itemsMap[s.task.list_id]:null),i=()=>{if(!a.value)return;const o=e.resolve({name:"list",params:{listId:a.value.id}});window.open(o.href,"_blank")};return(o,r)=>(c(),f("div",{class:j(["flexbox middle",{"space-12":!o.isFocused}])},[o.isFocused?(c(),ne(at,{key:0,task:o.task,input:o.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(c(),ne(Zt,{key:1,task:o.task},null,8,["task"])),a.value?(c(),f("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:i},[p("div",es,[p("img",{src:a.value.icon_url,loading:"lazy"},null,8,ts)]),z(" "+w(a.value.name),1)])):_("",!0)],2))}}),He=vt?window:void 0;function te(s){var e;const t=N(s);return(e=t==null?void 0:t.$el)!=null?e:t}function J(...s){const e=[],t=()=>{e.forEach(r=>r()),e.length=0},n=(r,l,d,S)=>(r.addEventListener(l,d,S),()=>r.removeEventListener(l,d,S)),a=D(()=>{const r=re(N(s[0])).filter(l=>l!=null);return r.every(l=>typeof l!="string")?r:void 0}),i=ft(()=>{var r,l;return[(l=(r=a.value)==null?void 0:r.map(d=>te(d)))!=null?l:[He].filter(d=>d!=null),re(N(a.value?s[1]:s[0])),re(k(a.value?s[2]:s[1])),N(a.value?s[3]:s[2])]},([r,l,d,S])=>{if(t(),!(r!=null&&r.length)||!(l!=null&&l.length)||!(d!=null&&d.length))return;const T=pt(S)?{...S}:S;e.push(...r.flatMap(I=>l.flatMap(b=>d.map(m=>n(I,b,m,T)))))},{flush:"post"}),o=()=>{i(),t()};return Ue(t),o}let Ee=!1;function Oe(s,e,t={}){const{window:n=He,ignore:a=[],capture:i=!0,detectIframe:o=!1,controls:r=!1}=t;if(!n)return r?{stop:Y,cancel:Y,trigger:Y}:Y;if(pe&&!Ee){Ee=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(v=>J(v,"click",Y,u)),J(n.document.documentElement,"click",Y,u)}let l=!0;const d=u=>N(a).some(v=>{if(typeof v=="string")return Array.from(n.document.querySelectorAll(v)).some(x=>x===u.target||u.composedPath().includes(x));{const x=te(v);return x&&(u.target===x||u.composedPath().includes(x))}});function S(u){const v=N(u);return v&&v.$.subTree.shapeFlag===16}function T(u,v){const x=N(u),P=x.$.subTree&&x.$.subTree.children;return P==null||!Array.isArray(P)?!1:P.some(W=>W.el===v.target||v.composedPath().includes(W.el))}const I=u=>{const v=te(s);if(u.target!=null&&!(!(v instanceof Element)&&S(s)&&T(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(l=!d(u)),!l){l=!0;return}e(u)}};let b=!1;const m=[J(n,"click",u=>{b||(b=!0,setTimeout(()=>{b=!1},0),I(u))},{passive:!0,capture:i}),J(n,"pointerdown",u=>{const v=te(s);l=!d(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),o&&J(n,"blur",u=>{setTimeout(()=>{var v;const x=te(s);((v=n.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(x!=null&&x.contains(n.document.activeElement))&&e(u)},0)},{passive:!0})].filter(Boolean),g=()=>m.forEach(u=>u());return r?{stop:g,cancel:()=>{l=!1},trigger:u=>{l=!0,I(u),l=!1}}:g}const ns={mounted(s,e){const t=!e.modifiers.bubble;if(typeof e.value=="function")s.__onClickOutside_stop=Oe(s,e.value,{capture:t});else{const[n,a]=e.value;s.__onClickOutside_stop=Oe(s,n,Object.assign({capture:t},a))}},unmounted(s){s.__onClickOutside_stop()}};function ue(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function We(s){const e=window.getComputedStyle(s);if(e.overflowX==="scroll"||e.overflowY==="scroll"||e.overflowX==="auto"&&s.clientWidth<s.scrollWidth||e.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const t=s.parentNode;return!t||t.tagName==="BODY"?!1:We(t)}}function as(s){const e=s||window.event,t=e.target;return We(t)?!1:e.touches.length>1?!0:(e.preventDefault&&e.preventDefault(),!1)}const ce=new WeakMap;function os(s,e=!1){const t=Ae(e);let n=null,a="";q(mt(s),r=>{const l=ue(N(r));if(l){const d=l;if(ce.get(d)||ce.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(a=d.style.overflow),d.style.overflow==="hidden")return t.value=!0;if(t.value)return d.style.overflow="hidden"}},{immediate:!0});const i=()=>{const r=ue(N(s));!r||t.value||(pe&&(n=J(r,"touchmove",l=>{as(l)},{passive:!1})),r.style.overflow="hidden",t.value=!0)},o=()=>{const r=ue(N(s));!r||!t.value||(pe&&(n==null||n()),r.style.overflow=a,ce.delete(r),t.value=!1)};return Ue(o),D({get(){return t.value},set(r){r?i():o()}})}function rs(){let s=!1;const e=Ae(!1);return(t,n)=>{if(e.value=n.value,s)return;s=!0;const a=os(t,n.value);q(e,i=>a.value=i)}}rs();const ls=s=>{const e=["\\- \\[ \\]","\\- \\[x\\]","\\* "],t=new RegExp(`^(${e.join("|")})`,"gm");return s.replace(t,"")},is=s=>{const e="\\- \\[x\\]";return new RegExp(`^${e}`,"gm").test(s)},us=ht("syncError",()=>{const s=kt(_t(yt(()=>gt.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:D(()=>new Map(s.value.filter(t=>t.entity==="task"&&t.error).map(t=>[t.id,t.error])))}});function cs(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const ds={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},fs=["href"],ps=["src"],ms={class:"bold"},vs={key:0,class:"hint custom-ml-4 nowrap"},hs=["onClick"],ks=C({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const e=Q(),t=n=>{window.confirm("Delete the file permanently?")&&e.deleteAttachments(s.task,[n])};return(n,a)=>{var i;return(i=n.task.attachments)!=null&&i.length?(c(),f("div",ds,[(c(!0),f(A,null,X(n.task.attachments,o=>(c(),f("div",{key:o.uuid||o.id,class:"pl-attachments__item small"},[p("a",{href:o.download_url,target:"_blank"},[o.preview_url?(c(),f("img",{key:0,src:o.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,ps)):(c(),f(A,{key:1},[p("span",ms,w(o.file_name),1),o.size?(c(),f("span",vs,w(k(cs)(o.size)),1)):_("",!0)],64))],8,fs),n.isFocused?(c(),f("div",{key:0,class:j(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":o.preview_url}])},[p("a",{class:j(o.preview_url?"button circle white":"custom-ml-8"),onClick:G(r=>t(o.id),["prevent"])},a[0]||(a[0]=[p("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,hs)],2)):_("",!0)]))),128))])):_("",!0)}}}),de=C({__name:"UserPic",props:{userId:{}},setup(s){const e=s,t=wt(),n=D(()=>t.getItemById(e.userId));return(a,i)=>{var o;return(o=n.value)!=null&&o.photo_url?(c(),f("span",{key:0,class:"icon userpic",style:Re({backgroundImage:`url(${n.value.photo_url})`})},null,4)):_("",!0)}}}),_s={key:0,class:"tw-cursor-pointer"},ys={key:0,class:"pl-list-item-firedBullet"},gs={key:1,class:"tw-cursor-pointer"},ws=C({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:e}){const t=s,n=e,a=$(t.task.status===1);q(()=>t.task.status,r=>{a.value=r===1});const i=D(()=>bt(t.task)),o=()=>{a.value=!a.value,n("complete")};return(r,l)=>(c(),f("div",{class:"tw-w-5 tw-flex-none",onClick:o},[L(qe,{name:"bounce",mode:"out-in"},{default:O(()=>{var d;return[a.value?(c(),f("div",gs,l[0]||(l[0]=[p("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(c(),f("div",_s,[i.value===k(St)?(c(),f("div",ys)):(c(),f("div",{key:1,class:"pl-list-item-bullet",style:Re(`background-color: ${(d=k(It).get(i.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),bs=new WeakMap;function Ss(){const s=Tt(),e=me(),t=()=>{var l;const i=[...s.matched].reverse().find(d=>{var S;return(S=d.meta)==null?void 0:S.isListView})||null,o=((l=i==null?void 0:i.children)==null?void 0:l.find(d=>{var S;return(S=d.meta)==null?void 0:S.isTaskInfoView}))||null,r={listViewRoute:i,taskInfoRoute:o};return bs.set(s,r),r};return{navigateToTaskInfo:async a=>{const{listViewRoute:i,taskInfoRoute:o}=t();if(!i||!(o!=null&&o.name))return console.warn("Required routes not found"),!1;try{const r=await e.push({name:o.name,params:{taskId:a}});return!xt(r)}catch(r){return console.error("Navigation failed:",r),!1}}}}const Is={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Ts={class:"hint"},xs={class:"hint"},$s={class:"hint"},Cs={class:"tw-clear-both tw-inline-block"},Ls=["placeholder","data-id","innerHTML"],Ms=["innerHTML"],Ds={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Ps={key:0},Es={key:1},Os={key:2,class:"tw-flex-none"},Fs=["title"],Bs=["title"],Ns={class:"bold small"},As={key:5,class:"hint tw-flex-none custom-mt-2"},Us={key:6,class:"hint tw-flex-none custom-mt-2"},Rs={key:0},qs={key:1},js={key:7,class:"hint tw-flex-none custom-mt-2"},zs={key:8,class:"flexbox middle tw-flex-none"},Hs={key:9,class:"flexbox middle tw-flex-none"},Ws={key:10,class:"flexbox middle tw-flex-none"},Ks={key:11,class:"flexbox middle space-4 tw-flex-none"},Vs=["href"],Qs=["src"],Ys=C({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:e}){const t=s,n=e,a=Q(),i=us(),{navigateToTaskInfo:o}=Ss(),r=ye(ze),l=ye(Dt),d=$(!1),S=$(!1),T=$(t.task.name),I=$(t.task.status);q(()=>t.task.status,y=>{I.value=y});const b=$(),m=D(()=>ee(t.task)),g=["name","due_date","due_datetime","priority","location_id"],u=$({});q(()=>t.task,()=>{u.value=ot(g,t.task)},{immediate:!0});const{history:v,clear:x,pause:P,resume:W,commit:Ve}=$t(u,{deep:!0});P(),q(d,()=>{if(d.value)W();else{const y=b.value.innerText.trim();if(ee(t.task)&&!y){n("delete",t.task,u.value);return}u.value.name=y,Ve(),P(),tt(),x()}});let K=null;const he=()=>{n("complete",t.task,u.value)};Ct(()=>{ee(t.task)&&(b.value.focus(),d.value=!0)}),je(()=>{K&&(clearTimeout(K),K=null,he())});const Qe=y=>{if(y.target instanceof HTMLAnchorElement){const h=y.target.href;y.preventDefault(),setTimeout(()=>{window.open(h,"_blank")})}},Ye=()=>{I.value=I.value?0:1,b.value.classList.toggle("opacity-50"),!(K&&(clearTimeout(K),K=null,t.task.status===I.value))&&(K=setTimeout(he,1e3))},ke=()=>{S.value||n("blur",t.task,u.value)},Je=y=>{var U;y.preventDefault();const h=(U=y.clipboardData)==null?void 0:U.getData("text/plain");if(!h)return;if(b.value.innerText){document.execCommand("insertText",!1,h);return}const M=h.split(`
`).filter(F=>F);M.length&&n("insertMany",t.task,M.map(F=>({name:ls(F),...t.addableProps,...is(F)?{status:1}:{}})))},Xe=y=>{se(y.target)===0&&(S.value=!0,r==null||r.onLeft(y),n("delete",t.task,u.value))},Ge=async y=>{if(y.shiftKey)return;if(y.preventDefault(),t.isEnterDisabled){ke(),b.value.blur(),d.value=!1,await Pt(),n("insertFirst",{...t.addableProps});return}const h=y.target,M=h.innerText.trim(),U=se(h);let F,Z;U!==0&&(F=M.substring(0,U).trim(),Z=M.substring(U,M.length).trim(),h.innerText=F),M&&n("insert",t.task,{...t.addableProps},{currentName:F,newName:Z}),b.value.blur(),d.value=!1},Ze=y=>{T.value=y.target.innerText},et=()=>{m.value&&(u.value.due_date=v.value[v.value.length-1].snapshot.due_date||null,u.value.due_datetime=v.value[v.value.length-1].snapshot.due_datetime||null),b.value.blur(),d.value=!1};function tt(){const y=ee(t.task)?Object.entries({}):Object.entries(v.value[v.value.length-1].snapshot),h=Object.entries(v.value[0].snapshot),M=Yt(h,y);M.length&&n("update",t.task,Object.fromEntries(M))}const st=()=>{n("update",t.task,{favorite:t.task.favorite?0:1})},oe=async y=>{y.target.closest("[contenteditable], .chips li, a")===null&&await o(t.task.id)};function nt(y){return new URL(Object.assign({"../../assets/apps/shop.svg":rt,"../../assets/apps/tasks.svg":lt})[`../../assets/apps/${y}.svg`],import.meta.url).href}return(y,h)=>{var M,U,F,Z;return S.value?_("",!0):(c(),f("div",{key:0,class:j(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":y.$route.meta.isTaskInfoView&&((M=y.$route.params)==null?void 0:M.taskId)==t.task.id,highlighted:k(a).pinnedTaskUUIDs.has(t.task.uuid)}])},[t.sortable?(c(),f("div",Is,h[6]||(h[6]=[p("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):_("",!0),L(ws,{task:t.task,onComplete:Ye},null,8,["task"]),p("div",{class:"tw-flex-auto",onClick:oe},[(U=k(l))!=null&&U.is_debug_mode?(c(),f(A,{key:0},[p("span",Ts,"list_id: "+w(String(t.task.list_id)),1),h[7]||(h[7]=z(" | ")),p("span",xs,"id: "+w(t.task.id),1),h[8]||(h[8]=z(" | ")),p("span",$s,"srank: "+w(String(t.task.sort))+" | "+w(String(t.task.rank)),1)],64)):_("",!0),Lt((c(),f("div",null,[p("div",Cs,[p("div",{ref_key:"contenteditableRef",ref:b,contenteditable:"",class:j(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":t.task.status===1}]),placeholder:t.placeholder,"data-id":t.task.id,onKeydown:[H(Ge,["enter"]),h[0]||(h[0]=H(E=>{var B;(B=k(r))==null||B.onLeft(E,()=>{d.value=!1})},["left"])),h[1]||(h[1]=H(E=>{var B;(B=k(r))==null||B.onUp(E,()=>{d.value=!1})},["up"])),h[2]||(h[2]=H(E=>{var B;(B=k(r))==null||B.onRight(E,()=>{d.value=!1})},["right"])),h[3]||(h[3]=H(E=>{var B;(B=k(r))==null||B.onDown(E,()=>{d.value=!1})},["down"])),H(Xe,["delete"]),H(et,["esc"]),h[4]||(h[4]=H(()=>{d.value=!1},["tab"]))],onMousedown:Qe,onFocus:h[5]||(h[5]=E=>d.value=!0),onBlur:ke,onPaste:Je,onInput:Ze,innerHTML:k(be)(d.value?t.task.name:k(_e)(t.task.name))},null,42,Ls)]),t.task.note?(c(),f("div",{key:0,class:"hint tw-break-all tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:k(be)(k(_e)(t.task.note))},null,8,Ms)):_("",!0),L(ss,{task:y.task,input:T.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[k(ns),()=>{d.value=!1}]]),L(ks,{task:t.task,"is-focused":d.value},null,8,["task","is-focused"])]),p("div",Ds,[t.showInfoLink?(c(),f("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:G(oe,["prevent"])},h[9]||(h[9]=[p("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):_("",!0),I.value?_("",!0):(c(),f("div",{key:1,class:j(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!t.task.favorite}]),onClick:st},[t.task.favorite?(c(),f("span",Ps,h[10]||(h[10]=[p("i",{class:"fas fa-star text-yellow"},null,-1)]))):(c(),f("span",Es,h[11]||(h[11]=[p("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),k(i).taskErrorMap.get(t.task.id)?(c(),f("div",Os,[p("span",{class:"icon",style:{color:"orange"},title:k(i).taskErrorMap.get(t.task.id)},h[12]||(h[12]=[p("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,Fs)])):_("",!0),!k(Mt)(t.task)&&!k(ee)(t.task)?(c(),f("div",{key:3,class:"tw-flex-none",title:y.$t("syncing")},h[13]||(h[13]=[p("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,Bs)):_("",!0),(F=t.task.extended_data)!=null&&F.comments_count?(c(),f("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:G(oe,["prevent"])},[h[14]||(h[14]=p("i",{class:"fas fa-comment"},null,-1)),p("span",Ns,w(t.task.extended_data.comments_count),1)])):_("",!0),!I.value&&!t.task.assigned_contact_id&&t.task.create_datetime?(c(),f("div",As,w(k(R)().to(k(R)(t.task.create_datetime),!0)),1)):_("",!0),!I.value&&t.task.assigned_contact_id?(c(),f("div",Us,[t.task.update_datetime?(c(),f("span",Rs,w(k(R)().to(k(R)(t.task.update_datetime),!0)),1)):t.task.create_datetime?(c(),f("span",qs,w(k(R)().to(k(R)(t.task.create_datetime),!0)),1)):_("",!0)])):_("",!0),t.task.complete_datetime?(c(),f("div",js,w(k(R)().to(k(R)(t.task.complete_datetime),!0)),1)):_("",!0),!I.value&&!t.task.assigned_contact_id&&t.task.contact_id?(c(),f("div",zs,[L(de,{"user-id":t.task.contact_id},null,8,["user-id"])])):_("",!0),!I.value&&t.task.assigned_contact_id?(c(),f("div",Hs,[L(de,{"user-id":t.task.assigned_contact_id},null,8,["user-id"])])):_("",!0),I.value&&t.task.complete_contact_id?(c(),f("div",Ws,[L(de,{"user-id":t.task.complete_contact_id},null,8,["user-id"])])):_("",!0),(Z=t.task.external_links)!=null&&Z.length?(c(),f("div",Ks,[(c(!0),f(A,null,X(t.task.external_links,E=>(c(),f("a",{key:E.id,href:E.entity_link,class:"icon size-20",target:"_blank"},[p("img",{src:nt(E.app)},null,8,Qs)],8,Vs))),128))])):_("",!0)])],2))}}}),Js=C({__name:"ListNavigationProvider",setup(s){const e=$();return Et(ze,Rt(e)),(t,n)=>(c(),f("div",{ref_key:"navigatableRef",ref:e,class:"tw-relative"},[V(t.$slots,"default")],512))}}),Xs=C({__name:"TaskListItemStoreProvider",setup(s){const e=Q(),t=l=>e.completeTask(l),n=(l,d)=>e.updateItem(l,d),a=async(l,d,S)=>{await e.insert(S.currentName?"after":"before",l,{...d,name:S.newName})},i=(l,d)=>{e.insertMany(l,d)},o=async l=>{await e.insert("before",null,l,{shouldPinNewTask:!0})},r=l=>e.deleteItem(l);return(l,d)=>V(l.$slots,"default",{onComplete:t,onUpdate:n,onInsert:a,onInsertMany:i,onInsertFirst:o,onDelete:r})}}),Gs=C({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:e}){const t=s,n=e,a=$(null),{stop:i}=Ot(a,([{isIntersecting:o}])=>{o&&!t.disabled&&n("intersecting")},{rootMargin:"200px"});return je(()=>{i()}),(o,r)=>(c(),f("div",{ref_key:"elRef",ref:a},[V(o.$slots,"default")],512))}}),Zs={key:0,class:"skeleton custom-m-24"},en={key:0},tn={class:"box custom-py-24 small align-center gray"},sn={class:"skeleton custom-m-24"},Fe=30,nn=C({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const e=s,t=Q(),n=Bt(),a=$(Fe),i=$([]),o=$(!1),r=$(!1),l=D(()=>({list:{source:e.listId?t.getTasksInList(e.listId,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:e.listId?{list_id:e.listId,status:e.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:t.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:t.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:t.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:t.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:i.value,isFetchStream:!0,fetchParams:{filter:`search/${e.searchQuery}`},disableCheckin:!0},location:{source:e.locationId?t.getTasksInLocation(e.locationId,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:e.locationId?{location_id:e.locationId,status:e.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:e.userId?e.shouldFilterUncompleted?t.getTasksCompletedByUser(e.userId):t.getTasksByUser(e.userId):[],isFetchStream:!e.shouldFilterUncompleted,fetchParams:e.userId?e.shouldFilterUncompleted?{complete_contact_id:e.userId,status:"1"}:{filter:`user/${e.userId}`}:{},disableCheckin:!1},completed:{source:t.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:e.date?t.getTasksInDate(e.date,e.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:e.externalAppId?t.getTasksByApp(e.externalAppId):[],isFetchStream:!1,fetchParams:e.externalAppId?{external_app_id:e.externalAppId}:null,disableCheckin:!1}})[e.filter]),d=D(()=>l.value.source.slice(0,a.value));q(()=>e,T,{deep:!0,immediate:!0});const S=()=>{a.value+=Fe};async function T(){const{isFetchStream:b,fetchParams:m,disableCheckin:g}=l.value;if(!m||!I(m))return;if(o.value=!1,i.value=[],e.filter==="list"){const v=n.task.value.get(JSON.stringify({list_id:e.listId})),x=n.task.value.get(JSON.stringify({list_id:e.listId,status:"0"})),P=n.task.value.get(JSON.stringify({list_id:e.listId,status:"1"})),W=v||x;if(W)if(e.shouldFilterUncompleted){if(P)return}else delete m.status,m.starting_from=Ft(new Date(W))}r.value="starting_from"in m?!m.starting_from:!1;const u=await t[b?"fetchStream":"fetch"]({...m},{disableCheckin:g});r.value=!1,u&&u.value&&u.value.status_code==="ok"&&e.filter==="search"&&(i.value=[...i.value,...u.value.data],o.value=!i.value.length)}function I(b){return!(!b||b.list_id&&typeof b.list_id!="number"||b.location_id&&typeof b.location_id!="number")}return(b,m)=>r.value?(c(),f("div",Zs,[(c(),f(A,null,X(5,g=>p("span",{key:g,class:"skeleton-custom-box",style:{height:"40px"}})),64))])):(c(),f(A,{key:1},[V(b.$slots,"default",{tasks:d.value}),e.filter==="search"&&o.value?(c(),f("div",en,[p("p",tn,[z(w(b.$t("searchNoMatches"))+" ",1),p("strong",null,w(e.searchQuery),1)])])):_("",!0),L(qe,{name:"fade"},{default:O(()=>[d.value.length&&d.value.length<l.value.source.length?(c(),ne(Gs,{key:0,onIntersecting:S},{default:O(()=>[p("div",sn,[(c(),f(A,null,X(5,g=>p("span",{key:g,class:"skeleton-custom-box",style:{height:"40px"}})),64))])]),_:1})):_("",!0)]),_:1})],64))}}),an=C({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const e=s,t=Q(),n=me();q(n.currentRoute,async i=>{const o={...i.query};"addNewTask"in o&&(await a(),delete o.addNewTask,n.replace({path:i.path,query:o}))},{immediate:!0});async function a(){await t.insert("before",null,{...e.addableProps},{shouldPinNewTask:e.shouldPinNewTask})}return(i,o)=>(c(),f("div",{class:"text-gray pl-list-item-title",onClick:a},[o[0]||(o[0]=p("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),z(" "+w(i.$t("newToDo")),1)]))}}),on={class:"dialog-header"},rn={class:"dialog-content empty:tw-hidden"},ln={class:"dialog-footer tw-flex tw-gap-2"},Ke=C({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(e,t)=>(c(),f(A,null,[p("header",on,[p("h3",null,w(e.$props.title),1),e.hideCloseIcon?_("",!0):(c(),f("a",{key:0,class:"dialog-close",onClick:t[0]||(t[0]=G(n=>e.$emit("close"),["prevent"]))},t[2]||(t[2]=[p("i",{class:"fas fa-times"},null,-1)])))]),p("div",rn,[V(e.$slots,"default")]),p("footer",ln,[V(e.$slots,"submit"),e.hideCloseButton?_("",!0):(c(),f("button",{key:0,class:"button light-gray",onClick:t[1]||(t[1]=n=>e.$emit("close"))}," Close "))])],64))}}),un=C({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(e,t)=>(c(),ne(Ke,{title:e.title,"hide-close-icon":!0},{submit:O(()=>[p("button",{class:"danger",onClick:t[0]||(t[0]=(...n)=>e.onDelete&&e.onDelete(...n))}," Delete ")]),default:O(()=>[z(w(e.text)+" ",1)]),_:1},8,["title"]))}}),cn={class:"tw-w-68"},dn={class:"menu"},fn={href:"javascript:void(0);"},pn={class:"menu"},mn=["onClick"],vn=["disabled"],hn=C({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const e=Nt(),t=Ne(),n=$(),a=()=>{n.value&&s.onMove(n.value)};return(i,o)=>(c(),ne(Ke,{title:i.title,"hide-close-icon":!0},{submit:O(()=>[p("button",{disabled:!n.value,onClick:G(a,["prevent"])}," Move ",8,vn)]),default:O(()=>[p("div",cn,[p("ul",dn,[(c(!0),f(A,null,X(k(e).items,r=>(c(),f("li",{key:r.uuid||r.id},[p("a",fn,w(r.name),1),p("ul",pn,[(c(!0),f(A,null,X(k(t).getListsInPocket(r.id),l=>(c(),f("li",{key:l.uuid||l.id,class:j(n.value===l.id&&"selected rounded")},[p("a",{href:"#",onClick:G(()=>{n.value=n.value===l.id?void 0:l.id},["prevent"])},w(l.name),9,mn)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),kn={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},_n={class:"hint"},yn={class:"hint"},gn=C({__name:"TaskListMultiselect",setup(s){const e=Q(),t=$(new Set),{show:n,hide:a}=ge(un,{title:"Delete",text:we(()=>`Delete ${t.value.size} selected items?`),onDelete:async()=>{await e.deleteItems([...t.value]),t.value.clear(),a()}}),{show:i,hide:o}=ge(hn,{title:"Move Items",text:we(()=>`Delete ${t.value.size} selected items?`),onMove:async T=>{await e.sort(T,null,[...t.value]),t.value.clear(),o()}}),r=T=>{t.value.add(T)},l=T=>{t.value.delete(T)},d=()=>{i()},S=()=>{n()};return(T,I)=>(c(),f(A,null,[t.value.size?(c(),f("div",kn,[p("button",{class:"button light-gray smaller",onClick:d},[I[0]||(I[0]=p("i",{class:"fas fa-list text-blue"},null,-1)),z(" "+w(T.$t("Move"))+" ",1),p("span",_n,w(t.value.size),1)]),p("button",{class:"button light-gray smaller",onClick:S},[I[1]||(I[1]=p("i",{class:"fas fa-trash-alt text-red"},null,-1)),z(" "+w(T.$t("Delete"))+" ",1),p("span",yn,w(t.value.size),1)])])):_("",!0),V(T.$slots,"default",{onSelect:r,onDeselect:l})],64))}}),wn={class:"pl-bg-block custom-pb-4"},bn={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Sn={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},In={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},Tn={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Mn=C({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const e=s,t=Q(),n=D(()=>["upnext","due","priority","nearby","user"].includes(e.filter));return(a,i)=>(c(),f("div",wn,[e.header?(c(),f("div",bn,[p("h1",null,w(e.header),1)])):_("",!0),L(Js,null,{default:O(()=>[L(nn,{filter:e.filter,"should-filter-uncompleted":e.shouldFilterUncompleted,"list-id":e.listId,"location-id":e.locationId,"user-id":e.userId,date:e.date,"external-app-id":e.externalAppId,"search-query":e.searchQuery},{default:O(({tasks:o})=>[!o.length&&e.startMessage&&k(t).isPreFilled?(c(),f("div",Sn,w(e.startMessage),1)):_("",!0),e.hideAddNewTask?_("",!0):(c(),f("div",In,[L(an,{"addable-props":e.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])])),a.shouldFilterUncompleted&&!a.hideUncompletedLabel&&o.length?(c(),f("div",Tn,w(a.$t("completed")),1)):_("",!0),L(gn,null,{default:O(({onSelect:r,onDeselect:l})=>[L(Ut,{items:o,"sortable-list-id":e.disableSort?void 0:e.listId,"sortable-group-name":"tasks",onSort:k(t).sort,onSelect:r,onDeselect:l},{default:O(({item:d})=>[L(Xs,null,{default:O(({onUpdate:S,onComplete:T,onInsert:I,onInsertMany:b,onInsertFirst:m,onDelete:g,onBlur:u})=>[L(Ys,{task:d,sortable:!!e.listId&&!e.disableSort,"addable-props":e.addableProps,"is-enter-disabled":!e.listId||e.disableSort,"show-info-link":"",onUpdate:S,onComplete:T,onInsert:I,onInsertMany:b,onInsertFirst:m,onDelete:g,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Mn as _,Ke as a};
