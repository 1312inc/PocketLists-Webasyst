import{_ as U,a as V}from"./tasks-WSJ9-G2o.js";import{d as $,u as S,a as B,r as b,o as u,c as m,b as t,w as T,e as R,f as h,t as o,g as y,h as D,i as N,F as C,j as x,k as I,l as A,m as M,n as z,v as E,p as L,q as j,s as F,x as H,y as K,z as W,A as q,B as g,C as O}from"./index-GRMXxMck.js";import{C as P}from"./ContenteditableBlock-oAndeSXx.js";import"./rangy-5rxgwlWZ.js";const G={class:"tw-flex tw-flex-col tw-gap-2 blank box rounded tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},J={class:"tw-flex tw-gap-2"},Q={class:"tw-truncate smaller"},X={class:"gray"},Y={class:"gray"},Z=$({__name:"TaskInfoChatItem",props:{message:{}},setup(w){const r=w,_=S(),l=B(),d=b(!1),f=()=>{l.deleteItem(r.message)},a=c=>{l.updateItem(r.message,{comment:c})};return(c,n)=>{var i;return u(),m(C,null,[t("div",G,[t("div",J,[t("a",{onClick:T(f,["prevent"])},n[1]||(n[1]=[t("i",{class:"fas fa-times"},null,-1)])),t("a",{onClick:n[0]||(n[0]=T(p=>d.value=!0,["prevent"]))},n[2]||(n[2]=[t("i",{class:"fas fa-edit"},null,-1)]))]),R(P,{editable:d.value,focusable:!0,value:r.message.comment,tag:"div",onUpdate:a},null,8,["editable","value"])]),t("div",Q,[h(o((i=y(_).getItemById(r.message.contact_id))==null?void 0:i.name)+" ",1),t("span",X,o(y(D)(y(N)(r.message)).format("ll")),1),t("span",Y,o(typeof r.message.id=="number"?"delivered":"not delivered"),1)])],64)}}}),tt={class:"tw-flex tw-flex-col tw-h-full"},et={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},st={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},at={class:"state-with-inner-icon right width-100"},ot=$({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(w,{emit:r}){const _=r,l=w,d=B(),f=b(),a=b(""),c=x(()=>d.getComentsByTaskId(l.taskId));I(()=>l.taskId,i=>j(i)&&d.fetch({item_id:i}),{immediate:!0}),I(c,async()=>{c.value.length&&(await F(),_("update"))},{immediate:!0}),A(()=>{f.value.focus()}),I(()=>l.taskId,()=>{f.value.focus()});const n=async()=>{const i=await d.insert(l.taskId);i&&(d.updateItem(i,{comment:a.value}),a.value="",f.value.focus())};return(i,p)=>(u(),m("div",tt,[t("div",et,[(u(!0),m(C,null,M(c.value,e=>(u(),H(Z,{key:e.uuid||e.id,message:e},null,8,["message"]))),128))]),t("div",st,[t("div",at,[z(t("input",{ref_key:"inputRef",ref:f,"onUpdate:modelValue":p[0]||(p[0]=e=>a.value=e),type:"text",placeholder:"Message",class:"width-100 blank",onKeydown:L(n,["enter"])},null,544),[[E,a.value]]),t("button",{class:"icon",onClick:n},p[1]||(p[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),lt={key:0,class:"tw-h-full tw-flex tw-flex-col"},nt={class:"tw-flex-none custom-px-12"},it={class:"custom-my-0"},rt={class:"chips small"},ct={href:"#"},ut={href:"#"},dt={href:"#"},mt={href:"#"},ft={href:"#"},pt={key:0,class:"custom-mb-12"},_t={class:"hint custom-mb-4"},vt={class:"custom-ml-4"},ht={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},wt={key:1,class:"custom-mb-12"},kt=["href"],gt=["src"],yt=["href"],bt={class:"hint custom-ml-4"},Tt=$({__name:"TaskInfo",props:{taskId:{}},setup(w){const r=w,_=K(),l=b(),d=W(),f=S(),a=x(()=>d.getItemById(r.taskId)),c=x(()=>f.getItemById(a.value.contact_id)),n=()=>{setTimeout(()=>{l.value.scrollTo({top:l.value.scrollHeight})},100)},i=()=>{var s;const e=(s=[..._.currentRoute.value.matched].reverse().find(k=>k.meta.isListView))==null?void 0:s.name;e?_.push({name:e}):console.error("Cant find back route")};function p(e){return new URL(Object.assign({"../assets/apps/shop.svg":U,"../assets/apps/tasks.svg":V})[`../assets/apps/${e}.svg`],import.meta.url).href}return(e,s)=>{var k;return a.value?(u(),m("div",lt,[t("div",{class:"tw-flex-none custom-p-12"},[t("a",{class:"back larger",onClick:i},s[0]||(s[0]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t("div",nt,[t("h3",it,o(a.value.name),1),t("ul",rt,[t("li",null,[t("a",ct,[s[1]||(s[1]=t("i",{class:"fas fa-calendar-alt"},null,-1)),h(" "+o(e.$t("When")),1)])]),t("li",null,[t("a",ut,[s[2]||(s[2]=t("i",{class:"fas fa-map-marker-alt"},null,-1)),h(" "+o(e.$t("Where")),1)])]),t("li",null,[t("a",dt,[s[3]||(s[3]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+o(e.$t("Priority")),1)])]),t("li",null,[t("a",mt,[s[4]||(s[4]=t("i",{class:"fas fa-arrow-right"},null,-1)),h(" "+o(e.$t("Assign")),1)])]),t("li",null,[t("a",ft,[s[5]||(s[5]=t("i",{class:"fas fa-paperclip"},null,-1)),h(" "+o(e.$t("Attach")),1)])])]),c.value?(u(),m("div",pt,[t("div",_t,o(e.$t("Created by")),1),t("div",null,[t("span",{class:"icon userpic userpic-20",style:q({backgroundImage:`url(${c.value.photo_url})`})},null,4),t("span",vt,o(c.value.name),1),a.value.create_datetime?(u(),m("span",ht,o(y(O)(a.value.create_datetime)),1)):g("",!0)])])):g("",!0),(k=a.value.external_links)!=null&&k.length?(u(),m("div",wt,[(u(!0),m(C,null,M(a.value.external_links,v=>(u(),m("div",{key:v.id},[t("a",{href:v.entity_link,class:"icon size-20",target:"_blank"},[t("img",{src:p(v.app)},null,8,gt)],8,kt),t("a",{class:"custom-ml-4",href:v.entity_link},o(v.entity_title),9,yt),t("span",bt,o(v.app),1)]))),128))])):g("",!0),s[6]||(s[6]=t("hr",null,null,-1))]),t("div",{ref_key:"containerRef",ref:l,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[R(ot,{"task-id":e.taskId,onUpdate:n},null,8,["task-id"])],512)])):g("",!0)}}});export{Tt as default};
