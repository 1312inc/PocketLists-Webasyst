import{_ as N,t as L,a as V,b as z}from"./textToHtmlWithLinks-0qT2Ozru.js";import{d as C,u as B,a as R,r as b,c as x,b as j,o as a,e as o,f as t,g as v,h as g,w as U,i as A,t as h,j as $,k as H,n as S,l as E,m as I,p as K,q as F,T as q,s as G,v as O,x as W,F as M,y as D,z as Y,A as J,B as P,C as Q,D as X,E as Z}from"./index-NV3btlxa.js";import{C as tt}from"./ContenteditableBlock-6TCD2zl6.js";import{_ as et}from"./ContenteditableBlockClickable.vue_vue_type_script_setup_true_lang-yF4gVobP.js";import"./sanitizer-qTkizPqY.js";const st={key:0,class:"tw-hidden group-hover:tw-block"},at={class:"smaller tw-flex tw-items-center tw-gap-2"},ot={key:0},nt={class:"icon userpic"},lt=["src"],ct={key:1,class:"tw-truncate"},it={class:"tw-whitespace-nowrap opacity-60"},rt={key:2,class:"opacity-60"},ut=C({__name:"TaskInfoChatItem",props:{message:{}},setup(y){const n=y,k=B(),c=R(),d=b(),m=b(!1),e=x(()=>n.message.contact_id===j.contact_id),l=x(()=>k.getItemById(n.message.contact_id)),_=async()=>{confirm("Are You sure?")&&await c.deleteItem(n.message)},i=async()=>{m.value=!0,await E(),d.value.focus()},p=async r=>{r!==null&&await c.updateItem(n.message,{comment:r})};return(r,s)=>{var f;return a(),o("div",{class:S(["tw-group tw-flex tw-gap-2",{"tw-justify-end":e.value}])},[e.value?(a(),o("div",st,[t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:_},s[2]||(s[2]=[t("i",{class:"fas fa-trash-alt"},null,-1)])),t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:i},s[3]||(s[3]=[t("i",{class:"fas fa-edit"},null,-1)]))])):v("",!0),t("div",{class:S(["blank box rounded tw-flex-none tw-w-[80%] tw-flex tw-flex-col tw-gap-2",{"tw-bg-[var(--accent-color)] text-white":e.value}])},[g(tt,{ref_key:"contenteditableRef",ref:d,editable:m.value,focusable:!0,value:n.message.comment||"",tag:"div",class:"small",onBlur:s[0]||(s[0]=w=>m.value=!1),onUpdate:p,onKeydown:s[1]||(s[1]=U(A(w=>{var u,T;return(T=(u=w.target)==null?void 0:u.blur)==null?void 0:T.call(u)},["stop"]),["esc"]))},null,8,["editable","value"]),t("div",at,[l.value&&!e.value?(a(),o("div",ot,[t("span",nt,[t("img",{src:(f=l.value)==null?void 0:f.photo_url,alt:""},null,8,lt)])])):v("",!0),l.value&&!e.value?(a(),o("div",ct,h(l.value.name),1)):v("",!0),t("div",it,h($(H)(n.message.create_datetime).format("ll")),1),typeof n.message.id=="number"?(a(),o("div",rt,s[4]||(s[4]=[t("i",{class:"fas fa-check fa-xs"},null,-1)]))):v("",!0)])],2)],2)}}}),dt={class:"tw-flex tw-flex-col tw-h-full"},mt={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},pt={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},ft={class:"state-with-inner-icon right width-100"},vt=["placeholder"],_t=C({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(y,{emit:n}){const k=n,c=y,d=R(),m=b(),e=b(""),l=x(()=>d.getComentsByTaskId(c.taskId));I(()=>c.taskId,i=>W(i)&&d.fetch({item_id:i}),{immediate:!0}),I(l,async()=>{l.value.length&&(await E(),k("update"))},{immediate:!0}),K(()=>{m.value.focus()}),I(()=>c.taskId,()=>{m.value.focus()});const _=async()=>{if(!e.value)return;const i=await d.insert(c.taskId);i&&(d.updateItem(i,{comment:e.value}),e.value="",m.value.focus())};return(i,p)=>(a(),o("div",dt,[t("div",mt,[g(q,{name:"list"},{default:F(()=>[(a(!0),o(M,null,D(l.value,r=>(a(),Y(ut,{key:r.uuid||r.id,message:r},null,8,["message"]))),128))]),_:1})]),t("div",pt,[t("div",ft,[G(t("input",{ref_key:"inputRef",ref:m,"onUpdate:modelValue":p[0]||(p[0]=r=>e.value=r),type:"text",placeholder:i.$t("addComment"),class:"width-100 blank",onKeydown:U(_,["enter"])},null,40,vt),[[O,e.value,void 0,{trim:!0}]]),t("button",{class:"icon",onClick:_},p[1]||(p[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),wt={key:0,class:"tw-h-full tw-flex tw-flex-col"},ht={class:"pl-bg-block tw-flex-none custom-px-20 custom-pt-16 custom-mx-12"},kt={class:"custom-mb-24"},yt={key:0,class:"custom-mb-12"},gt={class:"flexbox middle space-8 wrap",title:"{{ $t('Created by') }}"},bt={class:"wide"},xt={class:"small"},It={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},$t={class:"custom-mb-12"},Ct={key:1,class:"custom-mb-12"},Tt=["href"],St=["src"],Bt=["href"],Rt={class:"hint custom-ml-4"},Lt=C({__name:"TaskInfo",props:{taskId:{}},setup(y){const n=y,k=J(),c=b(),d=P(),m=B(),e=x(()=>d.getItemById(n.taskId)),l=x(()=>m.getItemById(e.value.contact_id));Q(document,"keydown",s=>{s.code==="Escape"&&_()});const _=()=>{var f;const s=(f=[...k.currentRoute.value.matched].reverse().find(w=>w.meta.isListView))==null?void 0:f.name;s?k.push({name:s}):console.error("Cant find back route")},i=()=>{setTimeout(()=>{c.value.scrollTo({top:c.value.scrollHeight})},100)},p=async s=>{await d.updateItem(n.taskId,{note:s.trim()})};function r(s){return new URL(Object.assign({"../assets/apps/shop.svg":V,"../assets/apps/tasks.svg":z})[`../assets/apps/${s}.svg`],import.meta.url).href}return(s,f)=>{var w;return e.value?(a(),o("div",wt,[t("div",{class:"tw-flex-none custom-p-12"},[t("a",{class:"back larger",onClick:_},f[0]||(f[0]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t("div",ht,[t("h3",null,h(e.value.name),1),t("div",kt,[g(et,{value:e.value.note||"","value-active":$(L)(e.value.note||""),placeholder:s.$t("addNote"),class:"hint",onUpdate:p},null,8,["value","value-active","placeholder"])]),l.value?(a(),o("div",yt,[t("div",gt,[t("span",{class:"icon userpic userpic-20",style:X({backgroundImage:`url(${l.value.photo_url})`})},null,4),t("span",bt,[t("span",xt,h(l.value.name),1),e.value.create_datetime?(a(),o("span",It,h($(Z)(e.value.create_datetime)),1)):v("",!0)])])])):v("",!0),t("div",$t,[g(N,{task:e.value},null,8,["task"])]),(w=e.value.external_links)!=null&&w.length?(a(),o("div",Ct,[(a(!0),o(M,null,D(e.value.external_links,u=>(a(),o("div",{key:u.id},[t("a",{href:u.entity_link,class:"icon size-20",target:"_blank"},[t("img",{src:r(u.app)},null,8,St)],8,Tt),t("a",{class:"custom-ml-4",href:u.entity_link},h(u.entity_title),9,Bt),t("span",Rt,h(u.app),1)]))),128))])):v("",!0)]),t("div",{ref_key:"containerRef",ref:c,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[g(_t,{"task-id":s.taskId,onUpdate:i},null,8,["task-id"])],512)])):v("",!0)}}});export{Lt as default};
