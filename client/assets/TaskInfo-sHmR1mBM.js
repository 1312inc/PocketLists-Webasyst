import{_ as A,a as N}from"./tasks-WSJ9-G2o.js";import{d as $,u as B,a as R,r as g,c as b,o,b as n,e as t,f as v,g as C,w as M,h as z,t as l,i as E,j as L,n as S,k as j,l as D,m as I,p as K,q as F,T as G,s as H,v as W,x as q,F as U,y as V,z as O,A as P,B as Y,C as J,D as y,E as Q,G as X}from"./index-u9kGd2RZ.js";import{C as Z}from"./ContenteditableBlock-X6P98zUm.js";import"./rangy-5rxgwlWZ.js";const tt={key:0,class:"tw-hidden group-hover:tw-block"},et={class:"smaller tw-flex tw-items-center tw-gap-2"},st={key:0},at={class:"icon userpic"},ot=["src"],lt={key:1,class:"tw-truncate"},nt={class:"tw-whitespace-nowrap opacity-60"},it={key:2,class:"opacity-60"},rt=$({__name:"TaskInfoChatItem",props:{message:{}},setup(k){const r=k,h=B(),c=R(),m=g(),d=g(!1),a=b(()=>r.message.contact_id===j.contact_id),i=b(()=>h.getItemById(r.message.contact_id)),_=async()=>{confirm("Are You sure?")&&await c.deleteItem(r.message)},u=async()=>{d.value=!0,await D(),m.value.focus()},p=async s=>{await c.updateItem(r.message,{comment:s})};return(s,e)=>{var w;return o(),n("div",{class:S(["tw-group tw-flex tw-gap-2",{"tw-justify-end":a.value}])},[a.value?(o(),n("div",tt,[t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:_},e[2]||(e[2]=[t("i",{class:"fas fa-trash-alt"},null,-1)])),t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:u},e[3]||(e[3]=[t("i",{class:"fas fa-edit"},null,-1)]))])):v("",!0),t("div",{class:S(["blank box rounded tw-flex-none tw-w-[80%] tw-flex tw-flex-col tw-gap-2",{"tw-bg-[var(--accent-color)] text-white":a.value}])},[C(Z,{ref_key:"contenteditableRef",ref:m,editable:d.value,focusable:!0,value:r.message.comment||"",tag:"div",class:"small",onBlur:e[0]||(e[0]=f=>d.value=!1),onUpdate:p,onKeydown:e[1]||(e[1]=M(z(f=>{var x,T;return(T=(x=f.target)==null?void 0:x.blur)==null?void 0:T.call(x)},["stop"]),["esc"]))},null,8,["editable","value"]),t("div",et,[i.value&&!a.value?(o(),n("div",st,[t("span",at,[t("img",{src:(w=i.value)==null?void 0:w.photo_url,alt:""},null,8,ot)])])):v("",!0),i.value&&!a.value?(o(),n("div",lt,l(i.value.name),1)):v("",!0),t("div",nt,l(E(L)(r.message.create_datetime).format("ll")),1),typeof r.message.id=="number"?(o(),n("div",it,e[4]||(e[4]=[t("i",{class:"fas fa-check fa-xs"},null,-1)]))):v("",!0)])],2)],2)}}}),ct={class:"tw-flex tw-flex-col tw-h-full"},ut={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},dt={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},mt={class:"state-with-inner-icon right width-100"},ft=["placeholder"],pt=$({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(k,{emit:r}){const h=r,c=k,m=R(),d=g(),a=g(""),i=b(()=>m.getComentsByTaskId(c.taskId));I(()=>c.taskId,u=>q(u)&&m.fetch({item_id:u}),{immediate:!0}),I(i,async()=>{i.value.length&&(await D(),h("update"))},{immediate:!0}),K(()=>{d.value.focus()}),I(()=>c.taskId,()=>{d.value.focus()});const _=async()=>{if(!a.value)return;const u=await m.insert(c.taskId);u&&(m.updateItem(u,{comment:a.value}),a.value="",d.value.focus())};return(u,p)=>(o(),n("div",ct,[t("div",ut,[C(G,{name:"list"},{default:F(()=>[(o(!0),n(U,null,V(i.value,s=>(o(),O(rt,{key:s.uuid||s.id,message:s},null,8,["message"]))),128))]),_:1})]),t("div",dt,[t("div",mt,[H(t("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":p[0]||(p[0]=s=>a.value=s),type:"text",placeholder:u.$t("Message"),class:"width-100 blank",onKeydown:M(_,["enter"])},null,40,ft),[[W,a.value,void 0,{trim:!0}]]),t("button",{class:"icon",onClick:_},p[1]||(p[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),vt={key:0,class:"tw-h-full tw-flex tw-flex-col"},_t={class:"tw-flex-none custom-px-12"},wt={class:"custom-my-0"},ht={class:"chips small"},kt={href:"#"},yt={href:"#"},gt={href:"#"},bt={href:"#"},xt={href:"#"},It={key:0,class:"custom-mb-12"},$t={class:"hint custom-mb-4"},Ct={class:"custom-ml-4"},Tt={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},St={key:1,class:"custom-mb-12"},Bt=["href"],Rt=["src"],Mt=["href"],Et={class:"hint custom-ml-4"},Nt=$({__name:"TaskInfo",props:{taskId:{}},setup(k){const r=k,h=P(),c=g(),m=Y(),d=B(),a=b(()=>m.getItemById(r.taskId)),i=b(()=>d.getItemById(a.value.contact_id));J(document,"keydown",s=>{s.code==="Escape"&&_()});const _=()=>{var e;const s=(e=[...h.currentRoute.value.matched].reverse().find(w=>w.meta.isListView))==null?void 0:e.name;s?h.push({name:s}):console.error("Cant find back route")},u=()=>{setTimeout(()=>{c.value.scrollTo({top:c.value.scrollHeight})},100)};function p(s){return new URL(Object.assign({"../assets/apps/shop.svg":A,"../assets/apps/tasks.svg":N})[`../assets/apps/${s}.svg`],import.meta.url).href}return(s,e)=>{var w;return a.value?(o(),n("div",vt,[t("div",{class:"tw-flex-none custom-p-12"},[t("a",{class:"back larger",onClick:_},e[0]||(e[0]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t("div",_t,[t("h3",wt,l(a.value.name),1),t("ul",ht,[t("li",null,[t("a",kt,[e[1]||(e[1]=t("i",{class:"fas fa-calendar-alt"},null,-1)),y(" "+l(s.$t("When")),1)])]),t("li",null,[t("a",yt,[e[2]||(e[2]=t("i",{class:"fas fa-map-marker-alt"},null,-1)),y(" "+l(s.$t("Where")),1)])]),t("li",null,[t("a",gt,[e[3]||(e[3]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),y(" "+l(s.$t("Priority")),1)])]),t("li",null,[t("a",bt,[e[4]||(e[4]=t("i",{class:"fas fa-arrow-right"},null,-1)),y(" "+l(s.$t("Assign")),1)])]),t("li",null,[t("a",xt,[e[5]||(e[5]=t("i",{class:"fas fa-paperclip"},null,-1)),y(" "+l(s.$t("Attach")),1)])])]),i.value?(o(),n("div",It,[t("div",$t,l(s.$t("Created by")),1),t("div",null,[t("span",{class:"icon userpic userpic-20",style:Q({backgroundImage:`url(${i.value.photo_url})`})},null,4),t("span",Ct,l(i.value.name),1),a.value.create_datetime?(o(),n("span",Tt,l(E(X)(a.value.create_datetime)),1)):v("",!0)])])):v("",!0),(w=a.value.external_links)!=null&&w.length?(o(),n("div",St,[(o(!0),n(U,null,V(a.value.external_links,f=>(o(),n("div",{key:f.id},[t("a",{href:f.entity_link,class:"icon size-20",target:"_blank"},[t("img",{src:p(f.app)},null,8,Rt)],8,Bt),t("a",{class:"custom-ml-4",href:f.entity_link},l(f.entity_title),9,Mt),t("span",Et,l(f.app),1)]))),128))])):v("",!0),e[6]||(e[6]=t("hr",null,null,-1))]),t("div",{ref_key:"containerRef",ref:c,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[C(pt,{"task-id":s.taskId,onUpdate:u},null,8,["task-id"])],512)])):v("",!0)}}});export{Nt as default};
