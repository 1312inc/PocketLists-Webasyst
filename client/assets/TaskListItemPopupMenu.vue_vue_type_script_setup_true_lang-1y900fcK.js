import{d as V,aH as S,r as C,J as M,m as b,o as f,z as R,q as y,W as B,af as K,R as x,f as e,j as w,t as d,e as k,s as A,v as E,g as G,y as F,i as g,D as N,O as Z,F as P,B as J,aI as q,aJ as X,A as Q,a4 as z,c as T,a5 as ee,aK as te,I as $,aF as ae,u as le,h as I,n as W,ac as se,k as j,b as O}from"./index-8GM9p_88.js";const Je=""+new URL("img/shop.svg",import.meta.url).href,Ke="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.85619%2017.2942L5.86319%2020.6332L22.1312%201.06423C24.3722%200.898238%2026.6255%201.05688%2028.8212%201.53523L6.56619%2028.3052L0.867188%2023.5572C0.908188%2021.3822%201.25019%2019.2812%201.85619%2017.2942Z'%20fill='%23E80A8A'/%3e%3cpath%20d='M35.4942%204.15186C38.9684%206.19305%2041.8486%209.10706%2043.8492%2012.6049L25.3792%2034.8219L3.36719%2016.4809L10.9402%207.39386L23.8532%2018.1539L35.4932%204.15186H35.4942Z'%20fill='%2329ABE2'/%3e%3cpath%20d='M18.6278%2013.798L11.0658%2022.894L6.88281%2019.409L14.4448%2010.313L18.6278%2013.798V13.798Z'%20fill='%23292A76'/%3e%3cpath%20d='M4.01953%2035.6338L18.9695%2017.6138L27.3515%2024.5658L11.6495%2043.4918C8.51344%2041.5215%205.89666%2038.8265%204.01953%2035.6338V35.6338Z'%20fill='%23F7EA34'/%3e%3cpath%20d='M23.8675%2047C36.5705%2047%2046.8685%2036.703%2046.8685%2024C46.8685%2023.142%2046.8215%2022.294%2046.7305%2021.46L30.0085%2041.574L18.5015%2032.07L12.5215%2039.308L21.7155%2046.902C22.4235%2046.967%2023.1415%2047.001%2023.8675%2047.001V47Z'%20fill='%2349B749'/%3e%3cpath%20d='M44.8763%2033.3699C46.2421%2030.3102%2046.9204%2026.9882%2046.8633%2023.6379L44.1153%2026.9429L35.6863%2019.9829L32.6973%2023.6029L44.7343%2033.5419L44.8763%2033.3709V33.3699Z'%20fill='%23F1B61C'/%3e%3cpath%20d='M36.8902%2020.9769L33.8892%2024.5869L32.6992%2023.6029L35.6872%2019.9829L36.8892%2020.9769H36.8902Z'%20fill='%23097D3F'/%3e%3cpath%20d='M17.0791%2045.9832L28.7711%2031.8892L32.3841%2034.8862L22.3731%2046.9522C20.5762%2046.8379%2018.7989%2046.5123%2017.0781%2045.9822L17.0791%2045.9832Z'%20fill='%23F05323'/%3e%3cpath%20d='M22.3757%2046.9518L28.1267%2040.0198L24.5077%2037.0298L18.5137%2044.2548L21.7157%2046.8998C21.9347%2046.9198%2022.1547%2046.9378%2022.3757%2046.9518V46.9518Z'%20fill='%232B3F1B'/%3e%3cpath%20d='M24.5635%2029.7328L36.5855%2015.2658L33.7695%2012.9258L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4738L24.5635%2029.7338V29.7328Z'%20fill='%23292A76'/%3e%3cpath%20d='M21.5154%2031.6018L13.1484%2024.6308L18.9704%2017.6128L27.3524%2024.5658L21.5154%2031.6018V31.6018Z'%20fill='%2313A149'/%3e%3cpath%20d='M25.4245%2022.9678L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4748L23.6815%2028.9888L27.3515%2024.5658L25.4245%2022.9678V22.9678Z'%20fill='%230C0D1B'/%3e%3cpath%20d='M42.9619%2025.9902L44.1159%2026.9442L46.8639%2023.6392C46.9212%2026.9897%2046.2429%2030.3121%2044.8769%2033.3722L44.7349%2033.5422L39.9609%2029.6002L42.9609%2025.9902H42.9619Z'%20fill='%23269145'/%3e%3c/svg%3e",oe={class:"menu"},ne=["onClick"],ie=["onClick"],ue=["onClick"],re=["onClick"],de={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ce={key:0},pe={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},me=V({__name:"TaskListItemPopupMenuWhen",props:{dueDate:{},dueDateModifiers:{},dueDatetime:{},dueDatetimeModifiers:{}},emits:["update:dueDate","update:dueDatetime"],setup(i){const t=S(i,"dueDate"),n=S(i,"dueDatetime"),r=C(t.value),l=C(n.value?M(n.value).format("HH:mm"):""),u=C(!1),s=C(!1);b([t,n],()=>{u.value=!!(t.value||n.value),s.value=!!n.value},{immediate:!0}),b(l,()=>{!r.value&&l.value&&(r.value=M().format("YYYY-MM-DD"))}),b([r,l],([v,p])=>{t.value=v||null,n.value=p?K(`${v||M().format("YYYY-MM-DD")}T${p}`):null});const L=v=>{r.value=v,l.value=""},c=()=>{r.value="",l.value="",u.value=!1},h=()=>{l.value=""};return(v,p)=>(f(),R(B,null,{default:y(({handler:m,setRef:a})=>[x(v.$slots,"default",{handler:m,setRef:a})]),body:y(({handler:m})=>[e("ul",oe,[e("li",null,[e("a",{onClick:()=>{L(w(M)().format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.today")),9,ne)]),e("li",null,[e("a",{onClick:()=>{L(w(M)().add(1,"day").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.tomorrow")),9,ie)]),e("li",null,[e("a",{onClick:()=>{L(w(M)().add(2,"day").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.in2days")),9,ue)]),e("li",null,[e("a",{onClick:()=>{L(w(M)().endOf("week").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.thisWeekend")),9,re)]),e("li",null,[u.value?(f(),k("div",de,[A(e("input",{"onUpdate:modelValue":p[1]||(p[1]=a=>r.value=a),type:"date",class:"width-100"},null,512),[[E,r.value]]),e("a",{onClick:c},p[4]||(p[4]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),k("a",{key:0,onClick:p[0]||(p[0]=a=>u.value=!u.value)},d(v.$t("datePicker.selectDate")),1))]),u.value?(f(),k("li",ce,[s.value?(f(),k("div",pe,[A(e("input",{"onUpdate:modelValue":p[3]||(p[3]=a=>l.value=a),type:"time",class:"width-100"},null,512),[[E,l.value]]),e("a",{onClick:h},p[5]||(p[5]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),k("a",{key:0,onClick:p[2]||(p[2]=a=>s.value=!s.value)},d(v.$t("datePicker.selectTime")),1))])):G("",!0)])]),_:3}))}}),fe={class:"menu"},ve=["onClick"],_e=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const t=S(i,"modelValue");return(n,r)=>(f(),R(B,null,{default:y(({handler:l,setRef:u})=>[x(n.$slots,"default",{handler:l,setRef:u})]),body:y(({handler:l})=>[e("ul",fe,[(f(!0),k(P,null,F([...w(Z).values()],u=>(f(),k("li",{key:u.priority},[e("a",{onClick:g(()=>{t.value=u.priority,l()},["prevent"])},[e("i",{class:"fas fa-exclamation-circle",style:N(`color: ${u.color}`)},null,4),e("span",null,d(u.name),1)],8,ve)]))),128))])]),_:3}))}}),ke=V({__name:"TaskListItemPopupMenuAttachment",props:{task:{}},setup(i){const t=i,n=J(),{files:r,open:l,reset:u,onCancel:s,onChange:L}=q({});return L(async c=>{c&&(await n.addAttachments(t.task,[...c]),u())}),s(()=>{u()}),(c,h)=>x(c.$slots,"default",{open:w(l)})}}),Le=async i=>{try{const{response:t}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${X}&geocode=${i}&format=json`)).json();return t?t.GeoObjectCollection.featureMember.map(n=>n.GeoObject):[]}catch(t){return t instanceof Error&&console.error(t.message),[]}};function we(i,t,n){const u=40075016686e-3/(256*Math.pow(2,t))*Math.cos(n*(Math.PI/180));return i/u}const he={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},ye={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},ge={class:"pl-bg-block custom-p-16"},Ce={class:"small custom-mt-0"},$e={class:"small gray"},Me={class:"small"},De={class:"custom-my-12"},be={class:"custom-my-12"},Ve=["placeholder"],Ye=V({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(i){const t=i,n=Q(),r=z(),l=T(()=>Math.pow(2,21-t.zoom)*1128.49722*(s.value/1e4)),u=T(()=>Math.round(we(l.value,t.zoom,t.lat))),s=C(50),L=C(""),c=C(!1),h=ee([]),v=C("");b(te(L,500),a=>{if(c.value){c.value=!1;return}p(a)});const p=async a=>{h.value=await Le(a)},m=async()=>{const a=await r.insert({name:v.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:l.value});a&&(await r.updateItem(a,{name:v.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:l.value}),n.push(`/map/${a.id}`))};return(a,o)=>(f(),k("div",he,[e("div",ye,[e("div",ge,[e("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:o[0]||(o[0]=_=>a.$router.replace("/map"))},o[3]||(o[3]=[e("i",{class:"fas fa-times"},null,-1)])),e("p",Ce,d(a.$t("adjustLocationHint")),1),e("p",$e,[$(d(a.lat),1),o[4]||(o[4]=e("br",null,null,-1)),$(" "+d(a.lng),1)]),e("div",Me,[$(d(a.$t("Radius"))+": ",1),e("b",null,d(l.value&&Math.ceil(l.value))+" "+d(a.$t("m")),1)]),e("div",De,[A(e("input",{"onUpdate:modelValue":o[1]||(o[1]=_=>s.value=_),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[E,s.value,void 0,{number:!0}]])]),e("div",be,[A(e("input",{"onUpdate:modelValue":o[2]||(o[2]=_=>v.value=_),type:"text",placeholder:a.$t("name"),class:"width-100"},null,8,Ve),[[E,v.value,void 0,{trim:!0}]])]),e("button",{onClick:m},d(a.$t("Save location")),1)])]),e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:N({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:u.value+"px",height:u.value+"px"})},o[5]||(o[5]=[e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[e("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),Ie={class:"menu"},Pe=["onClick"],Te=V({__name:"TaskListItemPopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const t=S(i,"modelValue"),n=z(),r=C(),l=()=>{ae(Ye,{}).show()},u=s=>{t.value=s,r.value.isOpened=!1};return(s,L)=>(f(),R(B,{ref_key:"dropdownRef",ref:r},{default:y(({handler:c,setRef:h})=>[x(s.$slots,"default",{handler:c,setRef:h})]),body:y(()=>[e("ul",Ie,[e("li",null,[e("a",{onClick:L[0]||(L[0]=g(c=>u(null),["prevent"]))},[e("span",null,d(s.$t("None")),1)])]),e("li",null,[e("a",{onClick:g(l,["prevent"])},L[1]||(L[1]=[e("span",null,"New address...",-1),e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1)]))]),(f(!0),k(P,null,F(w(n).items,c=>(f(),k("li",{key:c.id},[e("a",{onClick:g(h=>u(c.id),["prevent"])},d(c.name),9,Pe)]))),128))])]),_:3},512))}});function D(i){return i!=null&&typeof i=="object"&&i["@@functional/placeholder"]===!0}function U(i){return function t(n){return arguments.length===0||D(n)?t:i.apply(this,arguments)}}function Se(i){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return D(n)?t:U(function(l){return i(n,l)});default:return D(n)&&D(r)?t:D(n)?U(function(l){return i(l,r)}):D(r)?U(function(l){return i(n,l)}):i(n,r)}}}var Ae=Se(function(t,n){for(var r={},l=0;l<t.length;)t[l]in n&&(r[t[l]]=n[t[l]]),l+=1;return r});const Ee=["onClick"],Be=["onClick"],xe=["onClick"],Ue={key:0},Ze=["onClick"],Re={class:"icon"},Fe=["src"],Ne={class:"menu"},ze=["onClick"],He=["onClick"],We={class:"icon"},je=["src"],Oe=["onClick"],qe=V({__name:"TaskListItemPopupMenu",props:{task:{},isSmall:{type:Boolean},hideAssign:{type:Boolean}},setup(i){const t=i,n=J(),r=z(),l=le(),u=["name","due_date","due_datetime","priority","location_id"],s=C({});let L=[];const c=T(()=>t.task.assigned_contact_id&&l.getItemById(t.task.assigned_contact_id)),h=T(()=>se(t.task)),v=T(()=>({"text-red":h.value===3,"text-yellow":h.value===2,"text-green":h.value===1,grey:h.value===0}));b(()=>t.task,m=>{L.forEach(a=>a()),s.value=Ae(u,m),L=u.map(a=>b(()=>s.value[a],async o=>{await n.updateItem(t.task,{[a]:o})}))},{immediate:!0});const p=async m=>{await n.updateItem(t.task.id,{assigned_contact_id:m})};return(m,a)=>(f(),k("ul",{class:W([t.isSmall?"smaller":"small","chips custom-m-0"])},[I(me,{dueDate:s.value.due_date,"onUpdate:dueDate":a[0]||(a[0]=o=>s.value.due_date=o),dueDatetime:s.value.due_datetime,"onUpdate:dueDatetime":a[1]||(a[1]=o=>s.value.due_datetime=o)},{default:y(({handler:o,setRef:_})=>[e("li",null,[e("a",{ref:_,class:W(v.value),onClick:g(o,["prevent"])},[a[4]||(a[4]=e("i",{class:"fas fa-calendar-alt"},null,-1)),$(" "+d(s.value.due_datetime?w(j)(s.value.due_datetime).format("LLL"):s.value.due_date?w(j)(s.value.due_date).format("LL"):m.$t("When")),1)],10,Ee)])]),_:1},8,["dueDate","dueDatetime"]),I(Te,{modelValue:s.value.location_id,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.location_id=o)},{default:y(({handler:o,setRef:_})=>{var Y;return[e("li",null,[e("a",{ref:_,onClick:g(o,["prevent"])},[a[5]||(a[5]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),$(" "+d(s.value.location_id?(Y=w(r).getItemById(s.value.location_id))==null?void 0:Y.name:m.$t("Where")),1)],8,Be)])]}),_:1},8,["modelValue"]),I(_e,{modelValue:s.value.priority,"onUpdate:modelValue":a[3]||(a[3]=o=>s.value.priority=o)},{default:y(({handler:o,setRef:_})=>{var Y,H;return[e("li",null,[e("a",{ref:_,onClick:g(o,["prevent"])},[(f(),k("span",{key:s.value.priority},[e("i",{style:N(`color: ${s.value.priority&&((Y=w(Z).get(s.value.priority))==null?void 0:Y.color)}`),class:"fas fa-exclamation-circle"},null,4)])),$(" "+d(s.value.priority?(H=w(Z).get(s.value.priority))==null?void 0:H.name:m.$t("Priority")),1)],8,xe)])]}),_:1},8,["modelValue"]),!m.hideAssign&&(w(O).user_rights.canassign||w(O).user_rights.backend==="FULL")?(f(),k("li",Ue,[I(B,null,{default:y(({handler:o,setRef:_})=>[e("a",{ref:_,onClick:g(o,["prevent"])},[c.value?(f(),k(P,{key:0},[e("span",Re,[e("img",{src:c.value.photo_url,class:"userpic"},null,8,Fe)]),$(" "+d(c.value.name),1)],64)):(f(),k(P,{key:1},[a[6]||(a[6]=e("i",{class:"fas fa-arrow-right"},null,-1)),$(" "+d(m.$t("Assign")),1)],64))],8,Ze)]),body:y(({handler:o})=>[e("ul",Ne,[e("li",null,[e("a",{onClick:g(()=>{p(null),o()},["prevent"])},d(m.$t("No assignment")),9,ze)]),(f(!0),k(P,null,F(w(l).items,_=>(f(),k("li",{key:_.id,class:"item"},[e("a",{onClick:g(()=>{p(_.id),o()},["prevent"])},[e("span",We,[e("img",{src:_.photo_url,class:"userpic"},null,8,je)]),e("span",null,d(_.name),1)],8,He)]))),128))])]),_:1})])):G("",!0),I(ke,{task:t.task},{default:y(({open:o})=>[e("li",null,[e("a",{onClick:g(()=>{o()},["prevent"])},[a[7]||(a[7]=e("i",{class:"fas fa-paperclip"},null,-1)),$(" "+d(m.$t("Attach")),1)],8,Oe)])]),_:1},8,["task"])],2))}});export{qe as _,Je as a,Ke as b,Ye as c,U as d,Se as e,Ae as p};
