import{ab as ne,d as P,ac as j,o as v,x as N,l as I,E as O,b as t,e as y,S as B,ad as Z,_ as se,w as h,ae as oe,a6 as ae,c as b,I as V,t as M,f as le,a0 as ie,N as re,a9 as ue,aa as de,y as me,X as W,af as z,ag as fe,r as H,k as K,ah as U,J as ce,F as ee,B as q,n as S,h as E,ai as pe,i as te,aj as ve,ak as ke,G as we,j as A,al as G,A as ge,s as ye,am as _e,an as be}from"./index-8JwXqn5-.js";import{m as F,g as R,s as J}from"./rangy-5rxgwlWZ.js";import{_ as Le}from"./SortableList.vue_vue_type_style_index_0_lang-t9Ls2xKY.js";function Te(k){let o=[];ne(k,()=>{k.value&&(o=[...k.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=n=>o.findIndex(m=>m.isEqualNode(n)),l=n=>o[e(n)-1],s=n=>o[e(n)+1],a=(n,m)=>{if(n){const f=s(n);if(f instanceof HTMLElement)return f.focus(),m&&F(f),f}else{const f=o[0];f instanceof HTMLElement&&f.focus()}},d=(n,m)=>{if(n.target instanceof HTMLElement){const f=n.target,_=R(f),D=m==="up"?l(f):s(f);D instanceof HTMLElement&&(n.preventDefault(),D.focus(),J(D,_))}};return{getPreviousElementSibling:l,getNextElementSibling:s,getCurrentPositionInNavigationList:e,focusNextTask:a,focusTaskById:(n,m)=>{const f=o.find(_=>{var D;return _ instanceof HTMLElement&&((D=_.dataset)==null?void 0:D.id)==n});f instanceof HTMLElement&&(f.focus(),m&&F(f))},onUp:n=>{d(n,"up")},onDown:n=>{d(n,"down")},onLeft:(n,m)=>{if(n.target instanceof HTMLElement){const f=n.target;if(R(f)===0){const _=l(f);_ instanceof HTMLElement&&(n.preventDefault(),m&&(_.innerText+=m),_.focus(),F(_),m&&J(_,_.innerText.length-m.length))}}},onRight:n=>{if(n.target instanceof HTMLElement){const m=n.target;if(R(m)===m.innerText.length){const f=s(m);f instanceof HTMLElement&&(n.preventDefault(),f.focus())}}}}}const Ce={class:"menu"},xe=P({__name:"TaskListItemPopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(k){const o=j(k,"modelValue"),e=l=>{o.value=l};return(l,s)=>(v(),N(Z,null,{default:I(({handler:a,setRef:d})=>[O(l.$slots,"default",{handler:a,setRef:d},void 0,!0)]),body:I(()=>[t("ul",Ce,[t("li",null,[t("a",{onClick:s[0]||(s[0]=a=>e(y(B)().startOf("day").format()))}," Today ")]),t("li",null,[t("a",{onClick:s[1]||(s[1]=a=>e(y(B)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),t("li",null,[t("a",{onClick:s[2]||(s[2]=a=>e(y(B)().add(2,"day").startOf("day").format()))}," In 2 days ")]),t("li",null,[t("a",{onClick:s[3]||(s[3]=a=>e(y(B)().endOf("week").startOf("day").format()))}," This weekend ")]),s[4]||(s[4]=t("li",null,null,-1))])]),_:3}))}}),Ie=se(xe,[["__scopeId","data-v-0e68afd4"]]),$e={class:"menu"},Me=P({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(k){const o=j(k,"modelValue");return(e,l)=>(v(),N(Z,null,{default:I(({handler:s,setRef:a})=>[O(e.$slots,"default",{handler:s,setRef:a})]),body:I(()=>[t("ul",$e,[t("li",null,[t("a",{onClick:l[0]||(l[0]=h(s=>o.value=0,["prevent"]))},l[3]||(l[3]=[t("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),t("span",null,"Without priority",-1)]))]),t("li",null,[t("a",{onClick:l[1]||(l[1]=h(s=>o.value=1,["prevent"]))},l[4]||(l[4]=[t("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),t("span",null,"Normal",-1)]))]),t("li",null,[t("a",{onClick:l[2]||(l[2]=h(s=>o.value=2,["prevent"]))},l[5]||(l[5]=[t("i",{class:"fas fa-star",style:{color:"red"}},null,-1),t("span",null,"Hight",-1)]))])])]),_:3}))}}),Ve=["onClick"],De={key:1},he={key:2},Ee=["onClick"],Pe={key:4},Ne=["onClick"],Se=P({__name:"TaskListItemPopupMenu",props:oe({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const o=k,e=j(k,"modelValue"),l=ae(null);{const s=ue(()=>de(()=>import("./TaskListItemPopupMenuWhere-UrkpTAGo.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));l.value=s}return(s,a)=>(v(),b("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:a[3]||(a[3]=h(()=>{},["prevent"]))},[o.isFocused?(v(),N(Ie,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":a[0]||(a[0]=d=>e.value.due_date=d)},{default:I(({handler:d,setRef:w})=>[t("a",{ref:w,onClick:h(d,["prevent"])},a[4]||(a[4]=[t("i",{class:"fas fa-calendar-alt"},null,-1)]),8,Ve)]),_:1},8,["modelValue"])):V("",!0),e.value.due_datetime?(v(),b("div",De,M(y(le)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(v(),b("div",he,M(y(B)(e.value.due_date).format("LL")),1)):V("",!0),o.isFocused||e.value.priority?(v(),N(Me,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":a[1]||(a[1]=d=>e.value.priority=d)},{default:I(({handler:d,setRef:w})=>[t("a",{ref:w,style:ie(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:h(d,["prevent"])},a[5]||(a[5]=[t("i",{class:"fas fa-star"},null,-1)]),12,Ee)]),_:1},8,["modelValue"])):V("",!0),e.value.location_id?(v(),b("div",Pe," Location: "+M(e.value.location_id),1)):V("",!0),o.isFocused&&l.value?(v(),N(re(l.value),{key:5,modelValue:e.value.location_id,"onUpdate:modelValue":a[2]||(a[2]=d=>e.value.location_id=d)},{default:I(({handler:d,setRef:w})=>[t("a",{ref:w,onClick:h(d,["prevent"])},a[6]||(a[6]=[t("i",{class:"fas fa-map-pin"},null,-1)]),8,Ne)]),_:1},8,["modelValue"])):V("",!0)],32))}}),Be=P({__name:"TaskListItemInfoLink",props:{task:{}},setup(k){const o=k,e=me(),l=s=>{var d,w;const a=(w=(d=e.currentRoute.value.matched.find($=>{var i;return(i=$.meta)==null?void 0:i.isListView}))==null?void 0:d.children.find($=>{var i;return(i=$.meta)==null?void 0:i.isTaskInfoView}))==null?void 0:w.name;a?e.push({name:a,params:{taskId:s}}):console.error("Cant find `taskInfo` route")};return(s,a)=>(v(),b("a",{onClick:a[0]||(a[0]=h(d=>l(o.task.id),["prevent"]))},a[1]||(a[1]=[t("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),Re={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},He={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},Ue={class:"tw-flex-auto"},Fe={class:"hint"},Oe={class:"hint"},qe={class:"hint"},We=["contenteditable","placeholder","data-id","textContent"],Ke={key:1},X=P({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","insertMany","blur","complete"],setup(k,{emit:o}){const e=k,l=o,s=W(z),a=W(fe),d=H(!1);let w=!1;const $=["name","due_date","due_datetime","priority","location_id"];let i={};const r=H({});let g;K([()=>e.task,()=>e.addableProps],async([c])=>{g&&g(),i=U.pick(c,$),r.value={...i},g=K(r,async()=>{const u=U.reduce(r.value,(C,L,p)=>U.isEqual(L,i[p])?C:[...C,p],[]);u.length&&l("update",e.task,U.pick(r.value,u))},{deep:!0})},{immediate:!0});const n=async c=>{w||(c.target instanceof HTMLElement&&(c.target.innerText=c.target.innerText.trim(),r.value.name=c.target.innerText),l("blur",e.task,r.value))},m=c=>{var p;c.preventDefault();const{innerText:u}=c.target,C=(p=c.clipboardData)==null?void 0:p.getData("text/plain"),L=C==null?void 0:C.split(`
`);if(L!=null&&L.length){document.execCommand("insertText",!1,L[0]);const T=L.slice(1);T.length&&!u&&l("insertMany",e.task,T.map(x=>({name:x,...e.addableProps})))}},f=c=>{c.target instanceof HTMLElement&&R(c.target)===0&&(w=!0,s==null||s.onLeft(c,c.target.innerText.trim()),l("delete",e.task,r.value))},_=async c=>{if(c.preventDefault(),c.target instanceof HTMLElement){const u=c.target,C=u.innerText.trim(),L=R(u),p={};L!==0&&(p.currentName=C.substring(0,L).trim(),p.newName=C.substring(L,C.length).trim(),u.innerText=p.currentName,F(u)),l("insert",e.task,{...r.value,...e.addableProps},p)}},D=()=>{l("complete",e.task,r.value)};return(c,u)=>{var C,L;return v(),b("div",Re,[e.sortable?(v(),b("div",He,u[7]||(u[7]=[t("i",{class:"fas fa-grip-vertical"},null,-1)]))):V("",!0),t("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:D},[t("div",{class:ce(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),t("div",Ue,[(C=y(a))!=null&&C.is_debug_mode?(v(),b(ee,{key:0},[t("span",Fe,"id: "+M(e.task.id),1),u[8]||(u[8]=q(" | ")),t("span",Oe,"prev_id: "+M(String(e.task.prev_item_id)),1),u[9]||(u[9]=q(" | ")),t("span",qe,"srank: "+M(String(e.task.sort))+" | "+M(String(e.task.rank)),1)],64)):V("",!0),t("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[S(_,["enter"]),u[0]||(u[0]=S((...p)=>{var T,x;return((T=y(s))==null?void 0:T.onLeft)&&((x=y(s))==null?void 0:x.onLeft(...p))},["left"])),u[1]||(u[1]=S((...p)=>{var T,x;return((T=y(s))==null?void 0:T.onUp)&&((x=y(s))==null?void 0:x.onUp(...p))},["up"])),u[2]||(u[2]=S((...p)=>{var T,x;return((T=y(s))==null?void 0:T.onRight)&&((x=y(s))==null?void 0:x.onRight(...p))},["right"])),u[3]||(u[3]=S((...p)=>{var T,x;return((T=y(s))==null?void 0:T.onDown)&&((x=y(s))==null?void 0:x.onDown(...p))},["down"])),S(f,["delete"])],onBlur:n,onFocus:u[4]||(u[4]=p=>d.value=!0),onFocusout:u[5]||(u[5]=p=>d.value=!1),onPaste:m,textContent:M(e.task.name)},null,40,We),E(Se,{modelValue:r.value,"onUpdate:modelValue":u[6]||(u[6]=p=>r.value=p),"is-focused":d.value},null,8,["modelValue","is-focused"])]),(L=e.task.extended_data)!=null&&L.comments_count?(v(),b("div",Ke,[u[10]||(u[10]=t("i",{class:"far fa-comment"},null,-1)),q(" "+M(e.task.extended_data.comments_count),1)])):V("",!0),e.showInfoLink?(v(),N(Be,{key:2,class:"tw-hidden group-hover:tw-block",task:c.task},null,8,["task"])):V("",!0)])}}}),Q=P({__name:"ListNavigationProvider",setup(k){const o=H();return pe(z,Te(o)),(e,l)=>(v(),b("div",{ref_key:"navigatableRef",ref:o},[O(e.$slots,"default")],512))}}),Y=P({__name:"TaskListItemStoreProvider",setup(k){const o=W(z),e=te(),l=i=>e.completeTask(i),s=(i,r)=>e.updateItem(i,r),a=async(i,r,g)=>{if(!g.currentName)await e.insert("before",i,{...r,name:g.newName});else{const n=await e.insert("after",i,{...r,name:g.newName});n&&(o==null||o.focusTaskById(n.id))}},d=async(i,r)=>{let g;for(let n=0;n<r.length;n++)g=await e.insert("after",g??i,r[n]),n===r.length-1?g&&(o==null||o.focusTaskById(g.id,!0)):g&&$(g)},w=i=>e.deleteItem(i),$=i=>{ve(i)&&(i.name?e.updateItem(i,{client_touch_datetime:ke()}):e.deleteItem(i))};return(i,r)=>O(i.$slots,"default",{onComplete:l,onUpdate:s,onInsert:a,onInsertMany:d,onDelete:w,onBlur:$})}}),je={key:0,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6 align-center"},ze={key:0,class:"lg:tw-hidden tw-mb-4"},Ae={class:"tw-m-0"},Ge={class:"tw-my-6"},Je={key:1,class:"tw-flex tw-flex-col"},Ze=P({__name:"TaskList",props:{items:{},addableProps:{},sortableListId:{},isFetching:{type:Boolean}},setup(k){const o=k,e=we(),l=te(),s=H(),a=H(!1),d=A(()=>o.items.filter(i=>_e(i))),w=A(()=>o.items.filter(i=>be(i))),$=async()=>{const i=await l.insertDummy({...o.addableProps});if(i){const r=document.querySelector(`[contenteditable][data-id="${i.id}"]`);r instanceof HTMLElement&&r.focus()}};return K(G.currentRoute,i=>{const r={...i.query};"addNewTask"in r&&($(),delete r.addNewTask,G.replace({path:i.path,query:r}))},{immediate:!0}),(i,r)=>{const g=ge("RouterLink");return o.isFetching?(v(),b("div",je,r[1]||(r[1]=[t("div",{class:"spinner custom-p-16"},null,-1)]))):(v(),b("div",{key:1,ref_key:"navigatableRef",ref:s,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},[o.sortableListId?(v(),b("div",ze,[E(g,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:I(()=>{var n;return[r[2]||(r[2]=t("i",{class:"fas fa-chevron-left gray"},null,-1)),t("h3",Ae,M((n=y(e).getItemById(o.sortableListId))==null?void 0:n.name),1)]}),_:1})])):V("",!0),t("div",{class:"tw-mb-4",onClick:$}," + New To-Do "),E(Q,null,{default:I(()=>[E(Le,{"sortable-list-id":o.sortableListId,"sortable-group-name":"tasks",items:d.value,onSort:y(l).sort},{default:I(({item:n})=>[E(Y,null,{default:I(({onUpdate:m,onComplete:f,onInsert:_,onInsertMany:D,onDelete:c,onBlur:u})=>[E(X,{task:n,sortable:!!o.sortableListId,editable:!0,"addable-props":o.addableProps,"show-info-link":!0,onUpdate:m,onComplete:f,onInsert:_,onInsertMany:D,onDelete:c,onBlur:u},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onInsertMany","onDelete","onBlur"])]),_:2},1024)]),_:1},8,["sortable-list-id","items","onSort"])]),_:1}),t("div",Ge,[t("a",{class:"gray",onClick:r[0]||(r[0]=h(n=>a.value=!a.value,["prevent"]))},"Completed ("+M(w.value.length)+")",1)]),a.value?(v(),b("div",Je,[E(Q,null,{default:I(()=>[E(Y,null,{default:I(({onComplete:n})=>[(v(!0),b(ee,null,ye(w.value,m=>(v(),N(X,{key:m.uuid||m.id,task:m,onComplete:n},null,8,["task","onComplete"]))),128))]),_:1})]),_:1})])):V("",!0)],512))}}});export{Ze as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./TaskListItemPopupMenuWhere-UrkpTAGo.js","./index-8JwXqn5-.js","./index-yni2lSK1.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-HIWPCSlv.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
