import{_ as Fe,t as fe,a as Ee,b as Be}from"./textToHtmlWithLinks-_-tJUGLF.js";import{r as L,ad as Ne,m as j,ae as B,d as S,a5 as Ue,c as P,af as Ae,o,e as u,n as H,t as w,j as v,k as Re,L as O,g as _,f as m,K as z,z as de,E as ge,y as te,ag as Q,ah as ce,a6 as we,ai as ne,aj as Oe,ak as He,al as be,am as ze,an as We,ao as je,ap as Ke,aq as qe,ar as Ve,as as Qe,A as V,F as N,x as J,i as X,u as Ye,C as Te,a2 as Je,h as C,q as D,at as Xe,R as Ge,U as Ie,Q as Ze,au as et,av as pe,aw as oe,p as tt,M as xe,s as st,w as W,ax as at,ay as $e,az as nt,l as ot,aA as lt,S as q,aB as it,aC as rt,aD as ut,G as ct,a8 as me,aE as ke}from"./index-P6aFWfe6.js";import{m as le,g as ee,a as dt,s as he}from"./sanitizer-qTkizPqY.js";import{_ as ft}from"./SortableList.vue_vue_type_style_index_0_lang-NOAPJ4wO.js";function pt(s){const t=L([]),e=new Set;Ne(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),j(t,()=>{for(const[f]of e.entries())typeof f=="function"&&f(),e.delete(f)});const a=f=>{e.add(f)},i=f=>t.value.findIndex(g=>g.isEqualNode(f)),p=f=>t.value[i(f)-1],n=f=>t.value[i(f)+1],l=(f,g)=>{if(f){const c=n(f);if(c instanceof HTMLElement)return c.focus(),g&&le(c),c}else{const c=t.value[0];c instanceof HTMLElement&&c.focus()}},r=(f,g,c)=>{if(f.target instanceof HTMLElement){const h=f.target,$=ee(h),F=g==="up"?p(h):n(h);F instanceof HTMLElement&&(f.preventDefault(),F.focus(),dt(F,$),typeof c=="function"&&c())}};return{getPreviousElementSibling:p,getNextElementSibling:n,getCurrentPositionInNavigationList:i,focusNextTask:l,focusTaskById:(f,g)=>{const c=t.value.find(h=>{var $;return h instanceof HTMLElement&&(($=h.dataset)==null?void 0:$.id)==f});c instanceof HTMLElement&&(c.focus(),g&&le(c))},onUp:(f,g)=>{r(f,"up",g)},onDown:(f,g)=>{r(f,"down",g)},onLeft:(f,g)=>{if(f.target instanceof HTMLElement){const c=f.target;if(ee(c)===0){const h=p(c);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),le(h),typeof g=="function"&&g())}}},onRight:(f,g)=>{if(f.target instanceof HTMLElement){const c=f.target;if(ee(c)===c.innerText.length){const h=n(c);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),typeof g=="function"&&g())}}},nextUpdate:a}}const mt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},kt={class:"flexbox space-12 smaller empty:tw-hidden"},ht={key:2},vt=S({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Ue(),e=P(()=>Ae(s.task)),a=P(()=>({"text-red":e.value===3,"text-yellow":e.value===2,"text-green":e.value===1,grey:e.value===0}));return(i,p)=>{var n;return o(),u("div",kt,[i.task.due_datetime&&!i.task.status?(o(),u("div",{key:0,class:H(["semibold",a.value])},w(v(Re)(i.task.due_datetime).format("LLL")),3)):i.task.due_date&&!i.task.status?(o(),u("div",{key:1,class:H(["semibold",a.value])},w(v(O)(i.task.due_date).format("LL")),3)):_("",!0),i.task.location_id?(o(),u("div",ht,[p[0]||(p[0]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),z(" "+w((n=v(t).getItemById(i.task.location_id))==null?void 0:n.name)+" "+w(v(mt)(v(t).distanceById(i.task.location_id))),1)])):_("",!0)])}}}),_t={class:"icon"},yt=["src"],gt=S({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=de(),e=ge(),a=P(()=>!t.currentRoute.value.params.listId),i=P(()=>s.task.list_id&&a.value?e.itemsMap[s.task.list_id]:null),p=()=>{if(!i.value)return;const n=t.resolve({name:"list",params:{listId:i.value.id}});window.open(n.href,"_blank")};return(n,l)=>(o(),u("div",{class:H(["flexbox middle",{"space-12":!n.isFocused}])},[n.isFocused?(o(),te(Fe,{key:0,task:n.task,input:n.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(o(),te(vt,{key:1,task:n.task},null,8,["task"])),i.value?(o(),u("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:p},[m("div",_t,[m("img",{src:i.value.icon_url,loading:"lazy"},null,8,yt)]),z(" "+w(i.value.name),1)])):_("",!0)],2))}}),Se=We?window:void 0;function Z(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Y(...s){const t=[],e=()=>{t.forEach(l=>l()),t.length=0},a=(l,r,d,b)=>(l.addEventListener(r,d,b),()=>l.removeEventListener(r,d,b)),i=P(()=>{const l=ne(B(s[0])).filter(r=>r!=null);return l.every(r=>typeof r!="string")?l:void 0}),p=Oe(()=>{var l,r;return[(r=(l=i.value)==null?void 0:l.map(d=>Z(d)))!=null?r:[Se].filter(d=>d!=null),ne(B(i.value?s[1]:s[0])),ne(v(i.value?s[2]:s[1])),B(i.value?s[3]:s[2])]},([l,r,d,b])=>{if(e(),!(l!=null&&l.length)||!(r!=null&&r.length)||!(d!=null&&d.length))return;const x=He(b)?{...b}:b;t.push(...l.flatMap(I=>r.flatMap(T=>d.map(f=>a(I,T,f,x)))))},{flush:"post"}),n=()=>{p(),e()};return be(e),n}let ve=!1;function _e(s,t,e={}){const{window:a=Se,ignore:i=[],capture:p=!0,detectIframe:n=!1,controls:l=!1}=e;if(!a)return l?{stop:Q,cancel:Q,trigger:Q}:Q;if(ce&&!ve){ve=!0;const c={passive:!0};Array.from(a.document.body.children).forEach(h=>Y(h,"click",Q,c)),Y(a.document.documentElement,"click",Q,c)}let r=!0;const d=c=>B(i).some(h=>{if(typeof h=="string")return Array.from(a.document.querySelectorAll(h)).some($=>$===c.target||c.composedPath().includes($));{const $=Z(h);return $&&(c.target===$||c.composedPath().includes($))}});function b(c){const h=B(c);return h&&h.$.subTree.shapeFlag===16}function x(c,h){const $=B(c),F=$.$.subTree&&$.$.subTree.children;return F==null||!Array.isArray(F)?!1:F.some(K=>K.el===h.target||h.composedPath().includes(K.el))}const I=c=>{const h=Z(s);if(c.target!=null&&!(!(h instanceof Element)&&b(s)&&x(s,c))&&!(!h||h===c.target||c.composedPath().includes(h))){if("detail"in c&&c.detail===0&&(r=!d(c)),!r){r=!0;return}t(c)}};let T=!1;const f=[Y(a,"click",c=>{T||(T=!0,setTimeout(()=>{T=!1},0),I(c))},{passive:!0,capture:p}),Y(a,"pointerdown",c=>{const h=Z(s);r=!d(c)&&!!(h&&!c.composedPath().includes(h))},{passive:!0}),n&&Y(a,"blur",c=>{setTimeout(()=>{var h;const $=Z(s);((h=a.document.activeElement)==null?void 0:h.tagName)==="IFRAME"&&!($!=null&&$.contains(a.document.activeElement))&&t(c)},0)},{passive:!0})].filter(Boolean),g=()=>f.forEach(c=>c());return l?{stop:g,cancel:()=>{r=!1},trigger:c=>{r=!0,I(c),r=!1}}:g}const wt={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=_e(s,t.value,{capture:e});else{const[a,i]=t.value;s.__onClickOutside_stop=_e(s,a,Object.assign({capture:e},i))}},unmounted(s){s.__onClickOutside_stop()}};function ie(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Ce(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Ce(e)}}function bt(s){const t=s||window.event,e=t.target;return Ce(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const re=new WeakMap;function Tt(s,t=!1){const e=we(t);let a=null,i="";j(ze(s),l=>{const r=ie(B(l));if(r){const d=r;if(re.get(d)||re.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(i=d.style.overflow),d.style.overflow==="hidden")return e.value=!0;if(e.value)return d.style.overflow="hidden"}},{immediate:!0});const p=()=>{const l=ie(B(s));!l||e.value||(ce&&(a=Y(l,"touchmove",r=>{bt(r)},{passive:!1})),l.style.overflow="hidden",e.value=!0)},n=()=>{const l=ie(B(s));!l||!e.value||(ce&&(a==null||a()),l.style.overflow=i,re.delete(l),e.value=!1)};return be(n),P({get(){return e.value},set(l){l?p():n()}})}function It(){let s=!1;const t=we(!1);return(e,a)=>{if(t.value=a.value,s)return;s=!0;const i=Tt(e,a.value);j(t,p=>i.value=p)}}It();const xt=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},$t=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},St=je("syncError",()=>{const s=Ke(qe(Ve(()=>Qe.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Ct(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Lt={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Mt=["href"],Dt=["src"],Pt={class:"bold"},Ft={key:0,class:"hint custom-ml-4 nowrap"},Et=["onClick"],Bt=S({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=V(),e=a=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[a])};return(a,i)=>{var p;return(p=a.task.attachments)!=null&&p.length?(o(),u("div",Lt,[(o(!0),u(N,null,J(a.task.attachments,n=>(o(),u("div",{key:n.uuid||n.id,class:"pl-attachments__item small"},[m("a",{href:n.download_url,target:"_blank"},[n.preview_url?(o(),u("img",{key:0,src:n.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Dt)):(o(),u(N,{key:1},[m("span",Pt,w(n.file_name),1),n.size?(o(),u("span",Ft,w(v(Ct)(n.size)),1)):_("",!0)],64))],8,Mt),a.isFocused?(o(),u("div",{key:0,class:H(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":n.preview_url}])},[m("a",{class:H(n.preview_url?"button circle white":"custom-ml-8"),onClick:X(l=>e(n.id),["prevent"])},i[0]||(i[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,Et)],2)):_("",!0)]))),128))])):_("",!0)}}}),ue=S({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Ye(),a=P(()=>e.getItemById(t.userId));return(i,p)=>{var n;return(n=a.value)!=null&&n.photo_url?(o(),u("span",{key:0,class:"icon userpic",style:Te({backgroundImage:`url(${a.value.photo_url})`})},null,4)):_("",!0)}}}),Nt={key:0,class:"tw-cursor-pointer"},Ut={key:0,class:"pl-list-item-firedBullet"},At={key:1,class:"tw-cursor-pointer"},Rt=S({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,a=t,i=L(e.task.status===1);j(()=>e.task.status,l=>{i.value=l===1});const p=P(()=>Je(e.task)),n=()=>{i.value=!i.value,a("complete")};return(l,r)=>(o(),u("div",{class:"tw-w-5 tw-flex-none",onClick:n},[C(Ie,{name:"bounce",mode:"out-in"},{default:D(()=>{var d;return[i.value?(o(),u("div",At,r[0]||(r[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(o(),u("div",Nt,[p.value===v(Xe)?(o(),u("div",Ut)):(o(),u("div",{key:1,class:"pl-list-item-bullet",style:Te(`background-color: ${(d=v(Ge).get(p.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),Ot=new WeakMap;function Ht(){const s=Ze(),t=de(),e=()=>{var r;const p=[...s.matched].reverse().find(d=>{var b;return(b=d.meta)==null?void 0:b.isListView})||null,n=((r=p==null?void 0:p.children)==null?void 0:r.find(d=>{var b;return(b=d.meta)==null?void 0:b.isTaskInfoView}))||null,l={listViewRoute:p,taskInfoRoute:n};return Ot.set(s,l),l};return{navigateToTaskInfo:async i=>{const{listViewRoute:p,taskInfoRoute:n}=e();if(!p||!(n!=null&&n.name))return console.warn("Required routes not found"),!1;try{const l=await t.push({name:n.name,params:{taskId:i}});return!et(l)}catch(l){return console.error("Navigation failed:",l),!1}}}}const zt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Wt={class:"hint"},jt={class:"hint"},Kt={class:"hint"},qt={class:"tw-clear-both tw-inline-block"},Vt=["placeholder","data-id","innerHTML"],Qt=["innerHTML"],Yt={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Jt={key:0},Xt={key:1},Gt={key:2,class:"tw-flex-none"},Zt=["title"],es=["title"],ts={class:"bold small"},ss={key:5,class:"hint tw-flex-none custom-mt-2"},as={key:6,class:"hint tw-flex-none custom-mt-2"},ns={key:0},os={key:1},ls={key:7,class:"hint tw-flex-none custom-mt-2"},is={key:8,class:"flexbox middle tw-flex-none"},rs={key:9,class:"flexbox middle tw-flex-none"},us={key:10,class:"flexbox middle tw-flex-none"},cs={key:11,class:"flexbox middle space-4 tw-flex-none"},ds=["href"],fs=["src"],ps=S({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,a=t,i=V(),p=St(),{navigateToTaskInfo:n}=Ht(),l=pe($e),r=pe(nt),d=L(!1),b=L(!1),x=L(e.task.name),I=L(e.task.status);j(()=>e.task.status,y=>{I.value=y});const T=L();let f=null;j(d,()=>{if(d.value)return;const y=T.value.innerText.trim();if(oe(e.task)&&!y){b.value=!0,a("delete",e.task);return}e.task.name!==y&&a("update",e.task,{name:y})}),tt(()=>{oe(e.task)&&(T.value.focus(),d.value=!0)}),xe(()=>{f&&(clearTimeout(f),f=null,g())});const g=()=>{a("complete",e.task)},c=()=>{I.value=I.value?0:1,T.value.classList.toggle("opacity-50"),!(f&&(clearTimeout(f),f=null,e.task.status===I.value))&&(f=setTimeout(g,1e3))},h=y=>{if(y.target instanceof HTMLAnchorElement){const k=y.target.href;y.preventDefault(),setTimeout(()=>{window.open(k,"_blank")})}},$=y=>{var R;y.preventDefault();const k=(R=y.clipboardData)==null?void 0:R.getData("text/plain");if(!k)return;if(T.value.innerText){document.execCommand("insertText",!1,k);return}const U=k.split(`
`).filter(A=>A);U.length&&a("insertMany",e.task,U.map(A=>({name:xt(A),...e.addableProps,...$t(A)?{status:1}:{}})))},F=y=>{ee(y.target)===0&&(l==null||l.onLeft(y),b.value=!0,a("delete",e.task))},K=async y=>{if(y.shiftKey)return;if(y.preventDefault(),e.isEnterDisabled){se(!0),await ot(),a("insertFirst",{...e.addableProps});return}const k=y.target,U=k.innerText.trim(),R=ee(k);let A="",G=!0;R===0&&U||(k.innerText=U.substring(0,R).trim(),A=U.substring(R,U.length).trim(),G=!1),a("insert",e.task,{...e.addableProps,name:A},{isBefore:G}),se()},Me=y=>{x.value=y.target.innerText},se=(y=!1)=>{const k=()=>{T.value.blur(),d.value=!1};if(y){k();return}setTimeout(()=>{k()})},De=()=>{a("update",e.task,{favorite:e.task.favorite?0:1})},ae=async y=>{y.target.closest("[contenteditable], .chips li, a")===null&&await n(e.task.id)};function Pe(y){return new URL(Object.assign({"../../assets/apps/shop.svg":Ee,"../../assets/apps/tasks.svg":Be})[`../../assets/apps/${y}.svg`],import.meta.url).href}return(y,k)=>{var U,R,A,G;return b.value?_("",!0):(o(),u("div",{key:0,class:H(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":y.$route.meta.isTaskInfoView&&((U=y.$route.params)==null?void 0:U.taskId)==e.task.id,highlighted:v(i).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(o(),u("div",zt,k[6]||(k[6]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):_("",!0),C(Rt,{task:e.task,onComplete:c},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:ae},[(R=v(r))!=null&&R.is_debug_mode?(o(),u(N,{key:0},[m("span",Wt,"list_id: "+w(String(e.task.list_id)),1),k[7]||(k[7]=z(" | ")),m("span",jt,"id: "+w(e.task.id),1),k[8]||(k[8]=z(" | ")),m("span",Kt,"srank: "+w(String(e.task.sort))+" | "+w(String(e.task.rank)),1)],64)):_("",!0),st((o(),u("div",null,[m("div",qt,[m("div",{ref_key:"contenteditableRef",ref:T,contenteditable:"",class:H(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(K,["enter"]),k[0]||(k[0]=W(M=>{var E;(E=v(l))==null||E.onLeft(M,()=>{d.value=!1})},["left"])),k[1]||(k[1]=W(M=>{var E;(E=v(l))==null||E.onUp(M,()=>{d.value=!1})},["up"])),k[2]||(k[2]=W(M=>{var E;(E=v(l))==null||E.onRight(M,()=>{d.value=!1})},["right"])),k[3]||(k[3]=W(M=>{var E;(E=v(l))==null||E.onDown(M,()=>{d.value=!1})},["down"])),W(F,["delete"]),W(se,["esc"]),k[4]||(k[4]=W(()=>{d.value=!1},["tab"]))],onMousedown:h,onFocus:k[5]||(k[5]=M=>d.value=!0),onPaste:$,onInput:Me,innerHTML:v(he)(d.value?e.task.name:v(fe)(e.task.name))},null,42,Vt)]),e.task.note?(o(),u("div",{key:0,class:"hint tw-break-all tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:v(he)(v(fe)(e.task.note))},null,8,Qt)):_("",!0),C(gt,{task:y.task,input:x.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[v(wt),()=>{d.value=!1}]]),C(Bt,{task:e.task,"is-focused":d.value},null,8,["task","is-focused"])]),m("div",Yt,[e.showInfoLink?(o(),u("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:X(ae,["prevent"])},k[9]||(k[9]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):_("",!0),I.value?_("",!0):(o(),u("div",{key:1,class:H(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:De},[e.task.favorite?(o(),u("span",Jt,k[10]||(k[10]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(o(),u("span",Xt,k[11]||(k[11]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),v(p).taskErrorMap.get(e.task.id)?(o(),u("div",Gt,[m("span",{class:"icon",style:{color:"orange"},title:v(p).taskErrorMap.get(e.task.id)},k[12]||(k[12]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,Zt)])):_("",!0),!v(at)(e.task)&&!v(oe)(e.task)?(o(),u("div",{key:3,class:"tw-flex-none",title:y.$t("syncing")},k[13]||(k[13]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,es)):_("",!0),(A=e.task.extended_data)!=null&&A.comments_count?(o(),u("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:X(ae,["prevent"])},[k[14]||(k[14]=m("i",{class:"fas fa-comment"},null,-1)),m("span",ts,w(e.task.extended_data.comments_count),1)])):_("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(o(),u("div",ss,w(v(O)().to(v(O)(e.task.create_datetime),!0)),1)):_("",!0),!I.value&&e.task.assigned_contact_id?(o(),u("div",as,[e.task.update_datetime?(o(),u("span",ns,w(v(O)().to(v(O)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(o(),u("span",os,w(v(O)().to(v(O)(e.task.create_datetime),!0)),1)):_("",!0)])):_("",!0),e.task.complete_datetime?(o(),u("div",ls,w(v(O)().to(v(O)(e.task.complete_datetime),!0)),1)):_("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.contact_id?(o(),u("div",is,[C(ue,{"user-id":e.task.contact_id},null,8,["user-id"])])):_("",!0),!I.value&&e.task.assigned_contact_id?(o(),u("div",rs,[C(ue,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):_("",!0),I.value&&e.task.complete_contact_id?(o(),u("div",us,[C(ue,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):_("",!0),(G=e.task.external_links)!=null&&G.length?(o(),u("div",cs,[(o(!0),u(N,null,J(e.task.external_links,M=>(o(),u("a",{key:M.id,href:M.entity_link,class:"icon size-20",target:"_blank"},[m("img",{src:Pe(M.app)},null,8,fs)],8,ds))),128))])):_("",!0)])],2))}}}),ms=S({__name:"ListNavigationProvider",setup(s){const t=L();return lt($e,pt(t)),(e,a)=>(o(),u("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[q(e.$slots,"default")],512))}}),ks=S({__name:"TaskListItemStoreProvider",setup(s){const t=V(),e=r=>t.completeTask(r),a=(r,d)=>t.updateItem(r,d),i=async(r,d,b)=>{await t.insert(b.isBefore?"before":"after",r,{...d})},p=async(r,d)=>{await t.insertMany(r,d)},n=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},l=async r=>{await t.deleteItem(r)};return(r,d)=>q(r.$slots,"default",{onComplete:e,onUpdate:a,onInsert:i,onInsertMany:p,onInsertFirst:n,onDelete:l})}}),hs=S({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,a=t,i=L(null),{stop:p}=it(i,([{isIntersecting:n}])=>{n&&!e.disabled&&a("intersecting")},{rootMargin:"200px"});return xe(()=>{p()}),(n,l)=>(o(),u("div",{ref_key:"elRef",ref:i},[q(n.$slots,"default")],512))}}),vs={key:0,class:"skeleton custom-m-24"},_s={key:0},ys={class:"box custom-py-24 small align-center gray"},gs={class:"skeleton custom-m-24"},ye=30,ws=S({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=V(),a=ut(),i=L(ye),p=L([]),n=L(!1),l=L(!1),r=P(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:p.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),d=P(()=>r.value.source.slice(0,i.value));j(()=>t,x,{deep:!0,immediate:!0});const b=()=>{i.value+=ye};async function x(){const{isFetchStream:T,fetchParams:f,disableCheckin:g}=r.value;if(!f||!I(f))return;if(n.value=!1,p.value=[],t.filter==="list"){const h=a.task.value.get(JSON.stringify({list_id:t.listId})),$=a.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),F=a.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),K=h||$;if(K)if(t.shouldFilterUncompleted){if(F)return}else delete f.status,f.starting_from=rt(new Date(K))}l.value="starting_from"in f?!f.starting_from:!1;const c=await e[T?"fetchStream":"fetch"]({...f},{disableCheckin:g});l.value=!1,c&&c.value&&c.value.status_code==="ok"&&t.filter==="search"&&(p.value=[...p.value,...c.value.data],n.value=!p.value.length)}function I(T){return!(!T||T.list_id&&typeof T.list_id!="number"||T.location_id&&typeof T.location_id!="number")}return(T,f)=>l.value?(o(),u("div",vs,[(o(),u(N,null,J(5,g=>m("span",{key:g,class:"skeleton-custom-box",style:{height:"40px"}})),64))])):(o(),u(N,{key:1},[q(T.$slots,"default",{tasks:d.value}),t.filter==="search"&&n.value?(o(),u("div",_s,[m("p",ys,[z(w(T.$t("searchNoMatches"))+" ",1),m("strong",null,w(t.searchQuery),1)])])):_("",!0),C(Ie,{name:"fade"},{default:D(()=>[d.value.length&&d.value.length<r.value.source.length?(o(),te(hs,{key:0,onIntersecting:b},{default:D(()=>[m("div",gs,[(o(),u(N,null,J(5,g=>m("span",{key:g,class:"skeleton-custom-box",style:{height:"40px"}})),64))])]),_:1})):_("",!0)]),_:1})],64))}}),bs=S({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=V(),a=de();j(a.currentRoute,async p=>{const n={...p.query};"addNewTask"in n&&(await i(),delete n.addNewTask,a.replace({path:p.path,query:n}))},{immediate:!0});async function i(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(p,n)=>(o(),u("div",{class:"text-gray pl-list-item-title",onClick:i},[n[0]||(n[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),z(" "+w(p.$t("newToDo")),1)]))}}),Ts={class:"dialog-header"},Is={class:"dialog-content empty:tw-hidden"},xs={class:"dialog-footer tw-flex tw-gap-2"},Le=S({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(t,e)=>(o(),u(N,null,[m("header",Ts,[m("h3",null,w(t.$props.title),1),t.hideCloseIcon?_("",!0):(o(),u("a",{key:0,class:"dialog-close",onClick:e[0]||(e[0]=X(a=>t.$emit("close"),["prevent"]))},e[2]||(e[2]=[m("i",{class:"fas fa-times"},null,-1)])))]),m("div",Is,[q(t.$slots,"default")]),m("footer",xs,[q(t.$slots,"submit"),t.hideCloseButton?_("",!0):(o(),u("button",{key:0,class:"button light-gray",onClick:e[1]||(e[1]=a=>t.$emit("close"))}," Close "))])],64))}}),$s=S({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(o(),te(Le,{title:t.title,"hide-close-icon":!0},{submit:D(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...a)=>t.onDelete&&t.onDelete(...a))}," Delete ")]),default:D(()=>[z(w(t.text)+" ",1)]),_:1},8,["title"]))}}),Ss={class:"tw-w-68"},Cs={class:"menu"},Ls={href:"javascript:void(0);"},Ms={class:"menu"},Ds=["onClick"],Ps=["disabled"],Fs=S({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=ct(),e=ge(),a=L(),i=()=>{a.value&&s.onMove(a.value)};return(p,n)=>(o(),te(Le,{title:p.title,"hide-close-icon":!0},{submit:D(()=>[m("button",{disabled:!a.value,onClick:X(i,["prevent"])}," Move ",8,Ps)]),default:D(()=>[m("div",Ss,[m("ul",Cs,[(o(!0),u(N,null,J(v(t).items,l=>(o(),u("li",{key:l.uuid||l.id},[m("a",Ls,w(l.name),1),m("ul",Ms,[(o(!0),u(N,null,J(v(e).getListsInPocket(l.id),r=>(o(),u("li",{key:r.uuid||r.id,class:H(a.value===r.id&&"selected rounded")},[m("a",{href:"#",onClick:X(()=>{a.value=a.value===r.id?void 0:r.id},["prevent"])},w(r.name),9,Ds)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Es={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Bs={class:"hint"},Ns={class:"hint"},Us=S({__name:"TaskListMultiselect",setup(s){const t=V(),e=L(new Set),{show:a,hide:i}=me($s,{title:"Delete",text:ke(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),i()}}),{show:p,hide:n}=me(Fs,{title:"Move Items",text:ke(()=>`Delete ${e.value.size} selected items?`),onMove:async x=>{await t.sort(x,null,[...e.value]),e.value.clear(),n()}}),l=x=>{e.value.add(x)},r=x=>{e.value.delete(x)},d=()=>{p()},b=()=>{a()};return(x,I)=>(o(),u(N,null,[e.value.size?(o(),u("div",Es,[m("button",{class:"button light-gray smaller",onClick:d},[I[0]||(I[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),z(" "+w(x.$t("Move"))+" ",1),m("span",Bs,w(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:b},[I[1]||(I[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),z(" "+w(x.$t("Delete"))+" ",1),m("span",Ns,w(e.value.size),1)])])):_("",!0),q(x.$slots,"default",{onSelect:l,onDeselect:r})],64))}}),As={class:"pl-bg-block custom-pb-4"},Rs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Os={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Hs={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},zs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Vs=S({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=V(),a=P(()=>["upnext","due","priority","nearby","user","date"].includes(t.filter));return(i,p)=>(o(),u("div",As,[t.header?(o(),u("div",Rs,[m("h1",null,w(t.header),1)])):_("",!0),C(ms,null,{default:D(()=>[C(ws,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:D(({tasks:n})=>[!n.length&&t.startMessage&&v(e).isPreFilled?(o(),u("div",Os,w(t.startMessage),1)):_("",!0),t.hideAddNewTask?_("",!0):(o(),u("div",Hs,[C(bs,{"addable-props":t.addableProps,"should-pin-new-task":a.value},null,8,["addable-props","should-pin-new-task"])])),i.shouldFilterUncompleted&&!i.hideUncompletedLabel&&n.length?(o(),u("div",zs,w(i.$t("completed")),1)):_("",!0),C(Us,null,{default:D(({onSelect:l,onDeselect:r})=>[C(ft,{items:n,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:v(e).sort,onSelect:l,onDeselect:r},{default:D(({item:d})=>[C(ks,null,{default:D(({onUpdate:b,onComplete:x,onInsert:I,onInsertMany:T,onInsertFirst:f,onDelete:g,onBlur:c})=>[C(ps,{task:d,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:b,onComplete:x,onInsert:I,onInsertMany:T,onInsertFirst:f,onDelete:g,onBlur:c},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Vs as _,Le as a};
