import{a7 as se,d as M,a8 as j,o as k,x as E,l as $,E as N,b as i,e as y,O as B,a9 as Z,_ as ne,w as S,aa as ae,a2 as oe,c as C,I as h,t as V,f as le,X as ie,V as re,a5 as ue,a6 as de,y as ce,R as K,ab as z,ac as fe,r as H,k as F,ad as q,J as me,F as ee,B as W,n as R,h as P,ae as pe,i as A,af as ve,ag as te,ah as ke,P as we,ai as ge,j as G,aj as J,ak as X,al as _e,G as ye,am as Q,A as be,an as Te,q as Ie}from"./index-GXjORegP.js";import{m as U,g as O,s as Y}from"./rangy-5rxgwlWZ.js";import{_ as Le}from"./SortableList.vue_vue_type_style_index_0_lang-CLEtFp8m.js";function xe(f){let t=[];se(f,()=>{f.value&&(t=[...f.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=r=>t.findIndex(p=>p.isEqualNode(r)),n=r=>t[e(r)-1],a=r=>t[e(r)+1],o=(r,p)=>{if(r){const c=a(r);if(c instanceof HTMLElement)return c.focus(),p&&U(c),c}else{const c=t[0];c instanceof HTMLElement&&c.focus()}},s=(r,p)=>{if(r.target instanceof HTMLElement){const c=r.target,b=O(c),D=p==="up"?n(c):a(c);D instanceof HTMLElement&&(r.preventDefault(),D.focus(),Y(D,b))}};return{getPreviousElementSibling:n,getNextElementSibling:a,getCurrentPositionInNavigationList:e,focusNextTask:o,focusTaskById:(r,p)=>{const c=t.find(b=>{var D;return b instanceof HTMLElement&&((D=b.dataset)==null?void 0:D.id)==r});c instanceof HTMLElement&&(c.focus(),p&&U(c))},onUp:r=>{s(r,"up")},onDown:r=>{s(r,"down")},onLeft:(r,p)=>{if(r.target instanceof HTMLElement){const c=r.target;if(O(c)===0){const b=n(c);b instanceof HTMLElement&&(r.preventDefault(),p&&(b.innerText+=p),b.focus(),U(b),p&&Y(b,b.innerText.length-p.length))}}},onRight:r=>{if(r.target instanceof HTMLElement){const p=r.target;if(O(p)===p.innerText.length){const c=a(p);c instanceof HTMLElement&&(r.preventDefault(),c.focus())}}}}}const Ce={class:"menu"},$e=M({__name:"TaskListItemPopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(f){const t=j(f,"modelValue"),e=n=>{t.value=n};return(n,a)=>(k(),E(Z,null,{default:$(({handler:o,setRef:s})=>[N(n.$slots,"default",{handler:o,setRef:s},void 0,!0)]),body:$(()=>[i("ul",Ce,[i("li",null,[i("a",{onClick:a[0]||(a[0]=o=>e(y(B)().startOf("day").format()))}," Today ")]),i("li",null,[i("a",{onClick:a[1]||(a[1]=o=>e(y(B)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),i("li",null,[i("a",{onClick:a[2]||(a[2]=o=>e(y(B)().add(2,"day").startOf("day").format()))}," In 2 days ")]),i("li",null,[i("a",{onClick:a[3]||(a[3]=o=>e(y(B)().endOf("week").startOf("day").format()))}," This weekend ")]),a[4]||(a[4]=i("li",null,null,-1))])]),_:3}))}}),he=ne($e,[["__scopeId","data-v-0e68afd4"]]),Me={class:"menu"},Ve=M({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(f){const t=j(f,"modelValue");return(e,n)=>(k(),E(Z,null,{default:$(({handler:a,setRef:o})=>[N(e.$slots,"default",{handler:a,setRef:o})]),body:$(()=>[i("ul",Me,[i("li",null,[i("a",{onClick:n[0]||(n[0]=S(a=>t.value=0,["prevent"]))},n[3]||(n[3]=[i("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),i("span",null,"Without priority",-1)]))]),i("li",null,[i("a",{onClick:n[1]||(n[1]=S(a=>t.value=1,["prevent"]))},n[4]||(n[4]=[i("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),i("span",null,"Normal",-1)]))]),i("li",null,[i("a",{onClick:n[2]||(n[2]=S(a=>t.value=2,["prevent"]))},n[5]||(n[5]=[i("i",{class:"fas fa-star",style:{color:"red"}},null,-1),i("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Se={key:1},Pe={key:2},Ee=["onClick"],Re=["onClick"],Ne=M({__name:"TaskListItemPopupMenu",props:ae({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const t=f,e=j(f,"modelValue"),n=oe(null);{const a=ue(()=>de(()=>import("./TaskListItemPopupMenuWhere-7hOtK9WR.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));n.value=a}return(a,o)=>(k(),C("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:o[3]||(o[3]=S(()=>{},["prevent"]))},[t.isFocused?(k(),E(he,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":o[0]||(o[0]=s=>e.value.due_date=s)},{default:$(({handler:s,setRef:w})=>[i("a",{ref:w,onClick:S(s,["prevent"])},o[4]||(o[4]=[i("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):h("",!0),e.value.due_datetime?(k(),C("div",Se,V(y(le)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(k(),C("div",Pe,V(y(B)(e.value.due_date).format("LL")),1)):h("",!0),t.isFocused||e.value.priority?(k(),E(Ve,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":o[1]||(o[1]=s=>e.value.priority=s)},{default:$(({handler:s,setRef:w})=>[i("a",{ref:w,style:ie(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:S(s,["prevent"])},o[5]||(o[5]=[i("i",{class:"fas fa-star"},null,-1)]),12,Ee)]),_:1},8,["modelValue"])):h("",!0),e.value.location_id&&n.value?(k(),E(re(n.value),{key:4,modelValue:e.value.location_id,"onUpdate:modelValue":o[2]||(o[2]=s=>e.value.location_id=s)},{default:$(({handler:s,setRef:w})=>[i("a",{ref:w,onClick:S(s,["prevent"])},o[6]||(o[6]=[i("i",{class:"fas fa-map-pin"},null,-1)]),8,Re)]),_:1},8,["modelValue"])):h("",!0)],32))}}),Be=M({__name:"TaskListItemInfoLink",props:{task:{}},setup(f){const t=f,e=ce(),n=a=>{var s,w;const o=(w=(s=e.currentRoute.value.matched.find(_=>{var l;return(l=_.meta)==null?void 0:l.isListView}))==null?void 0:s.children.find(_=>{var l;return(l=_.meta)==null?void 0:l.isTaskInfoView}))==null?void 0:w.name;o?e.push({name:o,params:{taskId:a}}):console.error("Cant find `taskInfo` route")};return(a,o)=>(k(),C("a",{onClick:o[0]||(o[0]=S(s=>n(t.task.id),["prevent"]))},o[1]||(o[1]=[i("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),Oe={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},He={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},qe={class:"tw-flex-auto"},Ue={class:"hint"},Fe={class:"hint"},We={class:"hint"},Ke=["contenteditable","placeholder","data-id","textContent"],je={key:1},ze=M({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","insertMany","blur","complete"],setup(f,{emit:t}){const e=f,n=t,a=K(z),o=K(fe),s=H(!1);let w=!1;const _=["name","due_date","due_datetime","priority","location_id"];let l={};const d=H({});let g;F([()=>e.task,()=>e.addableProps],async([v])=>{g&&g(),l=q.pick(v,_),d.value={...l},g=F(d,async()=>{const u=q.reduce(d.value,(L,T,m)=>q.isEqual(T,l[m])?L:[...L,m],[]);u.length&&n("update",e.task,q.pick(d.value,u))},{deep:!0})},{immediate:!0});const r=async v=>{w||(v.target instanceof HTMLElement&&(v.target.innerText=v.target.innerText.trim(),d.value.name=v.target.innerText),n("blur",e.task,d.value))},p=v=>{var m;v.preventDefault();const{innerText:u}=v.target,L=(m=v.clipboardData)==null?void 0:m.getData("text/plain"),T=L==null?void 0:L.split(`
`);if(T!=null&&T.length){document.execCommand("insertText",!1,T[0]);const I=T.slice(1);I.length&&!u&&n("insertMany",e.task,I.map(x=>({name:x,...e.addableProps})))}},c=v=>{v.target instanceof HTMLElement&&O(v.target)===0&&(w=!0,a==null||a.onLeft(v,v.target.innerText.trim()),n("delete",e.task,d.value))},b=async v=>{if(v.preventDefault(),v.target instanceof HTMLElement){const u=v.target,L=u.innerText.trim(),T=O(u),m={};T!==0&&(m.currentName=L.substring(0,T).trim(),m.newName=L.substring(T,L.length).trim(),u.innerText=m.currentName,U(u)),n("insert",e.task,{...d.value,...e.addableProps},m)}},D=()=>{n("complete",e.task,d.value)};return(v,u)=>{var L,T;return k(),C("div",Oe,[e.sortable?(k(),C("div",He,u[7]||(u[7]=[i("i",{class:"fas fa-grip-vertical"},null,-1)]))):h("",!0),i("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:D},[i("div",{class:me(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),i("div",qe,[(L=y(o))!=null&&L.is_debug_mode?(k(),C(ee,{key:0},[i("span",Ue,"id: "+V(e.task.id),1),u[8]||(u[8]=W(" | ")),i("span",Fe,"prev_id: "+V(String(e.task.prev_item_id)),1),u[9]||(u[9]=W(" | ")),i("span",We,"srank: "+V(String(e.task.sort))+" | "+V(String(e.task.rank)),1)],64)):h("",!0),i("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[R(b,["enter"]),u[0]||(u[0]=R((...m)=>{var I,x;return((I=y(a))==null?void 0:I.onLeft)&&((x=y(a))==null?void 0:x.onLeft(...m))},["left"])),u[1]||(u[1]=R((...m)=>{var I,x;return((I=y(a))==null?void 0:I.onUp)&&((x=y(a))==null?void 0:x.onUp(...m))},["up"])),u[2]||(u[2]=R((...m)=>{var I,x;return((I=y(a))==null?void 0:I.onRight)&&((x=y(a))==null?void 0:x.onRight(...m))},["right"])),u[3]||(u[3]=R((...m)=>{var I,x;return((I=y(a))==null?void 0:I.onDown)&&((x=y(a))==null?void 0:x.onDown(...m))},["down"])),R(c,["delete"])],onBlur:r,onFocus:u[4]||(u[4]=m=>s.value=!0),onFocusout:u[5]||(u[5]=m=>s.value=!1),onPaste:p,textContent:V(e.task.name)},null,40,Ke),P(Ne,{modelValue:d.value,"onUpdate:modelValue":u[6]||(u[6]=m=>d.value=m),"is-focused":s.value},null,8,["modelValue","is-focused"])]),(T=e.task.extended_data)!=null&&T.comments_count?(k(),C("div",je,[u[10]||(u[10]=i("i",{class:"far fa-comment"},null,-1)),W(" "+V(e.task.extended_data.comments_count),1)])):h("",!0),e.showInfoLink?(k(),E(Be,{key:2,class:"tw-hidden group-hover:tw-block",task:v.task},null,8,["task"])):h("",!0)])}}}),Ae=M({__name:"ListNavigationProvider",setup(f){const t=H();return pe(z,xe(t)),(e,n)=>(k(),C("div",{ref_key:"navigatableRef",ref:t},[N(e.$slots,"default")],512))}}),Ge=M({__name:"TaskListItemStoreProvider",setup(f){const t=K(z),e=A(),n=l=>e.completeTask(l),a=(l,d)=>e.updateItem(l,d),o=async(l,d,g)=>{if(!g.currentName)await e.insert("before",l,{...d,name:g.newName});else{const r=await e.insert("after",l,{...d,name:g.newName});r&&(t==null||t.focusTaskById(r.id))}},s=async(l,d)=>{let g;for(let r=0;r<d.length;r++)g=await e.insert("after",g??l,d[r]),r===d.length-1?g&&(t==null||t.focusTaskById(g.id,!0)):g&&_(g)},w=l=>e.deleteItem(l),_=l=>{ve(l)&&(l.name?e.updateItem(l,{client_touch_datetime:te()}):e.deleteItem(l))};return(l,d)=>N(l.$slots,"default",{onComplete:n,onUpdate:a,onInsert:o,onInsertMany:s,onDelete:w,onBlur:_})}}),Je=M({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(f,{emit:t}){const e=f,n=t,a=H(null),{stop:o}=ke(a,([{isIntersecting:s}])=>{s&&!e.disabled&&n("intersecting")},{rootMargin:"100px"});return we(()=>{o()}),(s,w)=>(k(),C("div",{ref_key:"elRef",ref:a,class:"tw-min-h-2"},[N(s.$slots,"default")],512))}}),Xe=M({__name:"TaskListLazyLoadFetcher",props:{listId:{},filter:{},locationId:{}},setup(f){const t=f,e=ge(),n=A(),a=H(!1),o=G(()=>{var l;return t.listId?n.getTasksInList(t.listId):t.filter?((l=n.getItemsByFilterName(t.filter))==null?void 0:l.value)||[]:t.locationId?n.getTasksInLocation(t.locationId)||[]:[]}),s=G(()=>{if(t.listId)return{list_id:t.listId,filter:void 0};if(t.filter)return{filter:t.filter,list_id:void 0};if(t.locationId)return{location_id:t.locationId,filter:void 0}}),w=async()=>{if(s.value){const l=await J(s.value);if(l){const d=l.timestamp;_e()>d&&(await n[t.filter?"fetchStreamAll":"fetchAll"]({...s.value,starting_from:te(new Date(d))}),X(s.value,Date.now()))}}};F(e,async()=>{e.value&&(await J(s.value)?await w():_())},{immediate:!0});const _=async()=>{if(s.value){const l=await n[t.filter?"fetchStream":"fetch"]({...s.value,offset:o.value.length});l&&l.status_code==="ok"&&X(s.value,Date.now())}};return(l,d)=>(k(),C(ee,null,[N(l.$slots,"default",{tasks:o.value}),a.value?(k(),E(Je,{key:0,onIntersecting:_})):h("",!0)],64))}}),Qe={class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},Ye={key:0,class:"lg:tw-hidden tw-mb-4"},Ze={class:"tw-m-0"},nt=M({__name:"TaskList",props:{listId:{},filter:{},locationId:{},addableProps:{}},setup(f){const t=f,e=ye(),n=A(),a=async()=>{const o=await n.insertDummy({...t.addableProps});o&&Te(()=>n.items,async()=>{await Ie();const s=document.querySelector(`[contenteditable][data-id="${o.id}"]`);s instanceof HTMLElement&&s.focus()})};return F(Q.currentRoute,o=>{const s={...o.query};"addNewTask"in s&&(a(),delete s.addNewTask,Q.replace({path:o.path,query:s}))},{immediate:!0}),(o,s)=>{const w=be("RouterLink");return k(),C("div",Qe,[t.listId?(k(),C("div",Ye,[P(w,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:$(()=>{var _;return[s[0]||(s[0]=i("i",{class:"fas fa-chevron-left gray"},null,-1)),i("h3",Ze,V((_=y(e).getItemById(t.listId))==null?void 0:_.name),1)]}),_:1})])):h("",!0),i("div",{class:"tw-mb-4",onClick:a}," + New To-Do "),P(Ae,null,{default:$(()=>[P(Xe,{"list-id":t.listId,filter:t.filter,"location-id":t.locationId},{default:$(({tasks:_})=>[P(Le,{"sortable-list-id":t.listId,"sortable-group-name":"tasks",items:_,onSort:y(n).sort},{default:$(({item:l})=>[P(Ge,null,{default:$(({onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:c,onBlur:b})=>[P(ze,{task:l,sortable:!!t.listId,editable:!0,"addable-props":t.addableProps,"show-info-link":!0,onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:c,onBlur:b},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onInsertMany","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["sortable-list-id","items","onSort"])]),_:1},8,["list-id","filter","location-id"])]),_:1})])}}});export{nt as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./TaskListItemPopupMenuWhere-7hOtK9WR.js","./index-GXjORegP.js","./index-KrfFgSv5.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-pVpUZ7-f.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
