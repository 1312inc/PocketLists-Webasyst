import{c as Fe,_ as Ee,t as he,a as Be,b as Ne,d as Ie}from"./textToHtmlWithLinks-COPD6Us1.js";import{r as S,ad as Ue,m as W,ae as E,d as C,a6 as Ae,c as P,af as Re,o as l,e as c,j as _,D as me,t as b,g as w,n as A,k as Oe,L as H,f as k,K as R,A as ke,G as ve,y as G,ag as V,ah as pe,a7 as xe,ai as le,aj as He,ak as ze,al as $e,am as qe,an as We,ao as je,ap as Ke,aq as Ve,ar as Qe,as as Je,B as j,F as z,x as Z,i as ee,u as Xe,a3 as Ye,h as M,q as U,at as Ge,R as Ze,U as et,Q as tt,au as st,av as _e,aw as ie,p as at,M as Se,s as nt,w as q,ax as ot,ay as Le,az as lt,aA as it,l as rt,aB as ut,S as te,aC as ct,aD as dt,aE as ft,H as pt,aF as ye,aG as ge}from"./index-LXa_umaz.js";import{m as re,g as Y,a as mt,s as we}from"./sanitizer-TiisBOmJ.js";import{_ as kt}from"./SortableList.vue_vue_type_style_index_0_lang-zDn9vdna.js";function vt(s){const t=S([]),e=new Set;Ue(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),W(t,()=>{for(const[p]of e.entries())typeof p=="function"&&p(),e.delete(p)});const n=p=>{e.add(p)},d=p=>t.value.findIndex(h=>h.isEqualNode(p)),i=p=>t.value[d(p)-1],a=p=>t.value[d(p)+1],o=(p,h)=>{if(p){const u=a(p);if(u instanceof HTMLElement)return u.focus(),h&&re(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},r=(p,h,u)=>{if(p.target instanceof HTMLElement){const v=p.target,I=Y(v),L=h==="up"?i(v):a(v);L instanceof HTMLElement&&(p.preventDefault(),L.focus(),mt(L,I),typeof u=="function"&&u())}};return{getPreviousElementSibling:i,getNextElementSibling:a,getCurrentPositionInNavigationList:d,focusNextTask:o,focusTaskById:(p,h)=>{const u=t.value.find(v=>{var I;return v instanceof HTMLElement&&((I=v.dataset)==null?void 0:I.id)==p});u instanceof HTMLElement&&(u.focus(),h&&re(u))},onUp:(p,h)=>{r(p,"up",h)},onDown:(p,h)=>{r(p,"down",h)},onLeft:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(Y(u)===0){const v=i(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),re(v),typeof h=="function"&&h())}}},onRight:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(Y(u)===u.innerText.length){const v=a(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),typeof h=="function"&&h())}}},nextUpdate:n}}const ht=s=>{const t=E(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},_t={class:"flexbox space-8 middle smaller empty:tw-hidden"},yt={key:4},gt=C({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Ae(),{currentLabel:e}=Fe(()=>s.task),n=P(()=>Re(s.task)),d=P(()=>({"text-red":n.value===3,"text-yellow":n.value===2,"text-green":n.value===1,grey:n.value===0}));return(i,a)=>{var o;return l(),c("div",_t,[_(e)?(l(),c("div",{key:0,class:"badge squared",style:me(`background: #${_(e).color};`)},b(_(e).name),5)):w("",!0),i.task.due_datetime&&!i.task.status?(l(),c("div",{key:1,class:A(["semibold",d.value])},b(_(Oe)(i.task.due_datetime).format("LLL")),3)):i.task.due_date&&!i.task.status?(l(),c("div",{key:2,class:A(["semibold",d.value])},b(_(H)(i.task.due_date).format("LL")),3)):w("",!0),i.task.due_date&&i.task.repeat_frequency&&i.task.repeat_interval?(l(),c("div",{key:3,class:A(d.value)},[a[0]||(a[0]=k("i",{class:"fas fa-redo text-light-gray"},null,-1)),R(" "+b(i.$t(`everyX.${i.task.repeat_interval}`,{n:i.task.repeat_frequency,days:i.$t(i.task.repeat_interval,{count:i.task.repeat_frequency})})),1)],2)):w("",!0),i.task.location_id?(l(),c("div",yt,[a[1]||(a[1]=k("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),R(" "+b((o=_(t).getItemById(i.task.location_id))==null?void 0:o.name)+" "+b(_(ht)(_(t).distanceById(i.task.location_id))),1)])):w("",!0)])}}}),wt={class:"icon"},bt=["src"],Tt=C({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=ke(),e=ve(),n=P(()=>!t.currentRoute.value.params.listId),d=P(()=>s.task.list_id&&n.value?e.itemsMap[s.task.list_id]:null),i=()=>{if(!d.value)return;const a=t.resolve({name:"list",params:{listId:d.value.id}});window.open(a.href,"_blank")};return(a,o)=>(l(),c("div",{class:A(["flexbox middle",{"space-12":!a.isFocused}])},[a.isFocused?(l(),G(Ee,{key:0,task:a.task,input:a.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(l(),G(gt,{key:1,task:a.task},null,8,["task"])),d.value?(l(),c("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:i},[k("div",wt,[k("img",{src:d.value.icon_url,loading:"lazy"},null,8,bt)]),R(" "+b(d.value.name),1)])):w("",!0)],2))}}),Ce=We?window:void 0;function X(s){var t;const e=E(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Q(...s){const t=[],e=()=>{t.forEach(o=>o()),t.length=0},n=(o,r,f,y)=>(o.addEventListener(r,f,y),()=>o.removeEventListener(r,f,y)),d=P(()=>{const o=le(E(s[0])).filter(r=>r!=null);return o.every(r=>typeof r!="string")?o:void 0}),i=He(()=>{var o,r;return[(r=(o=d.value)==null?void 0:o.map(f=>X(f)))!=null?r:[Ce].filter(f=>f!=null),le(E(d.value?s[1]:s[0])),le(_(d.value?s[2]:s[1])),E(d.value?s[3]:s[2])]},([o,r,f,y])=>{if(e(),!(o!=null&&o.length)||!(r!=null&&r.length)||!(f!=null&&f.length))return;const x=ze(y)?{...y}:y;t.push(...o.flatMap(T=>r.flatMap($=>f.map(p=>n(T,$,p,x)))))},{flush:"post"}),a=()=>{i(),e()};return $e(e),a}let be=!1;function Te(s,t,e={}){const{window:n=Ce,ignore:d=[],capture:i=!0,detectIframe:a=!1,controls:o=!1}=e;if(!n)return o?{stop:V,cancel:V,trigger:V}:V;if(pe&&!be){be=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(v=>Q(v,"click",V,u)),Q(n.document.documentElement,"click",V,u)}let r=!0;const f=u=>E(d).some(v=>{if(typeof v=="string")return Array.from(n.document.querySelectorAll(v)).some(I=>I===u.target||u.composedPath().includes(I));{const I=X(v);return I&&(u.target===I||u.composedPath().includes(I))}});function y(u){const v=E(u);return v&&v.$.subTree.shapeFlag===16}function x(u,v){const I=E(u),L=I.$.subTree&&I.$.subTree.children;return L==null||!Array.isArray(L)?!1:L.some(K=>K.el===v.target||v.composedPath().includes(K.el))}const T=u=>{const v=X(s);if(u.target!=null&&!(!(v instanceof Element)&&y(s)&&x(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(r=!f(u)),!r){r=!0;return}t(u)}};let $=!1;const p=[Q(n,"click",u=>{$||($=!0,setTimeout(()=>{$=!1},0),T(u))},{passive:!0,capture:i}),Q(n,"pointerdown",u=>{const v=X(s);r=!f(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),a&&Q(n,"blur",u=>{setTimeout(()=>{var v;const I=X(s);((v=n.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(I!=null&&I.contains(n.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),h=()=>p.forEach(u=>u());return o?{stop:h,cancel:()=>{r=!1},trigger:u=>{r=!0,T(u),r=!1}}:h}const It={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=Te(s,t.value,{capture:e});else{const[n,d]=t.value;s.__onClickOutside_stop=Te(s,n,Object.assign({capture:e},d))}},unmounted(s){s.__onClickOutside_stop()}};function ue(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Me(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Me(e)}}function xt(s){const t=s||window.event,e=t.target;return Me(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const ce=new WeakMap;function $t(s,t=!1){const e=xe(t);let n=null,d="";W(qe(s),o=>{const r=ue(E(o));if(r){const f=r;if(ce.get(f)||ce.set(f,f.style.overflow),f.style.overflow!=="hidden"&&(d=f.style.overflow),f.style.overflow==="hidden")return e.value=!0;if(e.value)return f.style.overflow="hidden"}},{immediate:!0});const i=()=>{const o=ue(E(s));!o||e.value||(pe&&(n=Q(o,"touchmove",r=>{xt(r)},{passive:!1})),o.style.overflow="hidden",e.value=!0)},a=()=>{const o=ue(E(s));!o||!e.value||(pe&&(n==null||n()),o.style.overflow=d,ce.delete(o),e.value=!1)};return $e(a),P({get(){return e.value},set(o){o?i():a()}})}function St(){let s=!1;const t=xe(!1);return(e,n)=>{if(t.value=n.value,s)return;s=!0;const d=$t(e,n.value);W(t,i=>d.value=i)}}St();const Lt=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},Ct=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Mt=je("syncError",()=>{const s=Ke(Ve(Qe(()=>Je.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Dt(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Pt={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Ft=["href"],Et=["src"],Bt={class:"bold"},Nt={key:0,class:"hint custom-ml-4 nowrap"},Ut=["onClick"],At=C({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=j(),e=n=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[n])};return(n,d)=>{var i;return(i=n.task.attachments)!=null&&i.length?(l(),c("div",Pt,[(l(!0),c(z,null,Z(n.task.attachments,a=>(l(),c("div",{key:a.uuid||a.id,class:"pl-attachments__item small"},[k("a",{href:a.download_url,target:"_blank"},[a.preview_url?(l(),c("img",{key:0,src:a.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Et)):(l(),c(z,{key:1},[k("span",Bt,b(a.file_name),1),a.size?(l(),c("span",Nt,b(_(Dt)(a.size)),1)):w("",!0)],64))],8,Ft),n.isFocused?(l(),c("div",{key:0,class:A(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":a.preview_url}])},[k("a",{class:A(a.preview_url?"button circle white":"custom-ml-8"),onClick:ee(o=>e(a.id),["prevent"])},d[0]||(d[0]=[k("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,Ut)],2)):w("",!0)]))),128))])):w("",!0)}}}),de=C({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Xe(),n=P(()=>e.getItemById(t.userId));return(d,i)=>{var a;return(a=n.value)!=null&&a.photo_url?(l(),c("span",{key:0,class:"icon userpic",style:me({backgroundImage:`url(${n.value.photo_url})`})},null,4)):w("",!0)}}}),Rt={key:0,class:"tw-cursor-pointer"},Ot={key:0,class:"pl-list-item-firedBullet"},Ht={key:1,class:"tw-cursor-pointer"},zt=C({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,n=t,d=S(e.task.status===1);W(()=>e.task.status,o=>{d.value=o===1});const i=P(()=>Ye(e.task)),a=()=>{d.value=!d.value,n("complete")};return(o,r)=>(l(),c("div",{class:"tw-w-5 tw-flex-none",onClick:a},[M(et,{name:"bounce",mode:"out-in"},{default:U(()=>{var f;return[d.value?(l(),c("div",Ht,r[0]||(r[0]=[k("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(l(),c("div",Rt,[i.value===_(Ge)?(l(),c("div",Ot)):(l(),c("div",{key:1,class:"pl-list-item-bullet",style:me(`background-color: ${(f=_(Ze).get(i.value))==null?void 0:f.color}`)},null,4))]))]}),_:1})]))}}),qt=new WeakMap;function Wt(){const s=tt(),t=ke(),e=()=>{var r;const i=[...s.matched].reverse().find(f=>{var y;return(y=f.meta)==null?void 0:y.isListView})||null,a=((r=i==null?void 0:i.children)==null?void 0:r.find(f=>{var y;return(y=f.meta)==null?void 0:y.isTaskInfoView}))||null,o={listViewRoute:i,taskInfoRoute:a};return qt.set(s,o),o};return{navigateToTaskInfo:async d=>{const{listViewRoute:i,taskInfoRoute:a}=e();if(!i||!(a!=null&&a.name))return console.warn("Required routes not found"),!1;try{const o=await t.push({name:a.name,params:{taskId:d}});return!st(o)}catch(o){return console.error("Navigation failed:",o),!1}}}}const jt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Kt={class:"hint"},Vt={class:"hint"},Qt={class:"hint"},Jt={class:"tw-clear-both tw-inline-block"},Xt=["placeholder","data-id","innerHTML"],Yt=["innerHTML"],Gt={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Zt={key:0},es={key:1},ts={key:2,class:"tw-flex-none"},ss=["title"],as=["title"],ns={class:"bold small"},os={key:5,class:"hint tw-flex-none custom-mt-2"},ls={key:6,class:"hint tw-flex-none custom-mt-2"},is={key:0},rs={key:1},us={key:7,class:"hint tw-flex-none custom-mt-2"},cs={key:8,class:"flexbox middle tw-flex-none"},ds={key:9,class:"flexbox middle tw-flex-none"},fs={key:10,class:"flexbox middle tw-flex-none"},ps={key:11,class:"flexbox middle space-4 tw-flex-none"},ms=["href"],ks=["src"],vs=C({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,n=t,d=j(),i=Mt(),{navigateToTaskInfo:a}=Wt(),o=_e(Le),r=_e(lt),f=S(!1),y=S(!1),x=S(e.task.name),T=S(e.task.status);W(()=>e.task.status,g=>{T.value=g});const $=S();let p=null;W(f,()=>{if(f.value)return;const g=$.value.innerText.trim();if(ie(e.task)&&!g){y.value=!0,n("delete",e.task);return}e.task.name!==g&&n("update",e.task,{name:g})}),at(()=>{ie(e.task)&&($.value.focus(),f.value=!0)}),Se(()=>{p&&(clearTimeout(p),p=null)});const h=()=>{it()||(f.value=!1)},u=()=>{n("complete",e.task)},v=()=>{T.value=T.value?0:1,$.value.classList.toggle("opacity-50"),!(p&&(clearTimeout(p),p=null,e.task.status===T.value))&&(p=setTimeout(u,1e3))},I=g=>{if(g.target instanceof HTMLAnchorElement){const m=g.target.href;g.preventDefault(),setTimeout(()=>{window.open(m,"_blank")})}},L=g=>{var O;g.preventDefault();const m=(O=g.clipboardData)==null?void 0:O.getData("text/plain");if(!m)return;if($.value.innerText){document.execCommand("insertText",!1,m);return}const B=m.split(`
`).filter(N=>N);B.length&&n("insertMany",e.task,B.map(N=>({name:Lt(N),...e.addableProps,...Ct(N)?{status:1}:{}})))},K=g=>{Y(g.target)===0&&(o==null||o.onLeft(g),y.value=!0,n("delete",e.task))},ae=async g=>{if(g.shiftKey)return;if(g.preventDefault(),e.isEnterDisabled){ne(!0),await rt(),n("insertFirst",{...e.addableProps});return}const m=g.target,B=m.innerText.trim(),O=Y(m);let N="",J=!0;O===0&&B||(m.innerText=B.substring(0,O).trim(),N=B.substring(O,B.length).trim(),J=!1),n("insert",e.task,{...e.addableProps,name:N},{isBefore:J}),ne()},se=g=>{x.value=g.target.innerText};function ne(g=!1){const m=()=>{$.value.blur(),f.value=!1};if(g){m();return}setTimeout(()=>{m()})}const De=()=>{n("update",e.task,{favorite:e.task.favorite?0:1})},oe=async g=>{g.target.closest("[contenteditable], .chips li, a")===null&&await a(e.task.id)};function Pe(g){return new URL(Object.assign({"../../assets/apps/shop.svg":Be,"../../assets/apps/tasks.svg":Ne})[`../../assets/apps/${g}.svg`],import.meta.url).href}return(g,m)=>{var B,O,N,J;return y.value?w("",!0):(l(),c("div",{key:0,class:A(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":g.$route.meta.isTaskInfoView&&((B=g.$route.params)==null?void 0:B.taskId)==e.task.id,highlighted:_(d).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(l(),c("div",jt,m[7]||(m[7]=[k("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):w("",!0),M(zt,{task:e.task,onComplete:v},null,8,["task"]),k("div",{class:"tw-flex-auto",onClick:oe},[(O=_(r))!=null&&O.is_debug_mode?(l(),c(z,{key:0},[k("span",Kt,"list_id: "+b(String(e.task.list_id)),1),m[8]||(m[8]=R(" | ")),k("span",Vt,"id: "+b(e.task.id),1),m[9]||(m[9]=R(" | ")),k("span",Qt,"srank: "+b(String(e.task.sort))+" | "+b(String(e.task.rank)),1)],64)):w("",!0),nt((l(),c("div",null,[k("div",Jt,[k("div",{ref_key:"contenteditableRef",ref:$,contenteditable:"",class:A(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[q(ae,["enter"]),m[0]||(m[0]=q(D=>{var F;(F=_(o))==null||F.onLeft(D,()=>{f.value=!1})},["left"])),m[1]||(m[1]=q(D=>{var F;(F=_(o))==null||F.onUp(D,()=>{f.value=!1})},["up"])),m[2]||(m[2]=q(D=>{var F;(F=_(o))==null||F.onRight(D,()=>{f.value=!1})},["right"])),m[3]||(m[3]=q(D=>{var F;(F=_(o))==null||F.onDown(D,()=>{f.value=!1})},["down"])),q(K,["delete"]),m[4]||(m[4]=q(()=>{ne()},["esc"])),m[5]||(m[5]=q(()=>{f.value=!1},["tab"]))],onMousedown:I,onFocus:m[6]||(m[6]=D=>f.value=!0),onPaste:L,onInput:se,innerHTML:_(we)(f.value?e.task.name:_(he)(e.task.name))},null,42,Xt)]),e.task.note?(l(),c("div",{key:0,class:"hint break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(we)(_(he)(e.task.note))},null,8,Yt)):w("",!0),M(Tt,{task:g.task,input:x.value,"is-focused":f.value},null,8,["task","input","is-focused"])])),[[_(It),h]]),M(At,{task:e.task,"is-focused":f.value},null,8,["task","is-focused"])]),k("div",Gt,[e.showInfoLink?(l(),c("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:ee(oe,["prevent"])},m[10]||(m[10]=[k("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):w("",!0),T.value?w("",!0):(l(),c("div",{key:1,class:A(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:De},[e.task.favorite?(l(),c("span",Zt,m[11]||(m[11]=[k("i",{class:"fas fa-star text-yellow"},null,-1)]))):(l(),c("span",es,m[12]||(m[12]=[k("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(i).taskErrorMap.get(e.task.id)?(l(),c("div",ts,[k("span",{class:"icon",style:{color:"orange"},title:_(i).taskErrorMap.get(e.task.id)},m[13]||(m[13]=[k("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,ss)])):w("",!0),!_(ot)(e.task)&&!_(ie)(e.task)?(l(),c("div",{key:3,class:"tw-flex-none",title:g.$t("syncing")},m[14]||(m[14]=[k("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,as)):w("",!0),(N=e.task.extended_data)!=null&&N.comments_count?(l(),c("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:ee(oe,["prevent"])},[m[15]||(m[15]=k("i",{class:"fas fa-comment"},null,-1)),k("span",ns,b(e.task.extended_data.comments_count),1)])):w("",!0),!T.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(l(),c("div",os,b(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):w("",!0),!T.value&&e.task.assigned_contact_id?(l(),c("div",ls,[e.task.update_datetime?(l(),c("span",is,b(_(H)().to(_(H)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(l(),c("span",rs,b(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):w("",!0)])):w("",!0),e.task.complete_datetime?(l(),c("div",us,b(_(H)().to(_(H)(e.task.complete_datetime),!0)),1)):w("",!0),!T.value&&!e.task.assigned_contact_id&&e.task.contact_id?(l(),c("div",cs,[M(de,{"user-id":e.task.contact_id},null,8,["user-id"])])):w("",!0),!T.value&&e.task.assigned_contact_id?(l(),c("div",ds,[M(de,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):w("",!0),T.value&&e.task.complete_contact_id?(l(),c("div",fs,[M(de,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):w("",!0),(J=e.task.external_links)!=null&&J.length?(l(),c("div",ps,[(l(!0),c(z,null,Z(e.task.external_links,D=>(l(),c("a",{key:D.id,href:D.entity_link,class:"icon size-20",target:"_blank"},[k("img",{src:Pe(D.app)},null,8,ks)],8,ms))),128))])):w("",!0)])],2))}}}),hs=C({__name:"ListNavigationProvider",setup(s){const t=S();return ut(Le,vt(t)),(e,n)=>(l(),c("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[te(e.$slots,"default")],512))}}),_s=C({__name:"TaskListItemStoreProvider",setup(s){const t=j(),e=r=>t.completeTask(r),n=(r,f)=>t.updateItem(r,f),d=async(r,f,y)=>{await t.insert(y.isBefore?"before":"after",r,{...f})},i=async(r,f)=>{await t.insertMany(r,f)},a=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},o=async r=>{await t.deleteItem(r)};return(r,f)=>te(r.$slots,"default",{onComplete:e,onUpdate:n,onInsert:d,onInsertMany:i,onInsertFirst:a,onDelete:o})}}),ys=C({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,n=t,d=S(null),{stop:i}=ct(d,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"200px"});return Se(()=>{i()}),(a,o)=>(l(),c("div",{ref_key:"elRef",ref:d},[te(a.$slots,"default")],512))}}),gs={key:0,class:"skeleton custom-m-24"},ws={key:0},bs={class:"box custom-py-24 small align-center gray"},fe=30,Ts=C({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=j(),n=ve(),d=ft(),i=S(fe),a=S([]),o=S(!1),r=S(0),f=S(!1),y=P(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:a.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),x=P(()=>y.value.source.slice(0,i.value));W(()=>t,()=>{i.value=fe,$()},{deep:!0,immediate:!0});const T=()=>{var h;((h=y.value.source)==null?void 0:h.length)>x.value.length&&(i.value+=fe)};async function $(){const{isFetchStream:h,fetchParams:u,disableCheckin:v}=y.value;if(!u||!p(u))return;if(o.value=!1,a.value=[],t.filter==="list"){const L=d.task.value.get(JSON.stringify({list_id:t.listId})),K=d.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ae=d.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),se=L||K;if(se)if(t.shouldFilterUncompleted){if(ae)return}else delete u.status,u.starting_from=dt(new Date(se))}if(r.value=8,t.filter==="list"){const L=n.getItemById(t.listId);r.value=L==null?void 0:L.extended_data.items_count}f.value=!d.task.value.get(JSON.stringify(y.value.fetchParams))&&("status"in y.value.fetchParams?y.value.fetchParams.status!=="0":!0);const I=await e[h?"fetchStream":"fetch"]({...u},{disableCheckin:v});f.value=!1,I&&I.value&&I.value.status_code==="ok"&&t.filter==="search"&&(a.value=[...a.value,...I.value.data],o.value=!a.value.length)}function p(h){return!(!h||h.list_id&&typeof h.list_id!="number"||h.location_id&&typeof h.location_id!="number")}return(h,u)=>f.value?(l(),c("div",gs,[(l(!0),c(z,null,Z(r.value,v=>(l(),c("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(l(),c(z,{key:1},[te(h.$slots,"default",{tasks:x.value}),t.filter==="search"&&o.value?(l(),c("div",ws,[k("p",bs,[R(b(h.$t("searchNoMatches"))+" ",1),k("strong",null,b(t.searchQuery),1)])])):w("",!0),(l(),G(ys,{key:h.$route.fullPath,onIntersecting:T}))],64))}}),Is=C({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=j(),n=ke();W(n.currentRoute,async i=>{const a={...i.query};"addNewTask"in a&&(await d(),delete a.addNewTask,n.replace({path:i.path,query:a}))},{immediate:!0});async function d(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(i,a)=>(l(),c("div",{class:"text-gray pl-list-item-title",onClick:d},[a[0]||(a[0]=k("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),R(" "+b(i.$t("newToDo")),1)]))}}),xs=C({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(l(),G(Ie,{title:t.title,"hide-close-icon":!0},{submit:U(()=>[k("button",{class:"danger",onClick:e[0]||(e[0]=(...n)=>t.onDelete&&t.onDelete(...n))}," Delete ")]),default:U(()=>[R(b(t.text)+" ",1)]),_:1},8,["title"]))}}),$s={class:"tw-w-68"},Ss={class:"menu"},Ls={href:"javascript:void(0);"},Cs={class:"menu"},Ms=["onClick"],Ds=["disabled"],Ps=C({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=pt(),e=ve(),n=S(),d=()=>{n.value&&s.onMove(n.value)};return(i,a)=>(l(),G(Ie,{title:i.title,"hide-close-icon":!0},{submit:U(()=>[k("button",{disabled:!n.value,onClick:ee(d,["prevent"])}," Move ",8,Ds)]),default:U(()=>[k("div",$s,[k("ul",Ss,[(l(!0),c(z,null,Z(_(t).items,o=>(l(),c("li",{key:o.uuid||o.id},[k("a",Ls,b(o.name),1),k("ul",Cs,[(l(!0),c(z,null,Z(_(e).getListsInPocket(o.id),r=>(l(),c("li",{key:r.uuid||r.id,class:A(n.value===r.id&&"selected rounded")},[k("a",{href:"#",onClick:ee(()=>{n.value=n.value===r.id?void 0:r.id},["prevent"])},b(r.name),9,Ms)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Fs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Es={class:"hint"},Bs={class:"hint"},Ns=C({__name:"TaskListMultiselect",setup(s){const t=j(),e=S(new Set),{show:n,hide:d}=ye(xs,{title:"Delete",text:ge(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),d()}}),{show:i,hide:a}=ye(Ps,{title:"Move Items",text:ge(()=>`Delete ${e.value.size} selected items?`),onMove:async x=>{await t.sort(x,null,[...e.value]),e.value.clear(),a()}}),o=x=>{e.value.add(x)},r=x=>{e.value.delete(x)},f=()=>{i()},y=()=>{n()};return(x,T)=>(l(),c(z,null,[e.value.size?(l(),c("div",Fs,[k("button",{class:"button light-gray smaller",onClick:f},[T[0]||(T[0]=k("i",{class:"fas fa-list text-blue"},null,-1)),R(" "+b(x.$t("Move"))+" ",1),k("span",Es,b(e.value.size),1)]),k("button",{class:"button light-gray smaller",onClick:y},[T[1]||(T[1]=k("i",{class:"fas fa-trash-alt text-red"},null,-1)),R(" "+b(x.$t("Delete"))+" ",1),k("span",Bs,b(e.value.size),1)])])):w("",!0),te(x.$slots,"default",{onSelect:o,onDeselect:r})],64))}}),Us={class:"pl-bg-block custom-pb-4"},As={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Rs={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Os={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},Hs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Ks=C({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=j(),n=P(()=>t.filter!=="list");return(d,i)=>(l(),c("div",Us,[t.header?(l(),c("div",As,[k("h1",null,b(t.header),1)])):w("",!0),M(hs,null,{default:U(()=>[M(Ts,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:U(({tasks:a})=>[!a.length&&t.startMessage&&_(e).isPreFilled?(l(),c("div",Rs,b(t.startMessage),1)):w("",!0),t.hideAddNewTask?w("",!0):(l(),c("div",Os,[M(Is,{"addable-props":t.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])])),d.shouldFilterUncompleted&&!d.hideUncompletedLabel&&a.length?(l(),c("div",Hs,b(d.$t("completed")),1)):w("",!0),M(Ns,null,{default:U(({onSelect:o,onDeselect:r})=>[M(kt,{items:a,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:o,onDeselect:r},{default:U(({item:f})=>[M(_s,null,{default:U(({onUpdate:y,onComplete:x,onInsert:T,onInsertMany:$,onInsertFirst:p,onDelete:h,onBlur:u})=>[M(vs,{task:f,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:y,onComplete:x,onInsert:T,onInsertMany:$,onInsertFirst:p,onDelete:h,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Ks as _};
