import{a4 as V,d as x,A as z,a5 as A,c as C,r as y,a6 as T,m as D,a7 as j,o as c,e as f,f as t,t as n,I as h,s as L,v as E,D as B,z as $,q as M,j as I,b as N,i as v,a8 as U,p as Y,K as q,F as P,y as F,h as R,Y as G,a9 as H,g as O,aa as K,ab as Z}from"./index-gfIV291z.js";import{a as W,_ as S}from"./TaskList.vue_vue_type_script_setup_true_lang-5u2zVKFw.js";import"./textToHtmlWithLinks-fg8KEJve.js";import"./sanitizer-qTkizPqY.js";import"./SortableList.vue_vue_type_style_index_0_lang-twHir3jb.js";const X=async i=>{try{const{response:e}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${V}&geocode=${i}&format=json`)).json();return e?e.GeoObjectCollection.featureMember.map(r=>r.GeoObject):[]}catch(e){return e instanceof Error&&console.error(e.message),[]}};function J(i,e,r){const l=40075016686e-3/(256*Math.pow(2,e))*Math.cos(r*(Math.PI/180));return i/l}const Q={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},tt={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},et={class:"pl-bg-block custom-p-16"},ot={class:"small custom-mt-0"},at={class:"small gray"},st={class:"small"},lt={class:"custom-my-12"},nt={class:"custom-my-12"},it=["placeholder"],rt=x({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(i){const e=i,r=z(),p=A(),u=C(()=>Math.pow(2,21-e.zoom)*1128.49722*(w.value/1e4)),l=C(()=>Math.round(J(u.value,e.zoom,e.lat))),w=y(50),k=y(""),g=y(!1),s=T([]),o=y("");D(j(k,500),a=>{if(g.value){g.value=!1;return}m(a)});const m=async a=>{s.value=await X(a)},_=async()=>{const a=await p.insert({name:o.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:u.value});a&&(await p.updateItem(a,{name:o.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:u.value}),r.push(`/map/${a.id}`))};return(a,d)=>(c(),f("div",Q,[t("div",tt,[t("div",et,[t("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:d[0]||(d[0]=b=>a.$router.replace("/map"))},d[3]||(d[3]=[t("i",{class:"fas fa-times"},null,-1)])),t("p",ot,n(a.$t("adjustLocationHint")),1),t("p",at,[h(n(a.lat),1),d[4]||(d[4]=t("br",null,null,-1)),h(" "+n(a.lng),1)]),t("div",st,[h(n(a.$t("Radius"))+": ",1),t("b",null,n(u.value&&Math.ceil(u.value))+" "+n(a.$t("m")),1)]),t("div",lt,[L(t("input",{"onUpdate:modelValue":d[1]||(d[1]=b=>w.value=b),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[E,w.value,void 0,{number:!0}]])]),t("div",nt,[L(t("input",{"onUpdate:modelValue":d[2]||(d[2]=b=>o.value=b),type:"text",placeholder:a.$t("name"),class:"width-100"},null,8,it),[[E,o.value,void 0,{trim:!0}]])]),t("button",{onClick:_},n(a.$t("Save location")),1)])]),t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:B({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:l.value+"px",height:l.value+"px"})},d[5]||(d[5]=[t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[t("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),ut=["href"],dt=x({__name:"ModalPremium",props:{message:{}},emits:["close"],setup(i,{emit:e}){const r=e,p=i;return(u,l)=>(c(),$(W,{"hide-close-button":!0,"hide-close-icon":!0,title:u.$t("modalPremiumTitle")},{default:M(()=>[h(n(p.message),1)]),submit:M(()=>[t("a",{class:"button",href:`${I(N).base_url}upgrade/`},n(u.$t("modalPremiumBuy")),9,ut),t("button",{class:"outlined",onClick:l[0]||(l[0]=v(w=>r("close"),["prevent"]))},n(u.$t("modalPremiumCancel")),1)]),_:1},8,["title"]))}});function ct(i){if(N.is_premium)return;const e=U(dt,{message:i});return Y(()=>e.show()),q(()=>e.remove()),{show:e.show,hide:e.remove}}const mt={class:"pl-map-sidebar"},pt={key:0,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},wt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},ft={class:"menu large"},vt=["onClick"],ht={key:1,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},gt={class:"tw-flex-none tw-flex tw-items-center tw-gap-4 tw-justify-between"},_t={class:"bold"},bt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},It=x({__name:"MapView",props:{locationId:{}},setup(i){ct();const e=z(),r=A(),p=K(()=>Z(()=>import("./MapYandex--pZR_-3x.js"),__vite__mapDeps([0,1,2]),import.meta.url)),u=T(p),l=C(()=>i.locationId&&r.getItemById(i.locationId)),w=s=>{e.push(`/map/${s}`)},k=()=>{const s={...e.currentRoute.value.query};s.addLocation?delete s.addLocation:s.addLocation="1",e.push({path:"/map",query:s})},g=async s=>{await r.deleteItem(s),e.push("/map")};return(s,o)=>(c(),f(P,null,[t("div",mt,[l.value?(c(),f("div",ht,[t("div",gt,[t("a",{class:"back larger",onClick:o[0]||(o[0]=v(m=>s.$router.push("/map"),["prevent"]))},o[4]||(o[4]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)])),t("div",_t,n(l.value.name),1),t("div",null,[t("a",{onClick:o[1]||(o[1]=v(m=>g(l.value),["prevent"]))},o[5]||(o[5]=[t("i",{class:"fas fa-trash-alt text-light-gray"},null,-1)]))])]),t("div",bt,[R(S,{filter:"location","location-id":l.value.id,"addable-props":{location_id:l.value.id}},null,8,["location-id","addable-props"]),o[6]||(o[6]=t("div",{class:"custom-px-24 custom-my-24 tw-cursor-pointer"}," Выполненные ",-1)),R(S,{filter:"location","location-id":l.value.id,"should-filter-uncompleted":!0,"hide-add-new-task":!0},null,8,["location-id"])])])):(c(),f("div",pt,[t("a",{class:"button",onClick:v(k,["prevent"])},[o[2]||(o[2]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),h(" "+n(s.$t("New location")),1)]),t("div",wt,[t("ul",ft,[(c(!0),f(P,null,F(I(r).items,m=>(c(),f("li",{key:m.id,class:"rounded"},[t("a",{onClick:v(_=>w(m.id),["prevent"])},[o[3]||(o[3]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),t("span",null,n(m.name),1)],8,vt)]))),128))])])]))]),(c(),$(H,{to:"#wa-app"},[(c(),$(G(u.value),{places:I(r).items,"selected-location-id":s.locationId,onSelectLocation:w},{default:M(({lng:m,lat:_,zoom:a})=>[s.$route.query.addLocation?(c(),$(rt,{key:0,lng:m,lat:_,zoom:a},null,8,["lng","lat","zoom"])):O("",!0),o[7]||(o[7]=t("div",{id:"map",class:"tw-absolute tw-w-full tw-h-1/2 md:tw-h-full tw-top-0 tw-left-0 z-0"},null,-1))]),_:1},40,["places","selected-location-id"]))]))],64))}});export{It as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./MapYandex--pZR_-3x.js","./index-gfIV291z.js","./index-jpgVZ2n-.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
