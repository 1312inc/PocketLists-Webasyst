import{aO as F,aP as k,aQ as K,aR as Z,aS as R,aT as Q,aU as T,a4 as V,d as X,r as D,aV as G,aW as q,p as H,m as B,S as J}from"./index-npZA7Hpi.js";function W(a,c,o,t={}){const n=F(a),r=k(n[0]),e=k(n[1]),M=k(o),i=K(c,t.units),s=Math.asin(Math.sin(e)*Math.cos(i)+Math.cos(e)*Math.sin(i)*Math.cos(M)),_=r+Math.atan2(Math.sin(M)*Math.sin(i)*Math.cos(e),Math.cos(i)-Math.sin(e)*Math.sin(s)),d=R(_),v=R(s);return Z([d,v],t.properties)}function U(a,c,o){if(a!==null)for(var t,n,r,e,M,i,s,_=0,d=0,v,l=a.type,h=l==="FeatureCollection",f=l==="Feature",C=h?a.features.length:1,u=0;u<C;u++){s=h?a.features[u].geometry:f?a.geometry:a,v=s?s.type==="GeometryCollection":!1,M=v?s.geometries.length:1;for(var p=0;p<M;p++){var g=0,w=0;if(e=v?s.geometries[p]:s,e!==null){i=e.coordinates;var m=e.type;switch(_=o&&(m==="Polygon"||m==="MultiPolygon")?1:0,m){case null:break;case"Point":if(c(i,d,u,g,w)===!1)return!1;d++,g++;break;case"LineString":case"MultiPoint":for(t=0;t<i.length;t++){if(c(i[t],d,u,g,w)===!1)return!1;d++,m==="MultiPoint"&&g++}m==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(t=0;t<i.length;t++){for(n=0;n<i[t].length-_;n++){if(c(i[t][n],d,u,g,w)===!1)return!1;d++}m==="MultiLineString"&&g++,m==="Polygon"&&w++}m==="Polygon"&&g++;break;case"MultiPolygon":for(t=0;t<i.length;t++){for(w=0,n=0;n<i[t].length;n++){for(r=0;r<i[t][n].length-_;r++){if(c(i[t][n][r],d,u,g,w)===!1)return!1;d++}w++}g++}break;case"GeometryCollection":for(t=0;t<e.geometries.length;t++)if(U(e.geometries[t],c,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function j(a,c={}){if(a.bbox!=null&&c.recompute!==!0)return a.bbox;const o=[1/0,1/0,-1/0,-1/0];return U(a,t=>{o[0]>t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),o[2]<t[0]&&(o[2]=t[0]),o[3]<t[1]&&(o[3]=t[1])}),o}function $(a,c,o={}){const t=o.steps||64,n=o.properties?o.properties:!Array.isArray(a)&&a.type==="Feature"&&a.properties?a.properties:{},r=[];for(let e=0;e<t;e++)r.push(W(a,c,e*-360/t,o).geometry.coordinates);return r.push(r[0]),Q([r],n)}const{load:x}=T(`https://api-maps.yandex.ru/v3/?apikey=${V}&lang=ru_RU`,()=>{},{manual:!0,immediate:!1});async function I(){if("ymaps3"in window)return ymaps3;try{return await x(),await ymaps3.ready,ymaps3.import.registerCdn("https://cdn.jsdelivr.net/npm/{package}",["@yandex/ymaps3-default-ui-theme@latest"]),ymaps3}catch{console.error("Can't load Yandex Maps")}}const nt=X({__name:"MapYandex",props:{places:{},selectedLocationId:{}},emits:["selectLocation"],setup(a,{emit:c}){const o=c,t=a;let n;const r=D(G.lng),e=D(G.lat),M=D(q);H(async()=>{const s=await I();i(s)});const i=async s=>{if(s){const l=document.getElementById("map");if(l){const{YMap:h,YMapDefaultSchemeLayer:f,YMapMarker:C,YMapFeature:u,YMapDefaultFeaturesLayer:p,YMapListener:g,YMapControls:w}=s,{YMapZoomControl:m}=await s.import("@yandex/ymaps3-default-ui-theme");n=new h(l,{location:{center:[r.value,e.value],zoom:M.value}}),n.addChild(new f({})),n.addChild(new p({}));const E=new w({position:"top right",orientation:"vertical"});E.addChild(new m({})),n.addChild(E),n.addChild(new g({onActionEnd:_}));const b=new Set;B(()=>t.places,L=>{if(Array.isArray(L)&&L.length){b.forEach(y=>{n.removeChild(y)}),b.clear();const S=new DOMParser().parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 384 512"><path fill="#7256ee" d="M172.3 501.7C27 291 0 269.4 0 192 0 86 86 0 192 0s192 86 192 192c0 77.4-27 99-172.3 309.7-9.5 13.8-29.9 13.8-39.5 0zM192 272c44.2 0 80-35.8 80-80s-35.8-80-80-80-80 35.8-80 80 35.8 80 80 80z"/></svg>',"image/svg+xml").documentElement;S.style.transform="translate(-50%,-50%)",S.style.cursor="pointer";for(const y of L){if(!y.location_latitude||!y.location_longitude)continue;const Y=S.cloneNode(!0);Y.onclick=()=>{o("selectLocation",y.id)},Y.style.transform="translate(-50%, calc(-50% - 12px))";const O=new C({coordinates:[y.location_longitude,y.location_latitude],draggable:!1,mapFollowsOnDrag:!0},Y);n.addChild(O),b.add(O);const N=$([y.location_longitude,y.location_latitude],y.location_radius,{steps:100,units:"meters"}),z=new u({geometry:{type:"Polygon",coordinates:N.geometry.coordinates},style:{stroke:[{width:2,color:"rgb(14, 194, 219)"}],fill:"rgba(56, 56, 219, 0.5)"}});n.addChild(z),b.add(z)}_()}},{immediate:!0}),B(()=>t.selectedLocationId,L=>{const P=t.places.find(S=>S.uuid===L||S.id===L);if(!P){n.setLocation({bounds:v(t.places)});return}const A=d(P);A&&n.setLocation({bounds:A})},{immediate:!0})}}function _(){n.zoom&&n.center&&(r.value=n.center[0],e.value=n.center[1],M.value=n.zoom)}function d(l){if(!l.location_longitude||!l.location_latitude||!l.location_radius)return;const h=$([l.location_longitude,l.location_latitude],l.location_radius,{steps:64,units:"meters"}),f=j(h);return[[f[0],f[1]],[f[2],f[3]]]}function v(l){let h=1/0,f=0,C=1/0,u=0;for(const p of l)p.location_latitude&&p.location_longitude&&(h=Math.min(p.location_longitude,h),f=Math.max(p.location_longitude,f),C=Math.min(p.location_latitude,C),u=Math.max(p.location_latitude,u));return[[h,C],[f,u]]}};return(s,_)=>J(s.$slots,"default",{lng:r.value,lat:e.value,zoom:M.value})}});export{nt as default};
