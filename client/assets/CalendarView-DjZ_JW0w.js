import{d as z,r as D,c as C,m as _,o as v,e as g,f as i,t as M,j as p,L as k,F as T,x as Y,n as L,D as $,S as B,$ as N,a0 as O,p as R,l as H,a1 as I,a2 as V,z as E,J as F,B as P,I as A,h as x,q as j,i as q,g as S,K as U,R as G,a3 as J,a4 as K}from"./index-V0gsrDTQ.js";import{_ as W}from"./TaskList.vue_vue_type_script_setup_true_lang-x5A1wmKl.js";import"./textToHtmlWithLinks-HUqvNfVe.js";import"./sanitizer-TiisBOmJ.js";import"./SortableList.vue_vue_type_style_index_0_lang-0yQ_G7kP.js";const Q=typeof window<"u"&&typeof document<"u"?window:void 0,X=(m,d)=>{const n=new Date(Date.UTC(2017,0,2)),l=[];for(let c=0;c<7;c++)l.push(n.toLocaleDateString(m,{weekday:"short"})),n.setDate(n.getDate()+1);return d||l.unshift(l.pop()),l};function Z(m,d,n){let l=0,c=!1,f=0,h=null;const a=10,s=10;function w(o){const y=-o.deltaY,b=Math.abs(y);b<s||o.timeStamp-f<300&&c||(f=o.timeStamp,l<b&&!c?(y<-a?d():y>a&&n(),u(b),h&&clearTimeout(h),h=setTimeout(()=>{l===b&&r()},1e3)):b<a&&r())}function u(o){l=o,c=!0}function r(){l=a,c=!1}const e=()=>{m.value&&m.value.removeEventListener("wheel",w)},t=_(m,o=>{e(),o&&o.addEventListener("wheel",w)},{immediate:!0,flush:"post"});I()&&V(()=>{e(),t()})}function ee(m,d={width:0,height:0}){const n=Q;let l;const c=n&&"ResizeObserver"in n,f=D(d.width),h=D(d.height),a=([u])=>{const r=u.contentBoxSize;if(r){const e=Array.isArray(r)?r:[r];f.value=e.reduce((t,{inlineSize:o})=>t+o,0),h.value=e.reduce((t,{blockSize:o})=>t+o,0)}else f.value=u.contentRect.width,h.value=u.contentRect.height},s=()=>{l&&(l.disconnect(),l=void 0)},w=_(m,u=>{s(),c&&n&&(l=new ResizeObserver(a),u&&l.observe(u))},{immediate:!0,flush:"post"});return R(()=>{m.value&&(f.value="offsetWidth"in m.value?m.value.offsetWidth:d.width,h.value="offsetHeight"in m.value?m.value.offsetHeight:d.height)}),I()&&V(()=>{s(),w()}),{width:f,height:h}}function te(m,d,n){const l=D(1),c=D(!0),f=D(!0),{height:h}=ee(m),a=C(()=>h.value/6),s=D(k()),w=C(()=>{const e=s.value.startOf("M"),t=e.get("d")+-n,o=t<0?7+t:t;return e.add(-(6*7+o),"d")}),u=C(()=>new Array(6*7*3).fill(null).map((e,t)=>{const o=w.value.add(t,"d").toDate(),y=o.toLocaleDateString();return{localeDate:y,timestamp:o.getTime(),isWeekend:[0,6].includes(o.getDay()),isCurrent:new Date().toLocaleDateString()===y,isFirstDay:o.getDate()===1,isCurrentMonth:o.getMonth()===s.value.get("M")}}));R(()=>{d.value&&(f.value=!1,d.value.style.transform=`translate3d(0px, ${-d.value.clientHeight}px, 0px)`)}),Z(m,()=>{c.value&&l.value<2&&l.value++},()=>{c.value&&l.value>0&&l.value--});const r=e=>{if(d.value){const t=d.value.querySelectorAll(".icg-months-grid-day--first-day")[e];t instanceof HTMLElement&&(d.value.style.transform=`translate3d(0px, ${-t.offsetTop}px, 0px)`)}};return _(l,e=>{e===1?r(e):d.value&&(f.value=!0,c.value=!1,d.value.addEventListener("transitionend",()=>{f.value=!1,c.value=!0,s.value=s.value.add(e===0?-1:1,"month"),H(()=>{l.value=1})},{once:!0}),r(e))}),_(f,e=>{d.value&&(d.value.style.transitionProperty=e?"transform":"none")}),_(a,()=>{r(1)},{flush:"post"}),{cellHeight:a,activeMonth:s,daysInCalendar:u}}const ae={class:"icg"},se={class:"icg-header"},le={class:"icg-month"},oe={class:"icg-controls"},ie=i("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[i("path",{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"})],-1),ne=[ie],re=i("svg",{xmlns:"http://www.w3.org/2000/svg",height:".8rem",viewBox:"0 0 320 512"},[i("path",{d:"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"})],-1),de=[re],ce={class:"icg-weekdays"},ue=z({__name:"InfiniteCalendarGrid",props:{firstDayOfWeek:{default:0},locale:{default:"en-US"},todayLabel:{default:"Today"},items:{},fieldWithDate:{}},emits:["changeInterval"],setup(m,{emit:d}){const n=m,l=d,c=D(null),f=D(null),{cellHeight:h,activeMonth:a,daysInCalendar:s}=te(c,f,n.firstDayOfWeek),w=X(n.locale,n.firstDayOfWeek),u=C(()=>{const r={};for(const e of n.items){const t=e[n.fieldWithDate];if(typeof t=="string"||typeof t=="number"){const o=new Date(t);if(!isNaN(o.getTime())){const y=o.toLocaleDateString();r[y]?r[y].push(e):r[y]=[e]}}}return r});return _(s,r=>{l("changeInterval",{start:r[0].timestamp,end:r[r.length-1].timestamp})},{immediate:!0,flush:"post"}),(r,e)=>(v(),g("div",ae,[i("div",se,[i("div",le,M(p(a).toDate().toLocaleDateString(n.locale,{year:"numeric",month:"long"}).replace("Ð³.","")),1),i("div",oe,[i("button",{onClick:e[0]||(e[0]=t=>a.value=p(a).add(-1,"M"))},ne),i("button",{onClick:e[1]||(e[1]=t=>a.value=p(k)())},M(n.todayLabel),1),i("button",{onClick:e[2]||(e[2]=t=>a.value=p(a).add(1,"M"))},de)])]),i("div",ce,[(v(!0),g(T,null,Y(p(w),(t,o)=>(v(),g("div",{key:t,class:L(["icg-weekdays-cell",{"icg-weekdays-cell--weekend":o===(n.firstDayOfWeek?5:0)||o===6}])},M(t),3))),128))]),i("div",{ref_key:"wrapperRef",ref:c,class:"icg-wrapper"},[i("div",{ref_key:"containerRef",ref:f,class:"icg-months-grid"},[(v(!0),g(T,null,Y(p(s),t=>(v(),g("div",{key:t.timestamp,class:L(["icg-months-grid-day",{"icg-months-grid-day--active-month":t.isCurrentMonth,"icg-months-grid-day--first-day":t.isFirstDay,"icg-months-grid-day--weekend":t.isWeekend,"icg-months-grid-day--current":t.isCurrent}]),style:$({height:`${p(h)}px`})},[B(r.$slots,"default",N(O({date:t,items:u.value[t.localeDate]})))],6))),128))],512)],512)]))}}),me={class:"tw-flex tw-flex-col lg:tw-flex-row tw-h-full lg:tw-gap-4"},fe={class:"lg:tw-flex-auto lt-lg:tw-h-1/2 tw-relative"},pe=["onClick"],he={class:"pl-calendar-day"},ve={key:0},ge={class:"pl-calendar-items custom-px-4 custom-pt-32 lt-lg:tw-flex lt-lg:tw-gap-.5"},we={key:0,class:"pl-calendar-bullet"},ye={key:0,class:"lg:tw-w-80 lt-lg:tw-h-1/2 empty:tw-hidden tw-flex tw-flex-col tw-gap-3 tw-overflow-y-auto hide-scrollbar"},De={class:"flexbox space-12 middle custom-pt-12 tw-flex-none custom-px-12"},ke={class:"custom-my-0"},Me={class:"wide custom-px-12"},_e={key:1,class:"lg:tw-w-80 lt-lg:tw-h-1/2 empty:tw-hidden"},Ye=z({__name:"CalendarView",props:{selectedDate:{}},setup(m){const{t:d}=E();F(d("calendar"));const n=P(),l=D(),c=D(),f=C(()=>[...n.getDue(),...n.getTasksCompleted].map(s=>({...s,filterDate:s.complete_datetime||s.due_date})).filter(s=>{if(!s.filterDate)return!1;const w=new Date(s.filterDate).getTime();return w>l.value&&w<c.value})),h=({start:a,end:s})=>{l.value=a,c.value=s,n.fetch({status:1}),n.fetchStream({filter:`due/${k(a).format("YYYY-MM-DD")},${k(s).format("YYYY-MM-DD")}`},{disableCheckin:!0})};return(a,s)=>{const w=A("RouterView");return v(),g("div",me,[i("div",fe,[x(p(ue),{items:f.value,"field-with-date":"filterDate","first-day-of-week":1,"today-label":a.$t("today"),locale:p(K),onChangeInterval:h},{default:j(({date:u,items:r})=>[i("div",{class:"tw-h-full",style:$(a.selectedDate===p(k)(u.timestamp).format("YYYY-MM-DD")&&"background: var(--highlighted-green)"),onClick:e=>a.$router.push({name:"calendarDate",params:{date:p(k)(u.timestamp).format("YYYY-MM-DD")}})},[i("div",he,[U(M(new Date(u.timestamp).getDate())+" ",1),new Date(u.timestamp).getDate()===1?(v(),g("span",ve,M(p(k)(u.timestamp).format("MMM")),1)):S("",!0)]),i("div",ge,[(v(!0),g(T,null,Y(r,e=>{var t;return v(),g("div",{key:e.uuid||e.id,class:"flexbox middle space-4"},[e.complete_datetime?(v(),g("div",we,s[1]||(s[1]=[i("i",{class:"smaller gray fas fa-check"},null,-1)]))):(v(),g("span",{key:1,class:"pl-calendar-bullet",style:$(`color: ${(t=p(G).get(p(J)(e)))==null?void 0:t.color}`)},s[2]||(s[2]=[i("i",{class:"smallest fas fa-circle"},null,-1)]),4)),i("div",{class:L(["smaller lt-lg:tw-hidden tw-truncate",{"opacity-50":e.complete_datetime}])},M(e.name),3)])}),128))])],12,pe)]),_:1},8,["items","today-label","locale"])]),a.$route.name==="calendarDate"?(v(),g("div",ye,[a.selectedDate?(v(),g(T,{key:0},[i("div",De,[i("a",{class:"back larger",onClick:s[0]||(s[0]=q(u=>a.$router.push({name:"calendar"}),["prevent"]))},s[3]||(s[3]=[i("i",{class:"fas fa-arrow-circle-left"},null,-1)])),i("h4",ke,M(p(k)(a.selectedDate).format("LL")),1)]),i("div",Me,[i("div",null,[x(W,{filter:"date",date:a.selectedDate,"addable-props":{due_date:a.selectedDate}},null,8,["date","addable-props"]),x(W,{filter:"date","should-filter-uncompleted":!0,date:a.selectedDate,"hide-add-new-task":!0,"disable-sort":!0},null,8,["date"])])])],64)):S("",!0)])):S("",!0),a.$route.meta.isTaskInfoView?(v(),g("div",_e,[x(w)])):S("",!0)])}}});export{Ye as default};
