import{d as h,u as T,a as C,r as m,o as f,c as v,b as e,w as y,t as _,e as g,f as S,g as B,h as x,i as $,j as b,k as I,l as R,T as D,m as M,v as V,n as N,p as U,q as E,F,s as K,x as L,y as j}from"./index-23hnr_y9.js";import{C as q}from"./ContenteditableBlock-fvdgwLCh.js";import"./rangy-5rxgwlWZ.js";const A={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background custom-p-16 tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},G={class:"tw-flex tw-gap-2"},H={class:"tw-flex tw-gap-2"},z={class:"tw-truncate"},J={class:"hint"},O={class:"hint"},P=h({__name:"TaskInfoChatItem",props:{message:{}},setup(r){const s=r,c=T(),o=C(),t=m(!1),a=()=>{o.deleteItem(s.message)},l=u=>{o.updateItem(s.message,{comment:u})};return(u,n)=>{var i;return f(),v("div",A,[e("div",G,[e("a",{onClick:y(a,["prevent"])},n[1]||(n[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:n[0]||(n[0]=y(w=>t.value=!0,["prevent"]))},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),e("div",H,[e("div",z,_((i=g(c).getItemById(s.message.contact_id))==null?void 0:i.name),1),e("div",J,_(g(S)(g(B)(s.message)).format("ll")),1)]),x(q,{editable:t.value,focusable:!0,value:s.message.comment,tag:"div",onUpdate:l},null,8,["editable","value"]),e("div",O,_(typeof s.message.id=="number"?"delivered":"not delivered"),1)])}}}),Q={class:"tw-h-full tw-flex tw-flex-col"},W={class:"tw-flex-none tw-sticky custom-py-12 pl-bg-block"},X={class:"state-with-inner-icon right width-100"},Y=h({__name:"TaskInfoChat",props:{taskId:{}},setup(r){const s=r,c=$(),o=C(),t=b(()=>c.getItemById(s.taskId)),a=b(()=>t.value?o.getComentsByTaskId(t.value.id):[]),l=m(),u=m(),n=m(!1),i=m("");I(()=>s.taskId,()=>{t.value&&U(t.value)&&o.fetch({item_id:t.value.id})},{immediate:!0}),I(a,async()=>{await E(),l.value&&(l.value.scrollTop=l.value.scrollHeight),n.value=!0});const w=async()=>{if(t.value){const k=await o.insert(t.value.id);k&&o.updateItem(k,{comment:i.value}),i.value="",u.value.focus()}};return(k,p)=>(f(),v("div",Q,[e("div",{ref_key:"chatContainerRef",ref:l,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[x(D,{name:"slide-right",css:n.value},{default:R(()=>[(f(!0),v(F,null,K(a.value,d=>(f(),L(P,{key:d.uuid||d.id,message:d},null,8,["message"]))),128))]),_:1},8,["css"])],512),e("div",W,[e("div",X,[M(e("input",{ref_key:"inputRef",ref:u,"onUpdate:modelValue":p[0]||(p[0]=d=>i.value=d),type:"text",placeholder:"Type a message",class:"width-100",onKeydown:N(w,["enter"])},null,544),[[V,i.value]]),e("button",{class:"icon",onClick:w},p[1]||(p[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),Z={class:"pl-bg-block tw-h-full tw-flex tw-flex-col"},ee={class:"tw-flex-auto custom-p-12 custom-pb-0"},oe=h({__name:"TaskInfo",props:{taskId:{}},setup(r){const s=r,c=j(),o=()=>{var a;const t=(a=[...c.currentRoute.value.matched].reverse().find(l=>l.meta.isListView))==null?void 0:a.name;t?c.push({name:t}):console.error("Cant find back route")};return(t,a)=>(f(),v("div",Z,[e("div",{class:"tw-flex-none custom-p-12"},[e("button",{class:"circle gray",onClick:o},a[0]||(a[0]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",ee,[x(Y,{"task-id":s.taskId},null,8,["task-id"])])]))}});export{oe as default};
