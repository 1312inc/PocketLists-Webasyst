import{_ as M,a as U}from"./tasks-WSJ9-G2o.js";import{d as $,u as S,a as B,r as b,o as u,c as m,b as e,w as T,e as R,f as h,t as o,g as y,h as V,i as E,F as C,j as x,k as I,l as N,m as D,n as A,v as L,p as z,q as j,s as F,x as H,y as K,z as W,A as q,B as O,C as g,D as P}from"./index-b_DxFLH3.js";import{C as G}from"./ContenteditableBlock-n9XRvYFF.js";import"./rangy-5rxgwlWZ.js";const J={class:"tw-flex tw-flex-col tw-gap-2 blank box rounded tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},Q={class:"tw-flex tw-gap-2"},X={class:"tw-truncate smaller"},Y={class:"gray"},Z={class:"gray"},ee=$({__name:"TaskInfoChatItem",props:{message:{}},setup(w){const r=w,_=S(),n=B(),d=b(!1),f=()=>{n.deleteItem(r.message)},a=c=>{n.updateItem(r.message,{comment:c})};return(c,l)=>{var i;return u(),m(C,null,[e("div",J,[e("div",Q,[e("a",{onClick:T(f,["prevent"])},l[1]||(l[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:l[0]||(l[0]=T(p=>d.value=!0,["prevent"]))},l[2]||(l[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),R(G,{editable:d.value,focusable:!0,value:r.message.comment,tag:"div",onUpdate:a},null,8,["editable","value"])]),e("div",X,[h(o((i=y(_).getItemById(r.message.contact_id))==null?void 0:i.name)+" ",1),e("span",Y,o(y(V)(y(E)(r.message)).format("ll")),1),e("span",Z,o(typeof r.message.id=="number"?"delivered":"not delivered"),1)])],64)}}}),te={class:"tw-flex tw-flex-col tw-h-full"},se={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},ae={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},oe={class:"state-with-inner-icon right width-100"},le=$({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(w,{emit:r}){const _=r,n=w,d=B(),f=b(),a=b(""),c=x(()=>d.getComentsByTaskId(n.taskId));I(()=>n.taskId,i=>j(i)&&d.fetch({item_id:i}),{immediate:!0}),I(c,async()=>{c.value.length&&(await F(),_("update"))},{immediate:!0}),N(()=>{f.value.focus()}),I(()=>n.taskId,()=>{f.value.focus()});const l=async()=>{const i=await d.insert(n.taskId);i&&(d.updateItem(i,{comment:a.value}),a.value="",f.value.focus())};return(i,p)=>(u(),m("div",te,[e("div",se,[(u(!0),m(C,null,D(c.value,t=>(u(),H(ee,{key:t.uuid||t.id,message:t},null,8,["message"]))),128))]),e("div",ae,[e("div",oe,[A(e("input",{ref_key:"inputRef",ref:f,"onUpdate:modelValue":p[0]||(p[0]=t=>a.value=t),type:"text",placeholder:"Message",class:"width-100 blank",onKeydown:z(l,["enter"])},null,544),[[L,a.value]]),e("button",{class:"icon",onClick:l},p[1]||(p[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),ne={key:0,class:"tw-h-full tw-flex tw-flex-col"},ie={class:"tw-flex-none custom-px-12"},re={class:"custom-my-0"},ce={class:"chips small"},ue={href:"#"},de={href:"#"},me={href:"#"},fe={href:"#"},pe={href:"#"},_e={key:0,class:"custom-mb-12"},ve={class:"hint custom-mb-4"},he={class:"custom-ml-4"},we={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},ke={key:1,class:"custom-mb-12"},ge=["href"],ye=["src"],be=["href"],Ie={class:"hint custom-ml-4"},Se=$({__name:"TaskInfo",props:{taskId:{}},setup(w){const r=w,_=K(),n=b(),d=W(),f=S(),a=x(()=>d.getItemById(r.taskId)),c=x(()=>f.getItemById(a.value.contact_id));q(document,"keydown",t=>{t.code==="Escape"&&l()});const l=()=>{var s;const t=(s=[..._.currentRoute.value.matched].reverse().find(k=>k.meta.isListView))==null?void 0:s.name;t?_.push({name:t}):console.error("Cant find back route")},i=()=>{setTimeout(()=>{n.value.scrollTo({top:n.value.scrollHeight})},100)};function p(t){return new URL(Object.assign({"../assets/apps/shop.svg":M,"../assets/apps/tasks.svg":U})[`../assets/apps/${t}.svg`],import.meta.url).href}return(t,s)=>{var k;return a.value?(u(),m("div",ne,[e("div",{class:"tw-flex-none custom-p-12"},[e("a",{class:"back larger",onClick:l},s[0]||(s[0]=[e("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),e("div",ie,[e("h3",re,o(a.value.name),1),e("ul",ce,[e("li",null,[e("a",ue,[s[1]||(s[1]=e("i",{class:"fas fa-calendar-alt"},null,-1)),h(" "+o(t.$t("When")),1)])]),e("li",null,[e("a",de,[s[2]||(s[2]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),h(" "+o(t.$t("Where")),1)])]),e("li",null,[e("a",me,[s[3]||(s[3]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+o(t.$t("Priority")),1)])]),e("li",null,[e("a",fe,[s[4]||(s[4]=e("i",{class:"fas fa-arrow-right"},null,-1)),h(" "+o(t.$t("Assign")),1)])]),e("li",null,[e("a",pe,[s[5]||(s[5]=e("i",{class:"fas fa-paperclip"},null,-1)),h(" "+o(t.$t("Attach")),1)])])]),c.value?(u(),m("div",_e,[e("div",ve,o(t.$t("Created by")),1),e("div",null,[e("span",{class:"icon userpic userpic-20",style:O({backgroundImage:`url(${c.value.photo_url})`})},null,4),e("span",he,o(c.value.name),1),a.value.create_datetime?(u(),m("span",we,o(y(P)(a.value.create_datetime)),1)):g("",!0)])])):g("",!0),(k=a.value.external_links)!=null&&k.length?(u(),m("div",ke,[(u(!0),m(C,null,D(a.value.external_links,v=>(u(),m("div",{key:v.id},[e("a",{href:v.entity_link,class:"icon size-20",target:"_blank"},[e("img",{src:p(v.app)},null,8,ye)],8,ge),e("a",{class:"custom-ml-4",href:v.entity_link},o(v.entity_title),9,be),e("span",Ie,o(v.app),1)]))),128))])):g("",!0),s[6]||(s[6]=e("hr",null,null,-1))]),e("div",{ref_key:"containerRef",ref:n,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[R(le,{"task-id":t.taskId,onUpdate:i},null,8,["task-id"])],512)])):g("",!0)}}});export{Se as default};
