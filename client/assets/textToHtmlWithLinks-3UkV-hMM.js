import{d as V,aH as S,r as $,J as M,m as b,o as f,z as Z,q as g,W as x,af as J,R as U,f as e,j as w,t as d,e as L,s as A,v as E,g as G,y as z,i as y,D as F,O as R,F as T,B as q,aI as K,aJ as X,A as Q,a4 as W,c as P,a5 as ee,aK as te,I as C,aF as ae,u as le,h as I,n as H,ac as se,k as j,b as O}from"./index-xfGaqx-Z.js";const qe=""+new URL("img/shop.svg",import.meta.url).href,Je="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.85619%2017.2942L5.86319%2020.6332L22.1312%201.06423C24.3722%200.898238%2026.6255%201.05688%2028.8212%201.53523L6.56619%2028.3052L0.867188%2023.5572C0.908188%2021.3822%201.25019%2019.2812%201.85619%2017.2942Z'%20fill='%23E80A8A'/%3e%3cpath%20d='M35.4942%204.15186C38.9684%206.19305%2041.8486%209.10706%2043.8492%2012.6049L25.3792%2034.8219L3.36719%2016.4809L10.9402%207.39386L23.8532%2018.1539L35.4932%204.15186H35.4942Z'%20fill='%2329ABE2'/%3e%3cpath%20d='M18.6278%2013.798L11.0658%2022.894L6.88281%2019.409L14.4448%2010.313L18.6278%2013.798V13.798Z'%20fill='%23292A76'/%3e%3cpath%20d='M4.01953%2035.6338L18.9695%2017.6138L27.3515%2024.5658L11.6495%2043.4918C8.51344%2041.5215%205.89666%2038.8265%204.01953%2035.6338V35.6338Z'%20fill='%23F7EA34'/%3e%3cpath%20d='M23.8675%2047C36.5705%2047%2046.8685%2036.703%2046.8685%2024C46.8685%2023.142%2046.8215%2022.294%2046.7305%2021.46L30.0085%2041.574L18.5015%2032.07L12.5215%2039.308L21.7155%2046.902C22.4235%2046.967%2023.1415%2047.001%2023.8675%2047.001V47Z'%20fill='%2349B749'/%3e%3cpath%20d='M44.8763%2033.3699C46.2421%2030.3102%2046.9204%2026.9882%2046.8633%2023.6379L44.1153%2026.9429L35.6863%2019.9829L32.6973%2023.6029L44.7343%2033.5419L44.8763%2033.3709V33.3699Z'%20fill='%23F1B61C'/%3e%3cpath%20d='M36.8902%2020.9769L33.8892%2024.5869L32.6992%2023.6029L35.6872%2019.9829L36.8892%2020.9769H36.8902Z'%20fill='%23097D3F'/%3e%3cpath%20d='M17.0791%2045.9832L28.7711%2031.8892L32.3841%2034.8862L22.3731%2046.9522C20.5762%2046.8379%2018.7989%2046.5123%2017.0781%2045.9822L17.0791%2045.9832Z'%20fill='%23F05323'/%3e%3cpath%20d='M22.3757%2046.9518L28.1267%2040.0198L24.5077%2037.0298L18.5137%2044.2548L21.7157%2046.8998C21.9347%2046.9198%2022.1547%2046.9378%2022.3757%2046.9518V46.9518Z'%20fill='%232B3F1B'/%3e%3cpath%20d='M24.5635%2029.7328L36.5855%2015.2658L33.7695%2012.9258L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4738L24.5635%2029.7338V29.7328Z'%20fill='%23292A76'/%3e%3cpath%20d='M21.5154%2031.6018L13.1484%2024.6308L18.9704%2017.6128L27.3524%2024.5658L21.5154%2031.6018V31.6018Z'%20fill='%2313A149'/%3e%3cpath%20d='M25.4245%2022.9678L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4748L23.6815%2028.9888L27.3515%2024.5658L25.4245%2022.9678V22.9678Z'%20fill='%230C0D1B'/%3e%3cpath%20d='M42.9619%2025.9902L44.1159%2026.9442L46.8639%2023.6392C46.9212%2026.9897%2046.2429%2030.3121%2044.8769%2033.3722L44.7349%2033.5422L39.9609%2029.6002L42.9609%2025.9902H42.9619Z'%20fill='%23269145'/%3e%3c/svg%3e",oe={class:"menu"},ne=["onClick"],ie=["onClick"],ue=["onClick"],re=["onClick"],de={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ce={key:0},pe={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},me=V({__name:"TaskListItemPopupMenuWhen",props:{dueDate:{},dueDateModifiers:{},dueDatetime:{},dueDatetimeModifiers:{}},emits:["update:dueDate","update:dueDatetime"],setup(u){const t=S(u,"dueDate"),o=S(u,"dueDatetime"),r=$(t.value),a=$(o.value?M(o.value).format("HH:mm"):""),i=$(!1),s=$(!1);b([t,o],()=>{i.value=!!(t.value||o.value),s.value=!!o.value},{immediate:!0}),b(a,()=>{!r.value&&a.value&&(r.value=M().format("YYYY-MM-DD"))}),b([r,a],([v,p])=>{t.value=v||null,o.value=p?J(`${v||M().format("YYYY-MM-DD")}T${p}`):null});const k=v=>{r.value=v,a.value=""},c=()=>{r.value="",a.value="",i.value=!1},h=()=>{a.value=""};return(v,p)=>(f(),Z(x,null,{default:g(({handler:m,setRef:l})=>[U(v.$slots,"default",{handler:m,setRef:l})]),body:g(({handler:m})=>[e("ul",oe,[e("li",null,[e("a",{onClick:()=>{k(w(M)().format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.today")),9,ne)]),e("li",null,[e("a",{onClick:()=>{k(w(M)().add(1,"day").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.tomorrow")),9,ie)]),e("li",null,[e("a",{onClick:()=>{k(w(M)().add(2,"day").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.in2days")),9,ue)]),e("li",null,[e("a",{onClick:()=>{k(w(M)().endOf("week").format("YYYY-MM-DD")),m()}},d(v.$t("datePicker.thisWeekend")),9,re)]),e("li",null,[i.value?(f(),L("div",de,[A(e("input",{"onUpdate:modelValue":p[1]||(p[1]=l=>r.value=l),type:"date",class:"width-100"},null,512),[[E,r.value]]),e("a",{onClick:c},p[4]||(p[4]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),L("a",{key:0,onClick:p[0]||(p[0]=l=>i.value=!i.value)},d(v.$t("datePicker.selectDate")),1))]),i.value?(f(),L("li",ce,[s.value?(f(),L("div",pe,[A(e("input",{"onUpdate:modelValue":p[3]||(p[3]=l=>a.value=l),type:"time",class:"width-100"},null,512),[[E,a.value]]),e("a",{onClick:h},p[5]||(p[5]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),L("a",{key:0,onClick:p[2]||(p[2]=l=>s.value=!s.value)},d(v.$t("datePicker.selectTime")),1))])):G("",!0)])]),_:3}))}}),fe={class:"menu"},ve=["onClick"],ke=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const t=S(u,"modelValue");return(o,r)=>(f(),Z(x,null,{default:g(({handler:a,setRef:i})=>[U(o.$slots,"default",{handler:a,setRef:i})]),body:g(({handler:a})=>[e("ul",fe,[(f(!0),L(T,null,z([...w(R).values()],i=>(f(),L("li",{key:i.priority},[e("a",{onClick:y(()=>{t.value=i.priority,a()},["prevent"])},[e("i",{class:"fas fa-exclamation-circle",style:F(`color: ${i.color}`)},null,4),e("span",null,d(i.name),1)],8,ve)]))),128))])]),_:3}))}}),_e=V({__name:"TaskListItemPopupMenuAttachment",props:{task:{}},setup(u){const t=u,o=q(),{files:r,open:a,reset:i,onCancel:s,onChange:k}=K({});return k(async c=>{c&&(await o.addAttachments(t.task,[...c]),i())}),s(()=>{i()}),(c,h)=>U(c.$slots,"default",{open:w(a)})}}),Le=async u=>{try{const{response:t}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${X}&geocode=${u}&format=json`)).json();return t?t.GeoObjectCollection.featureMember.map(o=>o.GeoObject):[]}catch(t){return t instanceof Error&&console.error(t.message),[]}};function we(u,t,o){const i=40075016686e-3/(256*Math.pow(2,t))*Math.cos(o*(Math.PI/180));return u/i}const he={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},ge={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},ye={class:"pl-bg-block custom-p-16"},$e={class:"small custom-mt-0"},Ce={class:"small gray"},Me={class:"small"},De={class:"custom-my-12"},be={class:"custom-my-12"},Ve=["placeholder"],Ye=V({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(u){const t=u,o=Q(),r=W(),a=P(()=>Math.pow(2,21-t.zoom)*1128.49722*(s.value/1e4)),i=P(()=>Math.round(we(a.value,t.zoom,t.lat))),s=$(50),k=$(""),c=$(!1),h=ee([]),v=$("");b(te(k,500),l=>{if(c.value){c.value=!1;return}p(l)});const p=async l=>{h.value=await Le(l)},m=async()=>{const l=await r.insert({name:v.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:a.value});l&&(await r.updateItem(l,{name:v.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:a.value}),o.push(`/map/${l.id}`))};return(l,n)=>(f(),L("div",he,[e("div",ge,[e("div",ye,[e("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:n[0]||(n[0]=_=>l.$router.replace("/map"))},n[3]||(n[3]=[e("i",{class:"fas fa-times"},null,-1)])),e("p",$e,d(l.$t("adjustLocationHint")),1),e("p",Ce,[C(d(l.lat),1),n[4]||(n[4]=e("br",null,null,-1)),C(" "+d(l.lng),1)]),e("div",Me,[C(d(l.$t("Radius"))+": ",1),e("b",null,d(a.value&&Math.ceil(a.value))+" "+d(l.$t("m")),1)]),e("div",De,[A(e("input",{"onUpdate:modelValue":n[1]||(n[1]=_=>s.value=_),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[E,s.value,void 0,{number:!0}]])]),e("div",be,[A(e("input",{"onUpdate:modelValue":n[2]||(n[2]=_=>v.value=_),type:"text",placeholder:l.$t("name"),class:"width-100"},null,8,Ve),[[E,v.value,void 0,{trim:!0}]])]),e("button",{onClick:m},d(l.$t("Save location")),1)])]),e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:F({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:i.value+"px",height:i.value+"px"})},n[5]||(n[5]=[e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[e("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),Ie={class:"menu"},Te=["onClick"],Pe=V({__name:"TaskListItemPopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const t=S(u,"modelValue"),o=W(),r=$(),a=()=>{ae(Ye,{}).show()},i=s=>{t.value=s,r.value.isOpened=!1};return(s,k)=>(f(),Z(x,{ref_key:"dropdownRef",ref:r},{default:g(({handler:c,setRef:h})=>[U(s.$slots,"default",{handler:c,setRef:h})]),body:g(()=>[e("ul",Ie,[e("li",null,[e("a",{onClick:k[0]||(k[0]=y(c=>i(null),["prevent"]))},[e("span",null,d(s.$t("None")),1)])]),e("li",null,[e("a",{onClick:y(a,["prevent"])},k[1]||(k[1]=[e("span",null,"New address...",-1),e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1)]))]),(f(!0),L(T,null,z(w(o).items,c=>(f(),L("li",{key:c.id},[e("a",{onClick:y(h=>i(c.id),["prevent"])},d(c.name),9,Te)]))),128))])]),_:3},512))}});function D(u){return u!=null&&typeof u=="object"&&u["@@functional/placeholder"]===!0}function B(u){return function t(o){return arguments.length===0||D(o)?t:u.apply(this,arguments)}}function Se(u){return function t(o,r){switch(arguments.length){case 0:return t;case 1:return D(o)?t:B(function(a){return u(o,a)});default:return D(o)&&D(r)?t:D(o)?B(function(a){return u(a,r)}):D(r)?B(function(a){return u(o,a)}):u(o,r)}}}var Ae=Se(function(t,o){for(var r={},a=0;a<t.length;)t[a]in o&&(r[t[a]]=o[t[a]]),a+=1;return r});const Ee=["onClick"],xe=["onClick"],Ue=["onClick"],Be={key:0},Re=["onClick"],Ze={class:"icon"},ze=["src"],Fe={class:"menu"},We=["onClick"],Ne=["onClick"],He={class:"icon"},je=["src"],Oe=["onClick"],Ke=V({__name:"TaskListItemPopupMenu",props:{task:{},isSmall:{type:Boolean},hideAssign:{type:Boolean}},setup(u){const t=u,o=q(),r=W(),a=le(),i=["name","due_date","due_datetime","priority","location_id"],s=$({});let k=[];const c=P(()=>t.task.assigned_contact_id&&a.getItemById(t.task.assigned_contact_id)),h=P(()=>se(t.task)),v=P(()=>({"text-red":h.value===3,"text-yellow":h.value===2,"text-green":h.value===1,grey:h.value===0}));b(()=>t.task,m=>{k.forEach(l=>l()),s.value=Ae(i,m),k=i.map(l=>b(()=>s.value[l],async n=>{await o.updateItem(t.task,{[l]:n})}))},{immediate:!0});const p=async m=>{await o.updateItem(t.task.id,{assigned_contact_id:m})};return(m,l)=>(f(),L("ul",{class:H([t.isSmall?"smaller":"small","chips custom-m-0"])},[I(me,{dueDate:s.value.due_date,"onUpdate:dueDate":l[0]||(l[0]=n=>s.value.due_date=n),dueDatetime:s.value.due_datetime,"onUpdate:dueDatetime":l[1]||(l[1]=n=>s.value.due_datetime=n)},{default:g(({handler:n,setRef:_})=>[e("li",null,[e("a",{ref:_,class:H(v.value),onClick:y(n,["prevent"])},[l[4]||(l[4]=e("i",{class:"fas fa-calendar-alt"},null,-1)),C(" "+d(s.value.due_datetime?w(j)(s.value.due_datetime).format("LLL"):s.value.due_date?w(j)(s.value.due_date).format("LL"):m.$t("When")),1)],10,Ee)])]),_:1},8,["dueDate","dueDatetime"]),I(Pe,{modelValue:s.value.location_id,"onUpdate:modelValue":l[2]||(l[2]=n=>s.value.location_id=n)},{default:g(({handler:n,setRef:_})=>{var Y;return[e("li",null,[e("a",{ref:_,onClick:y(n,["prevent"])},[l[5]||(l[5]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),C(" "+d(s.value.location_id?(Y=w(r).getItemById(s.value.location_id))==null?void 0:Y.name:m.$t("Where")),1)],8,xe)])]}),_:1},8,["modelValue"]),I(ke,{modelValue:s.value.priority,"onUpdate:modelValue":l[3]||(l[3]=n=>s.value.priority=n)},{default:g(({handler:n,setRef:_})=>{var Y,N;return[e("li",null,[e("a",{ref:_,onClick:y(n,["prevent"])},[(f(),L("span",{key:s.value.priority},[e("i",{style:F(`color: ${s.value.priority&&((Y=w(R).get(s.value.priority))==null?void 0:Y.color)}`),class:"fas fa-exclamation-circle"},null,4)])),C(" "+d(s.value.priority?(N=w(R).get(s.value.priority))==null?void 0:N.name:m.$t("Priority")),1)],8,Ue)])]}),_:1},8,["modelValue"]),!m.hideAssign&&(w(O).user_rights.canassign||w(O).user_rights.backend==="FULL")?(f(),L("li",Be,[I(x,null,{default:g(({handler:n,setRef:_})=>[e("a",{ref:_,onClick:y(n,["prevent"])},[c.value?(f(),L(T,{key:0},[e("span",Ze,[e("img",{src:c.value.photo_url,class:"userpic"},null,8,ze)]),C(" "+d(c.value.name),1)],64)):(f(),L(T,{key:1},[l[6]||(l[6]=e("i",{class:"fas fa-arrow-right"},null,-1)),C(" "+d(m.$t("Assign")),1)],64))],8,Re)]),body:g(({handler:n})=>[e("ul",Fe,[e("li",null,[e("a",{onClick:y(()=>{p(null),n()},["prevent"])},d(m.$t("No assignment")),9,We)]),(f(!0),L(T,null,z(w(a).items,_=>(f(),L("li",{key:_.id,class:"item"},[e("a",{onClick:y(()=>{p(_.id),n()},["prevent"])},[e("span",He,[e("img",{src:_.photo_url,class:"userpic"},null,8,je)]),e("span",null,d(_.name),1)],8,Ne)]))),128))])]),_:1})])):G("",!0),I(_e,{task:t.task},{default:g(({open:n})=>[e("li",null,[e("a",{onClick:y(()=>{n()},["prevent"])},[l[7]||(l[7]=e("i",{class:"fas fa-paperclip"},null,-1)),C(" "+d(m.$t("Attach")),1)],8,Oe)])]),_:1},8,["task"])],2))}});function Xe(u){const t=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),o=/(https?:\/\/[^\s<"']{2,}|ftp:\/\/[^\s<"']{2,}|www\.[^\s<"']+\.[a-z]{2,}(?:\/[^\s<"']*)?|[\w.+-]+@[a-z\d-]+\.[a-z]{2,}(?:\.[a-z]{2,})*)/gi;return t.replace(o,a=>{let i=a,s=a;return a.includes("@")?a.startsWith("mailto:")||(i=`mailto:${a}`):/^(https?|ftp):\/\//i.test(a)||(i=`https://${a}`,s=a.replace(/^www\./i,"")),/^(https?|ftp|mailto):/i.test(i)?`<a href="${i.replace(/"/g,"%22").replace(/'/g,"%27")}" target="_blank" rel="noopener noreferrer nofollow">${s}</a>`:s})}export{Ke as _,qe as a,Je as b,Ye as c,B as d,Se as e,Ae as p,Xe as t};
