import{h as y,r as b,G as H,L,o as u,j as p,M as B,N as D,u as q,E as z,H as K,D as U,v as I,k as t,m as l,O as j,t as k,I as x,P as S,q as f,Q as F,R as W,z as G,w as _,S as J,U as Q,B as M,V as O,F as N,W as Y,C as A}from"./index-3PVGchPi.js";import{C as P}from"./ContenteditableBlock-88Vfx_Lb.js";import{u as X,p as Z,_ as ee}from"./SortableList.vue_vue_type_style_index_0_lang-mw9HopRA.js";import{_ as te}from"./SearchForm.vue_vue_type_script_setup_true_lang-_SxjagM3.js";import"./rangy-5rxgwlWZ.js";const se=y({__name:"WaDropOnElement",props:{draggableEntityName:{}},emits:["drop"],setup(m,{emit:o}){const e=o,a=m,n=b(),{getDraggingEntityName:r}=X();return H(()=>{L(n,"dragenter",s=>{a.draggableEntityName===r()&&s.currentTarget instanceof HTMLElement&&s.currentTarget.classList.add("dragover")}),L(n,"dragleave",s=>{if(s.currentTarget instanceof HTMLElement){if(s.relatedTarget&&s.currentTarget.contains(s.relatedTarget))return;s.currentTarget.classList.remove("dragover")}}),L(n,"dragover",s=>{s.preventDefault()}),L(n,"drop",s=>{if(a.draggableEntityName===r()&&s.currentTarget instanceof HTMLElement&&(s.preventDefault(),s.currentTarget.classList.remove("dragover"),s.dataTransfer))try{const g=JSON.parse(s.dataTransfer.getData("text/plain")).taskIds;e("drop",g)}catch{}})}),(s,g)=>(u(),p("div",{ref_key:"menuItemElementRef",ref:n},[B(s.$slots,"default")],512))}}),ae={class:"tw-group tw-relative custom-p-16"},ne={key:0},oe={class:"hint"},re={class:"hint"},ie={class:"hint"},le={class:"tw-flex tw-gap-4 tw-justify-between"},ce={class:"tw-flex tw-gap-2"},de=y({__name:"ListsListItem",props:{item:{}},setup(m,{expose:o}){const e=m,a=D(),n=q(),r=z(),s=b();o({focus:v});const g=c=>{a.updateItemName(e.item,c)},T=()=>{a.deleteItem(e.item),r.push({name:"lists"})},w=async c=>{await n.sort(e.item.id,null,c)},i=async c=>{c.target instanceof HTMLElement&&c.target.innerText&&r.push({name:"list",params:{id:e.item.id},query:{addNewTask:1}})};function v(){s.value.focus()}return(c,d)=>{const V=K("RouterLink");return u(),U(se,{"draggable-entity-name":"tasks",onDrop:w},{default:I(()=>{var C,E,h,$,R;return[t("div",ae,[d[4]||(d[4]=t("div",{class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},[t("i",{class:"fas fa-grip-vertical"})],-1)),t("div",null,[l(j).is_debug_mode?(u(),p("div",ne,[t("span",oe,"id: "+k((C=e.item)==null?void 0:C.id),1),d[0]||(d[0]=x(" | ")),t("span",re,"prev_id: "+k(String((E=e.item)==null?void 0:E.prev_item_id)),1),d[1]||(d[1]=x(" | ")),t("span",ie,"srank: "+k(String((h=e.item)==null?void 0:h.sort))+" | "+k(String(($=l(a).getItemById(e.item.id))==null?void 0:$.rank)),1)])):S("",!0),t("div",le,[f(V,{to:{name:"list",params:{id:e.item.id}},class:"tw-flex-auto"},{default:I(()=>[t("div",{class:F({"tw-bg-yellow":l(W)(l(r).currentRoute.value.params.id)===e.item.id||l(r).currentRoute.value.params.id===e.item.uuid})},[f(P,{ref_key:"contenteditableBlockRef",ref:s,value:c.item.name,editable:!0,focusable:!0,placeholder:"New list",tag:"span",onUpdate:g,onKeydown:G(_(i,["prevent"]),["enter"])},null,8,["value","onKeydown"])],2)]),_:1},8,["to"]),x(" "+k(e.item.extended_data.items_count)+" ",1),e.item.extended_data.items_priority_count?(u(),p("div",{key:0,class:"badge",style:J(`background-color: ${(R=l(Z).get(e.item.extended_data.items_priority_value))==null?void 0:R.color}`)},k(e.item.extended_data.items_priority_count),5)):S("",!0),t("div",ce,[t("a",{class:"count",onClick:_(v,["prevent"])},d[2]||(d[2]=[t("i",{class:"fas fa-pen"},null,-1)])),t("a",{class:"count",onClick:_(T,["prevent"])},d[3]||(d[3]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))])])])])]}),_:1})}}}),ue=y({__name:"LazyRender",props:{renderOnIdle:{type:Boolean}},setup(m){const o=b(null),e=b(!1),{stop:a}=Q(o,([{isIntersecting:r}])=>{r&&(e.value=!0,a())},{rootMargin:"600px"});m.renderOnIdle&&n(()=>{e.value=!0,a()});function n(r){"requestIdleCallback"in window?window.requestIdleCallback(r):setTimeout(()=>{M(r)},300)}return(r,s)=>(u(),p("div",{ref_key:"targetRef",ref:o,style:{height:"100px"}},[e.value?B(r.$slots,"default",{key:0}):S("",!0)],512))}}),pe={class:"heading black custom-m-0 custom-mb-8"},me={class:"pl-bg-block"},fe={key:0,class:"custom-px-16 custom-py-12 gray"},ge=y({__name:"ListsList",props:{pocket:{}},setup(m){const o=m,e=O(),a=D(),n=b(!1),r=[],s=async()=>{await a.createList({pocket_id:o.pocket.id}),await M(),r.at(-1).focus()},g=w=>{e.updateItemName(o.pocket,w)},T=()=>{e.deleteItem(o.pocket)};return(w,i)=>(u(),p(N,null,[t("h5",pe,[f(P,{value:o.pocket.name,tag:"span",editable:n.value,focusable:!0,placeholder:"New Pocket",onBlur:i[0]||(i[0]=v=>n.value=!1),onUpdate:g},null,8,["value","editable"]),t("a",{class:"count",onClick:i[1]||(i[1]=_(v=>n.value=!n.value,["prevent"]))},i[2]||(i[2]=[t("i",{class:"fas fa-pen"},null,-1)])),t("a",{class:"count action",onClick:_(s,["prevent"])},i[3]||(i[3]=[t("i",{class:"fas fa-plus-circle"},null,-1)])),t("a",{class:"count action",onClick:_(T,["prevent"])},i[4]||(i[4]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))]),t("div",me,[f(ee,{items:l(a).getListsInPocket(o.pocket.id),"sortable-list-id":o.pocket.id,"sortable-group-name":"lists",onSort:l(a).sort},{default:I(({item:v})=>[f(ue,{style:{height:"auto"}},{default:I(()=>[f(de,{ref:c=>r.push(c),item:v},null,8,["item"])]),_:2},1024)]),_:1},8,["items","sortable-list-id","onSort"]),l(a).getListsInPocket(o.pocket.id).length?S("",!0):(u(),p("div",fe," No Lists Yet "))])],64))}}),ve={class:"align-center"},Le=y({__name:"SidebarInner",setup(m){const o=O();return(e,a)=>(u(),p(N,null,[f(te),a[2]||(a[2]=Y('<div class="bricks"><div class="brick pl-bg-block"><span class="icon"><i class="fas fa-star"></i></span><span class="count">495</span> Star </div><div class="brick pl-bg-block"><span class="icon"><i class="fas fa-bolt"></i></span><span class="count">33</span> Bolt </div></div>',1)),(u(!0),p(N,null,A(l(o).items,n=>(u(),p("div",{key:n.uuid||n.id},[f(ge,{pocket:n},null,8,["pocket"])]))),128)),t("div",ve,[t("button",{class:"gray",onClick:a[0]||(a[0]=n=>l(o).createPocket())},a[1]||(a[1]=[t("i",{class:"fa fa-plus"},null,-1)]))])],64))}});export{Le as default};
