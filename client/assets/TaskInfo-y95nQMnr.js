import{d as g,u as b,a as x,r as p,o as m,c as w,b as e,w as _,e as y,f as T,t as v,g as h,h as C,i as S,F as I,j as $,k,l as B,m as R,n as V,v as M,p as N,q as U,s as D,x as E,y as A,z as F}from"./index-jVtFVCqa.js";import{C as K}from"./ContenteditableBlock-YGbtomg-.js";import"./rangy-5rxgwlWZ.js";const L={class:"tw-flex tw-flex-col tw-gap-2 blank box rounded tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},W={class:"tw-flex tw-gap-2"},j={class:"tw-truncate smaller"},q={class:"gray"},z={class:"gray"},H=g({__name:"TaskInfoChatItem",props:{message:{}},setup(f){const s=f,c=b(),o=x(),l=p(!1),a=()=>{o.deleteItem(s.message)},t=r=>{o.updateItem(s.message,{comment:r})};return(r,n)=>{var i;return m(),w(I,null,[e("div",L,[e("div",W,[e("a",{onClick:_(a,["prevent"])},n[1]||(n[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:n[0]||(n[0]=_(u=>l.value=!0,["prevent"]))},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),y(K,{editable:l.value,focusable:!0,value:s.message.comment,tag:"div",onUpdate:t},null,8,["editable","value"])]),e("div",j,[T(v((i=h(c).getItemById(s.message.contact_id))==null?void 0:i.name)+" ",1),e("span",q,v(h(C)(h(S)(s.message)).format("ll")),1),e("span",z,v(typeof s.message.id=="number"?"delivered":"not delivered"),1)])],64)}}}),P={class:"tw-flex tw-flex-col tw-h-full"},G={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},J={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},O={class:"state-with-inner-icon right width-100"},Q=g({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(f,{emit:s}){const c=s,o=f,l=x(),a=p(),t=p(""),r=$(()=>l.getComentsByTaskId(o.taskId));k(()=>o.taskId,i=>U(i)&&l.fetch({item_id:i}),{immediate:!0}),k(r,async()=>{r.value.length&&(await D(),c("update"))},{immediate:!0}),B(()=>{a.value.focus()}),k(()=>o.taskId,()=>{a.value.focus()});const n=async()=>{const i=await l.insert(o.taskId);i&&(l.updateItem(i,{comment:t.value}),t.value="",a.value.focus())};return(i,u)=>(m(),w("div",P,[e("div",G,[(m(!0),w(I,null,R(r.value,d=>(m(),E(H,{key:d.uuid||d.id,message:d},null,8,["message"]))),128))]),e("div",J,[e("div",O,[V(e("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":u[0]||(u[0]=d=>t.value=d),type:"text",placeholder:"Type a message",class:"width-100 blank",onKeydown:N(n,["enter"])},null,544),[[M,t.value]]),e("button",{class:"icon",onClick:n},u[1]||(u[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),X={class:"tw-h-full tw-flex tw-flex-col"},te=g({__name:"TaskInfo",props:{taskId:{}},setup(f){const s=A(),c=p(),o=()=>{setTimeout(()=>{c.value.scrollTo({top:c.value.scrollHeight})},100)},l=()=>{var t;const a=(t=[...s.currentRoute.value.matched].reverse().find(r=>r.meta.isListView))==null?void 0:t.name;a?s.push({name:a}):console.error("Cant find back route")};return(a,t)=>(m(),w("div",X,[e("div",{class:"tw-flex-none custom-p-12"},[e("a",{class:"back larger",onClick:l},t[0]||(t[0]=[e("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),t[1]||(t[1]=F('<div class="tw-flex-none custom-px-12"><h3 class="custom-my-0"> taskname </h3><ul class="chips smaller"><li><a href="#">When</a></li><li><a href="#">Where</a></li><li><a href="#">Priority</a></li><li><a href="#">Assign</a></li><li><a href="#">Attach</a></li><li><a href="#">Tags</a></li></ul><p class="hint custom-mt-0"> note / sublist / created / updated / last actor / more </p></div>',1)),e("div",{ref_key:"containerRef",ref:c,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[y(Q,{"task-id":a.taskId,onUpdate:o},null,8,["task-id"])],512)]))}});export{te as default};
