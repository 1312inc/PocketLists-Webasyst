import{a8 as te,d as V,a9 as j,o as k,x as P,l as $,E as B,b as l,e as _,O as R,aa as X,_ as se,w as S,ab as ne,a3 as ae,c as L,I as h,t as M,f as oe,Y as le,W as ie,a6 as re,a7 as ue,y as de,S as K,ac as z,ad as ce,r as H,k as q,ae as F,J as fe,F as Z,B as W,n as N,h as E,af as me,i as A,ag as pe,ah as ee,ai as ve,aj as ke,ak as we,j as G,al as ge,am as _e,an as J,G as ye,ao as Y,A as be,ap as Te,q as Ie}from"./index-aLPS7_Q8.js";import{m as U,g as O,s as Q}from"./rangy-5rxgwlWZ.js";import{_ as Le}from"./SortableList.vue_vue_type_style_index_0_lang-diBtrhAW.js";function xe(f){let t=[];te(f,()=>{f.value&&(t=[...f.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=r=>t.findIndex(p=>p.isEqualNode(r)),n=r=>t[e(r)-1],s=r=>t[e(r)+1],a=(r,p)=>{if(r){const c=s(r);if(c instanceof HTMLElement)return c.focus(),p&&U(c),c}else{const c=t[0];c instanceof HTMLElement&&c.focus()}},o=(r,p)=>{if(r.target instanceof HTMLElement){const c=r.target,b=O(c),D=p==="up"?n(c):s(c);D instanceof HTMLElement&&(r.preventDefault(),D.focus(),Q(D,b))}};return{getPreviousElementSibling:n,getNextElementSibling:s,getCurrentPositionInNavigationList:e,focusNextTask:a,focusTaskById:(r,p)=>{const c=t.find(b=>{var D;return b instanceof HTMLElement&&((D=b.dataset)==null?void 0:D.id)==r});c instanceof HTMLElement&&(c.focus(),p&&U(c))},onUp:r=>{o(r,"up")},onDown:r=>{o(r,"down")},onLeft:(r,p)=>{if(r.target instanceof HTMLElement){const c=r.target;if(O(c)===0){const b=n(c);b instanceof HTMLElement&&(r.preventDefault(),p&&(b.innerText+=p),b.focus(),U(b),p&&Q(b,b.innerText.length-p.length))}}},onRight:r=>{if(r.target instanceof HTMLElement){const p=r.target;if(O(p)===p.innerText.length){const c=s(p);c instanceof HTMLElement&&(r.preventDefault(),c.focus())}}}}}const Ce={class:"menu"},$e=V({__name:"TaskListItemPopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(f){const t=j(f,"modelValue"),e=n=>{t.value=n};return(n,s)=>(k(),P(X,null,{default:$(({handler:a,setRef:o})=>[B(n.$slots,"default",{handler:a,setRef:o},void 0,!0)]),body:$(()=>[l("ul",Ce,[l("li",null,[l("a",{onClick:s[0]||(s[0]=a=>e(_(R)().startOf("day").format()))}," Today ")]),l("li",null,[l("a",{onClick:s[1]||(s[1]=a=>e(_(R)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),l("li",null,[l("a",{onClick:s[2]||(s[2]=a=>e(_(R)().add(2,"day").startOf("day").format()))}," In 2 days ")]),l("li",null,[l("a",{onClick:s[3]||(s[3]=a=>e(_(R)().endOf("week").startOf("day").format()))}," This weekend ")]),s[4]||(s[4]=l("li",null,null,-1))])]),_:3}))}}),he=se($e,[["__scopeId","data-v-0e68afd4"]]),Me={class:"menu"},Ve=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(f){const t=j(f,"modelValue");return(e,n)=>(k(),P(X,null,{default:$(({handler:s,setRef:a})=>[B(e.$slots,"default",{handler:s,setRef:a})]),body:$(()=>[l("ul",Me,[l("li",null,[l("a",{onClick:n[0]||(n[0]=S(s=>t.value=0,["prevent"]))},n[3]||(n[3]=[l("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),l("span",null,"Without priority",-1)]))]),l("li",null,[l("a",{onClick:n[1]||(n[1]=S(s=>t.value=1,["prevent"]))},n[4]||(n[4]=[l("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),l("span",null,"Normal",-1)]))]),l("li",null,[l("a",{onClick:n[2]||(n[2]=S(s=>t.value=2,["prevent"]))},n[5]||(n[5]=[l("i",{class:"fas fa-star",style:{color:"red"}},null,-1),l("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Se={key:1},Ee={key:2},Pe=["onClick"],Ne={key:4},Be=["onClick"],Re=V({__name:"TaskListItemPopupMenu",props:ne({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const t=f,e=j(f,"modelValue"),n=ae(null);{const s=re(()=>ue(()=>import("./TaskListItemPopupMenuWhere-eCq010Jo.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));n.value=s}return(s,a)=>(k(),L("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:a[3]||(a[3]=S(()=>{},["prevent"]))},[t.isFocused?(k(),P(he,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value.due_date=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,onClick:S(o,["prevent"])},a[4]||(a[4]=[l("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):h("",!0),e.value.due_datetime?(k(),L("div",Se,M(_(oe)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(k(),L("div",Ee,M(_(R)(e.value.due_date).format("LL")),1)):h("",!0),t.isFocused||e.value.priority?(k(),P(Ve,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":a[1]||(a[1]=o=>e.value.priority=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,style:le(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:S(o,["prevent"])},a[5]||(a[5]=[l("i",{class:"fas fa-star"},null,-1)]),12,Pe)]),_:1},8,["modelValue"])):h("",!0),e.value.location_id?(k(),L("div",Ne," Location: "+M(e.value.location_id),1)):h("",!0),t.isFocused&&n.value?(k(),P(ie(n.value),{key:5,modelValue:e.value.location_id,"onUpdate:modelValue":a[2]||(a[2]=o=>e.value.location_id=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,onClick:S(o,["prevent"])},a[6]||(a[6]=[l("i",{class:"fas fa-map-pin"},null,-1)]),8,Be)]),_:1},8,["modelValue"])):h("",!0)],32))}}),Oe=V({__name:"TaskListItemInfoLink",props:{task:{}},setup(f){const t=f,e=de(),n=s=>{var o,w;const a=(w=(o=e.currentRoute.value.matched.find(y=>{var i;return(i=y.meta)==null?void 0:i.isListView}))==null?void 0:o.children.find(y=>{var i;return(i=y.meta)==null?void 0:i.isTaskInfoView}))==null?void 0:w.name;a?e.push({name:a,params:{taskId:s}}):console.error("Cant find `taskInfo` route")};return(s,a)=>(k(),L("a",{onClick:a[0]||(a[0]=S(o=>n(t.task.id),["prevent"]))},a[1]||(a[1]=[l("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),He={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},Fe={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},Ue={class:"tw-flex-auto"},qe={class:"hint"},We={class:"hint"},Ke={class:"hint"},je=["contenteditable","placeholder","data-id","textContent"],ze={key:1},Ae=V({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","insertMany","blur","complete"],setup(f,{emit:t}){const e=f,n=t,s=K(z),a=K(ce),o=H(!1);let w=!1;const y=["name","due_date","due_datetime","priority","location_id"];let i={};const d=H({});let g;q([()=>e.task,()=>e.addableProps],async([v])=>{g&&g(),i=F.pick(v,y),d.value={...i},g=q(d,async()=>{const u=F.reduce(d.value,(x,T,m)=>F.isEqual(T,i[m])?x:[...x,m],[]);u.length&&n("update",e.task,F.pick(d.value,u))},{deep:!0})},{immediate:!0});const r=async v=>{w||(v.target instanceof HTMLElement&&(v.target.innerText=v.target.innerText.trim(),d.value.name=v.target.innerText),n("blur",e.task,d.value))},p=v=>{var m;v.preventDefault();const{innerText:u}=v.target,x=(m=v.clipboardData)==null?void 0:m.getData("text/plain"),T=x==null?void 0:x.split(`
`);if(T!=null&&T.length){document.execCommand("insertText",!1,T[0]);const I=T.slice(1);I.length&&!u&&n("insertMany",e.task,I.map(C=>({name:C,...e.addableProps})))}},c=v=>{v.target instanceof HTMLElement&&O(v.target)===0&&(w=!0,s==null||s.onLeft(v,v.target.innerText.trim()),n("delete",e.task,d.value))},b=async v=>{if(v.preventDefault(),v.target instanceof HTMLElement){const u=v.target,x=u.innerText.trim(),T=O(u),m={};T!==0&&(m.currentName=x.substring(0,T).trim(),m.newName=x.substring(T,x.length).trim(),u.innerText=m.currentName,U(u)),n("insert",e.task,{...d.value,...e.addableProps},m)}},D=()=>{n("complete",e.task,d.value)};return(v,u)=>{var x,T;return k(),L("div",He,[e.sortable?(k(),L("div",Fe,u[7]||(u[7]=[l("i",{class:"fas fa-grip-vertical"},null,-1)]))):h("",!0),l("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:D},[l("div",{class:fe(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),l("div",Ue,[(x=_(a))!=null&&x.is_debug_mode?(k(),L(Z,{key:0},[l("span",qe,"id: "+M(e.task.id),1),u[8]||(u[8]=W(" | ")),l("span",We,"prev_id: "+M(String(e.task.prev_item_id)),1),u[9]||(u[9]=W(" | ")),l("span",Ke,"srank: "+M(String(e.task.sort))+" | "+M(String(e.task.rank)),1)],64)):h("",!0),l("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[N(b,["enter"]),u[0]||(u[0]=N((...m)=>{var I,C;return((I=_(s))==null?void 0:I.onLeft)&&((C=_(s))==null?void 0:C.onLeft(...m))},["left"])),u[1]||(u[1]=N((...m)=>{var I,C;return((I=_(s))==null?void 0:I.onUp)&&((C=_(s))==null?void 0:C.onUp(...m))},["up"])),u[2]||(u[2]=N((...m)=>{var I,C;return((I=_(s))==null?void 0:I.onRight)&&((C=_(s))==null?void 0:C.onRight(...m))},["right"])),u[3]||(u[3]=N((...m)=>{var I,C;return((I=_(s))==null?void 0:I.onDown)&&((C=_(s))==null?void 0:C.onDown(...m))},["down"])),N(c,["delete"])],onBlur:r,onFocus:u[4]||(u[4]=m=>o.value=!0),onFocusout:u[5]||(u[5]=m=>o.value=!1),onPaste:p,textContent:M(e.task.name)},null,40,je),E(Re,{modelValue:d.value,"onUpdate:modelValue":u[6]||(u[6]=m=>d.value=m),"is-focused":o.value},null,8,["modelValue","is-focused"])]),(T=e.task.extended_data)!=null&&T.comments_count?(k(),L("div",ze,[u[10]||(u[10]=l("i",{class:"far fa-comment"},null,-1)),W(" "+M(e.task.extended_data.comments_count),1)])):h("",!0),e.showInfoLink?(k(),P(Oe,{key:2,class:"tw-hidden group-hover:tw-block",task:v.task},null,8,["task"])):h("",!0)])}}}),Ge=V({__name:"ListNavigationProvider",setup(f){const t=H();return me(z,xe(t)),(e,n)=>(k(),L("div",{ref_key:"navigatableRef",ref:t},[B(e.$slots,"default")],512))}}),Je=V({__name:"TaskListItemStoreProvider",setup(f){const t=K(z),e=A(),n=i=>e.completeTask(i),s=(i,d)=>e.updateItem(i,d),a=async(i,d,g)=>{if(!g.currentName)await e.insert("before",i,{...d,name:g.newName});else{const r=await e.insert("after",i,{...d,name:g.newName});r&&(t==null||t.focusTaskById(r.id))}},o=async(i,d)=>{let g;for(let r=0;r<d.length;r++)g=await e.insert("after",g??i,d[r]),r===d.length-1?g&&(t==null||t.focusTaskById(g.id,!0)):g&&y(g)},w=i=>e.deleteItem(i),y=i=>{pe(i)&&(i.name?e.updateItem(i,{client_touch_datetime:ee()}):e.deleteItem(i))};return(i,d)=>B(i.$slots,"default",{onComplete:n,onUpdate:s,onInsert:a,onInsertMany:o,onDelete:w,onBlur:y})}}),Ye=V({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(f,{emit:t}){const e=f,n=t,s=H(null),{stop:a}=ve(s,([{isIntersecting:o}])=>{o&&!e.disabled&&n("intersecting")},{rootMargin:"100px"});return ke(()=>{a()}),(o,w)=>(k(),L("div",{ref_key:"elRef",ref:s,class:"tw-min-h-2"},[B(o.$slots,"default")],512))}}),Qe=V({__name:"TaskListLazyLoadFetcher",props:{listId:{},filter:{},locationId:{}},setup(f){const t=f,e=we(),n=A(),s=H(!1),a=G(()=>{var i;return t.listId?n.getTasksInList(t.listId):t.filter?((i=n.getItemsByFilterName(t.filter))==null?void 0:i.value)||[]:t.locationId?n.getTasksInLocation(t.locationId)||[]:[]}),o=G(()=>{if(t.listId)return{list_id:t.listId,filter:void 0};if(t.filter)return{filter:t.filter,list_id:void 0};if(t.locationId)return{location_id:t.locationId,filter:void 0}}),w=async()=>{if(o.value){const i=await ge(o.value);if(i){const d=i.timestamp;_e()>d&&(await n[t.filter?"fetchStreamAll":"fetchAll"]({...o.value,starting_from:ee(new Date(d))}),J(o.value,Date.now()))}}};q(e,async()=>{e.value&&(await w(),s.value=!0)},{immediate:!0});const y=async()=>{if(o.value){const i=await n[t.filter?"fetchStream":"fetch"]({...o.value,offset:a.value.length});i&&i.status_code==="ok"&&J(o.value,Date.now())}};return(i,d)=>(k(),L(Z,null,[B(i.$slots,"default",{tasks:a.value}),s.value?(k(),P(Ye,{key:0,onIntersecting:y})):h("",!0)],64))}}),Xe={class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},Ze={key:0,class:"lg:tw-hidden tw-mb-4"},et={class:"tw-m-0"},at=V({__name:"TaskList",props:{listId:{},filter:{},locationId:{},addableProps:{}},setup(f){const t=f,e=ye(),n=A(),s=async()=>{const a=await n.insertDummy({...t.addableProps});a&&Te(()=>n.items,async()=>{await Ie();const o=document.querySelector(`[contenteditable][data-id="${a.id}"]`);o instanceof HTMLElement&&o.focus()})};return q(Y.currentRoute,a=>{const o={...a.query};"addNewTask"in o&&(s(),delete o.addNewTask,Y.replace({path:a.path,query:o}))},{immediate:!0}),(a,o)=>{const w=be("RouterLink");return k(),L("div",Xe,[t.listId?(k(),L("div",Ze,[E(w,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:$(()=>{var y;return[o[0]||(o[0]=l("i",{class:"fas fa-chevron-left gray"},null,-1)),l("h3",et,M((y=_(e).getItemById(t.listId))==null?void 0:y.name),1)]}),_:1})])):h("",!0),l("div",{class:"tw-mb-4",onClick:s}," + New To-Do "),E(Ge,null,{default:$(()=>[E(Qe,{"list-id":t.listId,filter:t.filter,"location-id":t.locationId},{default:$(({tasks:y})=>[E(Le,{"sortable-list-id":t.listId,"sortable-group-name":"tasks",items:y,onSort:_(n).sort},{default:$(({item:i})=>[E(Je,null,{default:$(({onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:c,onBlur:b})=>[E(Ae,{task:i,sortable:!!t.listId,editable:!0,"addable-props":t.addableProps,"show-info-link":!0,onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:c,onBlur:b},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onInsertMany","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["sortable-list-id","items","onSort"])]),_:1},8,["list-id","filter","location-id"])]),_:1})])}}});export{at as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./TaskListItemPopupMenuWhere-eCq010Jo.js","./index-aLPS7_Q8.js","./index-KrfFgSv5.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-L9rcgxId.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
