import{a8 as te,d as V,a9 as j,o as w,x as E,l as x,E as B,b as i,e as _,P as O,aa as X,_ as se,w as S,ab as ne,a3 as ae,c as L,I as $,t as M,f as oe,Y as le,N as ie,a6 as re,a7 as ue,y as de,U as K,ac as z,ad as fe,r as R,k as q,ae as U,J as ce,F as Z,B as W,n as N,h as P,af as me,i as A,ag as pe,ah as ee,ai as ve,aj as ke,ak as we,j as G,al as ge,am as _e,an as J,G as ye,ao as Y,A as be}from"./index-FRWD2OZN.js";import{m as F,g as H,s as Q}from"./rangy-5rxgwlWZ.js";import{_ as Te}from"./SortableList.vue_vue_type_style_index_0_lang-kigiOvpI.js";function Le(m){let t=[];te(m,()=>{m.value&&(t=[...m.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=r=>t.findIndex(v=>v.isEqualNode(r)),n=r=>t[e(r)-1],s=r=>t[e(r)+1],o=(r,v)=>{if(r){const c=s(r);if(c instanceof HTMLElement)return c.focus(),v&&F(c),c}else{const c=t[0];c instanceof HTMLElement&&c.focus()}},a=(r,v)=>{if(r.target instanceof HTMLElement){const c=r.target,y=H(c),D=v==="up"?n(c):s(c);D instanceof HTMLElement&&(r.preventDefault(),D.focus(),Q(D,y))}};return{getPreviousElementSibling:n,getNextElementSibling:s,getCurrentPositionInNavigationList:e,focusNextTask:o,focusTaskById:(r,v)=>{const c=t.find(y=>{var D;return y instanceof HTMLElement&&((D=y.dataset)==null?void 0:D.id)==r});c instanceof HTMLElement&&(c.focus(),v&&F(c))},onUp:r=>{a(r,"up")},onDown:r=>{a(r,"down")},onLeft:(r,v)=>{if(r.target instanceof HTMLElement){const c=r.target;if(H(c)===0){const y=n(c);y instanceof HTMLElement&&(r.preventDefault(),v&&(y.innerText+=v),y.focus(),F(y),v&&Q(y,y.innerText.length-v.length))}}},onRight:r=>{if(r.target instanceof HTMLElement){const v=r.target;if(H(v)===v.innerText.length){const c=s(v);c instanceof HTMLElement&&(r.preventDefault(),c.focus())}}}}}const Ie={class:"menu"},he=V({__name:"TaskListItemPopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(m){const t=j(m,"modelValue"),e=n=>{t.value=n};return(n,s)=>(w(),E(X,null,{default:x(({handler:o,setRef:a})=>[B(n.$slots,"default",{handler:o,setRef:a},void 0,!0)]),body:x(()=>[i("ul",Ie,[i("li",null,[i("a",{onClick:s[0]||(s[0]=o=>e(_(O)().startOf("day").format()))}," Today ")]),i("li",null,[i("a",{onClick:s[1]||(s[1]=o=>e(_(O)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),i("li",null,[i("a",{onClick:s[2]||(s[2]=o=>e(_(O)().add(2,"day").startOf("day").format()))}," In 2 days ")]),i("li",null,[i("a",{onClick:s[3]||(s[3]=o=>e(_(O)().endOf("week").startOf("day").format()))}," This weekend ")]),s[4]||(s[4]=i("li",null,null,-1))])]),_:3}))}}),Ce=se(he,[["__scopeId","data-v-0e68afd4"]]),xe={class:"menu"},$e=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(m){const t=j(m,"modelValue");return(e,n)=>(w(),E(X,null,{default:x(({handler:s,setRef:o})=>[B(e.$slots,"default",{handler:s,setRef:o})]),body:x(()=>[i("ul",xe,[i("li",null,[i("a",{onClick:n[0]||(n[0]=S(s=>t.value=0,["prevent"]))},n[3]||(n[3]=[i("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),i("span",null,"Without priority",-1)]))]),i("li",null,[i("a",{onClick:n[1]||(n[1]=S(s=>t.value=1,["prevent"]))},n[4]||(n[4]=[i("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),i("span",null,"Normal",-1)]))]),i("li",null,[i("a",{onClick:n[2]||(n[2]=S(s=>t.value=2,["prevent"]))},n[5]||(n[5]=[i("i",{class:"fas fa-star",style:{color:"red"}},null,-1),i("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Me={key:1},Ve={key:2},Se=["onClick"],Pe={key:4},Ee=["onClick"],Ne=V({__name:"TaskListItemPopupMenu",props:ne({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const t=m,e=j(m,"modelValue"),n=ae(null);{const s=re(()=>ue(()=>import("./TaskListItemPopupMenuWhere-7Qy2phJE.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));n.value=s}return(s,o)=>(w(),L("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:o[3]||(o[3]=S(()=>{},["prevent"]))},[t.isFocused?(w(),E(Ce,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.due_date=a)},{default:x(({handler:a,setRef:f})=>[i("a",{ref:f,onClick:S(a,["prevent"])},o[4]||(o[4]=[i("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):$("",!0),e.value.due_datetime?(w(),L("div",Me,M(_(oe)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(w(),L("div",Ve,M(_(O)(e.value.due_date).format("LL")),1)):$("",!0),t.isFocused||e.value.priority?(w(),E($e,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.priority=a)},{default:x(({handler:a,setRef:f})=>[i("a",{ref:f,style:le(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:S(a,["prevent"])},o[5]||(o[5]=[i("i",{class:"fas fa-star"},null,-1)]),12,Se)]),_:1},8,["modelValue"])):$("",!0),e.value.location_id?(w(),L("div",Pe," Location: "+M(e.value.location_id),1)):$("",!0),t.isFocused&&n.value?(w(),E(ie(n.value),{key:5,modelValue:e.value.location_id,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.location_id=a)},{default:x(({handler:a,setRef:f})=>[i("a",{ref:f,onClick:S(a,["prevent"])},o[6]||(o[6]=[i("i",{class:"fas fa-map-pin"},null,-1)]),8,Ee)]),_:1},8,["modelValue"])):$("",!0)],32))}}),Re=V({__name:"TaskListItemInfoLink",props:{task:{}},setup(m){const t=m,e=de(),n=s=>{var a,f;const o=(f=(a=e.currentRoute.value.matched.find(I=>{var l;return(l=I.meta)==null?void 0:l.isListView}))==null?void 0:a.children.find(I=>{var l;return(l=I.meta)==null?void 0:l.isTaskInfoView}))==null?void 0:f.name;o?e.push({name:o,params:{taskId:s}}):console.error("Cant find `taskInfo` route")};return(s,o)=>(w(),L("a",{onClick:o[0]||(o[0]=S(a=>n(t.task.id),["prevent"]))},o[1]||(o[1]=[i("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),Be={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},Oe={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},He={class:"tw-flex-auto"},Ue={class:"hint"},Fe={class:"hint"},qe={class:"hint"},We=["contenteditable","placeholder","data-id","textContent"],Ke={key:1},je=V({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","insertMany","blur","complete"],setup(m,{emit:t}){const e=m,n=t,s=K(z),o=K(fe),a=R(!1);let f=!1;const I=["name","due_date","due_datetime","priority","location_id"];let l={};const d=R({});let g;q([()=>e.task,()=>e.addableProps],async([k])=>{g&&g(),l=U.pick(k,I),d.value={...l},g=q(d,async()=>{const u=U.reduce(d.value,(h,b,p)=>U.isEqual(b,l[p])?h:[...h,p],[]);u.length&&n("update",e.task,U.pick(d.value,u))},{deep:!0})},{immediate:!0});const r=async k=>{f||(k.target instanceof HTMLElement&&(k.target.innerText=k.target.innerText.trim(),d.value.name=k.target.innerText),n("blur",e.task,d.value))},v=k=>{var p;k.preventDefault();const{innerText:u}=k.target,h=(p=k.clipboardData)==null?void 0:p.getData("text/plain"),b=h==null?void 0:h.split(`
`);if(b!=null&&b.length){document.execCommand("insertText",!1,b[0]);const T=b.slice(1);T.length&&!u&&n("insertMany",e.task,T.map(C=>({name:C,...e.addableProps})))}},c=k=>{k.target instanceof HTMLElement&&H(k.target)===0&&(f=!0,s==null||s.onLeft(k,k.target.innerText.trim()),n("delete",e.task,d.value))},y=async k=>{if(k.preventDefault(),k.target instanceof HTMLElement){const u=k.target,h=u.innerText.trim(),b=H(u),p={};b!==0&&(p.currentName=h.substring(0,b).trim(),p.newName=h.substring(b,h.length).trim(),u.innerText=p.currentName,F(u)),n("insert",e.task,{...d.value,...e.addableProps},p)}},D=()=>{n("complete",e.task,d.value)};return(k,u)=>{var h,b;return w(),L("div",Be,[e.sortable?(w(),L("div",Oe,u[7]||(u[7]=[i("i",{class:"fas fa-grip-vertical"},null,-1)]))):$("",!0),i("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:D},[i("div",{class:ce(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),i("div",He,[(h=_(o))!=null&&h.is_debug_mode?(w(),L(Z,{key:0},[i("span",Ue,"id: "+M(e.task.id),1),u[8]||(u[8]=W(" | ")),i("span",Fe,"prev_id: "+M(String(e.task.prev_item_id)),1),u[9]||(u[9]=W(" | ")),i("span",qe,"srank: "+M(String(e.task.sort))+" | "+M(String(e.task.rank)),1)],64)):$("",!0),i("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[N(y,["enter"]),u[0]||(u[0]=N((...p)=>{var T,C;return((T=_(s))==null?void 0:T.onLeft)&&((C=_(s))==null?void 0:C.onLeft(...p))},["left"])),u[1]||(u[1]=N((...p)=>{var T,C;return((T=_(s))==null?void 0:T.onUp)&&((C=_(s))==null?void 0:C.onUp(...p))},["up"])),u[2]||(u[2]=N((...p)=>{var T,C;return((T=_(s))==null?void 0:T.onRight)&&((C=_(s))==null?void 0:C.onRight(...p))},["right"])),u[3]||(u[3]=N((...p)=>{var T,C;return((T=_(s))==null?void 0:T.onDown)&&((C=_(s))==null?void 0:C.onDown(...p))},["down"])),N(c,["delete"])],onBlur:r,onFocus:u[4]||(u[4]=p=>a.value=!0),onFocusout:u[5]||(u[5]=p=>a.value=!1),onPaste:v,textContent:M(e.task.name)},null,40,We),P(Ne,{modelValue:d.value,"onUpdate:modelValue":u[6]||(u[6]=p=>d.value=p),"is-focused":a.value},null,8,["modelValue","is-focused"])]),(b=e.task.extended_data)!=null&&b.comments_count?(w(),L("div",Ke,[u[10]||(u[10]=i("i",{class:"far fa-comment"},null,-1)),W(" "+M(e.task.extended_data.comments_count),1)])):$("",!0),e.showInfoLink?(w(),E(Re,{key:2,class:"tw-hidden group-hover:tw-block",task:k.task},null,8,["task"])):$("",!0)])}}}),ze=V({__name:"ListNavigationProvider",setup(m){const t=R();return me(z,Le(t)),(e,n)=>(w(),L("div",{ref_key:"navigatableRef",ref:t},[B(e.$slots,"default")],512))}}),Ae=V({__name:"TaskListItemStoreProvider",setup(m){const t=K(z),e=A(),n=l=>e.completeTask(l),s=(l,d)=>e.updateItem(l,d),o=async(l,d,g)=>{if(!g.currentName)await e.insert("before",l,{...d,name:g.newName});else{const r=await e.insert("after",l,{...d,name:g.newName});r&&(t==null||t.focusTaskById(r.id))}},a=async(l,d)=>{let g;for(let r=0;r<d.length;r++)g=await e.insert("after",g??l,d[r]),r===d.length-1?g&&(t==null||t.focusTaskById(g.id,!0)):g&&I(g)},f=l=>e.deleteItem(l),I=l=>{pe(l)&&(l.name?e.updateItem(l,{client_touch_datetime:ee()}):e.deleteItem(l))};return(l,d)=>B(l.$slots,"default",{onComplete:n,onUpdate:s,onInsert:o,onInsertMany:a,onDelete:f,onBlur:I})}}),Ge=V({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(m,{emit:t}){const e=m,n=t,s=R(null),{stop:o}=ve(s,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"100px"});return ke(()=>{o()}),(a,f)=>(w(),L("div",{ref_key:"elRef",ref:s,class:"tw-min-h-2"},[B(a.$slots,"default")],512))}}),Je=V({__name:"TaskListLazyLoadFetcher",props:{listId:{},filter:{},fetchDisabled:{type:Boolean}},setup(m){const t=m,e=we(),n=A(),s=R(!1),o=G(()=>{var l;return t.listId?n.getTasksInList(t.listId):t.filter?((l=n.getItemsByFilterName(t.filter))==null?void 0:l.value)||[]:[]}),a=G(()=>{if(t.listId)return{list_id:t.listId,filter:void 0};if(t.filter)return{filter:t.filter,list_id:void 0}}),f=async()=>{if(!t.fetchDisabled&&a.value){const l=await ge(a.value);if(l){const d=l.timestamp;_e()>d&&(await n[t.listId?"fetchAll":"fetchStreamAll"]({...a.value,starting_from:ee(new Date(d))}),J(a.value,Date.now()))}}};q(e,async()=>{e.value&&(await f(),s.value=!0)},{immediate:!0});const I=async()=>{if(!t.fetchDisabled&&a.value){const l=await n[t.listId?"fetch":"fetchStream"]({...a.value,offset:o.value.length});l&&l.status_code==="ok"&&J(a.value,Date.now())}};return(l,d)=>(w(),L(Z,null,[B(l.$slots,"default",{tasks:o.value}),s.value?(w(),E(Ge,{key:0,onIntersecting:I})):$("",!0)],64))}}),Ye={key:0,class:"lg:tw-hidden tw-mb-4"},Qe={class:"tw-m-0"},tt=V({__name:"TaskList",props:{listId:{},filter:{},addableProps:{}},setup(m){const t=m,e=ye(),n=A(),s=R(),o=async()=>{const a=await n.insertDummy({...t.addableProps});if(a){const f=document.querySelector(`[contenteditable][data-id="${a.id}"]`);f instanceof HTMLElement&&f.focus()}};return q(Y.currentRoute,a=>{const f={...a.query};"addNewTask"in f&&(o(),delete f.addNewTask,Y.replace({path:a.path,query:f}))},{immediate:!0}),(a,f)=>{const I=be("RouterLink");return w(),L("div",{ref_key:"navigatableRef",ref:s,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},[t.listId?(w(),L("div",Ye,[P(I,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:x(()=>{var l;return[f[0]||(f[0]=i("i",{class:"fas fa-chevron-left gray"},null,-1)),i("h3",Qe,M((l=_(e).getItemById(t.listId))==null?void 0:l.name),1)]}),_:1})])):$("",!0),i("div",{class:"tw-mb-4",onClick:o}," + New To-Do "),P(ze,null,{default:x(()=>[P(Je,{"list-id":t.listId,filter:t.filter,"fetch-disabled":!1},{default:x(({tasks:l})=>[P(Te,{"sortable-list-id":t.listId,"sortable-group-name":"tasks",items:l,onSort:_(n).sort},{default:x(({item:d})=>[P(Ae,null,{default:x(({onUpdate:g,onComplete:r,onInsert:v,onInsertMany:c,onDelete:y,onBlur:D})=>[P(je,{task:d,sortable:!!t.listId,editable:!0,"addable-props":t.addableProps,"show-info-link":!0,onUpdate:g,onComplete:r,onInsert:v,onInsertMany:c,onDelete:y,onBlur:D},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onInsertMany","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["sortable-list-id","items","onSort"])]),_:1},8,["list-id","filter"])]),_:1})],512)}}});export{tt as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./TaskListItemPopupMenuWhere-7Qy2phJE.js","./index-FRWD2OZN.js","./index-yni2lSK1.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-y2MMR-IT.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
