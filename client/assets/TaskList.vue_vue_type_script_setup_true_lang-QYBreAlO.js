import{d as Ee,_ as Be,t as he,a as Ne,b as Ae,e as Ce,u as Re}from"./textToHtmlWithLinks-_HWS3l1C.js";import{r as $,ad as Ue,m as z,ae as B,d as x,a6 as Oe,c as D,af as He,o as i,e as c,j as _,D as ke,t as w,g,n as R,k as ze,L as H,f as k,K as U,A as ve,G as ae,y as Z,ag as V,ah as me,a7 as Ie,ai as ie,aj as qe,ak as We,al as Te,am as je,an as Ke,ao as Ve,ap as Qe,aq as Ze,ar as Je,as as Xe,B as j,F as q,x as ee,i as J,u as Ye,a3 as Ge,h as M,q as F,at as et,R as tt,U as st,Q as at,au as nt,av as _e,aw as re,p as ot,M as $e,s as xe,w as W,ax as lt,ay as Se,az as it,aA as rt,l as ut,aB as ct,S as te,aC as dt,aD as ft,aE as pt,H as mt,aF as ye,aG as ge,z as kt,aH as vt,v as ht,W as _t}from"./index-oYoCgmil.js";import{m as ue,g as G,a as yt,s as we}from"./sanitizer-TiisBOmJ.js";import{_ as gt}from"./SortableList.vue_vue_type_style_index_0_lang-lYx1unUm.js";function wt(s){const t=$([]),e=new Set;Ue(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),z(t,()=>{for(const[m]of e.entries())typeof m=="function"&&m(),e.delete(m)});const n=m=>{e.add(m)},d=m=>t.value.findIndex(p=>p.isEqualNode(m)),l=m=>t.value[d(m)-1],a=m=>t.value[d(m)+1],o=(m,p)=>{if(m){const u=a(m);if(u instanceof HTMLElement)return u.focus(),p&&ue(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},r=(m,p,u)=>{if(m.target instanceof HTMLElement){const v=m.target,I=G(v),S=p==="up"?l(v):a(v);S instanceof HTMLElement&&(m.preventDefault(),S.focus(),yt(S,I),typeof u=="function"&&u())}};return{getPreviousElementSibling:l,getNextElementSibling:a,getCurrentPositionInNavigationList:d,focusNextTask:o,focusTaskById:(m,p)=>{const u=t.value.find(v=>{var I;return v instanceof HTMLElement&&((I=v.dataset)==null?void 0:I.id)==m});u instanceof HTMLElement&&(u.focus(),p&&ue(u))},onUp:(m,p)=>{r(m,"up",p)},onDown:(m,p)=>{r(m,"down",p)},onLeft:(m,p)=>{if(m.target instanceof HTMLElement){const u=m.target;if(G(u)===0){const v=l(u);v instanceof HTMLElement&&(m.preventDefault(),v.focus(),ue(v),typeof p=="function"&&p())}}},onRight:(m,p)=>{if(m.target instanceof HTMLElement){const u=m.target;if(G(u)===u.innerText.length){const v=a(u);v instanceof HTMLElement&&(m.preventDefault(),v.focus(),typeof p=="function"&&p())}}},nextUpdate:n}}const bt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},Lt={class:"flexbox space-8 middle smaller empty:tw-hidden"},Ct={key:4},It=x({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Oe(),{currentLabel:e}=Ee(()=>s.task),n=D(()=>He(s.task)),d=D(()=>({"text-red":n.value===3,"text-yellow":n.value===2,"text-green":n.value===1,grey:n.value===0}));return(l,a)=>{var o;return i(),c("div",Lt,[_(e)?(i(),c("div",{key:0,class:"badge squared",style:ke(`background: #${_(e).color};`)},w(_(e).name),5)):g("",!0),l.task.due_datetime&&!l.task.status?(i(),c("div",{key:1,class:R(["semibold",d.value])},w(_(ze)(l.task.due_datetime).format("LLL")),3)):l.task.due_date&&!l.task.status?(i(),c("div",{key:2,class:R(["semibold",d.value])},w(_(H)(l.task.due_date).format("LL")),3)):g("",!0),l.task.due_date&&l.task.repeat_frequency&&l.task.repeat_interval?(i(),c("div",{key:3,class:R(d.value)},[a[0]||(a[0]=k("i",{class:"fas fa-redo text-light-gray"},null,-1)),U(" "+w(l.$t(`everyX.${l.task.repeat_interval}`,{n:l.task.repeat_frequency,days:l.$t(l.task.repeat_interval,{count:l.task.repeat_frequency})})),1)],2)):g("",!0),l.task.location_id?(i(),c("div",Ct,[a[1]||(a[1]=k("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),U(" "+w((o=_(t).getItemById(l.task.location_id))==null?void 0:o.name)+" "+w(_(bt)(_(t).distanceById(l.task.location_id))),1)])):g("",!0)])}}}),Tt={class:"icon"},$t=["src"],xt=x({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=ve(),e=ae(),n=D(()=>!t.currentRoute.value.params.listId),d=D(()=>s.task.list_id&&n.value?e.itemsMap[s.task.list_id]:null),l=()=>{if(!d.value)return;const a=t.resolve({name:"list",params:{listId:d.value.id}});window.open(a.href,"_blank")};return(a,o)=>(i(),c("div",{class:R(["flexbox middle",{"space-12":!a.isFocused}])},[a.isFocused?(i(),Z(Be,{key:0,task:a.task,input:a.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(i(),Z(It,{key:1,task:a.task},null,8,["task"])),d.value?(i(),c("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:l},[k("div",Tt,[k("img",{src:d.value.icon_url,loading:"lazy"},null,8,$t)]),U(" "+w(d.value.name),1)])):g("",!0)],2))}}),Me=Ke?window:void 0;function Y(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Q(...s){const t=[],e=()=>{t.forEach(o=>o()),t.length=0},n=(o,r,f,y)=>(o.addEventListener(r,f,y),()=>o.removeEventListener(r,f,y)),d=D(()=>{const o=ie(B(s[0])).filter(r=>r!=null);return o.every(r=>typeof r!="string")?o:void 0}),l=qe(()=>{var o,r;return[(r=(o=d.value)==null?void 0:o.map(f=>Y(f)))!=null?r:[Me].filter(f=>f!=null),ie(B(d.value?s[1]:s[0])),ie(_(d.value?s[2]:s[1])),B(d.value?s[3]:s[2])]},([o,r,f,y])=>{if(e(),!(o!=null&&o.length)||!(r!=null&&r.length)||!(f!=null&&f.length))return;const C=We(y)?{...y}:y;t.push(...o.flatMap(L=>r.flatMap(T=>f.map(m=>n(L,T,m,C)))))},{flush:"post"}),a=()=>{l(),e()};return Te(e),a}let be=!1;function Le(s,t,e={}){const{window:n=Me,ignore:d=[],capture:l=!0,detectIframe:a=!1,controls:o=!1}=e;if(!n)return o?{stop:V,cancel:V,trigger:V}:V;if(me&&!be){be=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(v=>Q(v,"click",V,u)),Q(n.document.documentElement,"click",V,u)}let r=!0;const f=u=>B(d).some(v=>{if(typeof v=="string")return Array.from(n.document.querySelectorAll(v)).some(I=>I===u.target||u.composedPath().includes(I));{const I=Y(v);return I&&(u.target===I||u.composedPath().includes(I))}});function y(u){const v=B(u);return v&&v.$.subTree.shapeFlag===16}function C(u,v){const I=B(u),S=I.$.subTree&&I.$.subTree.children;return S==null||!Array.isArray(S)?!1:S.some(K=>K.el===v.target||v.composedPath().includes(K.el))}const L=u=>{const v=Y(s);if(u.target!=null&&!(!(v instanceof Element)&&y(s)&&C(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(r=!f(u)),!r){r=!0;return}t(u)}};let T=!1;const m=[Q(n,"click",u=>{T||(T=!0,setTimeout(()=>{T=!1},0),L(u))},{passive:!0,capture:l}),Q(n,"pointerdown",u=>{const v=Y(s);r=!f(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),a&&Q(n,"blur",u=>{setTimeout(()=>{var v;const I=Y(s);((v=n.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(I!=null&&I.contains(n.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),p=()=>m.forEach(u=>u());return o?{stop:p,cancel:()=>{r=!1},trigger:u=>{r=!0,L(u),r=!1}}:p}const St={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=Le(s,t.value,{capture:e});else{const[n,d]=t.value;s.__onClickOutside_stop=Le(s,n,Object.assign({capture:e},d))}},unmounted(s){s.__onClickOutside_stop()}};function ce(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function De(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:De(e)}}function Mt(s){const t=s||window.event,e=t.target;return De(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const de=new WeakMap;function Dt(s,t=!1){const e=Ie(t);let n=null,d="";z(je(s),o=>{const r=ce(B(o));if(r){const f=r;if(de.get(f)||de.set(f,f.style.overflow),f.style.overflow!=="hidden"&&(d=f.style.overflow),f.style.overflow==="hidden")return e.value=!0;if(e.value)return f.style.overflow="hidden"}},{immediate:!0});const l=()=>{const o=ce(B(s));!o||e.value||(me&&(n=Q(o,"touchmove",r=>{Mt(r)},{passive:!1})),o.style.overflow="hidden",e.value=!0)},a=()=>{const o=ce(B(s));!o||!e.value||(me&&(n==null||n()),o.style.overflow=d,de.delete(o),e.value=!1)};return Te(a),D({get(){return e.value},set(o){o?l():a()}})}function Pt(){let s=!1;const t=Ie(!1);return(e,n)=>{if(t.value=n.value,s)return;s=!0;const d=Dt(e,n.value);z(t,l=>d.value=l)}}Pt();const Ft=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},Et=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Bt=Ve("syncError",()=>{const s=Qe(Ze(Je(()=>Xe.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:D(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Nt(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const At={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Rt=["href"],Ut=["src"],Ot={class:"bold"},Ht={key:0,class:"hint custom-ml-4 nowrap"},zt=["onClick"],qt=x({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=j(),e=n=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[n])};return(n,d)=>{var l;return(l=n.task.attachments)!=null&&l.length?(i(),c("div",At,[(i(!0),c(q,null,ee(n.task.attachments,a=>(i(),c("div",{key:a.uuid||a.id,class:"pl-attachments__item small"},[k("a",{href:a.download_url,target:"_blank"},[a.preview_url?(i(),c("img",{key:0,src:a.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Ut)):(i(),c(q,{key:1},[k("span",Ot,w(a.file_name),1),a.size?(i(),c("span",Ht,w(_(Nt)(a.size)),1)):g("",!0)],64))],8,Rt),n.isFocused?(i(),c("div",{key:0,class:R(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":a.preview_url}])},[k("a",{class:R(a.preview_url?"button circle white":"custom-ml-8"),onClick:J(o=>e(a.id),["prevent"])},d[0]||(d[0]=[k("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,zt)],2)):g("",!0)]))),128))])):g("",!0)}}}),fe=x({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Ye(),n=D(()=>e.getItemById(t.userId));return(d,l)=>{var a;return(a=n.value)!=null&&a.photo_url?(i(),c("span",{key:0,class:"icon userpic",style:ke({backgroundImage:`url(${n.value.photo_url})`})},null,4)):g("",!0)}}}),Wt={key:0,class:"tw-cursor-pointer"},jt={key:0,class:"pl-list-item-firedBullet"},Kt={key:1,class:"tw-cursor-pointer"},Vt=x({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,n=t,d=$(e.task.status===1);z(()=>e.task.status,o=>{d.value=o===1});const l=D(()=>Ge(e.task)),a=()=>{d.value=!d.value,n("complete")};return(o,r)=>(i(),c("div",{class:"tw-w-5 tw-flex-none",onClick:a},[M(st,{name:"bounce",mode:"out-in"},{default:F(()=>{var f;return[d.value?(i(),c("div",Kt,r[0]||(r[0]=[k("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(i(),c("div",Wt,[l.value===_(et)?(i(),c("div",jt)):(i(),c("div",{key:1,class:"pl-list-item-bullet",style:ke(`background-color: ${(f=_(tt).get(l.value))==null?void 0:f.color}`)},null,4))]))]}),_:1})]))}}),Qt=new WeakMap;function Zt(){const s=at(),t=ve(),e=()=>{var r;const l=[...s.matched].reverse().find(f=>{var y;return(y=f.meta)==null?void 0:y.isListView})||null,a=((r=l==null?void 0:l.children)==null?void 0:r.find(f=>{var y;return(y=f.meta)==null?void 0:y.isTaskInfoView}))||null,o={listViewRoute:l,taskInfoRoute:a};return Qt.set(s,o),o};return{navigateToTaskInfo:async d=>{const{listViewRoute:l,taskInfoRoute:a}=e();if(!l||!(a!=null&&a.name))return console.warn("Required routes not found"),!1;try{const o=await t.push({name:a.name,params:{taskId:d}});return!nt(o)}catch(o){return console.error("Navigation failed:",o),!1}}}}const Jt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Xt={class:"hint"},Yt={class:"hint"},Gt={class:"hint"},es={class:"tw-clear-both tw-inline-block"},ts=["placeholder","data-id","innerHTML"],ss=["innerHTML"],as={class:"flexbox space-8 custom-pt-2 tw-flex-none"},ns={key:0},os={key:1},ls={key:2,class:"tw-flex-none"},is=["title"],rs=["title"],us={class:"bold small"},cs={key:5,class:"hint tw-flex-none custom-mt-2"},ds={key:6,class:"hint tw-flex-none custom-mt-2"},fs={key:0},ps={key:1},ms={key:7,class:"hint tw-flex-none custom-mt-2"},ks={key:8,class:"flexbox middle tw-flex-none"},vs={key:9,class:"flexbox middle tw-flex-none"},hs={key:10,class:"flexbox middle tw-flex-none"},_s={key:11,class:"flexbox middle space-4 tw-flex-none"},ys=["href"],gs=["src"],ws=x({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,n=t,d=j(),l=Bt(),{navigateToTaskInfo:a}=Zt(),o=_e(Se),r=_e(it),f=$(!1),y=$(!1),C=$(e.task.name),L=$(e.task.status);z(()=>e.task.status,b=>{L.value=b});const T=$();let m=null;z(f,()=>{if(f.value)return;const b=T.value.innerText.trim();if(re(e.task)&&!b){y.value=!0,n("delete",e.task);return}e.task.name!==b&&n("update",e.task,{name:b})}),ot(()=>{re(e.task)&&(T.value.focus(),f.value=!0)}),$e(()=>{m&&(clearTimeout(m),m=null)});const p=()=>{rt()||(f.value=!1)},u=()=>{n("complete",e.task)},v=()=>{L.value=L.value?0:1,T.value.classList.toggle("opacity-50"),!(m&&(clearTimeout(m),m=null,e.task.status===L.value))&&(m=setTimeout(u,1e3))},I=b=>{if(b.target instanceof HTMLAnchorElement){const h=b.target.href;b.preventDefault(),setTimeout(()=>{window.open(h,"_blank")})}},S=b=>{var O;b.preventDefault();const h=(O=b.clipboardData)==null?void 0:O.getData("text/plain");if(!h)return;if(T.value.innerText){document.execCommand("insertText",!1,h);return}const N=h.split(`
`).filter(A=>A);N.length&&n("insertMany",e.task,N.map(A=>({name:Ft(A),...e.addableProps,...Et(A)?{status:1}:{}})))},K=b=>{G(b.target)===0&&(o==null||o.onLeft(b),y.value=!0,n("delete",e.task))},ne=async b=>{if(b.shiftKey)return;if(b.preventDefault(),e.isEnterDisabled){oe(!0),await ut(),n("insertFirst",{...e.addableProps});return}const h=b.target,N=h.innerText.trim(),O=G(h);let A="",X=!0;O===0&&N||(h.innerText=N.substring(0,O).trim(),A=N.substring(O,N.length).trim(),X=!1),n("insert",e.task,{...e.addableProps,name:A},{isBefore:X}),oe()},se=b=>{C.value=b.target.innerText};function oe(b=!1){const h=()=>{T.value.blur(),f.value=!1};if(b){h();return}setTimeout(()=>{h()})}const Pe=()=>{n("update",e.task,{favorite:e.task.favorite?0:1})},le=async b=>{b.target.closest("[contenteditable], .chips li, a")===null&&await a(e.task.id)};function Fe(b){return new URL(Object.assign({"../../assets/apps/shop.svg":Ne,"../../assets/apps/tasks.svg":Ae})[`../../assets/apps/${b}.svg`],import.meta.url).href}return(b,h)=>{var N,O,A,X;return y.value?g("",!0):(i(),c("div",{key:0,class:R(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":b.$route.meta.isTaskInfoView&&((N=b.$route.params)==null?void 0:N.taskId)==e.task.id,highlighted:_(d).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(i(),c("div",Jt,h[7]||(h[7]=[k("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):g("",!0),M(Vt,{task:e.task,onComplete:v},null,8,["task"]),k("div",{class:"tw-flex-auto",onClick:le},[(O=_(r))!=null&&O.is_debug_mode?(i(),c(q,{key:0},[k("span",Xt,"list_id: "+w(String(e.task.list_id)),1),h[8]||(h[8]=U(" | ")),k("span",Yt,"id: "+w(e.task.id),1),h[9]||(h[9]=U(" | ")),k("span",Gt,"srank: "+w(String(e.task.sort))+" | "+w(String(e.task.rank)),1)],64)):g("",!0),xe((i(),c("div",null,[k("div",es,[k("div",{ref_key:"contenteditableRef",ref:T,contenteditable:"",class:R(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(ne,["enter"]),h[0]||(h[0]=W(P=>{var E;(E=_(o))==null||E.onLeft(P,()=>{f.value=!1})},["left"])),h[1]||(h[1]=W(P=>{var E;(E=_(o))==null||E.onUp(P,()=>{f.value=!1})},["up"])),h[2]||(h[2]=W(P=>{var E;(E=_(o))==null||E.onRight(P,()=>{f.value=!1})},["right"])),h[3]||(h[3]=W(P=>{var E;(E=_(o))==null||E.onDown(P,()=>{f.value=!1})},["down"])),W(K,["delete"]),h[4]||(h[4]=W(()=>{oe()},["esc"])),h[5]||(h[5]=W(()=>{f.value=!1},["tab"]))],onMousedown:I,onFocus:h[6]||(h[6]=P=>f.value=!0),onPaste:S,onInput:se,innerHTML:_(we)(f.value?e.task.name:_(he)(e.task.name))},null,42,ts)]),e.task.note?(i(),c("div",{key:0,class:"hint break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(we)(_(he)(e.task.note))},null,8,ss)):g("",!0),M(xt,{task:b.task,input:C.value,"is-focused":f.value},null,8,["task","input","is-focused"])])),[[_(St),p]]),M(qt,{task:e.task,"is-focused":f.value},null,8,["task","is-focused"])]),k("div",as,[e.showInfoLink?(i(),c("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:J(le,["prevent"])},h[10]||(h[10]=[k("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):g("",!0),L.value?g("",!0):(i(),c("div",{key:1,class:R(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:Pe},[e.task.favorite?(i(),c("span",ns,h[11]||(h[11]=[k("i",{class:"fas fa-star text-yellow"},null,-1)]))):(i(),c("span",os,h[12]||(h[12]=[k("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(l).taskErrorMap.get(e.task.id)?(i(),c("div",ls,[k("span",{class:"icon",style:{color:"orange"},title:_(l).taskErrorMap.get(e.task.id)},h[13]||(h[13]=[k("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,is)])):g("",!0),!_(lt)(e.task)&&!_(re)(e.task)?(i(),c("div",{key:3,class:"tw-flex-none",title:b.$t("syncing")},h[14]||(h[14]=[k("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,rs)):g("",!0),(A=e.task.extended_data)!=null&&A.comments_count?(i(),c("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:J(le,["prevent"])},[h[15]||(h[15]=k("i",{class:"fas fa-comment"},null,-1)),k("span",us,w(e.task.extended_data.comments_count),1)])):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(i(),c("div",cs,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0),!L.value&&e.task.assigned_contact_id?(i(),c("div",ds,[e.task.update_datetime?(i(),c("span",fs,w(_(H)().to(_(H)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(i(),c("span",ps,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0)])):g("",!0),e.task.complete_datetime?(i(),c("div",ms,w(_(H)().to(_(H)(e.task.complete_datetime),!0)),1)):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.contact_id?(i(),c("div",ks,[M(fe,{"user-id":e.task.contact_id},null,8,["user-id"])])):g("",!0),!L.value&&e.task.assigned_contact_id?(i(),c("div",vs,[M(fe,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):g("",!0),L.value&&e.task.complete_contact_id?(i(),c("div",hs,[M(fe,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):g("",!0),(X=e.task.external_links)!=null&&X.length?(i(),c("div",_s,[(i(!0),c(q,null,ee(e.task.external_links,P=>(i(),c("a",{key:P.id,href:P.entity_link,class:"icon size-20",target:"_blank"},[k("img",{src:Fe(P.app)},null,8,gs)],8,ys))),128))])):g("",!0)])],2))}}}),bs=x({__name:"ListNavigationProvider",setup(s){const t=$();return ct(Se,wt(t)),(e,n)=>(i(),c("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[te(e.$slots,"default")],512))}}),Ls=x({__name:"TaskListItemStoreProvider",setup(s){const t=j(),e=r=>t.completeTask(r),n=(r,f)=>t.updateItem(r,f),d=async(r,f,y)=>{await t.insert(y.isBefore?"before":"after",r,{...f})},l=async(r,f)=>{await t.insertMany(r,f)},a=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},o=async r=>{await t.deleteItem(r)};return(r,f)=>te(r.$slots,"default",{onComplete:e,onUpdate:n,onInsert:d,onInsertMany:l,onInsertFirst:a,onDelete:o})}}),Cs=x({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,n=t,d=$(null),{stop:l}=dt(d,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"200px"});return $e(()=>{l()}),(a,o)=>(i(),c("div",{ref_key:"elRef",ref:d},[te(a.$slots,"default")],512))}}),Is={key:0,class:"skeleton custom-m-24"},Ts={key:0},$s={class:"box custom-py-24 small align-center gray"},pe=30,xs=x({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=j(),n=ae(),d=pt(),l=$(pe),a=$([]),o=$(!1),r=$(0),f=$(!1),y=D(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:a.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),C=D(()=>y.value.source.slice(0,l.value));z(()=>t,()=>{l.value=pe,T()},{deep:!0,immediate:!0});const L=()=>{var p;((p=y.value.source)==null?void 0:p.length)>C.value.length&&(l.value+=pe)};async function T(){const{isFetchStream:p,fetchParams:u,disableCheckin:v}=y.value;if(!u||!m(u))return;if(o.value=!1,a.value=[],t.filter==="list"){const S=d.task.value.get(JSON.stringify({list_id:t.listId})),K=d.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ne=d.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),se=S||K;if(se)if(t.shouldFilterUncompleted){if(ne)return}else delete u.status,u.starting_from=ft(new Date(se))}if(r.value=8,t.filter==="list"){const S=n.getItemById(t.listId);r.value=S==null?void 0:S.extended_data.items_count}f.value=!d.task.value.get(JSON.stringify(y.value.fetchParams))&&("status"in y.value.fetchParams?y.value.fetchParams.status!=="0":!0);const I=await e[p?"fetchStream":"fetch"]({...u},{disableCheckin:v});f.value=!1,I&&I.value&&I.value.status_code==="ok"&&t.filter==="search"&&(a.value=[...a.value,...I.value.data],o.value=!a.value.length)}function m(p){return!(!p||p.list_id&&typeof p.list_id!="number"||p.location_id&&typeof p.location_id!="number")}return(p,u)=>f.value?(i(),c("div",Is,[(i(!0),c(q,null,ee(r.value,v=>(i(),c("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(i(),c(q,{key:1},[te(p.$slots,"default",{tasks:C.value}),t.filter==="search"&&o.value?(i(),c("div",Ts,[k("p",$s,[U(w(p.$t("searchNoMatches"))+" ",1),k("strong",null,w(t.searchQuery),1)])])):g("",!0),(i(),Z(Cs,{key:p.$route.fullPath,onIntersecting:L}))],64))}}),Ss=x({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=j(),n=ve();z(n.currentRoute,async l=>{const a={...l.query};"addNewTask"in a&&(await d(),delete a.addNewTask,n.replace({path:l.path,query:a}))},{immediate:!0});async function d(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(l,a)=>(i(),c("div",{class:"text-gray pl-list-item-title",onClick:d},[a[0]||(a[0]=k("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),U(" "+w(l.$t("newToDo")),1)]))}}),Ms=x({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(i(),Z(Ce,{title:t.title,"hide-close-icon":!0},{submit:F(()=>[k("button",{class:"danger",onClick:e[0]||(e[0]=(...n)=>t.onDelete&&t.onDelete(...n))}," Delete ")]),default:F(()=>[U(w(t.text)+" ",1)]),_:1},8,["title"]))}}),Ds={class:"tw-w-68"},Ps={class:"menu"},Fs={href:"javascript:void(0);"},Es={class:"menu"},Bs=["onClick"],Ns=["disabled"],As=x({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=mt(),e=ae(),n=$(),d=()=>{n.value&&s.onMove(n.value)};return(l,a)=>(i(),Z(Ce,{title:l.title,"hide-close-icon":!0},{submit:F(()=>[k("button",{disabled:!n.value,onClick:J(d,["prevent"])}," Move ",8,Ns)]),default:F(()=>[k("div",Ds,[k("ul",Ps,[(i(!0),c(q,null,ee(_(t).items,o=>(i(),c("li",{key:o.uuid||o.id},[k("a",Fs,w(o.name),1),k("ul",Es,[(i(!0),c(q,null,ee(_(e).getListsInPocket(o.id),r=>(i(),c("li",{key:r.uuid||r.id,class:R(n.value===r.id&&"selected rounded")},[k("a",{href:"#",onClick:J(()=>{n.value=n.value===r.id?void 0:r.id},["prevent"])},w(r.name),9,Bs)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Rs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Us={class:"hint"},Os={class:"hint"},Hs=x({__name:"TaskListMultiselect",setup(s){const t=j(),e=$(new Set),{show:n,hide:d}=ye(Ms,{title:"Delete",text:ge(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),d()}}),{show:l,hide:a}=ye(As,{title:"Move Items",text:ge(()=>`Delete ${e.value.size} selected items?`),onMove:async C=>{await t.sort(C,null,[...e.value]),e.value.clear(),a()}}),o=C=>{e.value.add(C)},r=C=>{e.value.delete(C)},f=()=>{l()},y=()=>{n()};return(C,L)=>(i(),c(q,null,[e.value.size?(i(),c("div",Rs,[k("button",{class:"button light-gray smaller",onClick:f},[L[0]||(L[0]=k("i",{class:"fas fa-list text-blue"},null,-1)),U(" "+w(C.$t("Move"))+" ",1),k("span",Us,w(e.value.size),1)]),k("button",{class:"button light-gray smaller",onClick:y},[L[1]||(L[1]=k("i",{class:"fas fa-trash-alt text-red"},null,-1)),U(" "+w(C.$t("Delete"))+" ",1),k("span",Os,w(e.value.size),1)])])):g("",!0),te(C.$slots,"default",{onSelect:o,onDeselect:r})],64))}}),zs="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.32594%207.70265C7.97656%207.35329%207.41285%207.34569%207.05419%207.68545L0.468799%2013.819C-0.0347521%2014.296%20-0.0455698%2015.0948%200.444949%2015.5853C0.934984%2016.0753%201.73243%2016.0645%202.20909%2015.5614L8.34314%208.97661C8.6834%208.61748%208.67574%208.05242%208.32594%207.70265Z'%20fill='black'/%3e%3cpath%20d='M2.55008%203.99187C2.58461%203.8699%202.75749%203.8699%202.79201%203.99187L3.24893%205.60604C3.29055%205.75306%203.40545%205.86796%203.55246%205.90957L5.16664%206.36649C5.28861%206.40102%205.28861%206.57389%205.16664%206.60842L3.55246%207.06534C3.40545%207.10695%203.29055%207.22186%203.24893%207.36887L2.79201%208.98304C2.75749%209.10501%202.58461%209.10501%202.55008%208.98304L2.09317%207.36887C2.05155%207.22186%201.93665%207.10695%201.78963%207.06534L0.17546%206.60842C0.0534922%206.57389%200.0534924%206.40102%200.175461%206.36649L1.78963%205.90957C1.93665%205.86796%202.05155%205.75306%202.09317%205.60604L2.55008%203.99187Z'%20fill='%23EE6622'/%3e%3cpath%20d='M5.00052%200.122182C5.02707%200.0302363%205.16006%200.0302364%205.18661%200.122182L5.53809%201.33902C5.5701%201.44985%205.65849%201.53647%205.77158%201.56784L7.01325%201.91228C7.10707%201.93831%207.10707%202.06863%207.01325%202.09466L5.77158%202.43911C5.65849%202.47048%205.5701%202.5571%205.53809%202.66792L5.18661%203.88476C5.16006%203.97671%205.02707%203.97671%205.00052%203.88476L4.64904%202.66792C4.61703%202.5571%204.52864%202.47048%204.41555%202.43911L3.17388%202.09466C3.08006%202.06863%203.08006%201.93831%203.17388%201.91228L4.41555%201.56784C4.52864%201.53647%204.61703%201.44985%204.64904%201.33902L5.00052%200.122182Z'%20fill='%2355DDDD'/%3e%3cpath%20d='M8.73211%2011.8502C8.75813%2011.7583%208.88846%2011.7583%208.91448%2011.8502L9.25893%2013.067C9.2903%2013.1779%209.37692%2013.2645%209.48775%2013.2959L10.7046%2013.6403C10.7965%2013.6663%2010.7965%2013.7967%2010.7046%2013.8227L9.48775%2014.1671C9.37692%2014.1985%209.2903%2014.2851%209.25893%2014.3959L8.91448%2015.6128C8.88846%2015.7047%208.75813%2015.7047%208.73211%2015.6128L8.38766%2014.3959C8.35629%2014.2851%208.26967%2014.1985%208.15884%2014.1671L6.94201%2013.8227C6.85006%2013.7967%206.85006%2013.6663%206.94201%2013.6403L8.15884%2013.2959C8.26967%2013.2645%208.35629%2013.1779%208.38766%2013.067L8.73211%2011.8502Z'%20fill='%23F5C400'/%3e%3cpath%20d='M13.3484%209.16196C13.3813%209.04562%2013.5462%209.04562%2013.5791%209.16196L14.015%2010.7016C14.0547%2010.8419%2014.1643%2010.9515%2014.3045%2010.9912L15.8442%2011.427C15.9605%2011.4599%2015.9605%2011.6248%2015.8442%2011.6578L14.3045%2012.0936C14.1643%2012.1333%2014.0547%2012.2429%2014.015%2012.3831L13.5791%2013.9228C13.5462%2014.0391%2013.3813%2014.0391%2013.3484%2013.9228L12.9125%2012.3831C12.8728%2012.2429%2012.7633%2012.1333%2012.623%2012.0936L11.0833%2011.6578C10.967%2011.6248%2010.967%2011.4599%2011.0833%2011.427L12.623%2010.9912C12.7633%2010.9515%2012.8728%2010.8419%2012.9125%2010.7016L13.3484%209.16196Z'%20fill='%2322CC22'/%3e%3cpath%20d='M10.7288%200.228994C10.7952%20-0.00536791%2011.1274%20-0.00536752%2011.1937%200.228994L12.0717%203.33062C12.1516%203.61311%2012.3724%203.83389%2012.6549%203.91386L15.7565%204.79183C15.9909%204.85816%2015.9909%205.19035%2015.7565%205.25669L12.6549%206.13466C12.3724%206.21462%2012.1516%206.4354%2012.0717%206.71789L11.1937%209.81952C11.1274%2010.0539%2010.7952%2010.0539%2010.7288%209.81952L9.85087%206.71789C9.77091%206.4354%209.55012%206.21462%209.26763%206.13466L6.16601%205.25669C5.93164%205.19035%205.93164%204.85816%206.16601%204.79183L9.26763%203.91386C9.55012%203.83389%209.77091%203.61311%209.85087%203.33062L10.7288%200.228994Z'%20fill='%230088EE'/%3e%3c/svg%3e",qs=["src","onClick"],Ws={class:"custom-p-12"},js={class:"small custom-mb-8"},Ks=["placeholder","disabled"],Vs={class:"flexbox middle"},Qs=["disabled"],Zs={key:0,class:"spinner"},Js={key:0,class:"custom-mt-4 text-red"},Xs=x({__name:"TaskListAI",props:{listId:{}},setup(s){const t=s,{t:e}=kt(),n=j(),d=ae(),l=$(),a=$(""),o=$([]),r=D(()=>{var p;return((p=d.getItemById(t.listId))==null?void 0:p.name)??void 0}),{data:f,error:y,isFetching:C,execute:L}=vt(D(()=>`pocketlists.ai.gpt?prompt=${a.value||r.value}`),{immediate:!1}).json(),{showIfNotPremium:T}=Re(e("listAIPremiumMessage"),{immediate:!1});z(()=>{var p;return(p=l.value)==null?void 0:p.isOpened},p=>{p&&T()});const m=async()=>{if(!(!a.value&&!r.value)){o.value=[],await L();try{o.value=JSON.parse(f.value.data.text),await n.insertToList(t.listId,o.value.map(p=>({name:p}))),a.value="",l.value.isOpened=!1}catch{}}};return(p,u)=>(i(),Z(_t,{ref_key:"dropdownRef",ref:l},{default:F(({handler:v,setRef:I})=>[k("img",{ref:I,src:_(zs),class:"tw-cursor-pointer",onClick:v},null,8,qs)]),body:F(()=>[k("div",Ws,[k("div",js,w(p.$t("listAILabel")),1),xe(k("textarea",{"onUpdate:modelValue":u[0]||(u[0]=v=>a.value=v),class:"width-100 custom-mb-8 small",placeholder:r.value,style:{height:"4rem",resize:"none"},disabled:_(C)},null,8,Ks),[[ht,a.value]]),k("div",Vs,[k("button",{class:"small",disabled:_(C),onClick:J(m,["prevent"])},w(p.$t("write")),9,Qs),_(C)?(i(),c("div",Zs)):g("",!0)]),_(y)?(i(),c("div",Js,w(p.$t("Error")),1)):g("",!0)])]),_:1},512))}}),Ys={class:"pl-bg-block custom-pb-4"},Gs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},ea={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},ta={key:1,class:"flexbox middle custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},sa={class:"wide"},aa={key:2,class:"custom-py-12 tw-cursor-pointer heading"},ra=x({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=j(),n=D(()=>t.filter!=="list");return(d,l)=>(i(),c("div",Ys,[t.header?(i(),c("div",Gs,[k("h1",null,w(t.header),1)])):g("",!0),M(bs,null,{default:F(()=>[M(xs,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:F(({tasks:a})=>[!a.length&&t.startMessage&&_(e).isPreFilled?(i(),c("div",ea,w(t.startMessage),1)):g("",!0),t.hideAddNewTask?g("",!0):(i(),c("div",ta,[k("div",sa,[M(Ss,{"addable-props":t.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])]),M(Xs,{"list-id":t.listId},null,8,["list-id"])])),d.shouldFilterUncompleted&&!d.hideUncompletedLabel&&a.length?(i(),c("div",aa,w(d.$t("completed")),1)):g("",!0),M(Hs,null,{default:F(({onSelect:o,onDeselect:r})=>[M(gt,{items:a,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:o,onDeselect:r},{default:F(({item:f})=>[M(Ls,null,{default:F(({onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:m,onDelete:p,onBlur:u})=>[M(ws,{task:f,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:m,onDelete:p,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{ra as _};
