import{d as g,u as I,a as C,r as f,o as w,c as p,b as e,w as h,t as _,e as x,O as T,f as k,g as S,h as y,i as b,j as $,T as B,k as R,v as M,l as V,m as D,n as N,F as U,p as E,q as F,s as K}from"./index-vcerziWz.js";import{C as L}from"./ContenteditableBlock-M_5GU0iK.js";import"./rangy-5rxgwlWZ.js";const j={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background tw-p-4 tw-rounded-lg tw-rounded-tl-0 tw-text-sm tw-mr-4"},q={class:"tw-flex tw-gap-2"},A={class:"tw-flex tw-gap-2"},G={class:"tw-truncate"},H={class:"hint"},O={class:"hint"},z=g({__name:"TaskChatItem",props:{message:{}},setup(c){const s=c,r=I(),l=C(),t=f(!1),a=()=>{l.deleteItem(s.message)},n=d=>{l.updateItem(s.message,{comment:d})};return(d,o)=>{var i;return w(),p("div",j,[e("div",q,[e("a",{onClick:h(a,["prevent"])},o[1]||(o[1]=[e("i",{class:"fas fa-times"},null,-1)])),e("a",{onClick:o[0]||(o[0]=h(v=>t.value=!0,["prevent"]))},o[2]||(o[2]=[e("i",{class:"fas fa-edit"},null,-1)]))]),e("div",A,[e("div",G,_((i=x(r).getItemById(s.message.contact_id))==null?void 0:i.name),1),e("div",H,_(x(T)(s.message.create_datetime).format("ll")),1)]),k(L,{editable:t.value,focusable:!0,value:s.message.comment,tag:"div",onUpdate:n},null,8,["editable","value"]),e("div",O,_(typeof s.message.id=="number"?"delivered":"not delivered"),1)])}}}),J={class:"tw-h-full tw-flex tw-flex-col"},P={class:"tw-flex-none tw-sticky tw-py-3 pl-bg-block"},Q={class:"state-with-inner-icon right tw-w-full"},W=g({__name:"TaskChat",props:{taskId:{}},setup(c){const s=c,r=S(),l=C(),t=y(()=>r.getItemById(s.taskId)),a=y(()=>t.value?l.getComentsByTaskId(t.value.id):[]),n=f(),d=f(),o=f(!1),i=f("");b(()=>s.taskId,()=>{t.value&&D(t.value)&&l.fetch({item_id:t.value.id})},{immediate:!0}),b(a,async()=>{await N(),n.value&&(n.value.scrollTop=n.value.scrollHeight),o.value=!0});const v=async()=>{t.value&&(await l.insert(t.value.id,i.value),i.value="",d.value.focus())};return(ee,m)=>(w(),p("div",J,[e("div",{ref_key:"chatContainerRef",ref:n,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[k(B,{name:"slide-right",css:o.value},{default:$(()=>[(w(!0),p(U,null,E(a.value,u=>(w(),F(z,{key:u.uuid||u.id,message:u},null,8,["message"]))),128))]),_:1},8,["css"])],512),e("div",P,[e("div",Q,[R(e("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":m[0]||(m[0]=u=>i.value=u),type:"text",placeholder:"Type a message",class:"tw-w-full",onKeydown:V(v,["enter"])},null,544),[[M,i.value]]),e("button",{class:"icon",onClick:v},m[1]||(m[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),X={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},Y={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden tw-p-3 tw-pb-0"},Z={class:"tw-flex-auto tw-min-h-0"},oe=g({__name:"Test",props:{taskId:{}},setup(c){const s=c,r=K(),l=()=>{var a;const t=(a=r.currentRoute.value.matched.find(n=>n.meta.isListView))==null?void 0:a.name;t?r.push({name:t}):console.error("Cant find back route")};return(t,a)=>(w(),p("div",X,[e("div",{class:"tw-flex-none tw-p-3"},[e("button",{class:"circle gray",onClick:l},a[0]||(a[0]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Y,[e("div",Z,[k(W,{"task-id":s.taskId},null,8,["task-id"])])])]))}});export{oe as default};
