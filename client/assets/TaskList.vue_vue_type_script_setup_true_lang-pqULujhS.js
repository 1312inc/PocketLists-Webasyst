import{u as Pe,_ as Fe,t as ve,a as Be,b as Ee}from"./textToHtmlWithLinks-l5ter1ZY.js";import{r as S,ae as Ne,m as j,af as B,d as L,a6 as Ue,c as P,ag as Ae,o as l,e as r,j as _,D as pe,t as b,g as y,n as H,k as Re,L as O,f as m,K as z,A as me,G as ke,y as te,ah as J,ai as fe,a7 as Ie,aj as oe,ak as Oe,al as He,am as Te,an as ze,ao as We,ap as je,aq as Ke,ar as qe,as as Ve,at as Qe,B as q,F as A,x as se,i as X,u as Je,a3 as Ye,h as M,q as U,au as Xe,R as Ge,U as Ze,Q as et,av as tt,aw as he,ax as le,p as st,M as $e,s as at,w as W,ay as nt,az as xe,aA as ot,l as lt,aB as it,S as K,aC as rt,aD as ut,aE as ct,H as dt,a9 as _e,aF as ye}from"./index-l4vW2gN4.js";import{m as ie,g as ee,a as ft,s as ge}from"./sanitizer-TiisBOmJ.js";import{_ as pt}from"./SortableList.vue_vue_type_style_index_0_lang-2cgeKdOq.js";function mt(s){const t=S([]),e=new Set;Ne(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),j(t,()=>{for(const[p]of e.entries())typeof p=="function"&&p(),e.delete(p)});const a=p=>{e.add(p)},c=p=>t.value.findIndex(h=>h.isEqualNode(p)),f=p=>t.value[c(p)-1],n=p=>t.value[c(p)+1],o=(p,h)=>{if(p){const u=n(p);if(u instanceof HTMLElement)return u.focus(),h&&ie(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},i=(p,h,u)=>{if(p.target instanceof HTMLElement){const v=p.target,T=ee(v),C=h==="up"?f(v):n(v);C instanceof HTMLElement&&(p.preventDefault(),C.focus(),ft(C,T),typeof u=="function"&&u())}};return{getPreviousElementSibling:f,getNextElementSibling:n,getCurrentPositionInNavigationList:c,focusNextTask:o,focusTaskById:(p,h)=>{const u=t.value.find(v=>{var T;return v instanceof HTMLElement&&((T=v.dataset)==null?void 0:T.id)==p});u instanceof HTMLElement&&(u.focus(),h&&ie(u))},onUp:(p,h)=>{i(p,"up",h)},onDown:(p,h)=>{i(p,"down",h)},onLeft:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===0){const v=f(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),ie(v),typeof h=="function"&&h())}}},onRight:(p,h)=>{if(p.target instanceof HTMLElement){const u=p.target;if(ee(u)===u.innerText.length){const v=n(u);v instanceof HTMLElement&&(p.preventDefault(),v.focus(),typeof h=="function"&&h())}}},nextUpdate:a}}const kt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},vt={class:"flexbox space-12 smaller empty:tw-hidden"},ht={key:3},_t=L({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Ue(),{currentLabel:e}=Pe(()=>s.task),a=P(()=>Ae(s.task)),c=P(()=>({"text-red":a.value===3,"text-yellow":a.value===2,"text-green":a.value===1,grey:a.value===0}));return(f,n)=>{var o;return l(),r("div",vt,[_(e)?(l(),r("div",{key:0,class:"badge squared",style:pe(`background: #${_(e).color};`)},b(_(e).name),5)):y("",!0),f.task.due_datetime&&!f.task.status?(l(),r("div",{key:1,class:H(["semibold",c.value])},b(_(Re)(f.task.due_datetime).format("LLL")),3)):f.task.due_date&&!f.task.status?(l(),r("div",{key:2,class:H(["semibold",c.value])},b(_(O)(f.task.due_date).format("LL")),3)):y("",!0),f.task.location_id?(l(),r("div",ht,[n[0]||(n[0]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),z(" "+b((o=_(t).getItemById(f.task.location_id))==null?void 0:o.name)+" "+b(_(kt)(_(t).distanceById(f.task.location_id))),1)])):y("",!0)])}}}),yt={class:"icon"},gt=["src"],wt=L({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=me(),e=ke(),a=P(()=>!t.currentRoute.value.params.listId),c=P(()=>s.task.list_id&&a.value?e.itemsMap[s.task.list_id]:null),f=()=>{if(!c.value)return;const n=t.resolve({name:"list",params:{listId:c.value.id}});window.open(n.href,"_blank")};return(n,o)=>(l(),r("div",{class:H(["flexbox middle",{"space-12":!n.isFocused}])},[n.isFocused?(l(),te(Fe,{key:0,task:n.task,input:n.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(l(),te(_t,{key:1,task:n.task},null,8,["task"])),c.value?(l(),r("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:f},[m("div",yt,[m("img",{src:c.value.icon_url,loading:"lazy"},null,8,gt)]),z(" "+b(c.value.name),1)])):y("",!0)],2))}}),Se=We?window:void 0;function Z(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Y(...s){const t=[],e=()=>{t.forEach(o=>o()),t.length=0},a=(o,i,d,g)=>(o.addEventListener(i,d,g),()=>o.removeEventListener(i,d,g)),c=P(()=>{const o=oe(B(s[0])).filter(i=>i!=null);return o.every(i=>typeof i!="string")?o:void 0}),f=Oe(()=>{var o,i;return[(i=(o=c.value)==null?void 0:o.map(d=>Z(d)))!=null?i:[Se].filter(d=>d!=null),oe(B(c.value?s[1]:s[0])),oe(_(c.value?s[2]:s[1])),B(c.value?s[3]:s[2])]},([o,i,d,g])=>{if(e(),!(o!=null&&o.length)||!(i!=null&&i.length)||!(d!=null&&d.length))return;const $=He(g)?{...g}:g;t.push(...o.flatMap(I=>i.flatMap(x=>d.map(p=>a(I,x,p,$)))))},{flush:"post"}),n=()=>{f(),e()};return Te(e),n}let we=!1;function be(s,t,e={}){const{window:a=Se,ignore:c=[],capture:f=!0,detectIframe:n=!1,controls:o=!1}=e;if(!a)return o?{stop:J,cancel:J,trigger:J}:J;if(fe&&!we){we=!0;const u={passive:!0};Array.from(a.document.body.children).forEach(v=>Y(v,"click",J,u)),Y(a.document.documentElement,"click",J,u)}let i=!0;const d=u=>B(c).some(v=>{if(typeof v=="string")return Array.from(a.document.querySelectorAll(v)).some(T=>T===u.target||u.composedPath().includes(T));{const T=Z(v);return T&&(u.target===T||u.composedPath().includes(T))}});function g(u){const v=B(u);return v&&v.$.subTree.shapeFlag===16}function $(u,v){const T=B(u),C=T.$.subTree&&T.$.subTree.children;return C==null||!Array.isArray(C)?!1:C.some(V=>V.el===v.target||v.composedPath().includes(V.el))}const I=u=>{const v=Z(s);if(u.target!=null&&!(!(v instanceof Element)&&g(s)&&$(s,u))&&!(!v||v===u.target||u.composedPath().includes(v))){if("detail"in u&&u.detail===0&&(i=!d(u)),!i){i=!0;return}t(u)}};let x=!1;const p=[Y(a,"click",u=>{x||(x=!0,setTimeout(()=>{x=!1},0),I(u))},{passive:!0,capture:f}),Y(a,"pointerdown",u=>{const v=Z(s);i=!d(u)&&!!(v&&!u.composedPath().includes(v))},{passive:!0}),n&&Y(a,"blur",u=>{setTimeout(()=>{var v;const T=Z(s);((v=a.document.activeElement)==null?void 0:v.tagName)==="IFRAME"&&!(T!=null&&T.contains(a.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),h=()=>p.forEach(u=>u());return o?{stop:h,cancel:()=>{i=!1},trigger:u=>{i=!0,I(u),i=!1}}:h}const bt={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=be(s,t.value,{capture:e});else{const[a,c]=t.value;s.__onClickOutside_stop=be(s,a,Object.assign({capture:e},c))}},unmounted(s){s.__onClickOutside_stop()}};function re(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function Le(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:Le(e)}}function It(s){const t=s||window.event,e=t.target;return Le(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const ue=new WeakMap;function Tt(s,t=!1){const e=Ie(t);let a=null,c="";j(ze(s),o=>{const i=re(B(o));if(i){const d=i;if(ue.get(d)||ue.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(c=d.style.overflow),d.style.overflow==="hidden")return e.value=!0;if(e.value)return d.style.overflow="hidden"}},{immediate:!0});const f=()=>{const o=re(B(s));!o||e.value||(fe&&(a=Y(o,"touchmove",i=>{It(i)},{passive:!1})),o.style.overflow="hidden",e.value=!0)},n=()=>{const o=re(B(s));!o||!e.value||(fe&&(a==null||a()),o.style.overflow=c,ue.delete(o),e.value=!1)};return Te(n),P({get(){return e.value},set(o){o?f():n()}})}function $t(){let s=!1;const t=Ie(!1);return(e,a)=>{if(t.value=a.value,s)return;s=!0;const c=Tt(e,a.value);j(t,f=>c.value=f)}}$t();const xt=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},St=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Lt=je("syncError",()=>{const s=Ke(qe(Ve(()=>Qe.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:P(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Ct(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const Mt={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Dt=["href"],Pt=["src"],Ft={class:"bold"},Bt={key:0,class:"hint custom-ml-4 nowrap"},Et=["onClick"],Nt=L({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=q(),e=a=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[a])};return(a,c)=>{var f;return(f=a.task.attachments)!=null&&f.length?(l(),r("div",Mt,[(l(!0),r(A,null,se(a.task.attachments,n=>(l(),r("div",{key:n.uuid||n.id,class:"pl-attachments__item small"},[m("a",{href:n.download_url,target:"_blank"},[n.preview_url?(l(),r("img",{key:0,src:n.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Pt)):(l(),r(A,{key:1},[m("span",Ft,b(n.file_name),1),n.size?(l(),r("span",Bt,b(_(Ct)(n.size)),1)):y("",!0)],64))],8,Dt),a.isFocused?(l(),r("div",{key:0,class:H(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":n.preview_url}])},[m("a",{class:H(n.preview_url?"button circle white":"custom-ml-8"),onClick:X(o=>e(n.id),["prevent"])},c[0]||(c[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,Et)],2)):y("",!0)]))),128))])):y("",!0)}}}),ce=L({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Je(),a=P(()=>e.getItemById(t.userId));return(c,f)=>{var n;return(n=a.value)!=null&&n.photo_url?(l(),r("span",{key:0,class:"icon userpic",style:pe({backgroundImage:`url(${a.value.photo_url})`})},null,4)):y("",!0)}}}),Ut={key:0,class:"tw-cursor-pointer"},At={key:0,class:"pl-list-item-firedBullet"},Rt={key:1,class:"tw-cursor-pointer"},Ot=L({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,a=t,c=S(e.task.status===1);j(()=>e.task.status,o=>{c.value=o===1});const f=P(()=>Ye(e.task)),n=()=>{c.value=!c.value,a("complete")};return(o,i)=>(l(),r("div",{class:"tw-w-5 tw-flex-none",onClick:n},[M(Ze,{name:"bounce",mode:"out-in"},{default:U(()=>{var d;return[c.value?(l(),r("div",Rt,i[0]||(i[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(l(),r("div",Ut,[f.value===_(Xe)?(l(),r("div",At)):(l(),r("div",{key:1,class:"pl-list-item-bullet",style:pe(`background-color: ${(d=_(Ge).get(f.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),Ht=new WeakMap;function zt(){const s=et(),t=me(),e=()=>{var i;const f=[...s.matched].reverse().find(d=>{var g;return(g=d.meta)==null?void 0:g.isListView})||null,n=((i=f==null?void 0:f.children)==null?void 0:i.find(d=>{var g;return(g=d.meta)==null?void 0:g.isTaskInfoView}))||null,o={listViewRoute:f,taskInfoRoute:n};return Ht.set(s,o),o};return{navigateToTaskInfo:async c=>{const{listViewRoute:f,taskInfoRoute:n}=e();if(!f||!(n!=null&&n.name))return console.warn("Required routes not found"),!1;try{const o=await t.push({name:n.name,params:{taskId:c}});return!tt(o)}catch(o){return console.error("Navigation failed:",o),!1}}}}const Wt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},jt={class:"hint"},Kt={class:"hint"},qt={class:"hint"},Vt={class:"tw-clear-both tw-inline-block"},Qt=["placeholder","data-id","innerHTML"],Jt=["innerHTML"],Yt={class:"flexbox space-8 custom-pt-2 tw-flex-none"},Xt={key:0},Gt={key:1},Zt={key:2,class:"tw-flex-none"},es=["title"],ts=["title"],ss={class:"bold small"},as={key:5,class:"hint tw-flex-none custom-mt-2"},ns={key:6,class:"hint tw-flex-none custom-mt-2"},os={key:0},ls={key:1},is={key:7,class:"hint tw-flex-none custom-mt-2"},rs={key:8,class:"flexbox middle tw-flex-none"},us={key:9,class:"flexbox middle tw-flex-none"},cs={key:10,class:"flexbox middle tw-flex-none"},ds={key:11,class:"flexbox middle space-4 tw-flex-none"},fs=["href"],ps=["src"],ms=L({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,a=t,c=q(),f=Lt(),{navigateToTaskInfo:n}=zt(),o=he(xe),i=he(ot),d=S(!1),g=S(!1),$=S(e.task.name),I=S(e.task.status);j(()=>e.task.status,w=>{I.value=w});const x=S();let p=null;j(d,()=>{if(d.value)return;const w=x.value.innerText.trim();if(le(e.task)&&!w){g.value=!0,a("delete",e.task);return}e.task.name!==w&&a("update",e.task,{name:w})}),st(()=>{le(e.task)&&(x.value.focus(),d.value=!0)}),$e(()=>{p&&(clearTimeout(p),p=null,h())});const h=()=>{a("complete",e.task)},u=()=>{I.value=I.value?0:1,x.value.classList.toggle("opacity-50"),!(p&&(clearTimeout(p),p=null,e.task.status===I.value))&&(p=setTimeout(h,1e3))},v=w=>{if(w.target instanceof HTMLAnchorElement){const k=w.target.href;w.preventDefault(),setTimeout(()=>{window.open(k,"_blank")})}},T=w=>{var R;w.preventDefault();const k=(R=w.clipboardData)==null?void 0:R.getData("text/plain");if(!k)return;if(x.value.innerText){document.execCommand("insertText",!1,k);return}const E=k.split(`
`).filter(N=>N);E.length&&a("insertMany",e.task,E.map(N=>({name:xt(N),...e.addableProps,...St(N)?{status:1}:{}})))},C=w=>{ee(w.target)===0&&(o==null||o.onLeft(w),g.value=!0,a("delete",e.task))},V=async w=>{if(w.shiftKey)return;if(w.preventDefault(),e.isEnterDisabled){Q(!0),await lt(),a("insertFirst",{...e.addableProps});return}const k=w.target,E=k.innerText.trim(),R=ee(k);let N="",G=!0;R===0&&E||(k.innerText=E.substring(0,R).trim(),N=E.substring(R,E.length).trim(),G=!1),a("insert",e.task,{...e.addableProps,name:N},{isBefore:G}),Q()},ae=w=>{$.value=w.target.innerText},Q=(w=!1)=>{const k=()=>{x.value.blur(),d.value=!1};if(w){k();return}setTimeout(()=>{k()})},Me=()=>{a("update",e.task,{favorite:e.task.favorite?0:1})},ne=async w=>{w.target.closest("[contenteditable], .chips li, a")===null&&await n(e.task.id)};function De(w){return new URL(Object.assign({"../../assets/apps/shop.svg":Be,"../../assets/apps/tasks.svg":Ee})[`../../assets/apps/${w}.svg`],import.meta.url).href}return(w,k)=>{var E,R,N,G;return g.value?y("",!0):(l(),r("div",{key:0,class:H(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":w.$route.meta.isTaskInfoView&&((E=w.$route.params)==null?void 0:E.taskId)==e.task.id,highlighted:_(c).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(l(),r("div",Wt,k[6]||(k[6]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):y("",!0),M(Ot,{task:e.task,onComplete:u},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:ne},[(R=_(i))!=null&&R.is_debug_mode?(l(),r(A,{key:0},[m("span",jt,"list_id: "+b(String(e.task.list_id)),1),k[7]||(k[7]=z(" | ")),m("span",Kt,"id: "+b(e.task.id),1),k[8]||(k[8]=z(" | ")),m("span",qt,"srank: "+b(String(e.task.sort))+" | "+b(String(e.task.rank)),1)],64)):y("",!0),at((l(),r("div",null,[m("div",Vt,[m("div",{ref_key:"contenteditableRef",ref:x,contenteditable:"",class:H(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(V,["enter"]),k[0]||(k[0]=W(D=>{var F;(F=_(o))==null||F.onLeft(D,()=>{d.value=!1})},["left"])),k[1]||(k[1]=W(D=>{var F;(F=_(o))==null||F.onUp(D,()=>{d.value=!1})},["up"])),k[2]||(k[2]=W(D=>{var F;(F=_(o))==null||F.onRight(D,()=>{d.value=!1})},["right"])),k[3]||(k[3]=W(D=>{var F;(F=_(o))==null||F.onDown(D,()=>{d.value=!1})},["down"])),W(C,["delete"]),W(Q,["esc"]),k[4]||(k[4]=W(()=>{d.value=!1},["tab"]))],onMousedown:v,onFocus:k[5]||(k[5]=D=>d.value=!0),onPaste:T,onInput:ae,innerHTML:_(ge)(d.value?e.task.name:_(ve)(e.task.name))},null,42,Qt)]),e.task.note?(l(),r("div",{key:0,class:"hint tw-break-all tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(ge)(_(ve)(e.task.note))},null,8,Jt)):y("",!0),M(wt,{task:w.task,input:$.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[_(bt),()=>{d.value=!1}]]),M(Nt,{task:e.task,"is-focused":d.value},null,8,["task","is-focused"])]),m("div",Yt,[e.showInfoLink?(l(),r("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:X(ne,["prevent"])},k[9]||(k[9]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):y("",!0),I.value?y("",!0):(l(),r("div",{key:1,class:H(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:Me},[e.task.favorite?(l(),r("span",Xt,k[10]||(k[10]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(l(),r("span",Gt,k[11]||(k[11]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(f).taskErrorMap.get(e.task.id)?(l(),r("div",Zt,[m("span",{class:"icon",style:{color:"orange"},title:_(f).taskErrorMap.get(e.task.id)},k[12]||(k[12]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,es)])):y("",!0),!_(nt)(e.task)&&!_(le)(e.task)?(l(),r("div",{key:3,class:"tw-flex-none",title:w.$t("syncing")},k[13]||(k[13]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,ts)):y("",!0),(N=e.task.extended_data)!=null&&N.comments_count?(l(),r("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:X(ne,["prevent"])},[k[14]||(k[14]=m("i",{class:"fas fa-comment"},null,-1)),m("span",ss,b(e.task.extended_data.comments_count),1)])):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(l(),r("div",as,b(_(O)().to(_(O)(e.task.create_datetime),!0)),1)):y("",!0),!I.value&&e.task.assigned_contact_id?(l(),r("div",ns,[e.task.update_datetime?(l(),r("span",os,b(_(O)().to(_(O)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(l(),r("span",ls,b(_(O)().to(_(O)(e.task.create_datetime),!0)),1)):y("",!0)])):y("",!0),e.task.complete_datetime?(l(),r("div",is,b(_(O)().to(_(O)(e.task.complete_datetime),!0)),1)):y("",!0),!I.value&&!e.task.assigned_contact_id&&e.task.contact_id?(l(),r("div",rs,[M(ce,{"user-id":e.task.contact_id},null,8,["user-id"])])):y("",!0),!I.value&&e.task.assigned_contact_id?(l(),r("div",us,[M(ce,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):y("",!0),I.value&&e.task.complete_contact_id?(l(),r("div",cs,[M(ce,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):y("",!0),(G=e.task.external_links)!=null&&G.length?(l(),r("div",ds,[(l(!0),r(A,null,se(e.task.external_links,D=>(l(),r("a",{key:D.id,href:D.entity_link,class:"icon size-20",target:"_blank"},[m("img",{src:De(D.app)},null,8,ps)],8,fs))),128))])):y("",!0)])],2))}}}),ks=L({__name:"ListNavigationProvider",setup(s){const t=S();return it(xe,mt(t)),(e,a)=>(l(),r("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[K(e.$slots,"default")],512))}}),vs=L({__name:"TaskListItemStoreProvider",setup(s){const t=q(),e=i=>t.completeTask(i),a=(i,d)=>t.updateItem(i,d),c=async(i,d,g)=>{await t.insert(g.isBefore?"before":"after",i,{...d})},f=async(i,d)=>{await t.insertMany(i,d)},n=async i=>{await t.insert("before",null,i,{shouldPinNewTask:!0})},o=async i=>{await t.deleteItem(i)};return(i,d)=>K(i.$slots,"default",{onComplete:e,onUpdate:a,onInsert:c,onInsertMany:f,onInsertFirst:n,onDelete:o})}}),hs=L({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,a=t,c=S(null),{stop:f}=rt(c,([{isIntersecting:n}])=>{n&&!e.disabled&&a("intersecting")},{rootMargin:"200px"});return $e(()=>{f()}),(n,o)=>(l(),r("div",{ref_key:"elRef",ref:c},[K(n.$slots,"default")],512))}}),_s={key:0,class:"skeleton custom-m-24"},ys={key:0},gs={class:"box custom-py-24 small align-center gray"},de=30,ws=L({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=q(),a=ke(),c=ct(),f=S(de),n=S([]),o=S(!1),i=S(0),d=S(!1),g=P(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:n.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),$=P(()=>g.value.source.slice(0,f.value));j(()=>t,()=>{f.value=de,x()},{deep:!0,immediate:!0});const I=()=>{var h;((h=g.value.source)==null?void 0:h.length)>$.value.length&&(f.value+=de)};async function x(){const{isFetchStream:h,fetchParams:u,disableCheckin:v}=g.value;if(!u||!p(u))return;if(o.value=!1,n.value=[],t.filter==="list"){const C=c.task.value.get(JSON.stringify({list_id:t.listId})),V=c.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ae=c.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),Q=C||V;if(Q)if(t.shouldFilterUncompleted){if(ae)return}else delete u.status,u.starting_from=ut(new Date(Q))}if(i.value=8,t.filter==="list"){const C=a.getItemById(t.listId);i.value=C==null?void 0:C.extended_data.items_count}d.value=!c.task.value.get(JSON.stringify(g.value.fetchParams))&&("status"in g.value.fetchParams?g.value.fetchParams.status!=="0":!0);const T=await e[h?"fetchStream":"fetch"]({...u},{disableCheckin:v});d.value=!1,T&&T.value&&T.value.status_code==="ok"&&t.filter==="search"&&(n.value=[...n.value,...T.value.data],o.value=!n.value.length)}function p(h){return!(!h||h.list_id&&typeof h.list_id!="number"||h.location_id&&typeof h.location_id!="number")}return(h,u)=>d.value?(l(),r("div",_s,[(l(!0),r(A,null,se(i.value,v=>(l(),r("span",{key:v,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(l(),r(A,{key:1},[K(h.$slots,"default",{tasks:$.value}),t.filter==="search"&&o.value?(l(),r("div",ys,[m("p",gs,[z(b(h.$t("searchNoMatches"))+" ",1),m("strong",null,b(t.searchQuery),1)])])):y("",!0),(l(),te(hs,{key:h.$route.fullPath,onIntersecting:I}))],64))}}),bs=L({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=q(),a=me();j(a.currentRoute,async f=>{const n={...f.query};"addNewTask"in n&&(await c(),delete n.addNewTask,a.replace({path:f.path,query:n}))},{immediate:!0});async function c(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(f,n)=>(l(),r("div",{class:"text-gray pl-list-item-title",onClick:c},[n[0]||(n[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),z(" "+b(f.$t("newToDo")),1)]))}}),Is={class:"dialog-header"},Ts={class:"dialog-content empty:tw-hidden"},$s={class:"dialog-footer tw-flex tw-gap-2"},Ce=L({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(s){return(t,e)=>(l(),r(A,null,[m("header",Is,[m("h3",null,b(t.$props.title),1),t.hideCloseIcon?y("",!0):(l(),r("a",{key:0,class:"dialog-close",onClick:e[0]||(e[0]=X(a=>t.$emit("close"),["prevent"]))},e[2]||(e[2]=[m("i",{class:"fas fa-times"},null,-1)])))]),m("div",Ts,[K(t.$slots,"default")]),m("footer",$s,[K(t.$slots,"submit"),t.hideCloseButton?y("",!0):(l(),r("button",{key:0,class:"button light-gray",onClick:e[1]||(e[1]=a=>t.$emit("close"))}," Close "))])],64))}}),xs=L({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(l(),te(Ce,{title:t.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...a)=>t.onDelete&&t.onDelete(...a))}," Delete ")]),default:U(()=>[z(b(t.text)+" ",1)]),_:1},8,["title"]))}}),Ss={class:"tw-w-68"},Ls={class:"menu"},Cs={href:"javascript:void(0);"},Ms={class:"menu"},Ds=["onClick"],Ps=["disabled"],Fs=L({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=dt(),e=ke(),a=S(),c=()=>{a.value&&s.onMove(a.value)};return(f,n)=>(l(),te(Ce,{title:f.title,"hide-close-icon":!0},{submit:U(()=>[m("button",{disabled:!a.value,onClick:X(c,["prevent"])}," Move ",8,Ps)]),default:U(()=>[m("div",Ss,[m("ul",Ls,[(l(!0),r(A,null,se(_(t).items,o=>(l(),r("li",{key:o.uuid||o.id},[m("a",Cs,b(o.name),1),m("ul",Ms,[(l(!0),r(A,null,se(_(e).getListsInPocket(o.id),i=>(l(),r("li",{key:i.uuid||i.id,class:H(a.value===i.id&&"selected rounded")},[m("a",{href:"#",onClick:X(()=>{a.value=a.value===i.id?void 0:i.id},["prevent"])},b(i.name),9,Ds)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Bs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Es={class:"hint"},Ns={class:"hint"},Us=L({__name:"TaskListMultiselect",setup(s){const t=q(),e=S(new Set),{show:a,hide:c}=_e(xs,{title:"Delete",text:ye(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),c()}}),{show:f,hide:n}=_e(Fs,{title:"Move Items",text:ye(()=>`Delete ${e.value.size} selected items?`),onMove:async $=>{await t.sort($,null,[...e.value]),e.value.clear(),n()}}),o=$=>{e.value.add($)},i=$=>{e.value.delete($)},d=()=>{f()},g=()=>{a()};return($,I)=>(l(),r(A,null,[e.value.size?(l(),r("div",Bs,[m("button",{class:"button light-gray smaller",onClick:d},[I[0]||(I[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),z(" "+b($.$t("Move"))+" ",1),m("span",Es,b(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:g},[I[1]||(I[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),z(" "+b($.$t("Delete"))+" ",1),m("span",Ns,b(e.value.size),1)])])):y("",!0),K($.$slots,"default",{onSelect:o,onDeselect:i})],64))}}),As={class:"pl-bg-block custom-pb-4"},Rs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},Os={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},Hs={key:1,class:"custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},zs={key:2,class:"custom-py-12 tw-cursor-pointer heading"},Vs=L({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=q(),a=P(()=>t.filter!=="list");return(c,f)=>(l(),r("div",As,[t.header?(l(),r("div",Rs,[m("h1",null,b(t.header),1)])):y("",!0),M(ks,null,{default:U(()=>[M(ws,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:U(({tasks:n})=>[!n.length&&t.startMessage&&_(e).isPreFilled?(l(),r("div",Os,b(t.startMessage),1)):y("",!0),t.hideAddNewTask?y("",!0):(l(),r("div",Hs,[M(bs,{"addable-props":t.addableProps,"should-pin-new-task":a.value},null,8,["addable-props","should-pin-new-task"])])),c.shouldFilterUncompleted&&!c.hideUncompletedLabel&&n.length?(l(),r("div",zs,b(c.$t("completed")),1)):y("",!0),M(Us,null,{default:U(({onSelect:o,onDeselect:i})=>[M(pt,{items:n,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:o,onDeselect:i},{default:U(({item:d})=>[M(vs,null,{default:U(({onUpdate:g,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u})=>[M(ms,{task:d,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:g,onComplete:$,onInsert:I,onInsertMany:x,onInsertFirst:p,onDelete:h,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{Vs as _,Ce as a};
