import{d as Ee,_ as Be,t as he,a as Ne,b as Ae,e as Ce,u as Re}from"./textToHtmlWithLinks-rgHYrkN3.js";import{r as $,ad as Ue,m as z,ae as B,d as x,a6 as Oe,c as D,af as He,o as l,e as c,j as _,D as ke,t as w,g,n as R,k as ze,L as H,f as m,K as U,A as ve,G as ae,y as K,ag as Q,ah as me,a7 as Ie,ai as ie,aj as qe,ak as We,al as Te,am as je,an as Ke,ao as Ve,ap as Qe,aq as Ze,ar as Je,as as Xe,B as j,F as q,x as ee,i as J,u as Ye,a3 as Ge,h as M,q as F,at as et,R as tt,U as st,Q as at,au as nt,av as _e,aw as re,p as ot,M as $e,s as xe,w as W,ax as lt,ay as Se,az as it,aA as rt,l as ut,aB as ct,S as te,aC as dt,aD as ft,aE as pt,H as mt,aF as ye,aG as ge,z as kt,aH as vt,v as ht,W as _t}from"./index-kcpnesMQ.js";import{m as ue,g as G,a as yt,s as we}from"./sanitizer-TiisBOmJ.js";import{_ as gt}from"./SortableList.vue_vue_type_style_index_0_lang-9_VIBgID.js";function wt(s){const t=$([]),e=new Set;Ue(s,()=>{s.value&&(t.value=[...s.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),z(t,()=>{for(const[f]of e.entries())typeof f=="function"&&f(),e.delete(f)});const n=f=>{e.add(f)},d=f=>t.value.findIndex(k=>k.isEqualNode(f)),i=f=>t.value[d(f)-1],a=f=>t.value[d(f)+1],o=(f,k)=>{if(f){const u=a(f);if(u instanceof HTMLElement)return u.focus(),k&&ue(u),u}else{const u=t.value[0];u instanceof HTMLElement&&u.focus()}},r=(f,k,u)=>{if(f.target instanceof HTMLElement){const h=f.target,I=G(h),S=k==="up"?i(h):a(h);S instanceof HTMLElement&&(f.preventDefault(),S.focus(),yt(S,I),typeof u=="function"&&u())}};return{getPreviousElementSibling:i,getNextElementSibling:a,getCurrentPositionInNavigationList:d,focusNextTask:o,focusTaskById:(f,k)=>{const u=t.value.find(h=>{var I;return h instanceof HTMLElement&&((I=h.dataset)==null?void 0:I.id)==f});u instanceof HTMLElement&&(u.focus(),k&&ue(u))},onUp:(f,k)=>{r(f,"up",k)},onDown:(f,k)=>{r(f,"down",k)},onLeft:(f,k)=>{if(f.target instanceof HTMLElement){const u=f.target;if(G(u)===0){const h=i(u);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),ue(h),typeof k=="function"&&k())}}},onRight:(f,k)=>{if(f.target instanceof HTMLElement){const u=f.target;if(G(u)===u.innerText.length){const h=a(u);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),typeof k=="function"&&k())}}},nextUpdate:n}}const bt=s=>{const t=B(s);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},Lt={class:"flexbox space-8 middle smaller empty:tw-hidden"},Ct={key:4},It=x({__name:"TaskListItemPopupLine",props:{task:{}},setup(s){const t=Oe(),{currentLabel:e}=Ee(()=>s.task),n=D(()=>He(s.task)),d=D(()=>({"text-red":n.value===3,"text-yellow":n.value===2,"text-green":n.value===1,grey:n.value===0}));return(i,a)=>{var o;return l(),c("div",Lt,[_(e)?(l(),c("div",{key:0,class:"badge squared",style:ke(`background: #${_(e).color};`)},w(_(e).name),5)):g("",!0),i.task.due_datetime&&!i.task.status?(l(),c("div",{key:1,class:R(["semibold",d.value])},w(_(ze)(i.task.due_datetime).format("LLL")),3)):i.task.due_date&&!i.task.status?(l(),c("div",{key:2,class:R(["semibold",d.value])},w(_(H)(i.task.due_date).format("LL")),3)):g("",!0),i.task.due_date&&i.task.repeat_frequency&&i.task.repeat_interval?(l(),c("div",{key:3,class:R(d.value)},[a[0]||(a[0]=m("i",{class:"fas fa-redo text-light-gray"},null,-1)),U(" "+w(i.$t(`everyX.${i.task.repeat_interval}`,{n:i.task.repeat_frequency,days:i.$t(i.task.repeat_interval,{count:i.task.repeat_frequency})})),1)],2)):g("",!0),i.task.location_id?(l(),c("div",Ct,[a[1]||(a[1]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),U(" "+w((o=_(t).getItemById(i.task.location_id))==null?void 0:o.name)+" "+w(_(bt)(_(t).distanceById(i.task.location_id))),1)])):g("",!0)])}}}),Tt={class:"icon"},$t=["src"],xt=x({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(s){const t=ve(),e=ae(),n=D(()=>!t.currentRoute.value.params.listId),d=D(()=>s.task.list_id&&n.value?e.itemsMap[s.task.list_id]:null),i=()=>{if(!d.value)return;const a=t.resolve({name:"list",params:{listId:d.value.id}});window.open(a.href,"_blank")};return(a,o)=>(l(),c("div",{class:R(["flexbox middle",{"space-12":!a.isFocused}])},[a.isFocused?(l(),K(Be,{key:0,task:a.task,input:a.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(l(),K(It,{key:1,task:a.task},null,8,["task"])),d.value?(l(),c("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:i},[m("div",Tt,[m("img",{src:d.value.icon_url,loading:"lazy"},null,8,$t)]),U(" "+w(d.value.name),1)])):g("",!0)],2))}}),Me=Ke?window:void 0;function Y(s){var t;const e=B(s);return(t=e==null?void 0:e.$el)!=null?t:e}function Z(...s){const t=[],e=()=>{t.forEach(o=>o()),t.length=0},n=(o,r,p,y)=>(o.addEventListener(r,p,y),()=>o.removeEventListener(r,p,y)),d=D(()=>{const o=ie(B(s[0])).filter(r=>r!=null);return o.every(r=>typeof r!="string")?o:void 0}),i=qe(()=>{var o,r;return[(r=(o=d.value)==null?void 0:o.map(p=>Y(p)))!=null?r:[Me].filter(p=>p!=null),ie(B(d.value?s[1]:s[0])),ie(_(d.value?s[2]:s[1])),B(d.value?s[3]:s[2])]},([o,r,p,y])=>{if(e(),!(o!=null&&o.length)||!(r!=null&&r.length)||!(p!=null&&p.length))return;const C=We(y)?{...y}:y;t.push(...o.flatMap(L=>r.flatMap(T=>p.map(f=>n(L,T,f,C)))))},{flush:"post"}),a=()=>{i(),e()};return Te(e),a}let be=!1;function Le(s,t,e={}){const{window:n=Me,ignore:d=[],capture:i=!0,detectIframe:a=!1,controls:o=!1}=e;if(!n)return o?{stop:Q,cancel:Q,trigger:Q}:Q;if(me&&!be){be=!0;const u={passive:!0};Array.from(n.document.body.children).forEach(h=>Z(h,"click",Q,u)),Z(n.document.documentElement,"click",Q,u)}let r=!0;const p=u=>B(d).some(h=>{if(typeof h=="string")return Array.from(n.document.querySelectorAll(h)).some(I=>I===u.target||u.composedPath().includes(I));{const I=Y(h);return I&&(u.target===I||u.composedPath().includes(I))}});function y(u){const h=B(u);return h&&h.$.subTree.shapeFlag===16}function C(u,h){const I=B(u),S=I.$.subTree&&I.$.subTree.children;return S==null||!Array.isArray(S)?!1:S.some(V=>V.el===h.target||h.composedPath().includes(V.el))}const L=u=>{const h=Y(s);if(u.target!=null&&!(!(h instanceof Element)&&y(s)&&C(s,u))&&!(!h||h===u.target||u.composedPath().includes(h))){if("detail"in u&&u.detail===0&&(r=!p(u)),!r){r=!0;return}t(u)}};let T=!1;const f=[Z(n,"click",u=>{T||(T=!0,setTimeout(()=>{T=!1},0),L(u))},{passive:!0,capture:i}),Z(n,"pointerdown",u=>{const h=Y(s);r=!p(u)&&!!(h&&!u.composedPath().includes(h))},{passive:!0}),a&&Z(n,"blur",u=>{setTimeout(()=>{var h;const I=Y(s);((h=n.document.activeElement)==null?void 0:h.tagName)==="IFRAME"&&!(I!=null&&I.contains(n.document.activeElement))&&t(u)},0)},{passive:!0})].filter(Boolean),k=()=>f.forEach(u=>u());return o?{stop:k,cancel:()=>{r=!1},trigger:u=>{r=!0,L(u),r=!1}}:k}const St={mounted(s,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")s.__onClickOutside_stop=Le(s,t.value,{capture:e});else{const[n,d]=t.value;s.__onClickOutside_stop=Le(s,n,Object.assign({capture:e},d))}},unmounted(s){s.__onClickOutside_stop()}};function ce(s){return typeof Window<"u"&&s instanceof Window?s.document.documentElement:typeof Document<"u"&&s instanceof Document?s.documentElement:s}function De(s){const t=window.getComputedStyle(s);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&s.clientWidth<s.scrollWidth||t.overflowY==="auto"&&s.clientHeight<s.scrollHeight)return!0;{const e=s.parentNode;return!e||e.tagName==="BODY"?!1:De(e)}}function Mt(s){const t=s||window.event,e=t.target;return De(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const de=new WeakMap;function Dt(s,t=!1){const e=Ie(t);let n=null,d="";z(je(s),o=>{const r=ce(B(o));if(r){const p=r;if(de.get(p)||de.set(p,p.style.overflow),p.style.overflow!=="hidden"&&(d=p.style.overflow),p.style.overflow==="hidden")return e.value=!0;if(e.value)return p.style.overflow="hidden"}},{immediate:!0});const i=()=>{const o=ce(B(s));!o||e.value||(me&&(n=Z(o,"touchmove",r=>{Mt(r)},{passive:!1})),o.style.overflow="hidden",e.value=!0)},a=()=>{const o=ce(B(s));!o||!e.value||(me&&(n==null||n()),o.style.overflow=d,de.delete(o),e.value=!1)};return Te(a),D({get(){return e.value},set(o){o?i():a()}})}function Pt(){let s=!1;const t=Ie(!1);return(e,n)=>{if(t.value=n.value,s)return;s=!0;const d=Dt(e,n.value);z(t,i=>d.value=i)}}Pt();const Ft=s=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return s.replace(e,"")},Et=s=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(s)},Bt=Ve("syncError",()=>{const s=Qe(Ze(Je(()=>Xe.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:D(()=>new Map(s.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Nt(s){return s<1024?`${s} B`:s<1024*1024?`${Math.floor(s/1024)} KB`:`${Math.floor(s/1048576)} MB`}const At={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Rt=["href"],Ut=["src"],Ot={class:"bold"},Ht={key:0,class:"hint custom-ml-4 nowrap"},zt=["onClick"],qt=x({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(s){const t=j(),e=n=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(s.task,[n])};return(n,d)=>{var i;return(i=n.task.attachments)!=null&&i.length?(l(),c("div",At,[(l(!0),c(q,null,ee(n.task.attachments,a=>(l(),c("div",{key:a.uuid||a.id,class:"pl-attachments__item small"},[m("a",{href:a.download_url,target:"_blank"},[a.preview_url?(l(),c("img",{key:0,src:a.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,Ut)):(l(),c(q,{key:1},[m("span",Ot,w(a.file_name),1),a.size?(l(),c("span",Ht,w(_(Nt)(a.size)),1)):g("",!0)],64))],8,Rt),n.isFocused?(l(),c("div",{key:0,class:R(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":a.preview_url}])},[m("a",{class:R(a.preview_url?"button circle white":"custom-ml-8"),onClick:J(o=>e(a.id),["prevent"])},d[0]||(d[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,zt)],2)):g("",!0)]))),128))])):g("",!0)}}}),fe=x({__name:"UserPic",props:{userId:{}},setup(s){const t=s,e=Ye(),n=D(()=>e.getItemById(t.userId));return(d,i)=>{var a;return(a=n.value)!=null&&a.photo_url?(l(),c("span",{key:0,class:"icon userpic",style:ke({backgroundImage:`url(${n.value.photo_url})`})},null,4)):g("",!0)}}}),Wt={key:0,class:"tw-cursor-pointer"},jt={key:0,class:"pl-list-item-firedBullet"},Kt={key:1,class:"tw-cursor-pointer"},Vt=x({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(s,{emit:t}){const e=s,n=t,d=$(e.task.status===1);z(()=>e.task.status,o=>{d.value=o===1});const i=D(()=>Ge(e.task)),a=()=>{d.value=!d.value,n("complete")};return(o,r)=>(l(),c("div",{class:"tw-w-5 tw-flex-none",onClick:a},[M(st,{name:"bounce",mode:"out-in"},{default:F(()=>{var p;return[d.value?(l(),c("div",Kt,r[0]||(r[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(l(),c("div",Wt,[i.value===_(et)?(l(),c("div",jt)):(l(),c("div",{key:1,class:"pl-list-item-bullet",style:ke(`background-color: ${(p=_(tt).get(i.value))==null?void 0:p.color}`)},null,4))]))]}),_:1})]))}}),Qt=new WeakMap;function Zt(){const s=at(),t=ve(),e=()=>{var r;const i=[...s.matched].reverse().find(p=>{var y;return(y=p.meta)==null?void 0:y.isListView})||null,a=((r=i==null?void 0:i.children)==null?void 0:r.find(p=>{var y;return(y=p.meta)==null?void 0:y.isTaskInfoView}))||null,o={listViewRoute:i,taskInfoRoute:a};return Qt.set(s,o),o};return{navigateToTaskInfo:async d=>{const{listViewRoute:i,taskInfoRoute:a}=e();if(!i||!(a!=null&&a.name))return console.warn("Required routes not found"),!1;try{const o=await t.push({name:a.name,params:{taskId:d}});return!nt(o)}catch(o){return console.error("Navigation failed:",o),!1}}}}const Jt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},Xt={class:"hint"},Yt={class:"hint"},Gt={class:"hint"},es={class:"tw-clear-both tw-inline-block"},ts=["placeholder","data-id","innerHTML"],ss=["innerHTML"],as={class:"flexbox space-8 custom-pt-2 tw-flex-none"},ns={key:0},os={key:1},ls={key:2,class:"tw-flex-none"},is=["title"],rs=["title"],us={class:"bold small"},cs={key:5,class:"hint tw-flex-none custom-mt-2"},ds={key:6,class:"hint tw-flex-none custom-mt-2"},fs={key:0},ps={key:1},ms={key:7,class:"hint tw-flex-none custom-mt-2"},ks={key:8,class:"flexbox middle tw-flex-none"},vs={key:9,class:"flexbox middle tw-flex-none"},hs={key:10,class:"flexbox middle tw-flex-none"},_s={key:11,class:"flexbox middle space-4 tw-flex-none"},ys=["href"],gs=["src"],ws=x({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(s,{emit:t}){const e=s,n=t,d=j(),i=Bt(),{navigateToTaskInfo:a}=Zt(),o=_e(Se),r=_e(it),p=$(!1),y=$(!1),C=$(e.task.name),L=$(e.task.status);z(()=>e.task.status,b=>{L.value=b});const T=$();let f=null;z(p,()=>{if(p.value)return;const b=T.value.innerText.trim();if(re(e.task)&&!b){y.value=!0,n("delete",e.task);return}e.task.name!==b&&n("update",e.task,{name:b})}),ot(()=>{re(e.task)&&(T.value.focus(),p.value=!0)}),$e(()=>{f&&(clearTimeout(f),f=null)});const k=()=>{rt()||(p.value=!1)},u=()=>{n("complete",e.task)},h=()=>{L.value=L.value?0:1,T.value.classList.toggle("opacity-50"),!(f&&(clearTimeout(f),f=null,e.task.status===L.value))&&(f=setTimeout(u,1e3))},I=b=>{if(b.target instanceof HTMLAnchorElement){const v=b.target.href;b.preventDefault(),setTimeout(()=>{window.open(v,"_blank")})}},S=b=>{var O;b.preventDefault();const v=(O=b.clipboardData)==null?void 0:O.getData("text/plain");if(!v)return;if(T.value.innerText){document.execCommand("insertText",!1,v);return}const N=v.split(`
`).filter(A=>A);N.length&&n("insertMany",e.task,N.map(A=>({name:Ft(A),...e.addableProps,...Et(A)?{status:1}:{}})))},V=b=>{G(b.target)===0&&(o==null||o.onLeft(b),y.value=!0,n("delete",e.task))},ne=async b=>{if(b.shiftKey)return;if(b.preventDefault(),e.isEnterDisabled){oe(!0),await ut(),n("insertFirst",{...e.addableProps});return}const v=b.target,N=v.innerText.trim(),O=G(v);let A="",X=!0;O===0&&N||(v.innerText=N.substring(0,O).trim(),A=N.substring(O,N.length).trim(),X=!1),n("insert",e.task,{...e.addableProps,name:A},{isBefore:X}),oe()},se=b=>{C.value=b.target.innerText};function oe(b=!1){const v=()=>{T.value.blur(),p.value=!1};if(b){v();return}setTimeout(()=>{v()})}const Pe=()=>{n("update",e.task,{favorite:e.task.favorite?0:1})},le=async b=>{b.target.closest("[contenteditable], .chips li, a")===null&&await a(e.task.id)};function Fe(b){return new URL(Object.assign({"../../assets/apps/shop.svg":Ne,"../../assets/apps/tasks.svg":Ae})[`../../assets/apps/${b}.svg`],import.meta.url).href}return(b,v)=>{var N,O,A,X;return y.value?g("",!0):(l(),c("div",{key:0,class:R(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":b.$route.meta.isTaskInfoView&&((N=b.$route.params)==null?void 0:N.taskId)==e.task.id,highlighted:_(d).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(l(),c("div",Jt,v[7]||(v[7]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):g("",!0),M(Vt,{task:e.task,onComplete:h},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:le},[(O=_(r))!=null&&O.is_debug_mode?(l(),c(q,{key:0},[m("span",Xt,"list_id: "+w(String(e.task.list_id)),1),v[8]||(v[8]=U(" | ")),m("span",Yt,"id: "+w(e.task.id),1),v[9]||(v[9]=U(" | ")),m("span",Gt,"srank: "+w(String(e.task.sort))+" | "+w(String(e.task.rank)),1)],64)):g("",!0),xe((l(),c("div",null,[m("div",es,[m("div",{ref_key:"contenteditableRef",ref:T,contenteditable:"",class:R(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(ne,["enter"]),v[0]||(v[0]=W(P=>{var E;(E=_(o))==null||E.onLeft(P,()=>{p.value=!1})},["left"])),v[1]||(v[1]=W(P=>{var E;(E=_(o))==null||E.onUp(P,()=>{p.value=!1})},["up"])),v[2]||(v[2]=W(P=>{var E;(E=_(o))==null||E.onRight(P,()=>{p.value=!1})},["right"])),v[3]||(v[3]=W(P=>{var E;(E=_(o))==null||E.onDown(P,()=>{p.value=!1})},["down"])),W(V,["delete"]),v[4]||(v[4]=W(()=>{oe()},["esc"])),v[5]||(v[5]=W(()=>{p.value=!1},["tab"]))],onMousedown:I,onFocus:v[6]||(v[6]=P=>p.value=!0),onPaste:S,onInput:se,innerHTML:_(we)(p.value?e.task.name:_(he)(e.task.name))},null,42,ts)]),e.task.note?(l(),c("div",{key:0,class:"hint break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(we)(_(he)(e.task.note))},null,8,ss)):g("",!0),M(xt,{task:b.task,input:C.value,"is-focused":p.value},null,8,["task","input","is-focused"])])),[[_(St),k]]),M(qt,{task:e.task,"is-focused":p.value},null,8,["task","is-focused"])]),m("div",as,[e.showInfoLink?(l(),c("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:J(le,["prevent"])},v[10]||(v[10]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):g("",!0),L.value?g("",!0):(l(),c("div",{key:1,class:R(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:Pe},[e.task.favorite?(l(),c("span",ns,v[11]||(v[11]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(l(),c("span",os,v[12]||(v[12]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(i).taskErrorMap.get(e.task.id)?(l(),c("div",ls,[m("span",{class:"icon",style:{color:"orange"},title:_(i).taskErrorMap.get(e.task.id)},v[13]||(v[13]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,is)])):g("",!0),!_(lt)(e.task)&&!_(re)(e.task)?(l(),c("div",{key:3,class:"tw-flex-none",title:b.$t("syncing")},v[14]||(v[14]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,rs)):g("",!0),(A=e.task.extended_data)!=null&&A.comments_count?(l(),c("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:J(le,["prevent"])},[v[15]||(v[15]=m("i",{class:"fas fa-comment"},null,-1)),m("span",us,w(e.task.extended_data.comments_count),1)])):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(l(),c("div",cs,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0),!L.value&&e.task.assigned_contact_id?(l(),c("div",ds,[e.task.update_datetime?(l(),c("span",fs,w(_(H)().to(_(H)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(l(),c("span",ps,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0)])):g("",!0),e.task.complete_datetime?(l(),c("div",ms,w(_(H)().to(_(H)(e.task.complete_datetime),!0)),1)):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.contact_id?(l(),c("div",ks,[M(fe,{"user-id":e.task.contact_id},null,8,["user-id"])])):g("",!0),!L.value&&e.task.assigned_contact_id?(l(),c("div",vs,[M(fe,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):g("",!0),L.value&&e.task.complete_contact_id?(l(),c("div",hs,[M(fe,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):g("",!0),(X=e.task.external_links)!=null&&X.length?(l(),c("div",_s,[(l(!0),c(q,null,ee(e.task.external_links,P=>(l(),c("a",{key:P.id,href:P.entity_link,class:"icon size-20",target:"_blank"},[m("img",{src:Fe(P.app)},null,8,gs)],8,ys))),128))])):g("",!0)])],2))}}}),bs=x({__name:"ListNavigationProvider",setup(s){const t=$();return ct(Se,wt(t)),(e,n)=>(l(),c("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[te(e.$slots,"default")],512))}}),Ls=x({__name:"TaskListItemStoreProvider",setup(s){const t=j(),e=r=>t.completeTask(r),n=(r,p)=>t.updateItem(r,p),d=async(r,p,y)=>{await t.insert(y.isBefore?"before":"after",r,{...p})},i=async(r,p)=>{await t.insertMany(r,p)},a=async r=>{await t.insert("before",null,r,{shouldPinNewTask:!0})},o=async r=>{await t.deleteItem(r)};return(r,p)=>te(r.$slots,"default",{onComplete:e,onUpdate:n,onInsert:d,onInsertMany:i,onInsertFirst:a,onDelete:o})}}),Cs=x({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(s,{emit:t}){const e=s,n=t,d=$(null),{stop:i}=dt(d,([{isIntersecting:a}])=>{a&&!e.disabled&&n("intersecting")},{rootMargin:"200px"});return $e(()=>{i()}),(a,o)=>(l(),c("div",{ref_key:"elRef",ref:d},[te(a.$slots,"default")],512))}}),Is={key:0,class:"skeleton custom-m-24"},Ts={key:0},$s={class:"box custom-py-24 small align-center gray"},pe=30,xs=x({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(s){const t=s,e=j(),n=ae(),d=pt(),i=$(pe),a=$([]),o=$(!1),r=$(0),p=$(!1),y=D(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:a.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),C=D(()=>y.value.source.slice(0,i.value));z(()=>t,()=>{i.value=pe,T()},{deep:!0,immediate:!0});const L=()=>{var k;((k=y.value.source)==null?void 0:k.length)>C.value.length&&(i.value+=pe)};async function T(){const{isFetchStream:k,fetchParams:u,disableCheckin:h}=y.value;if(!u||!f(u))return;if(o.value=!1,a.value=[],t.filter==="list"){const S=d.task.value.get(JSON.stringify({list_id:t.listId})),V=d.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ne=d.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),se=S||V;if(se)if(t.shouldFilterUncompleted){if(ne)return}else delete u.status,u.starting_from=ft(new Date(se))}if(r.value=8,t.filter==="list"){const S=n.getItemById(t.listId);r.value=S==null?void 0:S.extended_data.items_count}p.value=!d.task.value.get(JSON.stringify(y.value.fetchParams))&&("status"in y.value.fetchParams?y.value.fetchParams.status!=="0":!0);const I=await e[k?"fetchStream":"fetch"]({...u},{disableCheckin:h});p.value=!1,I&&I.value&&I.value.status_code==="ok"&&t.filter==="search"&&(a.value=[...a.value,...I.value.data],o.value=!a.value.length)}function f(k){return!(!k||k.list_id&&typeof k.list_id!="number"||k.location_id&&typeof k.location_id!="number")}return(k,u)=>p.value?(l(),c("div",Is,[(l(!0),c(q,null,ee(r.value,h=>(l(),c("span",{key:h,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(l(),c(q,{key:1},[te(k.$slots,"default",{tasks:C.value}),t.filter==="search"&&o.value?(l(),c("div",Ts,[m("p",$s,[U(w(k.$t("searchNoMatches"))+" ",1),m("strong",null,w(t.searchQuery),1)])])):g("",!0),(l(),K(Cs,{key:k.$route.fullPath,onIntersecting:L}))],64))}}),Ss=x({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(s){const t=s,e=j(),n=ve();z(n.currentRoute,async i=>{const a={...i.query};"addNewTask"in a&&(await d(),delete a.addNewTask,n.replace({path:i.path,query:a}))},{immediate:!0});async function d(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(i,a)=>(l(),c("div",{class:"text-gray pl-list-item-title",onClick:d},[a[0]||(a[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),U(" "+w(i.$t("newToDo")),1)]))}}),Ms=x({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(s){return(t,e)=>(l(),K(Ce,{title:t.title,"hide-close-icon":!0},{submit:F(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...n)=>t.onDelete&&t.onDelete(...n))}," Delete ")]),default:F(()=>[U(w(t.text)+" ",1)]),_:1},8,["title"]))}}),Ds={class:"tw-w-68"},Ps={class:"menu"},Fs={href:"javascript:void(0);"},Es={class:"menu"},Bs=["onClick"],Ns=["disabled"],As=x({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(s){const t=mt(),e=ae(),n=$(),d=()=>{n.value&&s.onMove(n.value)};return(i,a)=>(l(),K(Ce,{title:i.title,"hide-close-icon":!0},{submit:F(()=>[m("button",{disabled:!n.value,onClick:J(d,["prevent"])}," Move ",8,Ns)]),default:F(()=>[m("div",Ds,[m("ul",Ps,[(l(!0),c(q,null,ee(_(t).items,o=>(l(),c("li",{key:o.uuid||o.id},[m("a",Fs,w(o.name),1),m("ul",Es,[(l(!0),c(q,null,ee(_(e).getListsInPocket(o.id),r=>(l(),c("li",{key:r.uuid||r.id,class:R(n.value===r.id&&"selected rounded")},[m("a",{href:"#",onClick:J(()=>{n.value=n.value===r.id?void 0:r.id},["prevent"])},w(r.name),9,Bs)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Rs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Us={class:"hint"},Os={class:"hint"},Hs=x({__name:"TaskListMultiselect",setup(s){const t=j(),e=$(new Set),{show:n,hide:d}=ye(Ms,{title:"Delete",text:ge(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),d()}}),{show:i,hide:a}=ye(As,{title:"Move Items",text:ge(()=>`Delete ${e.value.size} selected items?`),onMove:async C=>{await t.sort(C,null,[...e.value]),e.value.clear(),a()}}),o=C=>{e.value.add(C)},r=C=>{e.value.delete(C)},p=()=>{i()},y=()=>{n()};return(C,L)=>(l(),c(q,null,[e.value.size?(l(),c("div",Rs,[m("button",{class:"button light-gray smaller",onClick:p},[L[0]||(L[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),U(" "+w(C.$t("Move"))+" ",1),m("span",Us,w(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:y},[L[1]||(L[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),U(" "+w(C.$t("Delete"))+" ",1),m("span",Os,w(e.value.size),1)])])):g("",!0),te(C.$slots,"default",{onSelect:o,onDeselect:r})],64))}}),zs="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.32594%207.70265C7.97656%207.35329%207.41285%207.34569%207.05419%207.68545L0.468799%2013.819C-0.0347521%2014.296%20-0.0455698%2015.0948%200.444949%2015.5853C0.934984%2016.0753%201.73243%2016.0645%202.20909%2015.5614L8.34314%208.97661C8.6834%208.61748%208.67574%208.05242%208.32594%207.70265Z'%20fill='black'/%3e%3cpath%20d='M2.55008%203.99187C2.58461%203.8699%202.75749%203.8699%202.79201%203.99187L3.24893%205.60604C3.29055%205.75306%203.40545%205.86796%203.55246%205.90957L5.16664%206.36649C5.28861%206.40102%205.28861%206.57389%205.16664%206.60842L3.55246%207.06534C3.40545%207.10695%203.29055%207.22186%203.24893%207.36887L2.79201%208.98304C2.75749%209.10501%202.58461%209.10501%202.55008%208.98304L2.09317%207.36887C2.05155%207.22186%201.93665%207.10695%201.78963%207.06534L0.17546%206.60842C0.0534922%206.57389%200.0534924%206.40102%200.175461%206.36649L1.78963%205.90957C1.93665%205.86796%202.05155%205.75306%202.09317%205.60604L2.55008%203.99187Z'%20fill='%23EE6622'/%3e%3cpath%20d='M5.00052%200.122182C5.02707%200.0302363%205.16006%200.0302364%205.18661%200.122182L5.53809%201.33902C5.5701%201.44985%205.65849%201.53647%205.77158%201.56784L7.01325%201.91228C7.10707%201.93831%207.10707%202.06863%207.01325%202.09466L5.77158%202.43911C5.65849%202.47048%205.5701%202.5571%205.53809%202.66792L5.18661%203.88476C5.16006%203.97671%205.02707%203.97671%205.00052%203.88476L4.64904%202.66792C4.61703%202.5571%204.52864%202.47048%204.41555%202.43911L3.17388%202.09466C3.08006%202.06863%203.08006%201.93831%203.17388%201.91228L4.41555%201.56784C4.52864%201.53647%204.61703%201.44985%204.64904%201.33902L5.00052%200.122182Z'%20fill='%2355DDDD'/%3e%3cpath%20d='M8.73211%2011.8502C8.75813%2011.7583%208.88846%2011.7583%208.91448%2011.8502L9.25893%2013.067C9.2903%2013.1779%209.37692%2013.2645%209.48775%2013.2959L10.7046%2013.6403C10.7965%2013.6663%2010.7965%2013.7967%2010.7046%2013.8227L9.48775%2014.1671C9.37692%2014.1985%209.2903%2014.2851%209.25893%2014.3959L8.91448%2015.6128C8.88846%2015.7047%208.75813%2015.7047%208.73211%2015.6128L8.38766%2014.3959C8.35629%2014.2851%208.26967%2014.1985%208.15884%2014.1671L6.94201%2013.8227C6.85006%2013.7967%206.85006%2013.6663%206.94201%2013.6403L8.15884%2013.2959C8.26967%2013.2645%208.35629%2013.1779%208.38766%2013.067L8.73211%2011.8502Z'%20fill='%23F5C400'/%3e%3cpath%20d='M13.3484%209.16196C13.3813%209.04562%2013.5462%209.04562%2013.5791%209.16196L14.015%2010.7016C14.0547%2010.8419%2014.1643%2010.9515%2014.3045%2010.9912L15.8442%2011.427C15.9605%2011.4599%2015.9605%2011.6248%2015.8442%2011.6578L14.3045%2012.0936C14.1643%2012.1333%2014.0547%2012.2429%2014.015%2012.3831L13.5791%2013.9228C13.5462%2014.0391%2013.3813%2014.0391%2013.3484%2013.9228L12.9125%2012.3831C12.8728%2012.2429%2012.7633%2012.1333%2012.623%2012.0936L11.0833%2011.6578C10.967%2011.6248%2010.967%2011.4599%2011.0833%2011.427L12.623%2010.9912C12.7633%2010.9515%2012.8728%2010.8419%2012.9125%2010.7016L13.3484%209.16196Z'%20fill='%2322CC22'/%3e%3cpath%20d='M10.7288%200.228994C10.7952%20-0.00536791%2011.1274%20-0.00536752%2011.1937%200.228994L12.0717%203.33062C12.1516%203.61311%2012.3724%203.83389%2012.6549%203.91386L15.7565%204.79183C15.9909%204.85816%2015.9909%205.19035%2015.7565%205.25669L12.6549%206.13466C12.3724%206.21462%2012.1516%206.4354%2012.0717%206.71789L11.1937%209.81952C11.1274%2010.0539%2010.7952%2010.0539%2010.7288%209.81952L9.85087%206.71789C9.77091%206.4354%209.55012%206.21462%209.26763%206.13466L6.16601%205.25669C5.93164%205.19035%205.93164%204.85816%206.16601%204.79183L9.26763%203.91386C9.55012%203.83389%209.77091%203.61311%209.85087%203.33062L10.7288%200.228994Z'%20fill='%230088EE'/%3e%3c/svg%3e",qs=["src","onClick"],Ws={class:"custom-p-12"},js={class:"small custom-mb-8"},Ks=["placeholder","disabled"],Vs={class:"flexbox middle"},Qs=["disabled"],Zs={key:0,class:"spinner"},Js={key:0,class:"custom-mt-4 text-red"},Xs=x({__name:"TaskListAI",props:{listId:{}},setup(s){const t=s,{t:e}=kt(),n=j(),d=ae(),i=$(),a=$(""),o=D(()=>{var f;return((f=d.getItemById(t.listId))==null?void 0:f.name)??void 0}),{data:r,error:p,isFetching:y,execute:C}=vt(D(()=>`pocketlists.ai.gpt?prompt=${a.value||o.value}`),{immediate:!1}).json(),{showIfNotPremium:L}=Re(e("listAIPremiumMessage"),{immediate:!1});z(()=>{var f;return(f=i.value)==null?void 0:f.isOpened},f=>{f&&L()});const T=async()=>{if(!(!a.value&&!o.value)){await C();try{const f=JSON.parse(r.value.data.text);if(!f.length)return;await n.insertToList(t.listId,f.map(k=>({name:k}))),a.value="",i.value.isOpened=!1}catch{}}};return(f,k)=>(l(),K(_t,{ref_key:"dropdownRef",ref:i},{default:F(({handler:u,setRef:h})=>[m("img",{ref:h,src:_(zs),class:"tw-cursor-pointer",onClick:u},null,8,qs)]),body:F(()=>[m("div",Ws,[m("div",js,w(f.$t("listAILabel")),1),xe(m("textarea",{"onUpdate:modelValue":k[0]||(k[0]=u=>a.value=u),class:"width-100 custom-mb-8 small",placeholder:o.value,style:{height:"4rem",resize:"none"},disabled:_(y)},null,8,Ks),[[ht,a.value]]),m("div",Vs,[m("button",{class:"small",disabled:_(y),onClick:J(T,["prevent"])},w(f.$t("write")),9,Qs),_(y)?(l(),c("div",Zs)):g("",!0)]),_(p)?(l(),c("div",Js,w(f.$t("Error")),1)):g("",!0)])]),_:1},512))}}),Ys={class:"pl-bg-block custom-pb-4"},Gs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},ea={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},ta={key:1,class:"flexbox middle custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},sa={class:"wide"},aa={key:2,class:"custom-py-12 tw-cursor-pointer heading"},ra=x({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(s){const t=s,e=j(),n=D(()=>t.filter!=="list");return(d,i)=>(l(),c("div",Ys,[t.header?(l(),c("div",Gs,[m("h1",null,w(t.header),1)])):g("",!0),M(bs,null,{default:F(()=>[M(xs,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:F(({tasks:a})=>[!a.length&&t.startMessage&&_(e).isPreFilled?(l(),c("div",ea,w(t.startMessage),1)):g("",!0),t.hideAddNewTask?g("",!0):(l(),c("div",ta,[m("div",sa,[M(Ss,{"addable-props":t.addableProps,"should-pin-new-task":n.value},null,8,["addable-props","should-pin-new-task"])]),t.listId?(l(),K(Xs,{key:0,"list-id":t.listId},null,8,["list-id"])):g("",!0)])),d.shouldFilterUncompleted&&!d.hideUncompletedLabel&&a.length?(l(),c("div",aa,w(d.$t("completed")),1)):g("",!0),M(Hs,null,{default:F(({onSelect:o,onDeselect:r})=>[M(gt,{items:a,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:o,onDeselect:r},{default:F(({item:p})=>[M(Ls,null,{default:F(({onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:f,onDelete:k,onBlur:u})=>[M(ws,{task:p,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:f,onDelete:k,onBlur:u},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{ra as _};
