import{d as b,c as h,u as T,f as M,l as C,a as m,b as a,e as y,r as d,g as R,w as B,n as S,o as w,h as f,i as t,j as _,k as z,F as N,m as V,t as p,p as v,T as $,q as I,v as D,s as O,x as P,y as q}from"./index-iEZuSWHI.js";import{O as A}from"./dayjs.min-7XySSGo5.js";const E=async()=>{const r=Array(10).fill(null).map(()=>({id:a.string.uuid(),task_id:a.string.uuid(),title:a.company.buzzPhrase(),created_at:a.date.past().getTime(),message:a.lorem.paragraph(),name:a.internet.displayName()}));await m.chatMessages.bulkPut(r)},F=b("chats",()=>{const r=h(()=>s=>T(M(C(()=>m.chatMessages.where("task_id").notEqual(s).sortBy("created_at"))),{initialValue:[]})),n=async s=>{const l={id:a.string.uuid(),task_id:a.string.uuid(),title:a.company.buzzPhrase(),created_at:new Date().getTime(),message:s,name:a.internet.displayName()};try{return await m.chatMessages.put(l),l}catch(e){console.log(e)}};return E(),{getMessgesByTaskId:r,addMessage:n}}),K={class:"tw-h-full tw-flex tw-flex-col"},L={class:"tw-flex tw-gap-2"},j={class:"hint"},G={class:"state-with-inner-icon right tw-w-full"},H=y({__name:"TaskChat",setup(r){const n=F(),s=d(),l=d(),e=n.getMessgesByTaskId(""),c=d(!1),{y:x}=R(),u=d(""),k=h(()=>128-x.value);B(e,async()=>{await S(),s.value&&(s.value.scrollTop=s.value.scrollHeight),c.value=!0});const g=async()=>{await n.addMessage(u.value),u.value="",l.value.focus()};return(J,o)=>(w(),f("div",K,[t("div",{ref_key:"chatContainerRef",ref:s,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[_($,{name:"slide-right",css:c.value},{default:z(()=>[(w(!0),f(N,null,V(v(e),i=>(w(),f("div",{key:i.id,class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background tw-p-4 tw-rounded-lg tw-rounded-tl-0 tw-text-sm tw-mr-4"},[t("div",L,[t("div",null,p(i.name),1),t("div",j,p(v(A)(i.created_at).format("ll")),1)]),t("div",null,p(i.message),1),o[1]||(o[1]=t("div",{class:"hint"}," delivered ",-1))]))),128))]),_:1},8,["css"])],512),t("div",{class:"tw-flex-none tw-sticky tw-py-3 pl-bg-block",style:P({bottom:`${k.value}px`})},[t("div",G,[I(t("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":o[0]||(o[0]=i=>u.value=i),type:"text",placeholder:"Type a message",class:"tw-w-full",onKeydown:O(g,["enter"])},null,544),[[D,u.value]]),t("button",{class:"icon",onClick:g},o[2]||(o[2]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])],4)]))}}),Q={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},U={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden tw-p-3 tw-pb-0"},W={class:"tw-flex-auto tw-min-h-0"},Z=y({__name:"Test",props:["taskId"],setup(r){const n=q(),s=()=>{var e;const l=(e=n.currentRoute.value.matched.find(c=>c.meta.isListView))==null?void 0:e.name;l?n.push({name:l}):console.error("Cant find back route")};return(l,e)=>(w(),f("div",Q,[t("div",{class:"tw-flex-none tw-p-3"},[t("button",{class:"circle gray",onClick:s},e[0]||(e[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",U,[e[1]||(e[1]=t("div",{class:"tw-h-32 tw-flex-none"}," Task Info ",-1)),t("div",W,[_(H)])])]))}});export{Z as default};
