import{d as w,u as h,a as g,r as p,o as r,c as m,b as t,w as k,t as f,e as u,f as x,g as b,h as _,i as I,j as y,T as C,k as T,v as $,l as B,m as S,F as R,n as D,p as M,q as V}from"./index-Ek7Qy4l0.js";import{C as E}from"./ContenteditableBlock-o8xbhpD1.js";import"./rangy-5rxgwlWZ.js";const N={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background custom-p-16 tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},U={class:"tw-flex tw-gap-2"},F={class:"tw-flex tw-gap-2"},K={class:"tw-truncate"},L={class:"hint"},j={class:"hint"},q=w({__name:"TaskInfoChatItem",props:{message:{}},setup(d){const e=d,n=h(),a=g(),s=p(!1),c=()=>{a.deleteItem(e.message)},l=i=>{a.updateItem(e.message,{comment:i})};return(i,o)=>{var v;return r(),m("div",N,[t("div",U,[t("a",{onClick:k(c,["prevent"])},o[1]||(o[1]=[t("i",{class:"fas fa-times"},null,-1)])),t("a",{onClick:o[0]||(o[0]=k(Q=>s.value=!0,["prevent"]))},o[2]||(o[2]=[t("i",{class:"fas fa-edit"},null,-1)]))]),t("div",F,[t("div",K,f((v=u(n).getItemById(e.message.contact_id))==null?void 0:v.name),1),t("div",L,f(u(x)(u(b)(e.message)).format("ll")),1)]),_(E,{editable:s.value,focusable:!0,value:e.message.comment,tag:"div",onUpdate:l},null,8,["editable","value"]),t("div",j,f(typeof e.message.id=="number"?"delivered":"not delivered"),1)])}}}),G={class:"tw-flex tw-flex-col tw-h-full"},z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},A={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-bg-block"},H={class:"state-with-inner-icon right width-100"},J=w({__name:"TaskInfoChat",props:{taskId:{}},setup(d){const e=d,n=g(),a=p(),s=p("");I(()=>e.taskId,l=>S(l)&&n.fetch({item_id:l}),{immediate:!0});const c=async()=>{const l=await n.insert(e.taskId);l&&(n.updateItem(l,{comment:s.value}),s.value="",a.value.focus())};return(l,i)=>(r(),m("div",G,[t("div",z,[_(C,{name:"slide-right"},{default:y(()=>[(r(!0),m(R,null,D(u(n).getComentsByTaskId(e.taskId),o=>(r(),M(q,{key:o.uuid||o.id,message:o},null,8,["message"]))),128))]),_:1})]),t("div",A,[t("div",H,[T(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":i[0]||(i[0]=o=>s.value=o),type:"text",placeholder:"Type a message",class:"width-100",onKeydown:B(c,["enter"])},null,544),[[$,s.value]]),t("button",{class:"icon",onClick:c},i[1]||(i[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),O={class:"pl-bg-block tw-h-full tw-flex tw-flex-col"},P={class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},Z=w({__name:"TaskInfo",props:{taskId:{}},setup(d){const e=V(),n=()=>{var s;const a=(s=[...e.currentRoute.value.matched].reverse().find(c=>c.meta.isListView))==null?void 0:s.name;a?e.push({name:a}):console.error("Cant find back route")};return(a,s)=>(r(),m("div",O,[t("div",{class:"tw-flex-none custom-p-12"},[t("button",{class:"circle gray",onClick:n},s[0]||(s[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",P,[_(J,{"task-id":a.taskId},null,8,["task-id"])])]))}});export{Z as default};
