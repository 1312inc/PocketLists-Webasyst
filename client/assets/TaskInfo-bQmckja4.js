import{d as w,u as h,a as k,r as p,o as d,c as m,b as t,w as g,t as f,e as u,f as b,g as x,h as v,i as I,j as y,T as C,k as T,v as $,l as B,F as S,m as R,n as D,p as M}from"./index-Wy9tw2SO.js";import{C as N}from"./ContenteditableBlock-6J0tsYOU.js";import"./rangy-5rxgwlWZ.js";const V={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background custom-p-16 tw-rounded-lg tw-rounded-tl-0 small custom-mr-16"},E={class:"tw-flex tw-gap-2"},U={class:"tw-flex tw-gap-2"},F={class:"tw-truncate"},K={class:"hint"},L={class:"hint"},j=w({__name:"TaskInfoChatItem",props:{message:{}},setup(i){const e=i,l=h(),c=k(),o=p(!1),a=()=>{c.deleteItem(e.message)},n=r=>{c.updateItem(e.message,{comment:r})};return(r,s)=>{var _;return d(),m("div",V,[t("div",E,[t("a",{onClick:g(a,["prevent"])},s[1]||(s[1]=[t("i",{class:"fas fa-times"},null,-1)])),t("a",{onClick:s[0]||(s[0]=g(Q=>o.value=!0,["prevent"]))},s[2]||(s[2]=[t("i",{class:"fas fa-edit"},null,-1)]))]),t("div",U,[t("div",F,f((_=u(l).getItemById(e.message.contact_id))==null?void 0:_.name),1),t("div",K,f(u(b)(u(x)(e.message)).format("ll")),1)]),v(N,{editable:o.value,focusable:!0,value:e.message.comment,tag:"div",onUpdate:n},null,8,["editable","value"]),t("div",L,f(typeof e.message.id=="number"?"delivered":"not delivered"),1)])}}}),G=i=>typeof i=="number"&&Number.isInteger(i),q={class:"tw-flex tw-flex-col tw-h-full"},z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},A={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-bg-block"},H={class:"state-with-inner-icon right width-100"},J=w({__name:"TaskInfoChat",props:{taskId:{}},setup(i){const e=i,l=k(),c=p(),o=p("");I(()=>e.taskId,n=>G(n)&&l.fetch({item_id:n}),{immediate:!0});const a=async()=>{const n=await l.insert(e.taskId);n&&(l.updateItem(n,{comment:o.value}),o.value="",c.value.focus())};return(n,r)=>(d(),m("div",q,[t("div",z,[v(C,{name:"slide-right"},{default:y(()=>[(d(!0),m(S,null,R(u(l).getComentsByTaskId(e.taskId),s=>(d(),D(j,{key:s.uuid||s.id,message:s},null,8,["message"]))),128))]),_:1})]),t("div",A,[t("div",H,[T(t("input",{ref_key:"inputRef",ref:c,"onUpdate:modelValue":r[0]||(r[0]=s=>o.value=s),type:"text",placeholder:"Type a message",class:"width-100",onKeydown:B(a,["enter"])},null,544),[[$,o.value]]),t("button",{class:"icon",onClick:a},r[1]||(r[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),O={class:"pl-bg-block tw-h-full tw-flex tw-flex-col"},P={class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},Z=w({__name:"TaskInfo",props:{taskId:{}},setup(i){const e=i,l=M(),c=()=>{var a;const o=(a=[...l.currentRoute.value.matched].reverse().find(n=>n.meta.isListView))==null?void 0:a.name;o?l.push({name:o}):console.error("Cant find back route")};return(o,a)=>(d(),m("div",O,[t("div",{class:"tw-flex-none custom-p-12"},[t("button",{class:"circle gray",onClick:c},a[0]||(a[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",P,[v(J,{"task-id":e.taskId},null,8,["task-id"])])]))}});export{Z as default};
