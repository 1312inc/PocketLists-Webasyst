import{ad as ne,d as E,ae as K,o as c,x as P,l as L,A as U,b as t,e as _,S as h,af as Y,_ as se,w as V,ag as oe,a6 as ae,c as b,J as I,t as $,f as le,a0 as ie,N as re,a9 as de,aa as ue,y as me,X as O,ah as W,ai as fe,r as H,k as q,aj as R,K as pe,F as Z,D as F,n as S,h as M,ak as ce,i as ee,q as te,al as ve,am as ke,H as we,j,an as z,B as ge,s as _e,ao as ye,ap as be}from"./index-7nyVdY-z.js";import{m as A,g as B,s as J}from"./rangy-5rxgwlWZ.js";import{_ as Le}from"./SortableList.vue_vue_type_style_index_0_lang-gopCHqbg.js";function Te(k){let a=[];ne(k,()=>{k.value&&(a=[...k.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=l=>a.findIndex(f=>f.isEqualNode(l)),o=l=>a[e(l)-1],n=l=>a[e(l)+1],s=(l,f)=>{if(l){const p=n(l);if(p instanceof HTMLElement)return p.focus(),f&&A(p),p}else{const p=a[0];p instanceof HTMLElement&&p.focus()}},u=(l,f)=>{if(l.target instanceof HTMLElement){const p=l.target,y=B(p),m=f==="up"?o(p):n(p);m instanceof HTMLElement&&(l.preventDefault(),m.focus(),J(m,y))}};return{getPreviousElementSibling:o,getNextElementSibling:n,getCurrentPositionInNavigationList:e,focusNextTask:s,focusTaskById:l=>{const f=a.find(p=>{var y;return p instanceof HTMLElement&&((y=p.dataset)==null?void 0:y.id)==l});f instanceof HTMLElement&&f.focus()},onUp:l=>{u(l,"up")},onDown:l=>{u(l,"down")},onLeft:(l,f)=>{if(l.target instanceof HTMLElement){const p=l.target;if(B(p)===0){const y=o(p);y instanceof HTMLElement&&(l.preventDefault(),f&&(y.innerText+=f),y.focus(),A(y),f&&J(y,y.innerText.length-f.length))}}},onRight:l=>{if(l.target instanceof HTMLElement){const f=l.target;if(B(f)===f.innerText.length){const p=n(f);p instanceof HTMLElement&&(l.preventDefault(),p.focus())}}}}}const Ce={class:"menu"},xe=E({__name:"PopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(k){const a=K(k,"modelValue"),e=o=>{a.value=o};return(o,n)=>(c(),P(Y,null,{default:L(({handler:s,setRef:u})=>[U(o.$slots,"default",{handler:s,setRef:u},void 0,!0)]),body:L(()=>[t("ul",Ce,[t("li",null,[t("a",{onClick:n[0]||(n[0]=s=>e(_(h)().startOf("day").format()))}," Today ")]),t("li",null,[t("a",{onClick:n[1]||(n[1]=s=>e(_(h)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),t("li",null,[t("a",{onClick:n[2]||(n[2]=s=>e(_(h)().add(2,"day").startOf("day").format()))}," In 2 days ")]),t("li",null,[t("a",{onClick:n[3]||(n[3]=s=>e(_(h)().endOf("week").startOf("day").format()))}," This weekend ")]),n[4]||(n[4]=t("li",null,null,-1))])]),_:3}))}}),$e=se(xe,[["__scopeId","data-v-ba661900"]]),Ie={class:"menu"},Ve=E({__name:"PopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(k){const a=K(k,"modelValue");return(e,o)=>(c(),P(Y,null,{default:L(({handler:n,setRef:s})=>[U(e.$slots,"default",{handler:n,setRef:s})]),body:L(()=>[t("ul",Ie,[t("li",null,[t("a",{onClick:o[0]||(o[0]=V(n=>a.value=0,["prevent"]))},o[3]||(o[3]=[t("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),t("span",null,"Without priority",-1)]))]),t("li",null,[t("a",{onClick:o[1]||(o[1]=V(n=>a.value=1,["prevent"]))},o[4]||(o[4]=[t("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),t("span",null,"Normal",-1)]))]),t("li",null,[t("a",{onClick:o[2]||(o[2]=V(n=>a.value=2,["prevent"]))},o[5]||(o[5]=[t("i",{class:"fas fa-star",style:{color:"red"}},null,-1),t("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Me={key:1},Ee={key:2},Ne=["onClick"],Pe={key:4},Se=["onClick"],he=E({__name:"PopupMenu",props:oe({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(k){const a=k,e=K(k,"modelValue"),o=ae(null);{const n=de(()=>ue(()=>import("./PopupMenuWhere-3XlgLbQ9.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));o.value=n}return(n,s)=>(c(),b("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:s[3]||(s[3]=V(()=>{},["prevent"]))},[a.isFocused?(c(),P($e,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":s[0]||(s[0]=u=>e.value.due_date=u)},{default:L(({handler:u,setRef:g})=>[t("a",{ref:g,onClick:V(u,["prevent"])},s[4]||(s[4]=[t("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):I("",!0),e.value.due_datetime?(c(),b("div",Me,$(_(le)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(c(),b("div",Ee,$(_(h)(e.value.due_date).format("LL")),1)):I("",!0),a.isFocused||e.value.priority?(c(),P(Ve,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":s[1]||(s[1]=u=>e.value.priority=u)},{default:L(({handler:u,setRef:g})=>[t("a",{ref:g,style:ie(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:V(u,["prevent"])},s[5]||(s[5]=[t("i",{class:"fas fa-star"},null,-1)]),12,Ne)]),_:1},8,["modelValue"])):I("",!0),e.value.location_id?(c(),b("div",Pe," Location: "+$(e.value.location_id),1)):I("",!0),a.isFocused&&o.value?(c(),P(re(o.value),{key:5,modelValue:e.value.location_id,"onUpdate:modelValue":s[2]||(s[2]=u=>e.value.location_id=u)},{default:L(({handler:u,setRef:g})=>[t("a",{ref:g,onClick:V(u,["prevent"])},s[6]||(s[6]=[t("i",{class:"fas fa-map-pin"},null,-1)]),8,Se)]),_:1},8,["modelValue"])):I("",!0)],32))}}),Be=E({__name:"TaskListItemInfoLink",props:{task:{}},setup(k){const a=k,e=me(),o=n=>{var u,g;const s=(g=(u=e.currentRoute.value.matched.find(d=>{var i;return(i=d.meta)==null?void 0:i.isListView}))==null?void 0:u.children.find(d=>{var i;return(i=d.meta)==null?void 0:i.isTaskInfoView}))==null?void 0:g.name;s?e.push({name:s,params:{taskId:n}}):console.error("Cant find `taskInfo` route")};return(n,s)=>(c(),b("a",{onClick:s[0]||(s[0]=V(u=>o(a.task.id),["prevent"]))},s[1]||(s[1]=[t("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),He={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},Re={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},Ue={class:"tw-flex-auto"},Fe={class:"hint"},Oe={class:"hint"},qe={class:"hint"},Ke=["contenteditable","placeholder","data-id","textContent"],We={key:1},X=E({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","blur","complete"],setup(k,{emit:a}){const e=k,o=a,n=O(W),s=O(fe),u=H(!1);let g=!1,d={name:e.task.name,due_date:e.task.due_date,due_datetime:e.task.due_datetime,priority:e.task.priority,location_id:e.task.location_id};const i=H({...d});let w;q([()=>e.task,()=>e.addableProps],async([m])=>{w&&w(),d=R.pick(m,Object.keys(d)),i.value={...d},w=q(i,async()=>{const r=R.reduce(i.value,(T,D,v)=>R.isEqual(D,d[v])?T:[...T,v],[]);r.length&&o("update",e.task,R.pick(i.value,r))},{deep:!0})},{immediate:!0});const N=async m=>{g||(m.target instanceof HTMLElement&&(m.target.innerText=m.target.innerText.trim(),i.value.name=m.target.innerText),o("blur",e.task,i.value))},l=m=>{var T;m.preventDefault();const r=(T=m.clipboardData)==null?void 0:T.getData("text/plain");r&&document.execCommand("insertText",!1,r)},f=m=>{m.target instanceof HTMLElement&&B(m.target)===0&&(g=!0,n==null||n.onLeft(m,m.target.innerText.trim()),o("delete",e.task,i.value))},p=async m=>{if(m.preventDefault(),m.target instanceof HTMLElement){const r=m.target,T=r.innerText.trim(),D=B(r),v={};D!==0&&(v.currentName=T.substring(0,D).trim(),v.newName=T.substring(D,T.length).trim(),r.innerText=v.currentName),o("insert",e.task,{...i.value,...e.addableProps},v)}},y=()=>{o("complete",e.task,i.value)};return(m,r)=>{var T,D;return c(),b("div",He,[e.sortable?(c(),b("div",Re,r[7]||(r[7]=[t("i",{class:"fas fa-grip-vertical"},null,-1)]))):I("",!0),t("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:y},[t("div",{class:pe(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),t("div",Ue,[(T=_(s))!=null&&T.is_debug_mode?(c(),b(Z,{key:0},[t("span",Fe,"id: "+$(e.task.id),1),r[8]||(r[8]=F(" | ")),t("span",Oe,"prev_id: "+$(String(e.task.prev_item_id)),1),r[9]||(r[9]=F(" | ")),t("span",qe,"srank: "+$(String(e.task.sort))+" | "+$(String(e.task.rank)),1)],64)):I("",!0),t("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[S(p,["enter"]),r[0]||(r[0]=S((...v)=>{var C,x;return((C=_(n))==null?void 0:C.onLeft)&&((x=_(n))==null?void 0:x.onLeft(...v))},["left"])),r[1]||(r[1]=S((...v)=>{var C,x;return((C=_(n))==null?void 0:C.onUp)&&((x=_(n))==null?void 0:x.onUp(...v))},["up"])),r[2]||(r[2]=S((...v)=>{var C,x;return((C=_(n))==null?void 0:C.onRight)&&((x=_(n))==null?void 0:x.onRight(...v))},["right"])),r[3]||(r[3]=S((...v)=>{var C,x;return((C=_(n))==null?void 0:C.onDown)&&((x=_(n))==null?void 0:x.onDown(...v))},["down"])),S(f,["delete"])],onBlur:N,onFocus:r[4]||(r[4]=v=>u.value=!0),onFocusout:r[5]||(r[5]=v=>u.value=!1),onPaste:l,textContent:$(e.task.name)},null,40,Ke),M(he,{modelValue:i.value,"onUpdate:modelValue":r[6]||(r[6]=v=>i.value=v),"is-focused":u.value},null,8,["modelValue","is-focused"])]),(D=e.task.extended_data)!=null&&D.comments_count?(c(),b("div",We,[r[10]||(r[10]=t("i",{class:"far fa-comment"},null,-1)),F(" "+$(e.task.extended_data.comments_count),1)])):I("",!0),e.showInfoLink?(c(),P(Be,{key:2,class:"tw-hidden group-hover:tw-block",task:m.task},null,8,["task"])):I("",!0)])}}}),G=E({__name:"ListNavigationProvider",setup(k){const a=H();return ce(W,Te(a)),(e,o)=>(c(),b("div",{ref_key:"navigatableRef",ref:a},[U(e.$slots,"default")],512))}}),Q=E({__name:"TaskListItemStoreProvider",setup(k){const a=O(W),e=ee(),o=d=>e.completeTask(d),n=(d,i)=>e.updateItem(d,i),s=async(d,i,w)=>{if(!w.currentName)await e.insert("before",i,d.list_id,d.id);else{const N=await e.insert("after",{...i,name:w.newName},d.list_id,d.id);await te(),N&&(a==null||a.focusTaskById(N.id))}},u=d=>e.deleteItem(d),g=d=>{ve(d)&&(d.name?e.updateItem(d,{client_touch_datetime:ke()}):e.deleteItem(d))};return(d,i)=>U(d.$slots,"default",{onComplete:o,onUpdate:n,onInsert:s,onDelete:u,onBlur:g})}}),je={key:0,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6 align-center"},ze={key:0,class:"lg:tw-hidden tw-mb-4"},Ae={class:"tw-m-0"},Je={class:"tw-my-6"},Xe={key:1,class:"tw-flex tw-flex-col"},Ze=E({__name:"TaskList",props:{items:{},addableProps:{},sortableListId:{},isFetching:{type:Boolean}},setup(k){const a=k,e=we(),o=ee(),n=H(),s=H(!1),u=j(()=>a.items.filter(i=>ye(i))),g=j(()=>a.items.filter(i=>be(i))),d=async()=>{await o.insertDummy({...a.addableProps}),await te();const i=document.querySelector(`[contenteditable][data-id="${u.value[0].id}"]`);i instanceof HTMLElement&&i.focus()};return q(z.currentRoute,i=>{const w={...i.query};"addNewTask"in w&&(d(),delete w.addNewTask,z.replace({path:i.path,query:w}))},{immediate:!0}),(i,w)=>{const N=ge("RouterLink");return a.isFetching?(c(),b("div",je,w[1]||(w[1]=[t("div",{class:"spinner custom-p-16"},null,-1)]))):(c(),b("div",{key:1,ref_key:"navigatableRef",ref:n,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},[a.sortableListId?(c(),b("div",ze,[M(N,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:L(()=>{var l;return[w[2]||(w[2]=t("i",{class:"fas fa-chevron-left gray"},null,-1)),t("h3",Ae,$((l=_(e).getItemById(a.sortableListId))==null?void 0:l.name),1)]}),_:1})])):I("",!0),t("div",{class:"tw-mb-4",onClick:d}," + New To-Do "),M(G,null,{default:L(()=>[M(Le,{"sortable-list-id":a.sortableListId,"sortable-group-name":"tasks",items:u.value,onSort:_(o).sort},{default:L(({item:l})=>[M(Q,null,{default:L(({onUpdate:f,onComplete:p,onInsert:y,onDelete:m,onBlur:r})=>[M(X,{task:l,sortable:!!a.sortableListId,editable:!0,"addable-props":a.addableProps,"show-info-link":!0,onUpdate:f,onComplete:p,onInsert:y,onDelete:m,onBlur:r},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onDelete","onBlur"])]),_:2},1024)]),_:1},8,["sortable-list-id","items","onSort"])]),_:1}),t("div",Je,[t("a",{class:"gray",onClick:w[0]||(w[0]=V(l=>s.value=!s.value,["prevent"]))},"Completed ("+$(g.value.length)+")",1)]),s.value?(c(),b("div",Xe,[M(G,null,{default:L(()=>[M(Q,null,{default:L(({onComplete:l})=>[(c(!0),b(Z,null,_e(g.value,f=>(c(),P(X,{key:f.uuid||f.id,task:f,onComplete:l},null,8,["task","onComplete"]))),128))]),_:1})]),_:1})])):I("",!0)],512))}}});export{Ze as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./PopupMenuWhere-3XlgLbQ9.js","./index-7nyVdY-z.js","./index-3GJYBzeD.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-9cOml7P3.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
