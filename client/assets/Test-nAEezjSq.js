import{d as _,u as y,a as b,r as w,o as m,c as p,b as t,w as h,t as v,e as k,O as C,f as g,g as I,h as x,i as T,T as $,j as B,v as R,k as S,n as M,F as V,l as D,m as N,p as U}from"./index-telG3gqR.js";import{C as E}from"./ContenteditableBlock-RC9mpi2w.js";import"./rangy-5rxgwlWZ.js";const F={class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background tw-p-4 tw-rounded-lg tw-rounded-tl-0 tw-text-sm tw-mr-4"},K={class:"tw-flex tw-gap-2"},L={class:"tw-flex tw-gap-2"},j={class:"tw-truncate"},A={class:"hint"},G={class:"hint"},H=_({__name:"TaskChatItem",props:{message:{}},setup(c){const e=c,n=y(),a=b(),o=w(!1),s=()=>{a.deleteItem(e.message)},r=i=>{a.updateItem(e.message,{comment:i})};return(i,l)=>{var d;return m(),p("div",F,[t("div",K,[t("a",{onClick:h(s,["prevent"])},l[1]||(l[1]=[t("i",{class:"fas fa-times"},null,-1)])),t("a",{onClick:l[0]||(l[0]=h(u=>o.value=!0,["prevent"]))},l[2]||(l[2]=[t("i",{class:"fas fa-edit"},null,-1)]))]),t("div",L,[t("div",j,v((d=k(n).getItemById(e.message.contact_id))==null?void 0:d.name),1),t("div",A,v(k(C)(e.message.create_datetime).format("ll")),1)]),g(E,{editable:o.value,focusable:!0,value:e.message.comment,tag:"div",onUpdate:r},null,8,["editable","value"]),t("div",G,v(typeof e.message.id=="number"?"delivered":"not delivered"),1)])}}}),O={class:"tw-h-full tw-flex tw-flex-col"},q={class:"tw-flex-none tw-sticky tw-py-3 pl-bg-block"},z={class:"state-with-inner-icon right tw-w-full"},J=_({__name:"TaskChat",props:{taskId:{}},setup(c){const e=c,n=b(),a=w(),o=w(),s=I(()=>n.getComentsByTaskId(e.taskId)),r=w(!1),i=w("");x(()=>e.taskId,d=>{n.fetch({item_id:d})},{immediate:!0}),x(s,async()=>{await M(),a.value&&(a.value.scrollTop=a.value.scrollHeight),r.value=!0});const l=async()=>{await n.insert(e.taskId,i.value),i.value="",o.value.focus()};return(d,u)=>(m(),p("div",O,[t("div",{ref_key:"chatContainerRef",ref:a,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[g($,{name:"slide-right",css:r.value},{default:T(()=>[(m(!0),p(V,null,D(s.value,f=>(m(),N(H,{key:f.uuid||f.id,message:f},null,8,["message"]))),128))]),_:1},8,["css"])],512),t("div",q,[t("div",z,[B(t("input",{ref_key:"inputRef",ref:o,"onUpdate:modelValue":u[0]||(u[0]=f=>i.value=f),type:"text",placeholder:"Type a message",class:"tw-w-full",onKeydown:S(l,["enter"])},null,544),[[R,i.value]]),t("button",{class:"icon",onClick:l},u[1]||(u[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),P={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},Q={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden tw-p-3 tw-pb-0"},W={class:"tw-flex-auto tw-min-h-0"},tt=_({__name:"Test",props:{taskId:{}},setup(c){const e=c,n=U(),a=()=>{var s;const o=(s=n.currentRoute.value.matched.find(r=>r.meta.isListView))==null?void 0:s.name;o?n.push({name:o}):console.error("Cant find back route")};return(o,s)=>(m(),p("div",P,[t("div",{class:"tw-flex-none tw-p-3"},[t("button",{class:"circle gray",onClick:a},s[0]||(s[0]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Q,[t("div",W,[g(J,{"task-id":e.taskId},null,8,["task-id"])])])]))}});export{tt as default};
