import{d as S,ac as I,o as v,x as h,l as x,A as F,b as e,e as L,S as P,ad as q,_ as oe,w as C,ae,a6 as ee,r as M,a5 as le,k as B,af as ie,c as k,h as V,m as z,v as K,F as H,s as j,D as R,t as $,ag as re,ah as ue,J as E,f as de,$ as ce,ai as me,X as te,aj as O,K as fe,n as N,ak as pe,i as se,q as ne,al as ve,am as we,H as ge,j as G,an as Y,B as ke,ao as ye,ap as _e}from"./index-MW8679oa.js";import{m as A,g as U,s as X}from"./rangy-5rxgwlWZ.js";import{_ as be}from"./SortableList.vue_vue_type_style_index_0_lang-M-iUBEAh.js";const Le={class:"menu"},$e=S({__name:"PopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(w){const a=I(w,"modelValue"),t=i=>{a.value=i};return(i,n)=>(v(),h(q,null,{default:x(({handler:u,setRef:c})=>[F(i.$slots,"default",{handler:u,setRef:c},void 0,!0)]),body:x(()=>[e("ul",Le,[e("li",null,[e("a",{onClick:n[0]||(n[0]=u=>t(L(P)().startOf("day").format()))}," Today ")]),e("li",null,[e("a",{onClick:n[1]||(n[1]=u=>t(L(P)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),e("li",null,[e("a",{onClick:n[2]||(n[2]=u=>t(L(P)().add(2,"day").startOf("day").format()))}," In 2 days ")]),e("li",null,[e("a",{onClick:n[3]||(n[3]=u=>t(L(P)().endOf("week").startOf("day").format()))}," This weekend ")]),n[4]||(n[4]=e("li",null,null,-1))])]),_:3}))}}),xe=oe($e,[["__scopeId","data-v-ba661900"]]),Ce={class:"menu"},Te=S({__name:"PopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(w){const a=I(w,"modelValue");return(t,i)=>(v(),h(q,null,{default:x(({handler:n,setRef:u})=>[F(t.$slots,"default",{handler:n,setRef:u})]),body:x(()=>[e("ul",Ce,[e("li",null,[e("a",{onClick:i[0]||(i[0]=C(n=>a.value=0,["prevent"]))},i[3]||(i[3]=[e("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),e("span",null,"Without priority",-1)]))]),e("li",null,[e("a",{onClick:i[1]||(i[1]=C(n=>a.value=1,["prevent"]))},i[4]||(i[4]=[e("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),e("span",null,"Normal",-1)]))]),e("li",null,[e("a",{onClick:i[2]||(i[2]=C(n=>a.value=2,["prevent"]))},i[5]||(i[5]=[e("i",{class:"fas fa-star",style:{color:"red"}},null,-1),e("span",null,"Hight",-1)]))])])]),_:3}))}}),Ve=async w=>{try{const{response:a}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${ae}&geocode=${w}&format=json`)).json();return a?a.GeoObjectCollection.featureMember.map(t=>t.GeoObject):[]}catch(a){return a instanceof Error&&console.error(a.message),[]}},Me={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-full"},De={class:"tw-absolute tw-flex tw-flex-col tw-gap-2 tw-top-12 tw-right-2 tw-z-50"},Se={class:"pl-bg-block tw-p-4 tw-rounded-md"},Ie={class:"menu"},Ee=["onClick"],Ne={class:"gray small"},he={class:"pl-bg-block tw-p-4 tw-rounded-md"},Pe={class:"tw-flex tw-items-center tw-gap-2 tw-my-2"},Re={class:"tw-flex-auto"},Ue={class:"pl-bg-block tw-p-4 tw-rounded-md"},Be={class:"menu"},He=["onClick"],Fe=S({__name:"ChooseLocation",props:{lng:{},lngModifiers:{},lat:{},latModifiers:{},radius:{},radiusModifiers:{},radiusSliderRange:{},radiusSliderRangeModifiers:{}},emits:["update:lng","update:lat","update:radius","update:radiusSliderRange"],setup(w){const a=I(w,"lng"),t=I(w,"lat"),i=I(w,"radius"),n=I(w,"radiusSliderRange"),u=ee(),c=M(""),y=M(!1),l=M(!1),m=le([]),_=M();B(m,({length:o})=>{y.value=!!o}),B(ie(c,500),o=>{if(l.value){l.value=!1;return}D(o)});const D=async o=>{m.value=await Ve(o)},r=o=>{_.value=o,y.value=!1,l.value=!0,c.value=o.name},f=()=>{l.value=!0,c.value=""},p=o=>{_.value={lat:o.location_latitude,lng:o.location_longitude,radius:o.location_radius}};return(o,s)=>(v(),k("div",Me,[e("div",De,[e("div",Se,[V(q,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=d=>y.value=d)},{default:x(({setRef:d})=>[z(e("input",{ref:g=>d(g),"onUpdate:modelValue":s[0]||(s[0]=g=>c.value=g),type:"text",class:"tw-w-full",placeholder:"Input location"},null,512),[[K,c.value]])]),body:x(()=>[e("ul",Ie,[(v(!0),k(H,null,j(m.value,d=>(v(),k("li",{key:d.uri},[e("a",{onClick:C(g=>r(d),["prevent"])},[e("div",null,[R($(d.name),1),s[4]||(s[4]=e("br",null,null,-1)),e("span",Ne,$(d.description),1)])],8,Ee)]))),128))])]),_:1},8,["modelValue"])]),e("div",he,[s[7]||(s[7]=e("h6",null," Current locations ",-1)),e("div",null,"Lat: "+$(t.value),1),e("div",null,"Lng: "+$(a.value),1),e("div",null,"Radius: "+$(i.value&&Math.ceil(i.value))+" m",1),e("div",Pe,[e("div",Re,[z(e("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>n.value=d),type:"range",min:"10",max:"100",class:"tw-w-full"},null,512),[[K,n.value,void 0,{number:!0}]])]),e("a",{class:"gray smaller",onClick:s[3]||(s[3]=C(d=>n.value=50,["prevent"]))},"reset")]),e("div",{class:"tw-flex tw-gap-2"},[s[5]||(s[5]=e("button",null,"Select",-1)),s[6]||(s[6]=e("button",null,"To Favorites",-1)),e("button",{onClick:f}," Reset ")])]),e("div",Ue,[s[8]||(s[8]=e("h6",null," Favorite locations ",-1)),e("ul",Be,[(v(!0),k(H,null,j(L(u).items,d=>(v(),k("li",{key:d.id},[e("a",{onClick:C(g=>p(d),["prevent"])},$(d.name),9,He)]))),128))])])]),s[9]||(s[9]=e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40"},[e("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1))]))}}),Oe={class:"menu"},je=["onClick"],qe=S({__name:"PopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(w){const a=I(w,"modelValue"),t=ee(),i=M(),n=()=>{re(Fe,{}).show()},u=c=>{a.value=c,i.value.isOpened=!1};return(c,y)=>(v(),h(q,{ref_key:"t",ref:i},{default:x(({handler:l,setRef:m})=>[F(c.$slots,"default",{handler:l,setRef:m})]),body:x(()=>[e("ul",Oe,[e("li",null,[e("a",{onClick:C(n,["prevent"])},y[0]||(y[0]=[e("span",null,"New address...",-1),e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1)]))]),(v(!0),k(H,null,j(L(t).items,l=>(v(),k("li",{key:l.id},[e("a",{onClick:C(m=>u(l.id),["prevent"])},$(l.name),9,je)]))),128))])]),_:3},512))}}),We=["onClick"],ze={key:1},Ke={key:2},Ge=["onClick"],Ye=["onClick"],Ae=S({__name:"PopupMenu",props:ue({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(w){const a=w,t=I(w,"modelValue");return(i,n)=>(v(),k("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:n[3]||(n[3]=C(()=>{},["prevent"]))},[a.isFocused?(v(),h(xe,{key:0,modelValue:t.value.due_date,"onUpdate:modelValue":n[0]||(n[0]=u=>t.value.due_date=u)},{default:x(({handler:u,setRef:c})=>[e("a",{ref:c,onClick:C(u,["prevent"])},n[4]||(n[4]=[e("i",{class:"fas fa-calendar-alt"},null,-1)]),8,We)]),_:1},8,["modelValue"])):E("",!0),t.value.due_datetime?(v(),k("div",ze,$(L(de)(t.value.due_datetime).format("LLL")),1)):t.value.due_date?(v(),k("div",Ke,$(L(P)(t.value.due_date).format("LL")),1)):E("",!0),a.isFocused||t.value.priority!==0?(v(),h(Te,{key:3,modelValue:t.value.priority,"onUpdate:modelValue":n[1]||(n[1]=u=>t.value.priority=u)},{default:x(({handler:u,setRef:c})=>[e("a",{ref:c,style:ce(`color: ${t.value.priority===0?"silver":t.value.priority===1?"orange":"red"}`),onClick:C(u,["prevent"])},n[5]||(n[5]=[e("i",{class:"fas fa-star"},null,-1)]),12,Ge)]),_:1},8,["modelValue"])):E("",!0),R(" "+$(t.value.location_id)+" ",1),V(qe,{modelValue:t.value.location_id,"onUpdate:modelValue":n[2]||(n[2]=u=>t.value.location_id=u)},{default:x(({handler:u,setRef:c})=>[e("a",{ref:c,onClick:C(u,["prevent"])},n[6]||(n[6]=[e("i",{class:"fas fa-map-pin"},null,-1)]),8,Ye)]),_:1},8,["modelValue"])],32))}});function Xe(w){let a=[];me(w,()=>{w.value&&(a=[...w.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const t=r=>a.findIndex(f=>f.isEqualNode(r)),i=r=>a[t(r)-1],n=r=>a[t(r)+1],u=(r,f)=>{if(r){const p=n(r);if(p instanceof HTMLElement)return p.focus(),f&&A(p),p}else{const p=a[0];p instanceof HTMLElement&&p.focus()}},c=(r,f)=>{if(r.target instanceof HTMLElement){const p=r.target,o=U(p),s=f==="up"?i(p):n(p);s instanceof HTMLElement&&(r.preventDefault(),s.focus(),X(s,o))}};return{getPreviousElementSibling:i,getNextElementSibling:n,getCurrentPositionInNavigationList:t,focusNextTask:u,focusTaskById:r=>{const f=a.find(p=>{var o;return p instanceof HTMLElement&&((o=p.dataset)==null?void 0:o.id)==r});f instanceof HTMLElement&&f.focus()},onUp:r=>{c(r,"up")},onDown:r=>{c(r,"down")},onLeft:(r,f)=>{if(r.target instanceof HTMLElement){const p=r.target;if(U(p)===0){const o=i(p);o instanceof HTMLElement&&(r.preventDefault(),f&&(o.innerText+=f),o.focus(),A(o),f&&X(o,o.innerText.length-f.length))}}},onRight:r=>{if(r.target instanceof HTMLElement){const f=r.target;if(U(f)===f.innerText.length){const p=n(f);p instanceof HTMLElement&&(r.preventDefault(),p.focus())}}}}}const W=Symbol("listNavigation"),Je={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},Qe={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},Ze={class:"tw-flex-auto"},et={class:"hint"},tt={class:"hint"},st={class:"hint"},nt=["contenteditable","placeholder","data-id","textContent"],ot={key:1},J=S({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{}},emits:["delete","update","insert","blur","complete"],setup(w,{emit:a}){const t=w,i=a,n=te(W),u=M(!1);let c=!1,y={name:t.task.name,due_date:t.task.due_date,due_datetime:t.task.due_datetime,priority:t.task.priority,location_id:t.task.location_id};const l=M({...y});let m;B([()=>t.task,()=>t.addableProps],async([o])=>{m&&m(),y=O.pick(o,Object.keys(y)),l.value={...y},m=B(l,async()=>{const s=O.reduce(l.value,(d,g,b)=>O.isEqual(g,y[b])?d:[...d,b],[]);s.length&&i("update",t.task,O.pick(l.value,s))},{deep:!0})},{immediate:!0});const _=async o=>{c||(o.target instanceof HTMLElement&&(o.target.innerText=o.target.innerText.trim(),l.value.name=o.target.innerText),i("blur",t.task,l.value))},D=o=>{var d;o.preventDefault();const s=(d=o.clipboardData)==null?void 0:d.getData("text/plain");s&&document.execCommand("insertText",!1,s)},r=o=>{o.target instanceof HTMLElement&&U(o.target)===0&&(c=!0,n==null||n.onLeft(o,o.target.innerText.trim()),i("delete",t.task,l.value))},f=async o=>{if(o.preventDefault(),o.target instanceof HTMLElement){const s=o.target,d=s.innerText.trim(),g=U(s),b={};g!==0&&(b.currentName=d.substring(0,g).trim(),b.newName=d.substring(g,d.length).trim(),s.innerText=b.currentName),i("insert",t.task,{...l.value,...t.addableProps},b)}},p=()=>{i("complete",t.task,l.value)};return(o,s)=>{var d;return v(),k("div",Je,[t.sortable?(v(),k("div",Qe,s[7]||(s[7]=[e("i",{class:"fas fa-grip-vertical"},null,-1)]))):E("",!0),e("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:p},[e("div",{class:fe(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",t.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),e("div",Ze,[(v(),k(H,{key:0},[e("span",et,"id: "+$(t.task.id),1),s[8]||(s[8]=R(" | ")),e("span",tt,"prev_id: "+$(String(t.task.prev_item_id)),1),s[9]||(s[9]=R(" | ")),e("span",st,"srank: "+$(String(t.task.sort))+" | "+$(String(t.task.rank)),1)],64)),e("div",{contenteditable:t.editable||void 0,placeholder:t.placeholder,"data-id":t.task.id,onKeydown:[N(f,["enter"]),s[0]||(s[0]=N((...g)=>{var b,T;return((b=L(n))==null?void 0:b.onLeft)&&((T=L(n))==null?void 0:T.onLeft(...g))},["left"])),s[1]||(s[1]=N((...g)=>{var b,T;return((b=L(n))==null?void 0:b.onUp)&&((T=L(n))==null?void 0:T.onUp(...g))},["up"])),s[2]||(s[2]=N((...g)=>{var b,T;return((b=L(n))==null?void 0:b.onRight)&&((T=L(n))==null?void 0:T.onRight(...g))},["right"])),s[3]||(s[3]=N((...g)=>{var b,T;return((b=L(n))==null?void 0:b.onDown)&&((T=L(n))==null?void 0:T.onDown(...g))},["down"])),N(r,["delete"])],onBlur:_,onFocus:s[4]||(s[4]=g=>u.value=!0),onFocusout:s[5]||(s[5]=g=>u.value=!1),onPaste:D,textContent:$(t.task.name)},null,40,nt),V(Ae,{modelValue:l.value,"onUpdate:modelValue":s[6]||(s[6]=g=>l.value=g),"is-focused":u.value},null,8,["modelValue","is-focused"])]),(d=t.task.extended_data)!=null&&d.comments_count?(v(),k("div",ot,[s[10]||(s[10]=e("i",{class:"far fa-comment"},null,-1)),R(" "+$(t.task.extended_data.comments_count),1)])):E("",!0)])}}}),Q=S({__name:"ListNavigationProvider",setup(w){const a=M();return pe(W,Xe(a)),(t,i)=>(v(),k("div",{ref_key:"navigatableRef",ref:a},[F(t.$slots,"default")],512))}}),Z=S({__name:"TaskListItemStoreProvider",setup(w){const a=te(W),t=se(),i=l=>t.completeTask(l),n=(l,m)=>t.updateItem(l,m),u=async(l,m,_)=>{if(!_.currentName)await t.insert("before",m,l.list_id,l.id);else{const D=await t.insert("after",{...m,name:_.newName},l.list_id,l.id);await ne(),D&&(a==null||a.focusTaskById(D.id))}},c=l=>t.deleteItem(l),y=l=>{ve(l)&&(l.name?t.updateItem(l,{client_touch_datetime:we()}):t.deleteItem(l))};return(l,m)=>F(l.$slots,"default",{onComplete:i,onUpdate:n,onInsert:u,onDelete:c,onBlur:y})}}),at={key:0,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6 align-center"},lt={key:0,class:"lg:tw-hidden tw-mb-4"},it={class:"tw-m-0"},rt={class:"tw-my-6"},ut={key:1,class:"tw-flex tw-flex-col"},ft=S({__name:"TaskList",props:{items:{},addableProps:{},sortableListId:{},isFetching:{type:Boolean}},setup(w){const a=w,t=ge(),i=se(),n=M(),u=M(!1),c=G(()=>a.items.filter(m=>ye(m))),y=G(()=>a.items.filter(m=>_e(m))),l=async()=>{await i.insertDummy({...a.addableProps}),await ne();const m=document.querySelector(`[contenteditable][data-id="${c.value[0].id}"]`);m instanceof HTMLElement&&m.focus()};return B(Y.currentRoute,m=>{const _={...m.query};"addNewTask"in _&&(l(),delete _.addNewTask,Y.replace({path:m.path,query:_}))},{immediate:!0}),(m,_)=>{const D=ke("RouterLink");return a.isFetching?(v(),k("div",at,_[1]||(_[1]=[e("div",{class:"spinner custom-p-16"},null,-1)]))):(v(),k("div",{key:1,ref_key:"navigatableRef",ref:n,class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},[a.sortableListId?(v(),k("div",lt,[V(D,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:x(()=>{var r;return[_[2]||(_[2]=e("i",{class:"fas fa-chevron-left gray"},null,-1)),e("h3",it,$((r=L(t).getItemById(a.sortableListId))==null?void 0:r.name),1)]}),_:1})])):E("",!0),e("div",{class:"tw-mb-4",onClick:l}," + New To-Do "),V(Q,null,{default:x(()=>[V(be,{"sortable-list-id":a.sortableListId,"sortable-group-name":"tasks",items:c.value,onSort:L(i).sort},{default:x(({item:r})=>[V(Z,null,{default:x(({onUpdate:f,onComplete:p,onInsert:o,onDelete:s,onBlur:d})=>[V(J,{task:r,sortable:!!a.sortableListId,editable:!0,"addable-props":a.addableProps,onUpdate:f,onComplete:p,onInsert:o,onDelete:s,onBlur:d},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onDelete","onBlur"])]),_:2},1024)]),_:1},8,["sortable-list-id","items","onSort"])]),_:1}),e("div",rt,[e("a",{class:"gray",onClick:_[0]||(_[0]=C(r=>u.value=!u.value,["prevent"]))},"Completed ("+$(y.value.length)+")",1)]),u.value?(v(),k("div",ut,[V(Q,null,{default:x(()=>[V(Z,null,{default:x(({onComplete:r})=>[(v(!0),k(H,null,j(y.value,f=>(v(),h(J,{key:f.uuid||f.id,task:f,onComplete:r},null,8,["task","onComplete"]))),128))]),_:1})]),_:1})])):E("",!0)],512))}}});export{ft as _,Fe as a};
