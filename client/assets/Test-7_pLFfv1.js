import{d as b,c as g,u as T,f as M,l as C,a as h,b as s,e as v,r as d,g as $,w as R,n as B,o as u,h as w,i as t,j as y,k as S,F as z,m as N,t as f,p as m,T as V,q as I,v as D,s as O,x as P,y as q}from"./index-wu_MmD8A.js";import{O as A}from"./dayjs.min-u_jEnsPc.js";const E=async()=>{const i=Array(10).fill(null).map(()=>({id:s.string.uuid(),task_id:s.string.uuid(),title:s.company.buzzPhrase(),created_at:s.date.past().getTime(),message:s.lorem.paragraph(),name:s.internet.displayName()}));await h.chatMessages.bulkPut(i)},F=b("chats",()=>{const i=g(()=>e=>T(M(C(()=>h.chatMessages.where("task_id").notEqual(e).sortBy("created_at"))),{initialValue:[]})),l=async e=>{const a={id:s.string.uuid(),task_id:s.string.uuid(),title:s.company.buzzPhrase(),created_at:new Date().getTime(),message:e,name:s.internet.displayName()};try{return await h.chatMessages.put(a),a}catch(o){console.log(o)}};return E(),{getMessgesByTaskId:i,addMessage:l}}),K={class:"tw-h-full tw-flex tw-flex-col"},L={class:"tw-flex tw-gap-2"},j={class:"hint"},G=t("div",{class:"hint"}," delivered ",-1),H={class:"state-with-inner-icon right tw-w-full"},Q=t("i",{class:"fas fa-arrow-right"},null,-1),U=[Q],W=v({__name:"TaskChat",setup(i){const l=F(),e=d(),a=d(),o=l.getMessgesByTaskId(""),c=d(!1),{y:x}=$(),r=d(""),k=g(()=>128-x.value);R(o,async()=>{await B(),e.value&&(e.value.scrollTop=e.value.scrollHeight),c.value=!0});const _=async()=>{await l.addMessage(r.value),r.value="",a.value.focus()};return(st,p)=>(u(),w("div",K,[t("div",{ref_key:"chatContainerRef",ref:e,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[y(V,{name:"slide-right",css:c.value},{default:S(()=>[(u(!0),w(z,null,N(m(o),n=>(u(),w("div",{key:n.id,class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background tw-p-4 tw-rounded-lg tw-rounded-tl-0 tw-text-sm tw-mr-4"},[t("div",L,[t("div",null,f(n.name),1),t("div",j,f(m(A)(n.created_at).format("ll")),1)]),t("div",null,f(n.message),1),G]))),128))]),_:1},8,["css"])],512),t("div",{class:"tw-flex-none tw-sticky tw-py-3 pl-bg-block",style:P({bottom:`${k.value}px`})},[t("div",H,[I(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":p[0]||(p[0]=n=>r.value=n),type:"text",placeholder:"Type a message",class:"tw-w-full",onKeydown:O(_,["enter"])},null,544),[[D,r.value]]),t("button",{class:"icon",onClick:_},U)])],4)]))}}),J={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},X=t("i",{class:"fas fa-times"},null,-1),Y=[X],Z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden tw-p-3 tw-pb-0"},tt=t("div",{class:"tw-h-32 tw-flex-none"}," Task Info ",-1),et={class:"tw-flex-auto tw-min-h-0"},lt=v({__name:"Test",props:["taskId"],setup(i){const l=q(),e=()=>{var o;const a=(o=l.currentRoute.value.matched.find(c=>c.meta.isListView))==null?void 0:o.name;a?l.push({name:a}):console.error("Cant find back route")};return(a,o)=>(u(),w("div",J,[t("div",{class:"tw-flex-none tw-p-3"},[t("button",{class:"circle gray",onClick:e},Y)]),t("div",Z,[tt,t("div",et,[y(W)])])]))}});export{lt as default};
