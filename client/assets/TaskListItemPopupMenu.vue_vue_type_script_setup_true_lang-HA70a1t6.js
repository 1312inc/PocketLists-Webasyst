import{d as V,aG as T,r as y,J as _,m as D,o as v,z as S,q as C,W as Z,ae as W,R as P,e,i as $,t as p,b as k,s as E,v as I,f as j,y as U,h as M,D as F,O as N,F as H,B as z,aH as O,aI as G,A as J,a4 as x,c as B,a5 as q,aJ as K,H as h,aE as X,g as Y,n as Q,j as R}from"./index-VXkmTHtp.js";const Ie=""+new URL("img/shop.svg",import.meta.url).href,Pe="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.85619%2017.2942L5.86319%2020.6332L22.1312%201.06423C24.3722%200.898238%2026.6255%201.05688%2028.8212%201.53523L6.56619%2028.3052L0.867188%2023.5572C0.908188%2021.3822%201.25019%2019.2812%201.85619%2017.2942Z'%20fill='%23E80A8A'/%3e%3cpath%20d='M35.4942%204.15186C38.9684%206.19305%2041.8486%209.10706%2043.8492%2012.6049L25.3792%2034.8219L3.36719%2016.4809L10.9402%207.39386L23.8532%2018.1539L35.4932%204.15186H35.4942Z'%20fill='%2329ABE2'/%3e%3cpath%20d='M18.6278%2013.798L11.0658%2022.894L6.88281%2019.409L14.4448%2010.313L18.6278%2013.798V13.798Z'%20fill='%23292A76'/%3e%3cpath%20d='M4.01953%2035.6338L18.9695%2017.6138L27.3515%2024.5658L11.6495%2043.4918C8.51344%2041.5215%205.89666%2038.8265%204.01953%2035.6338V35.6338Z'%20fill='%23F7EA34'/%3e%3cpath%20d='M23.8675%2047C36.5705%2047%2046.8685%2036.703%2046.8685%2024C46.8685%2023.142%2046.8215%2022.294%2046.7305%2021.46L30.0085%2041.574L18.5015%2032.07L12.5215%2039.308L21.7155%2046.902C22.4235%2046.967%2023.1415%2047.001%2023.8675%2047.001V47Z'%20fill='%2349B749'/%3e%3cpath%20d='M44.8763%2033.3699C46.2421%2030.3102%2046.9204%2026.9882%2046.8633%2023.6379L44.1153%2026.9429L35.6863%2019.9829L32.6973%2023.6029L44.7343%2033.5419L44.8763%2033.3709V33.3699Z'%20fill='%23F1B61C'/%3e%3cpath%20d='M36.8902%2020.9769L33.8892%2024.5869L32.6992%2023.6029L35.6872%2019.9829L36.8892%2020.9769H36.8902Z'%20fill='%23097D3F'/%3e%3cpath%20d='M17.0791%2045.9832L28.7711%2031.8892L32.3841%2034.8862L22.3731%2046.9522C20.5762%2046.8379%2018.7989%2046.5123%2017.0781%2045.9822L17.0791%2045.9832Z'%20fill='%23F05323'/%3e%3cpath%20d='M22.3757%2046.9518L28.1267%2040.0198L24.5077%2037.0298L18.5137%2044.2548L21.7157%2046.8998C21.9347%2046.9198%2022.1547%2046.9378%2022.3757%2046.9518V46.9518Z'%20fill='%232B3F1B'/%3e%3cpath%20d='M24.5635%2029.7328L36.5855%2015.2658L33.7695%2012.9258L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4738L24.5635%2029.7338V29.7328Z'%20fill='%23292A76'/%3e%3cpath%20d='M21.5154%2031.6018L13.1484%2024.6308L18.9704%2017.6128L27.3524%2024.5658L21.5154%2031.6018V31.6018Z'%20fill='%2313A149'/%3e%3cpath%20d='M25.4245%2022.9678L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4748L23.6815%2028.9888L27.3515%2024.5658L25.4245%2022.9678V22.9678Z'%20fill='%230C0D1B'/%3e%3cpath%20d='M42.9619%2025.9902L44.1159%2026.9442L46.8639%2023.6392C46.9212%2026.9897%2046.2429%2030.3121%2044.8769%2033.3722L44.7349%2033.5422L39.9609%2029.6002L42.9609%2025.9902H42.9619Z'%20fill='%23269145'/%3e%3c/svg%3e",ee={class:"menu"},te={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ae={key:0},le={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},se=V({__name:"TaskListItemPopupMenuWhen",props:{dueDate:{},dueDateModifiers:{},dueDatetime:{},dueDatetimeModifiers:{}},emits:["update:dueDate","update:dueDatetime"],setup(i){const t=T(i,"dueDate"),o=T(i,"dueDatetime"),u=y(t.value),a=y(o.value?_(o.value).format("HH:mm"):""),s=y(!1),m=y(!1);D([t,o],()=>{s.value=!!(t.value||o.value),m.value=!!o.value},{immediate:!0}),D(a,()=>{!u.value&&a.value&&(u.value=_().format("YYYY-MM-DD"))}),D([u,a],([d,n])=>{t.value=d||null,o.value=n?W(`${d||_().format("YYYY-MM-DD")}T${n}`):null});const c=d=>{u.value=d,a.value=""},l=()=>{u.value="",a.value="",s.value=!1},r=()=>{a.value=""};return(d,n)=>(v(),S(Z,null,{default:C(({handler:L,setRef:f})=>[P(d.$slots,"default",{handler:L,setRef:f})]),body:C(()=>[e("ul",ee,[e("li",null,[e("a",{onClick:n[0]||(n[0]=L=>c($(_)().format("YYYY-MM-DD")))},p(d.$t("datePicker.today")),1)]),e("li",null,[e("a",{onClick:n[1]||(n[1]=L=>c($(_)().add(1,"day").format("YYYY-MM-DD")))},p(d.$t("datePicker.tomorrow")),1)]),e("li",null,[e("a",{onClick:n[2]||(n[2]=L=>c($(_)().add(2,"day").format("YYYY-MM-DD")))},p(d.$t("datePicker.in2days")),1)]),e("li",null,[e("a",{onClick:n[3]||(n[3]=L=>c($(_)().endOf("week").format("YYYY-MM-DD")))},p(d.$t("datePicker.thisWeekend")),1)]),e("li",null,[s.value?(v(),k("div",te,[E(e("input",{"onUpdate:modelValue":n[5]||(n[5]=L=>u.value=L),type:"date",class:"width-100"},null,512),[[I,u.value]]),e("a",{onClick:l},n[8]||(n[8]=[e("i",{class:"fas fa-times"},null,-1)]))])):(v(),k("a",{key:0,onClick:n[4]||(n[4]=L=>s.value=!s.value)},p(d.$t("datePicker.selectDate")),1))]),s.value?(v(),k("li",ae,[m.value?(v(),k("div",le,[E(e("input",{"onUpdate:modelValue":n[7]||(n[7]=L=>a.value=L),type:"time",class:"width-100"},null,512),[[I,a.value]]),e("a",{onClick:r},n[9]||(n[9]=[e("i",{class:"fas fa-times"},null,-1)]))])):(v(),k("a",{key:0,onClick:n[6]||(n[6]=L=>m.value=!m.value)},p(d.$t("datePicker.selectTime")),1))])):j("",!0)])]),_:3}))}}),oe={class:"menu"},ne=["onClick"],ie=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const t=T(i,"modelValue");return(o,u)=>(v(),S(Z,null,{default:C(({handler:a,setRef:s})=>[P(o.$slots,"default",{handler:a,setRef:s})]),body:C(()=>[e("ul",oe,[(v(!0),k(H,null,U([...$(N).values()],a=>(v(),k("li",{key:a.priority},[e("a",{onClick:M(s=>t.value=a.priority,["prevent"])},[e("i",{class:"fas fa-exclamation-circle",style:F(`color: ${a.color}`)},null,4),e("span",null,p(a.name),1)],8,ne)]))),128))])]),_:3}))}}),ue=V({__name:"TaskListItemPopupMenuAttachment",props:{task:{}},setup(i){const t=i,o=z(),{files:u,open:a,reset:s,onCancel:m,onChange:c}=O({});return c(async l=>{l&&(await o.addAttachments(t.task,[...l]),s())}),m(()=>{s()}),(l,r)=>P(l.$slots,"default",{open:$(a)})}}),re=async i=>{try{const{response:t}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${G}&geocode=${i}&format=json`)).json();return t?t.GeoObjectCollection.featureMember.map(o=>o.GeoObject):[]}catch(t){return t instanceof Error&&console.error(t.message),[]}};function de(i,t,o){const s=40075016686e-3/(256*Math.pow(2,t))*Math.cos(o*(Math.PI/180));return i/s}const ce={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},pe={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},me={class:"pl-bg-block custom-p-16"},fe={class:"small custom-mt-0"},ve={class:"small gray"},Le={class:"small"},we={class:"custom-my-12"},ke={class:"custom-my-12"},$e=["placeholder"],ye=V({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(i){const t=i,o=J(),u=x(),a=B(()=>Math.pow(2,21-t.zoom)*1128.49722*(m.value/1e4)),s=B(()=>Math.round(de(a.value,t.zoom,t.lat))),m=y(50),c=y(""),l=y(!1),r=q([]),d=y("");D(K(c,500),f=>{if(l.value){l.value=!1;return}n(f)});const n=async f=>{r.value=await re(f)},L=async()=>{const f=await u.insert({name:d.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:a.value});f&&(await u.updateItem(f,{name:d.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:a.value}),o.push(`/map/${f.id}`))};return(f,w)=>(v(),k("div",ce,[e("div",pe,[e("div",me,[e("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:w[0]||(w[0]=b=>f.$router.replace("/map"))},w[3]||(w[3]=[e("i",{class:"fas fa-times"},null,-1)])),e("p",fe,p(f.$t("adjustLocationHint")),1),e("p",ve,[h(p(f.lat),1),w[4]||(w[4]=e("br",null,null,-1)),h(" "+p(f.lng),1)]),e("div",Le,[h(p(f.$t("Radius"))+": ",1),e("b",null,p(a.value&&Math.ceil(a.value))+" "+p(f.$t("m")),1)]),e("div",we,[E(e("input",{"onUpdate:modelValue":w[1]||(w[1]=b=>m.value=b),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[I,m.value,void 0,{number:!0}]])]),e("div",ke,[E(e("input",{"onUpdate:modelValue":w[2]||(w[2]=b=>d.value=b),type:"text",placeholder:f.$t("name"),class:"width-100"},null,8,$e),[[I,d.value,void 0,{trim:!0}]])]),e("button",{onClick:L},p(f.$t("Save location")),1)])]),e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:F({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:s.value+"px",height:s.value+"px"})},w[5]||(w[5]=[e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[e("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),Ce={class:"menu"},he=["onClick"],Me=V({__name:"TaskListItemPopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(i){const t=T(i,"modelValue"),o=x(),u=y(),a=()=>{X(ye,{}).show()},s=m=>{t.value=m,u.value.isOpened=!1};return(m,c)=>(v(),S(Z,{ref_key:"dropdownRef",ref:u},{default:C(({handler:l,setRef:r})=>[P(m.$slots,"default",{handler:l,setRef:r})]),body:C(()=>[e("ul",Ce,[e("li",null,[e("a",{onClick:c[0]||(c[0]=M(l=>s(null),["prevent"]))},[e("span",null,p(m.$t("None")),1)])]),e("li",null,[e("a",{onClick:M(a,["prevent"])},c[1]||(c[1]=[e("span",null,"New address...",-1),e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1)]))]),(v(!0),k(H,null,U($(o).items,l=>(v(),k("li",{key:l.id},[e("a",{onClick:M(r=>s(l.id),["prevent"])},p(l.name),9,he)]))),128))])]),_:3},512))}});function g(i){return i!=null&&typeof i=="object"&&i["@@functional/placeholder"]===!0}function A(i){return function t(o){return arguments.length===0||g(o)?t:i.apply(this,arguments)}}function _e(i){return function t(o,u){switch(arguments.length){case 0:return t;case 1:return g(o)?t:A(function(a){return i(o,a)});default:return g(o)&&g(u)?t:g(o)?A(function(a){return i(a,u)}):g(u)?A(function(a){return i(o,a)}):i(o,u)}}}var ge=_e(function(t,o){for(var u={},a=0;a<t.length;)t[a]in o&&(u[t[a]]=o[t[a]]),a+=1;return u});const De=["onClick"],Ve=["onClick"],be=["onClick"],Ye={href:"#"},Te=["onClick"],Ae=V({__name:"TaskListItemPopupMenu",props:{task:{},isSmall:{type:Boolean}},setup(i){const t=i,o=z(),u=x(),a=["name","due_date","due_datetime","priority","location_id"],s=y({});let m=[];return D(()=>t.task,c=>{m.forEach(l=>l()),s.value=ge(a,c),m=a.map(l=>D(()=>s.value[l],async r=>{await o.updateItem(t.task,{[l]:r})}))},{immediate:!0}),(c,l)=>(v(),k("ul",{class:Q([t.isSmall?"smaller":"small","chips custom-m-0"])},[Y(se,{dueDate:s.value.due_date,"onUpdate:dueDate":l[0]||(l[0]=r=>s.value.due_date=r),dueDatetime:s.value.due_datetime,"onUpdate:dueDatetime":l[1]||(l[1]=r=>s.value.due_datetime=r)},{default:C(({handler:r,setRef:d})=>[e("li",null,[e("a",{ref:d,onClick:M(r,["prevent"])},[l[4]||(l[4]=e("i",{class:"fas fa-calendar-alt"},null,-1)),h(" "+p(s.value.due_datetime?$(R)(s.value.due_datetime).format("LLL"):s.value.due_date?$(R)(s.value.due_date).format("LL"):c.$t("When")),1)],8,De)])]),_:1},8,["dueDate","dueDatetime"]),Y(Me,{modelValue:s.value.location_id,"onUpdate:modelValue":l[2]||(l[2]=r=>s.value.location_id=r)},{default:C(({handler:r,setRef:d})=>{var n;return[e("li",null,[e("a",{ref:d,onClick:M(r,["prevent"])},[l[5]||(l[5]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),h(" "+p(s.value.location_id?(n=$(u).getItemById(s.value.location_id))==null?void 0:n.name:c.$t("Where")),1)],8,Ve)])]}),_:1},8,["modelValue"]),Y(ie,{modelValue:s.value.priority,"onUpdate:modelValue":l[3]||(l[3]=r=>s.value.priority=r)},{default:C(({handler:r,setRef:d})=>{var n;return[e("li",null,[e("a",{ref:d,onClick:M(r,["prevent"])},[l[6]||(l[6]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),h(" "+p(s.value.priority?(n=$(N).get(s.value.priority))==null?void 0:n.name:c.$t("Priority")),1)],8,be)])]}),_:1},8,["modelValue"]),e("li",null,[e("a",Ye,[l[7]||(l[7]=e("i",{class:"fas fa-arrow-right"},null,-1)),h(" "+p(c.$t("Assign")),1)])]),Y(ue,{task:t.task},{default:C(({open:r})=>[e("li",null,[e("a",{onClick:M(()=>{r()},["prevent"])},[l[8]||(l[8]=e("i",{class:"fas fa-paperclip"},null,-1)),h(" "+p(c.$t("Attach")),1)],8,Te)])]),_:1},8,["task"])],2))}});export{Ae as _,Ie as a,Pe as b,ye as c,A as d,_e as e,ge as p};
