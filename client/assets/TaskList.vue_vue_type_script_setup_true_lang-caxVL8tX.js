import{a5 as te,d as M,a6 as j,o as k,x as E,l as $,E as B,b as l,e as _,O as R,a7 as Y,_ as se,w as S,a8 as ne,a0 as ae,c as C,I as h,t as V,f as oe,V as le,S as ie,a3 as re,a4 as ue,y as de,P as K,a9 as z,aa as fe,r as H,k as q,ab as U,J as ce,F as Z,B as W,n as N,h as P,ac as me,i as A,ad as pe,ae as ee,af as ve,ag as ke,ah as we,j as G,ai as ge,aj as _e,ak as J,G as ye,al as Q,A as be,am as Te,q as Ie}from"./index-KSa-CaJm.js";import{m as F,g as O,s as X}from"./rangy-5rxgwlWZ.js";import{_ as Le}from"./SortableList.vue_vue_type_style_index_0_lang-UFxWxKCp.js";function xe(c){let t=[];te(c,()=>{c.value&&(t=[...c.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0});const e=r=>t.findIndex(p=>p.isEqualNode(r)),n=r=>t[e(r)-1],s=r=>t[e(r)+1],a=(r,p)=>{if(r){const f=s(r);if(f instanceof HTMLElement)return f.focus(),p&&F(f),f}else{const f=t[0];f instanceof HTMLElement&&f.focus()}},o=(r,p)=>{if(r.target instanceof HTMLElement){const f=r.target,b=O(f),D=p==="up"?n(f):s(f);D instanceof HTMLElement&&(r.preventDefault(),D.focus(),X(D,b))}};return{getPreviousElementSibling:n,getNextElementSibling:s,getCurrentPositionInNavigationList:e,focusNextTask:a,focusTaskById:(r,p)=>{const f=t.find(b=>{var D;return b instanceof HTMLElement&&((D=b.dataset)==null?void 0:D.id)==r});f instanceof HTMLElement&&(f.focus(),p&&F(f))},onUp:r=>{o(r,"up")},onDown:r=>{o(r,"down")},onLeft:(r,p)=>{if(r.target instanceof HTMLElement){const f=r.target;if(O(f)===0){const b=n(f);b instanceof HTMLElement&&(r.preventDefault(),p&&(b.innerText+=p),b.focus(),F(b),p&&X(b,b.innerText.length-p.length))}}},onRight:r=>{if(r.target instanceof HTMLElement){const p=r.target;if(O(p)===p.innerText.length){const f=s(p);f instanceof HTMLElement&&(r.preventDefault(),f.focus())}}}}}const Ce={class:"menu"},$e=M({__name:"TaskListItemPopupMenuWhen",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const t=j(c,"modelValue"),e=n=>{t.value=n};return(n,s)=>(k(),E(Y,null,{default:$(({handler:a,setRef:o})=>[B(n.$slots,"default",{handler:a,setRef:o},void 0,!0)]),body:$(()=>[l("ul",Ce,[l("li",null,[l("a",{onClick:s[0]||(s[0]=a=>e(_(R)().startOf("day").format()))}," Today ")]),l("li",null,[l("a",{onClick:s[1]||(s[1]=a=>e(_(R)().add(1,"day").startOf("day").format()))}," Tomorrow ")]),l("li",null,[l("a",{onClick:s[2]||(s[2]=a=>e(_(R)().add(2,"day").startOf("day").format()))}," In 2 days ")]),l("li",null,[l("a",{onClick:s[3]||(s[3]=a=>e(_(R)().endOf("week").startOf("day").format()))}," This weekend ")]),s[4]||(s[4]=l("li",null,null,-1))])]),_:3}))}}),he=se($e,[["__scopeId","data-v-0e68afd4"]]),Me={class:"menu"},Ve=M({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(c){const t=j(c,"modelValue");return(e,n)=>(k(),E(Y,null,{default:$(({handler:s,setRef:a})=>[B(e.$slots,"default",{handler:s,setRef:a})]),body:$(()=>[l("ul",Me,[l("li",null,[l("a",{onClick:n[0]||(n[0]=S(s=>t.value=0,["prevent"]))},n[3]||(n[3]=[l("i",{class:"fas fa-star",style:{color:"silver"}},null,-1),l("span",null,"Without priority",-1)]))]),l("li",null,[l("a",{onClick:n[1]||(n[1]=S(s=>t.value=1,["prevent"]))},n[4]||(n[4]=[l("i",{class:"fas fa-star",style:{color:"orange"}},null,-1),l("span",null,"Normal",-1)]))]),l("li",null,[l("a",{onClick:n[2]||(n[2]=S(s=>t.value=2,["prevent"]))},n[5]||(n[5]=[l("i",{class:"fas fa-star",style:{color:"red"}},null,-1),l("span",null,"Hight",-1)]))])])]),_:3}))}}),De=["onClick"],Se={key:1},Pe={key:2},Ee=["onClick"],Ne=["onClick"],Be=M({__name:"TaskListItemPopupMenu",props:ne({isFocused:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const t=c,e=j(c,"modelValue"),n=ae(null);{const s=re(()=>ue(()=>import("./TaskListItemPopupMenuWhere-MHt-bkNm.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));n.value=s}return(s,a)=>(k(),C("div",{class:"tw-flex tw-gap-2 tw-pt-2 tw-items-center smaller empty:tw-hidden",onMousedown:a[3]||(a[3]=S(()=>{},["prevent"]))},[t.isFocused?(k(),E(he,{key:0,modelValue:e.value.due_date,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value.due_date=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,onClick:S(o,["prevent"])},a[4]||(a[4]=[l("i",{class:"fas fa-calendar-alt"},null,-1)]),8,De)]),_:1},8,["modelValue"])):h("",!0),e.value.due_datetime?(k(),C("div",Se,V(_(oe)(e.value.due_datetime).format("LLL")),1)):e.value.due_date?(k(),C("div",Pe,V(_(R)(e.value.due_date).format("LL")),1)):h("",!0),t.isFocused||e.value.priority?(k(),E(Ve,{key:3,modelValue:e.value.priority,"onUpdate:modelValue":a[1]||(a[1]=o=>e.value.priority=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,style:le(`color: ${e.value.priority===1?"orange":e.value.priority===2?"red":"silver"}`),onClick:S(o,["prevent"])},a[5]||(a[5]=[l("i",{class:"fas fa-star"},null,-1)]),12,Ee)]),_:1},8,["modelValue"])):h("",!0),e.value.location_id&&n.value?(k(),E(ie(n.value),{key:4,modelValue:e.value.location_id,"onUpdate:modelValue":a[2]||(a[2]=o=>e.value.location_id=o)},{default:$(({handler:o,setRef:w})=>[l("a",{ref:w,onClick:S(o,["prevent"])},a[6]||(a[6]=[l("i",{class:"fas fa-map-pin"},null,-1)]),8,Ne)]),_:1},8,["modelValue"])):h("",!0)],32))}}),Re=M({__name:"TaskListItemInfoLink",props:{task:{}},setup(c){const t=c,e=de(),n=s=>{var o,w;const a=(w=(o=e.currentRoute.value.matched.find(y=>{var i;return(i=y.meta)==null?void 0:i.isListView}))==null?void 0:o.children.find(y=>{var i;return(i=y.meta)==null?void 0:i.isTaskInfoView}))==null?void 0:w.name;a?e.push({name:a,params:{taskId:s}}):console.error("Cant find `taskInfo` route")};return(s,a)=>(k(),C("a",{onClick:a[0]||(a[0]=S(o=>n(t.task.id),["prevent"]))},a[1]||(a[1]=[l("i",{class:"fas fa-arrow-circle-right"},null,-1)])))}}),Oe={class:"tw-group tw-flex tw-relative tw-gap-2 tw-py-4 tw-px-6 -tw-mx-6"},He={key:0,class:"sortable-handle tw-cursor-grabbing tw-absolute -tw-translate-x-4 tw-hidden group-hover:tw-block"},Ue={class:"tw-flex-auto"},Fe={class:"hint"},qe={class:"hint"},We={class:"hint"},Ke=["contenteditable","placeholder","data-id","textContent"],je={key:1},ze=M({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},editable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean}},emits:["delete","update","insert","insertMany","blur","complete"],setup(c,{emit:t}){const e=c,n=t,s=K(z),a=K(fe),o=H(!1);let w=!1;const y=["name","due_date","due_datetime","priority","location_id"];let i={};const d=H({});let g;q([()=>e.task,()=>e.addableProps],async([v])=>{g&&g(),i=U.pick(v,y),d.value={...i},g=q(d,async()=>{const u=U.reduce(d.value,(L,T,m)=>U.isEqual(T,i[m])?L:[...L,m],[]);u.length&&n("update",e.task,U.pick(d.value,u))},{deep:!0})},{immediate:!0});const r=async v=>{w||(v.target instanceof HTMLElement&&(v.target.innerText=v.target.innerText.trim(),d.value.name=v.target.innerText),n("blur",e.task,d.value))},p=v=>{var m;v.preventDefault();const{innerText:u}=v.target,L=(m=v.clipboardData)==null?void 0:m.getData("text/plain"),T=L==null?void 0:L.split(`
`);if(T!=null&&T.length){document.execCommand("insertText",!1,T[0]);const I=T.slice(1);I.length&&!u&&n("insertMany",e.task,I.map(x=>({name:x,...e.addableProps})))}},f=v=>{v.target instanceof HTMLElement&&O(v.target)===0&&(w=!0,s==null||s.onLeft(v,v.target.innerText.trim()),n("delete",e.task,d.value))},b=async v=>{if(v.preventDefault(),v.target instanceof HTMLElement){const u=v.target,L=u.innerText.trim(),T=O(u),m={};T!==0&&(m.currentName=L.substring(0,T).trim(),m.newName=L.substring(T,L.length).trim(),u.innerText=m.currentName,F(u)),n("insert",e.task,{...d.value,...e.addableProps},m)}},D=()=>{n("complete",e.task,d.value)};return(v,u)=>{var L,T;return k(),C("div",Oe,[e.sortable?(k(),C("div",He,u[7]||(u[7]=[l("i",{class:"fas fa-grip-vertical"},null,-1)]))):h("",!0),l("div",{class:"tw-w-4 tw-h-4 tw-flex-none",onClick:D},[l("div",{class:ce(["tw-w-4 tw-h-4 tw-border tw-border-solid tw-border-gray-300 tw-rounded-full tw-cursor-pointer",e.task.status&&["tw-bg-red-400","tw-border-red-400"]])},null,2)]),l("div",Ue,[(L=_(a))!=null&&L.is_debug_mode?(k(),C(Z,{key:0},[l("span",Fe,"id: "+V(e.task.id),1),u[8]||(u[8]=W(" | ")),l("span",qe,"prev_id: "+V(String(e.task.prev_item_id)),1),u[9]||(u[9]=W(" | ")),l("span",We,"srank: "+V(String(e.task.sort))+" | "+V(String(e.task.rank)),1)],64)):h("",!0),l("div",{contenteditable:e.editable||void 0,placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[N(b,["enter"]),u[0]||(u[0]=N((...m)=>{var I,x;return((I=_(s))==null?void 0:I.onLeft)&&((x=_(s))==null?void 0:x.onLeft(...m))},["left"])),u[1]||(u[1]=N((...m)=>{var I,x;return((I=_(s))==null?void 0:I.onUp)&&((x=_(s))==null?void 0:x.onUp(...m))},["up"])),u[2]||(u[2]=N((...m)=>{var I,x;return((I=_(s))==null?void 0:I.onRight)&&((x=_(s))==null?void 0:x.onRight(...m))},["right"])),u[3]||(u[3]=N((...m)=>{var I,x;return((I=_(s))==null?void 0:I.onDown)&&((x=_(s))==null?void 0:x.onDown(...m))},["down"])),N(f,["delete"])],onBlur:r,onFocus:u[4]||(u[4]=m=>o.value=!0),onFocusout:u[5]||(u[5]=m=>o.value=!1),onPaste:p,textContent:V(e.task.name)},null,40,Ke),P(Be,{modelValue:d.value,"onUpdate:modelValue":u[6]||(u[6]=m=>d.value=m),"is-focused":o.value},null,8,["modelValue","is-focused"])]),(T=e.task.extended_data)!=null&&T.comments_count?(k(),C("div",je,[u[10]||(u[10]=l("i",{class:"far fa-comment"},null,-1)),W(" "+V(e.task.extended_data.comments_count),1)])):h("",!0),e.showInfoLink?(k(),E(Re,{key:2,class:"tw-hidden group-hover:tw-block",task:v.task},null,8,["task"])):h("",!0)])}}}),Ae=M({__name:"ListNavigationProvider",setup(c){const t=H();return me(z,xe(t)),(e,n)=>(k(),C("div",{ref_key:"navigatableRef",ref:t},[B(e.$slots,"default")],512))}}),Ge=M({__name:"TaskListItemStoreProvider",setup(c){const t=K(z),e=A(),n=i=>e.completeTask(i),s=(i,d)=>e.updateItem(i,d),a=async(i,d,g)=>{if(!g.currentName)await e.insert("before",i,{...d,name:g.newName});else{const r=await e.insert("after",i,{...d,name:g.newName});r&&(t==null||t.focusTaskById(r.id))}},o=async(i,d)=>{let g;for(let r=0;r<d.length;r++)g=await e.insert("after",g??i,d[r]),r===d.length-1?g&&(t==null||t.focusTaskById(g.id,!0)):g&&y(g)},w=i=>e.deleteItem(i),y=i=>{pe(i)&&(i.name?e.updateItem(i,{client_touch_datetime:ee()}):e.deleteItem(i))};return(i,d)=>B(i.$slots,"default",{onComplete:n,onUpdate:s,onInsert:a,onInsertMany:o,onDelete:w,onBlur:y})}}),Je=M({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(c,{emit:t}){const e=c,n=t,s=H(null),{stop:a}=ve(s,([{isIntersecting:o}])=>{o&&!e.disabled&&n("intersecting")},{rootMargin:"100px"});return ke(()=>{a()}),(o,w)=>(k(),C("div",{ref_key:"elRef",ref:s,class:"tw-min-h-2"},[B(o.$slots,"default")],512))}}),Qe=M({__name:"TaskListLazyLoadFetcher",props:{listId:{},filter:{},locationId:{}},setup(c){const t=c,e=we(),n=A(),s=H(!1),a=G(()=>{var i;return t.listId?n.getTasksInList(t.listId):t.filter?((i=n.getItemsByFilterName(t.filter))==null?void 0:i.value)||[]:t.locationId?n.getTasksInLocation(t.locationId)||[]:[]}),o=G(()=>{if(t.listId)return{list_id:t.listId,filter:void 0};if(t.filter)return{filter:t.filter,list_id:void 0};if(t.locationId)return{location_id:t.locationId,filter:void 0}}),w=async()=>{if(o.value){const i=await ge(o.value);if(i){const d=i.timestamp;_e()>d&&(await n[t.filter?"fetchStreamAll":"fetchAll"]({...o.value,starting_from:ee(new Date(d))}),J(o.value,Date.now()))}}};q(e,async()=>{e.value&&(await w(),s.value=!0)},{immediate:!0});const y=async()=>{if(o.value){const i=await n[t.filter?"fetchStream":"fetch"]({...o.value,offset:a.value.length});i&&i.status_code==="ok"&&J(o.value,Date.now())}};return(i,d)=>(k(),C(Z,null,[B(i.$slots,"default",{tasks:a.value}),s.value?(k(),E(Je,{key:0,onIntersecting:y})):h("",!0)],64))}}),Xe={class:"pl-bg-block tw-rounded-xl tw-overflow-hidden tw-p-6"},Ye={key:0,class:"lg:tw-hidden tw-mb-4"},Ze={class:"tw-m-0"},nt=M({__name:"TaskList",props:{listId:{},filter:{},locationId:{},addableProps:{}},setup(c){const t=c,e=ye(),n=A(),s=async()=>{const a=await n.insertDummy({...t.addableProps});a&&Te(()=>n.items,async()=>{await Ie();const o=document.querySelector(`[contenteditable][data-id="${a.id}"]`);o instanceof HTMLElement&&o.focus()})};return q(Q.currentRoute,a=>{const o={...a.query};"addNewTask"in o&&(s(),delete o.addNewTask,Q.replace({path:a.path,query:o}))},{immediate:!0}),(a,o)=>{const w=be("RouterLink");return k(),C("div",Xe,[t.listId?(k(),C("div",Ye,[P(w,{to:{name:"lists"},class:"tw-flex tw-items-center tw-gap-3"},{default:$(()=>{var y;return[o[0]||(o[0]=l("i",{class:"fas fa-chevron-left gray"},null,-1)),l("h3",Ze,V((y=_(e).getItemById(t.listId))==null?void 0:y.name),1)]}),_:1})])):h("",!0),l("div",{class:"tw-mb-4",onClick:s}," + New To-Do "),P(Ae,null,{default:$(()=>[P(Qe,{"list-id":t.listId,filter:t.filter,"location-id":t.locationId},{default:$(({tasks:y})=>[P(Le,{"sortable-list-id":t.listId,"sortable-group-name":"tasks",items:y,onSort:_(n).sort},{default:$(({item:i})=>[P(Ge,null,{default:$(({onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:f,onBlur:b})=>[P(ze,{task:i,sortable:!!t.listId,editable:!0,"addable-props":t.addableProps,"show-info-link":!0,onUpdate:d,onComplete:g,onInsert:r,onInsertMany:p,onDelete:f,onBlur:b},null,8,["task","sortable","addable-props","onUpdate","onComplete","onInsert","onInsertMany","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["sortable-list-id","items","onSort"])]),_:1},8,["list-id","filter","location-id"])]),_:1})])}}});export{nt as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./TaskListItemPopupMenuWhere-MHt-bkNm.js","./index-KSa-CaJm.js","./index-KrfFgSv5.css","./ChooseLocation.vue_vue_type_script_setup_true_lang-JfNJIpZD.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
