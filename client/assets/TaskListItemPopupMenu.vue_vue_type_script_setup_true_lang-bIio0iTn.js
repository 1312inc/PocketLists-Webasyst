import{d as V,aH as T,r as C,J as M,m as b,o as f,z as R,q as w,W as E,af as O,R as A,e,i as L,t as p,b as _,s as P,v as S,f as W,y as x,h,D as F,O as U,F as I,B as j,aI as G,aJ as J,A as K,a4 as N,c as Z,a5 as q,aK as X,H as g,aF as Q,u as ee,g as Y,n as te,j as H,k as z}from"./index-ugREaSg3.js";const je=""+new URL("img/shop.svg",import.meta.url).href,Oe="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.85619%2017.2942L5.86319%2020.6332L22.1312%201.06423C24.3722%200.898238%2026.6255%201.05688%2028.8212%201.53523L6.56619%2028.3052L0.867188%2023.5572C0.908188%2021.3822%201.25019%2019.2812%201.85619%2017.2942Z'%20fill='%23E80A8A'/%3e%3cpath%20d='M35.4942%204.15186C38.9684%206.19305%2041.8486%209.10706%2043.8492%2012.6049L25.3792%2034.8219L3.36719%2016.4809L10.9402%207.39386L23.8532%2018.1539L35.4932%204.15186H35.4942Z'%20fill='%2329ABE2'/%3e%3cpath%20d='M18.6278%2013.798L11.0658%2022.894L6.88281%2019.409L14.4448%2010.313L18.6278%2013.798V13.798Z'%20fill='%23292A76'/%3e%3cpath%20d='M4.01953%2035.6338L18.9695%2017.6138L27.3515%2024.5658L11.6495%2043.4918C8.51344%2041.5215%205.89666%2038.8265%204.01953%2035.6338V35.6338Z'%20fill='%23F7EA34'/%3e%3cpath%20d='M23.8675%2047C36.5705%2047%2046.8685%2036.703%2046.8685%2024C46.8685%2023.142%2046.8215%2022.294%2046.7305%2021.46L30.0085%2041.574L18.5015%2032.07L12.5215%2039.308L21.7155%2046.902C22.4235%2046.967%2023.1415%2047.001%2023.8675%2047.001V47Z'%20fill='%2349B749'/%3e%3cpath%20d='M44.8763%2033.3699C46.2421%2030.3102%2046.9204%2026.9882%2046.8633%2023.6379L44.1153%2026.9429L35.6863%2019.9829L32.6973%2023.6029L44.7343%2033.5419L44.8763%2033.3709V33.3699Z'%20fill='%23F1B61C'/%3e%3cpath%20d='M36.8902%2020.9769L33.8892%2024.5869L32.6992%2023.6029L35.6872%2019.9829L36.8892%2020.9769H36.8902Z'%20fill='%23097D3F'/%3e%3cpath%20d='M17.0791%2045.9832L28.7711%2031.8892L32.3841%2034.8862L22.3731%2046.9522C20.5762%2046.8379%2018.7989%2046.5123%2017.0781%2045.9822L17.0791%2045.9832Z'%20fill='%23F05323'/%3e%3cpath%20d='M22.3757%2046.9518L28.1267%2040.0198L24.5077%2037.0298L18.5137%2044.2548L21.7157%2046.8998C21.9347%2046.9198%2022.1547%2046.9378%2022.3757%2046.9518V46.9518Z'%20fill='%232B3F1B'/%3e%3cpath%20d='M24.5635%2029.7328L36.5855%2015.2658L33.7695%2012.9258L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4738L24.5635%2029.7338V29.7328Z'%20fill='%23292A76'/%3e%3cpath%20d='M21.5154%2031.6018L13.1484%2024.6308L18.9704%2017.6128L27.3524%2024.5658L21.5154%2031.6018V31.6018Z'%20fill='%2313A149'/%3e%3cpath%20d='M25.4245%2022.9678L24.1045%2024.5558L19.5065%2020.6758L17.1445%2023.4748L23.6815%2028.9888L27.3515%2024.5658L25.4245%2022.9678V22.9678Z'%20fill='%230C0D1B'/%3e%3cpath%20d='M42.9619%2025.9902L44.1159%2026.9442L46.8639%2023.6392C46.9212%2026.9897%2046.2429%2030.3121%2044.8769%2033.3722L44.7349%2033.5422L39.9609%2029.6002L42.9609%2025.9902H42.9619Z'%20fill='%23269145'/%3e%3c/svg%3e",ae={class:"menu"},le=["onClick"],se=["onClick"],oe=["onClick"],ne=["onClick"],ie={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},ue={key:0},re={key:1,class:"custom-px-8 custom-pb-8 flexbox space-8 middle"},de=V({__name:"TaskListItemPopupMenuWhen",props:{dueDate:{},dueDateModifiers:{},dueDatetime:{},dueDatetimeModifiers:{}},emits:["update:dueDate","update:dueDatetime"],setup(u){const t=T(u,"dueDate"),n=T(u,"dueDatetime"),c=C(t.value),l=C(n.value?M(n.value).format("HH:mm"):""),d=C(!1),s=C(!1);b([t,n],()=>{d.value=!!(t.value||n.value),s.value=!!n.value},{immediate:!0}),b(l,()=>{!c.value&&l.value&&(c.value=M().format("YYYY-MM-DD"))}),b([c,l],([r,a])=>{t.value=r||null,n.value=a?O(`${r||M().format("YYYY-MM-DD")}T${a}`):null});const k=r=>{c.value=r,l.value=""},m=()=>{c.value="",l.value="",d.value=!1},y=()=>{l.value=""};return(r,a)=>(f(),R(E,null,{default:w(({handler:i,setRef:o})=>[A(r.$slots,"default",{handler:i,setRef:o})]),body:w(({handler:i})=>[e("ul",ae,[e("li",null,[e("a",{onClick:()=>{k(L(M)().format("YYYY-MM-DD")),i()}},p(r.$t("datePicker.today")),9,le)]),e("li",null,[e("a",{onClick:()=>{k(L(M)().add(1,"day").format("YYYY-MM-DD")),i()}},p(r.$t("datePicker.tomorrow")),9,se)]),e("li",null,[e("a",{onClick:()=>{k(L(M)().add(2,"day").format("YYYY-MM-DD")),i()}},p(r.$t("datePicker.in2days")),9,oe)]),e("li",null,[e("a",{onClick:()=>{k(L(M)().endOf("week").format("YYYY-MM-DD")),i()}},p(r.$t("datePicker.thisWeekend")),9,ne)]),e("li",null,[d.value?(f(),_("div",ie,[P(e("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),type:"date",class:"width-100"},null,512),[[S,c.value]]),e("a",{onClick:m},a[4]||(a[4]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),_("a",{key:0,onClick:a[0]||(a[0]=o=>d.value=!d.value)},p(r.$t("datePicker.selectDate")),1))]),d.value?(f(),_("li",ue,[s.value?(f(),_("div",re,[P(e("input",{"onUpdate:modelValue":a[3]||(a[3]=o=>l.value=o),type:"time",class:"width-100"},null,512),[[S,l.value]]),e("a",{onClick:y},a[5]||(a[5]=[e("i",{class:"fas fa-times"},null,-1)]))])):(f(),_("a",{key:0,onClick:a[2]||(a[2]=o=>s.value=!s.value)},p(r.$t("datePicker.selectTime")),1))])):W("",!0)])]),_:3}))}}),ce={class:"menu"},pe=["onClick"],me=V({__name:"TaskListItemPopupMenuPriority",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const t=T(u,"modelValue");return(n,c)=>(f(),R(E,null,{default:w(({handler:l,setRef:d})=>[A(n.$slots,"default",{handler:l,setRef:d})]),body:w(({handler:l})=>[e("ul",ce,[(f(!0),_(I,null,x([...L(U).values()],d=>(f(),_("li",{key:d.priority},[e("a",{onClick:h(()=>{t.value=d.priority,l()},["prevent"])},[e("i",{class:"fas fa-exclamation-circle",style:F(`color: ${d.color}`)},null,4),e("span",null,p(d.name),1)],8,pe)]))),128))])]),_:3}))}}),fe=V({__name:"TaskListItemPopupMenuAttachment",props:{task:{}},setup(u){const t=u,n=j(),{files:c,open:l,reset:d,onCancel:s,onChange:k}=G({});return k(async m=>{m&&(await n.addAttachments(t.task,[...m]),d())}),s(()=>{d()}),(m,y)=>A(m.$slots,"default",{open:L(l)})}}),ve=async u=>{try{const{response:t}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${J}&geocode=${u}&format=json`)).json();return t?t.GeoObjectCollection.featureMember.map(n=>n.GeoObject):[]}catch(t){return t instanceof Error&&console.error(t.message),[]}};function _e(u,t,n){const d=40075016686e-3/(256*Math.pow(2,t))*Math.cos(n*(Math.PI/180));return u/d}const ke={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},Le={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},we={class:"pl-bg-block custom-p-16"},he={class:"small custom-mt-0"},ye={class:"small gray"},Ce={class:"small"},ge={class:"custom-my-12"},$e={class:"custom-my-12"},Me=["placeholder"],De=V({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(u){const t=u,n=K(),c=N(),l=Z(()=>Math.pow(2,21-t.zoom)*1128.49722*(s.value/1e4)),d=Z(()=>Math.round(_e(l.value,t.zoom,t.lat))),s=C(50),k=C(""),m=C(!1),y=q([]),r=C("");b(X(k,500),o=>{if(m.value){m.value=!1;return}a(o)});const a=async o=>{y.value=await ve(o)},i=async()=>{const o=await c.insert({name:r.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:l.value});o&&(await c.updateItem(o,{name:r.value,location_latitude:t.lat,location_longitude:t.lng,location_radius:l.value}),n.push(`/map/${o.id}`))};return(o,v)=>(f(),_("div",ke,[e("div",Le,[e("div",we,[e("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:v[0]||(v[0]=$=>o.$router.replace("/map"))},v[3]||(v[3]=[e("i",{class:"fas fa-times"},null,-1)])),e("p",he,p(o.$t("adjustLocationHint")),1),e("p",ye,[g(p(o.lat),1),v[4]||(v[4]=e("br",null,null,-1)),g(" "+p(o.lng),1)]),e("div",Ce,[g(p(o.$t("Radius"))+": ",1),e("b",null,p(l.value&&Math.ceil(l.value))+" "+p(o.$t("m")),1)]),e("div",ge,[P(e("input",{"onUpdate:modelValue":v[1]||(v[1]=$=>s.value=$),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[S,s.value,void 0,{number:!0}]])]),e("div",$e,[P(e("input",{"onUpdate:modelValue":v[2]||(v[2]=$=>r.value=$),type:"text",placeholder:o.$t("name"),class:"width-100"},null,8,Me),[[S,r.value,void 0,{trim:!0}]])]),e("button",{onClick:i},p(o.$t("Save location")),1)])]),e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:F({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:d.value+"px",height:d.value+"px"})},v[5]||(v[5]=[e("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[e("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),be={class:"menu"},Ve=["onClick"],Ye=V({__name:"TaskListItemPopupMenuWhere",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u){const t=T(u,"modelValue"),n=N(),c=C(),l=()=>{Q(De,{}).show()},d=s=>{t.value=s,c.value.isOpened=!1};return(s,k)=>(f(),R(E,{ref_key:"dropdownRef",ref:c},{default:w(({handler:m,setRef:y})=>[A(s.$slots,"default",{handler:m,setRef:y})]),body:w(()=>[e("ul",be,[e("li",null,[e("a",{onClick:k[0]||(k[0]=h(m=>d(null),["prevent"]))},[e("span",null,p(s.$t("None")),1)])]),e("li",null,[e("a",{onClick:h(l,["prevent"])},k[1]||(k[1]=[e("span",null,"New address...",-1),e("span",{class:"count"},[e("i",{class:"fas fa-map-marker-alt"})],-1)]))]),(f(!0),_(I,null,x(L(n).items,m=>(f(),_("li",{key:m.id},[e("a",{onClick:h(y=>d(m.id),["prevent"])},p(m.name),9,Ve)]))),128))])]),_:3},512))}});function D(u){return u!=null&&typeof u=="object"&&u["@@functional/placeholder"]===!0}function B(u){return function t(n){return arguments.length===0||D(n)?t:u.apply(this,arguments)}}function Ie(u){return function t(n,c){switch(arguments.length){case 0:return t;case 1:return D(n)?t:B(function(l){return u(n,l)});default:return D(n)&&D(c)?t:D(n)?B(function(l){return u(l,c)}):D(c)?B(function(l){return u(n,l)}):u(n,c)}}}var Te=Ie(function(t,n){for(var c={},l=0;l<t.length;)t[l]in n&&(c[t[l]]=n[t[l]]),l+=1;return c});const Pe=["onClick"],Se=["onClick"],Ee=["onClick"],Ae={key:0},Be=["onClick"],Ue={class:"icon"},Ze=["src"],Re={class:"menu"},xe=["onClick"],Fe=["onClick"],Ne={class:"icon"},He=["src"],ze=["onClick"],Ge=V({__name:"TaskListItemPopupMenu",props:{task:{},isSmall:{type:Boolean}},setup(u){const t=u,n=j(),c=N(),l=ee(),d=["name","due_date","due_datetime","priority","location_id"],s=C({});let k=[];const m=Z(()=>t.task.assigned_contact_id&&l.getItemById(t.task.assigned_contact_id));b(()=>t.task,r=>{k.forEach(a=>a()),s.value=Te(d,r),k=d.map(a=>b(()=>s.value[a],async i=>{await n.updateItem(t.task,{[a]:i})}))},{immediate:!0});const y=async r=>{await n.updateItem(t.task.id,{assigned_contact_id:r})};return(r,a)=>(f(),_("ul",{class:te([t.isSmall?"smaller":"small","chips custom-m-0"])},[Y(de,{dueDate:s.value.due_date,"onUpdate:dueDate":a[0]||(a[0]=i=>s.value.due_date=i),dueDatetime:s.value.due_datetime,"onUpdate:dueDatetime":a[1]||(a[1]=i=>s.value.due_datetime=i)},{default:w(({handler:i,setRef:o})=>[e("li",null,[e("a",{ref:o,onClick:h(i,["prevent"])},[a[4]||(a[4]=e("i",{class:"fas fa-calendar-alt"},null,-1)),g(" "+p(s.value.due_datetime?L(H)(s.value.due_datetime).format("LLL"):s.value.due_date?L(H)(s.value.due_date).format("LL"):r.$t("When")),1)],8,Pe)])]),_:1},8,["dueDate","dueDatetime"]),Y(Ye,{modelValue:s.value.location_id,"onUpdate:modelValue":a[2]||(a[2]=i=>s.value.location_id=i)},{default:w(({handler:i,setRef:o})=>{var v;return[e("li",null,[e("a",{ref:o,onClick:h(i,["prevent"])},[a[5]||(a[5]=e("i",{class:"fas fa-map-marker-alt"},null,-1)),g(" "+p(s.value.location_id?(v=L(c).getItemById(s.value.location_id))==null?void 0:v.name:r.$t("Where")),1)],8,Se)])]}),_:1},8,["modelValue"]),Y(me,{modelValue:s.value.priority,"onUpdate:modelValue":a[3]||(a[3]=i=>s.value.priority=i)},{default:w(({handler:i,setRef:o})=>{var v,$;return[e("li",null,[e("a",{ref:o,onClick:h(i,["prevent"])},[(f(),_("span",{key:s.value.priority},[e("i",{style:F(`color: ${s.value.priority&&((v=L(U).get(s.value.priority))==null?void 0:v.color)}`),class:"fas fa-exclamation-circle"},null,4)])),g(" "+p(s.value.priority?($=L(U).get(s.value.priority))==null?void 0:$.name:r.$t("Priority")),1)],8,Ee)])]}),_:1},8,["modelValue"]),L(z).user_rights.canassign||L(z).user_rights.backend==="FULL"?(f(),_("li",Ae,[Y(E,null,{default:w(({handler:i,setRef:o})=>[e("a",{ref:o,onClick:h(i,["prevent"])},[m.value?(f(),_(I,{key:0},[e("span",Ue,[e("img",{src:m.value.photo_url,class:"userpic"},null,8,Ze)]),g(" "+p(m.value.name),1)],64)):(f(),_(I,{key:1},[a[6]||(a[6]=e("i",{class:"fas fa-arrow-right"},null,-1)),g(" "+p(r.$t("Assign")),1)],64))],8,Be)]),body:w(({handler:i})=>[e("ul",Re,[e("li",null,[e("a",{onClick:h(()=>{y(null),i()},["prevent"])},p(r.$t("No assignment")),9,xe)]),(f(!0),_(I,null,x(L(l).items,o=>(f(),_("li",{key:o.id,class:"item"},[e("a",{onClick:h(()=>{y(o.id),i()},["prevent"])},[e("span",Ne,[e("img",{src:o.photo_url,class:"userpic"},null,8,He)]),e("span",null,p(o.name),1)],8,Fe)]))),128))])]),_:1})])):W("",!0),Y(fe,{task:t.task},{default:w(({open:i})=>[e("li",null,[e("a",{onClick:h(()=>{i()},["prevent"])},[a[7]||(a[7]=e("i",{class:"fas fa-paperclip"},null,-1)),g(" "+p(r.$t("Attach")),1)],8,ze)])]),_:1},8,["task"])],2))}});export{Ge as _,je as a,Oe as b,De as c,B as d,Ie as e,Te as p};
