import{a5 as A,d as P,A as S,a6 as T,c as C,r as g,a7 as z,m as N,a8 as D,o as r,e as p,f as t,t as u,K as b,s as M,v as L,D as j,z as B,J as q,I as F,i as y,F as E,x as U,j as R,g as _,h as I,y as x,Z as Y,q as G,a9 as H,aa as O,ab as Z}from"./index-oYoCgmil.js";import{_ as V}from"./TaskList.vue_vue_type_script_setup_true_lang-QYBreAlO.js";import{u as K}from"./textToHtmlWithLinks-_HWS3l1C.js";import"./sanitizer-TiisBOmJ.js";import"./SortableList.vue_vue_type_style_index_0_lang-lYx1unUm.js";const J=async d=>{try{const{response:a}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${A}&geocode=${d}&format=json`)).json();return a?a.GeoObjectCollection.featureMember.map(n=>n.GeoObject):[]}catch(a){return a instanceof Error&&console.error(a.message),[]}};function W(d,a,n){const w=40075016686e-3/(256*Math.pow(2,a))*Math.cos(n*(Math.PI/180));return d/w}const X={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},Q={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},tt={class:"pl-bg-block custom-p-16"},et={class:"small custom-mt-0"},ot={class:"small gray"},at={class:"small"},st={class:"custom-my-12"},lt={class:"custom-my-12"},nt=["placeholder"],it=P({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(d){const a=d,n=S(),c=T(),m=C(()=>Math.pow(2,21-a.zoom)*1128.49722*(i.value/1e4)),w=C(()=>Math.round(W(m.value,a.zoom,a.lat))),i=g(50),v=g(""),h=g(!1),$=z([]),o=g("");N(D(v,500),e=>{if(h.value){h.value=!1;return}s(e)});const s=async e=>{$.value=await J(e)},k=async()=>{const e=await c.insert({name:o.value,location_latitude:a.lat,location_longitude:a.lng,location_radius:m.value});e&&(await c.updateItem(e,{name:o.value,location_latitude:a.lat,location_longitude:a.lng,location_radius:m.value}),n.push(`/map/${e.id}`))};return(e,l)=>(r(),p("div",X,[t("div",Q,[t("div",tt,[t("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:l[0]||(l[0]=f=>e.$router.replace("/map"))},l[3]||(l[3]=[t("i",{class:"fas fa-times"},null,-1)])),t("p",et,u(e.$t("adjustLocationHint")),1),t("p",ot,[b(u(e.lat),1),l[4]||(l[4]=t("br",null,null,-1)),b(" "+u(e.lng),1)]),t("div",at,[b(u(e.$t("Radius"))+": ",1),t("b",null,u(m.value&&Math.ceil(m.value))+" "+u(e.$t("m")),1)]),t("div",st,[M(t("input",{"onUpdate:modelValue":l[1]||(l[1]=f=>i.value=f),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[L,i.value,void 0,{number:!0}]])]),t("div",lt,[M(t("input",{"onUpdate:modelValue":l[2]||(l[2]=f=>o.value=f),type:"text",placeholder:e.$t("name"),class:"width-100"},null,8,nt),[[L,o.value,void 0,{trim:!0}]])]),t("button",{onClick:k},u(e.$t("Save location")),1)])]),t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:j({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:w.value+"px",height:w.value+"px"})},l[5]||(l[5]=[t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[t("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),rt={class:"pl-map-sidebar"},ut={key:0,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full custom-m-12"},dt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},ct={class:"menu"},mt=["onClick"],pt={key:1,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full custom-m-12"},wt={class:"tw-flex-none tw-flex tw-items-center tw-gap-4 tw-justify-between"},ft={class:"bold"},vt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},ht={key:2,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},kt=P({__name:"MapView",props:{locationId:{}},setup(d){const{t:a}=B();q(a("map")),K(a("modalPremiumMap"));const n=S(),c=T(),m=O(()=>Z(()=>import("./MapYandex-WCoqVr2Y.js"),__vite__mapDeps([0,1,2]),import.meta.url)),w=z(m),i=C(()=>d.locationId?c.getItemById(d.locationId):null),v=o=>{n.push(`/map/${o}`)},h=()=>{const o={...n.currentRoute.value.query};o.addLocation?delete o.addLocation:o.addLocation="1",n.push({path:"/map",query:o})},$=async o=>{await c.deleteItem(o),n.push("/map")};return(o,s)=>{const k=F("RouterView");return r(),p(E,null,[t("div",rt,[o.$route.name==="map"?(r(),p("div",ut,[t("a",{class:"button custom-m-0",onClick:y(h,["prevent"])},[s[2]||(s[2]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),b(" "+u(o.$t("New location")),1)]),t("div",dt,[t("ul",ct,[(r(!0),p(E,null,U(R(c).items,e=>(r(),p("li",{key:e.id,class:"rounded"},[t("a",{onClick:y(l=>v(e.id),["prevent"])},[s[3]||(s[3]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),t("span",null,u(e.name),1),s[4]||(s[4]=t("span",{class:"count"},[t("i",{class:"fas fa-chevron-right fa-xs"})],-1))],8,mt)]))),128))])])])):_("",!0),o.$route.name==="location"&&i.value?(r(),p("div",pt,[t("div",wt,[t("a",{class:"back larger",onClick:s[0]||(s[0]=y(e=>o.$router.push("/map"),["prevent"]))},s[5]||(s[5]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)])),t("div",ft,u(i.value.name),1),t("div",null,[t("a",{onClick:s[1]||(s[1]=y(e=>$(i.value),["prevent"]))},s[6]||(s[6]=[t("i",{class:"fas fa-trash-alt text-light-gray"},null,-1)]))])]),t("div",vt,[I(V,{filter:"location","location-id":i.value.id,"addable-props":{location_id:i.value.id}},null,8,["location-id","addable-props"]),I(V,{filter:"location","location-id":i.value.id,"should-filter-uncompleted":!0,"hide-add-new-task":!0},null,8,["location-id"])])])):_("",!0),o.$route.meta.isTaskInfoView?(r(),p("div",ht,[I(k)])):_("",!0)]),(r(),x(H,{to:"#wa-app"},[(r(),x(Y(w.value),{places:R(c).items,"selected-location-id":o.locationId,onSelectLocation:v},{default:G(({lng:e,lat:l,zoom:f})=>[o.$route.query.addLocation?(r(),x(it,{key:0,lng:e,lat:l,zoom:f},null,8,["lng","lat","zoom"])):_("",!0),s[7]||(s[7]=t("div",{id:"map",class:"tw-absolute tw-w-full tw-h-1/2 md:tw-h-full tw-top-0 tw-left-0 z-0"},null,-1))]),_:1},40,["places","selected-location-id"]))]))],64)}}});export{kt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./MapYandex-WCoqVr2Y.js","./index-oYoCgmil.js","./index-RtSBYl5l.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
