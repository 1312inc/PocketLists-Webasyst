import{r as $,ad as Pe,m as z,ae as B,d as x,a6 as Fe,c as D,af as Ee,o as l,e as u,j as _,D as me,t as w,g,n as R,k as Be,L as H,f as m,K as U,F as q,x as G,A as ke,G as se,y as K,ag as Q,ah as pe,a7 as Le,ai as le,aj as Ne,ak as Ae,al as Ce,am as Re,an as Ue,ao as Oe,ap as He,aq as ze,ar as qe,as as We,B as j,i as J,u as je,a3 as Ke,h as M,q as P,at as Ve,R as Qe,U as Ze,Q as Je,au as Xe,av as ve,aw as ie,p as Ye,M as Ie,s as Te,w as W,ax as Ge,ay as $e,az as et,aA as tt,l as st,aB as at,S as ee,aC as nt,aD as ot,aE as lt,H as it,aF as he,aG as _e,z as rt,aH as ut,v as ct,W as dt}from"./index-v8lp8FAs.js";import{d as ft,a as pt,b as mt,_ as kt,t as ye,e as xe,u as vt}from"./textToHtmlWithLinks-i7jL7A0S.js";import{m as re,g as Y,a as ht,s as ge}from"./sanitizer-TiisBOmJ.js";import{_ as _t}from"./SortableList.vue_vue_type_style_index_0_lang-y4SbBIlq.js";function yt(a){const t=$([]),e=new Set;Pe(a,()=>{a.value&&(t.value=[...a.value.querySelectorAll("[contenteditable]")])},{subtree:!0,childList:!0}),z(t,()=>{for(const[f]of e.entries())typeof f=="function"&&f(),e.delete(f)});const o=f=>{e.add(f)},c=f=>t.value.findIndex(k=>k.isEqualNode(f)),p=f=>t.value[c(f)-1],s=f=>t.value[c(f)+1],n=(f,k)=>{if(f){const r=s(f);if(r instanceof HTMLElement)return r.focus(),k&&re(r),r}else{const r=t.value[0];r instanceof HTMLElement&&r.focus()}},i=(f,k,r)=>{if(f.target instanceof HTMLElement){const h=f.target,I=Y(h),S=k==="up"?p(h):s(h);S instanceof HTMLElement&&(f.preventDefault(),S.focus(),ht(S,I),typeof r=="function"&&r())}};return{getPreviousElementSibling:p,getNextElementSibling:s,getCurrentPositionInNavigationList:c,focusNextTask:n,focusTaskById:(f,k)=>{const r=t.value.find(h=>{var I;return h instanceof HTMLElement&&((I=h.dataset)==null?void 0:I.id)==f});r instanceof HTMLElement&&(r.focus(),k&&re(r))},onUp:(f,k)=>{i(f,"up",k)},onDown:(f,k)=>{i(f,"down",k)},onLeft:(f,k)=>{if(f.target instanceof HTMLElement){const r=f.target;if(Y(r)===0){const h=p(r);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),re(h),typeof k=="function"&&k())}}},onRight:(f,k)=>{if(f.target instanceof HTMLElement){const r=f.target;if(Y(r)===r.innerText.length){const h=s(r);h instanceof HTMLElement&&(f.preventDefault(),h.focus(),typeof k=="function"&&k())}}},nextUpdate:o}}const gt=a=>{const t=B(a);return typeof t=="number"&&!isNaN(t)?`${t.toFixed(2)}km`:""},wt={class:"flexbox space-8 middle smaller empty:tw-hidden"},bt={key:4},Lt={key:5,class:"flexbox middle space-4 tw-flex-none"},Ct=["href"],It={class:"icon size-16"},Tt=["src"],$t={class:"tw-capitalize"},xt=x({__name:"TaskListItemPopupLine",props:{task:{}},setup(a){const t=Fe(),{currentLabel:e}=ft(()=>a.task),o=D(()=>Ee(a.task)),c=D(()=>({"text-red":o.value===3,"text-yellow":o.value===2,"text-green":o.value===1,grey:o.value===0}));function p(s){return new URL(Object.assign({"../../assets/apps/shop.svg":pt,"../../assets/apps/tasks.svg":mt})[`../../assets/apps/${s}.svg`],import.meta.url).href}return(s,n)=>{var i,d;return l(),u("div",wt,[_(e)?(l(),u("div",{key:0,class:"badge squared",style:me(`background: #${_(e).color};`)},w(_(e).name),5)):g("",!0),s.task.due_datetime&&!s.task.status?(l(),u("div",{key:1,class:R(["semibold",c.value])},w(_(Be)(s.task.due_datetime).format("LLL")),3)):s.task.due_date&&!s.task.status?(l(),u("div",{key:2,class:R(["semibold",c.value])},w(_(H)(s.task.due_date).format("LL")),3)):g("",!0),s.task.due_date&&s.task.repeat_frequency&&s.task.repeat_interval?(l(),u("div",{key:3,class:R(c.value)},[n[0]||(n[0]=m("i",{class:"fas fa-redo text-light-gray"},null,-1)),U(" "+w(s.$t(`everyX.${s.task.repeat_interval}`,{n:s.task.repeat_frequency,days:s.$t(s.task.repeat_interval,{count:s.task.repeat_frequency})})),1)],2)):g("",!0),s.task.location_id?(l(),u("div",bt,[n[1]||(n[1]=m("i",{class:"fas fa-map-marker-alt text-light-gray"},null,-1)),U(" "+w((i=_(t).getItemById(s.task.location_id))==null?void 0:i.name)+" "+w(_(gt)(_(t).distanceById(s.task.location_id))),1)])):g("",!0),(d=s.task.external_links)!=null&&d.length?(l(),u("div",Lt,[(l(!0),u(q,null,G(s.task.external_links,y=>(l(),u("a",{key:y.id,href:y.entity_link,target:"_blank",class:"flexbox middle space-4"},[m("span",It,[m("img",{src:p(y.app)},null,8,Tt)]),m("span",$t,w(y.entity_type),1)],8,Ct))),128))])):g("",!0)])}}}),St={class:"icon"},Mt=["src"],Dt=x({__name:"TaskListItemPopup",props:{task:{},input:{},isFocused:{type:Boolean}},setup(a){const t=ke(),e=se(),o=D(()=>!t.currentRoute.value.params.listId),c=D(()=>a.task.list_id&&o.value?e.itemsMap[a.task.list_id]:null),p=()=>{if(!c.value)return;const s=t.resolve({name:"list",params:{listId:c.value.id}});window.open(s.href,"_blank")};return(s,n)=>(l(),u("div",{class:R(["flexbox middle",{"space-12":!s.isFocused}])},[s.isFocused?(l(),K(kt,{key:0,task:s.task,input:s.input,"is-small":!0,"hide-assign":!0},null,8,["task","input"])):(l(),K(xt,{key:1,task:s.task},null,8,["task"])),c.value?(l(),u("div",{key:2,class:"flexbox middle space-4 hint tw-cursor-pointer",onClick:p},[m("div",St,[m("img",{src:c.value.icon_url,loading:"lazy"},null,8,Mt)]),U(" "+w(c.value.name),1)])):g("",!0)],2))}}),Se=Ue?window:void 0;function X(a){var t;const e=B(a);return(t=e==null?void 0:e.$el)!=null?t:e}function Z(...a){const t=[],e=()=>{t.forEach(n=>n()),t.length=0},o=(n,i,d,y)=>(n.addEventListener(i,d,y),()=>n.removeEventListener(i,d,y)),c=D(()=>{const n=le(B(a[0])).filter(i=>i!=null);return n.every(i=>typeof i!="string")?n:void 0}),p=Ne(()=>{var n,i;return[(i=(n=c.value)==null?void 0:n.map(d=>X(d)))!=null?i:[Se].filter(d=>d!=null),le(B(c.value?a[1]:a[0])),le(_(c.value?a[2]:a[1])),B(c.value?a[3]:a[2])]},([n,i,d,y])=>{if(e(),!(n!=null&&n.length)||!(i!=null&&i.length)||!(d!=null&&d.length))return;const C=Ae(y)?{...y}:y;t.push(...n.flatMap(L=>i.flatMap(T=>d.map(f=>o(L,T,f,C)))))},{flush:"post"}),s=()=>{p(),e()};return Ce(e),s}let we=!1;function be(a,t,e={}){const{window:o=Se,ignore:c=[],capture:p=!0,detectIframe:s=!1,controls:n=!1}=e;if(!o)return n?{stop:Q,cancel:Q,trigger:Q}:Q;if(pe&&!we){we=!0;const r={passive:!0};Array.from(o.document.body.children).forEach(h=>Z(h,"click",Q,r)),Z(o.document.documentElement,"click",Q,r)}let i=!0;const d=r=>B(c).some(h=>{if(typeof h=="string")return Array.from(o.document.querySelectorAll(h)).some(I=>I===r.target||r.composedPath().includes(I));{const I=X(h);return I&&(r.target===I||r.composedPath().includes(I))}});function y(r){const h=B(r);return h&&h.$.subTree.shapeFlag===16}function C(r,h){const I=B(r),S=I.$.subTree&&I.$.subTree.children;return S==null||!Array.isArray(S)?!1:S.some(V=>V.el===h.target||h.composedPath().includes(V.el))}const L=r=>{const h=X(a);if(r.target!=null&&!(!(h instanceof Element)&&y(a)&&C(a,r))&&!(!h||h===r.target||r.composedPath().includes(h))){if("detail"in r&&r.detail===0&&(i=!d(r)),!i){i=!0;return}t(r)}};let T=!1;const f=[Z(o,"click",r=>{T||(T=!0,setTimeout(()=>{T=!1},0),L(r))},{passive:!0,capture:p}),Z(o,"pointerdown",r=>{const h=X(a);i=!d(r)&&!!(h&&!r.composedPath().includes(h))},{passive:!0}),s&&Z(o,"blur",r=>{setTimeout(()=>{var h;const I=X(a);((h=o.document.activeElement)==null?void 0:h.tagName)==="IFRAME"&&!(I!=null&&I.contains(o.document.activeElement))&&t(r)},0)},{passive:!0})].filter(Boolean),k=()=>f.forEach(r=>r());return n?{stop:k,cancel:()=>{i=!1},trigger:r=>{i=!0,L(r),i=!1}}:k}const Pt={mounted(a,t){const e=!t.modifiers.bubble;if(typeof t.value=="function")a.__onClickOutside_stop=be(a,t.value,{capture:e});else{const[o,c]=t.value;a.__onClickOutside_stop=be(a,o,Object.assign({capture:e},c))}},unmounted(a){a.__onClickOutside_stop()}};function ue(a){return typeof Window<"u"&&a instanceof Window?a.document.documentElement:typeof Document<"u"&&a instanceof Document?a.documentElement:a}function Me(a){const t=window.getComputedStyle(a);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&a.clientWidth<a.scrollWidth||t.overflowY==="auto"&&a.clientHeight<a.scrollHeight)return!0;{const e=a.parentNode;return!e||e.tagName==="BODY"?!1:Me(e)}}function Ft(a){const t=a||window.event,e=t.target;return Me(e)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const ce=new WeakMap;function Et(a,t=!1){const e=Le(t);let o=null,c="";z(Re(a),n=>{const i=ue(B(n));if(i){const d=i;if(ce.get(d)||ce.set(d,d.style.overflow),d.style.overflow!=="hidden"&&(c=d.style.overflow),d.style.overflow==="hidden")return e.value=!0;if(e.value)return d.style.overflow="hidden"}},{immediate:!0});const p=()=>{const n=ue(B(a));!n||e.value||(pe&&(o=Z(n,"touchmove",i=>{Ft(i)},{passive:!1})),n.style.overflow="hidden",e.value=!0)},s=()=>{const n=ue(B(a));!n||!e.value||(pe&&(o==null||o()),n.style.overflow=c,ce.delete(n),e.value=!1)};return Ce(s),D({get(){return e.value},set(n){n?p():s()}})}function Bt(){let a=!1;const t=Le(!1);return(e,o)=>{if(t.value=o.value,a)return;a=!0;const c=Et(e,o.value);z(t,p=>c.value=p)}}Bt();const Nt=a=>{const t=["\\- \\[ \\]","\\- \\[x\\]","\\* "],e=new RegExp(`^(${t.join("|")})`,"gm");return a.replace(e,"")},At=a=>{const t="\\- \\[x\\]";return new RegExp(`^${t}`,"gm").test(a)},Rt=Oe("syncError",()=>{const a=He(ze(qe(()=>We.jobsUpdate.toArray())),{initialValue:[]});return{taskErrorMap:D(()=>new Map(a.value.filter(e=>e.entity==="task"&&e.error).map(e=>[e.id,e.error])))}});function Ut(a){return a<1024?`${a} B`:a<1024*1024?`${Math.floor(a/1024)} KB`:`${Math.floor(a/1048576)} MB`}const Ot={key:0,class:"pl-attachments flexbox wrap space-12 custom-mt-4"},Ht=["href"],zt=["src"],qt={class:"bold"},Wt={key:0,class:"hint custom-ml-4 nowrap"},jt=["onClick"],Kt=x({__name:"TaskListItemAttachments",props:{task:{},isFocused:{type:Boolean}},setup(a){const t=j(),e=o=>{window.confirm("Delete the file permanently?")&&t.deleteAttachments(a.task,[o])};return(o,c)=>{var p;return(p=o.task.attachments)!=null&&p.length?(l(),u("div",Ot,[(l(!0),u(q,null,G(o.task.attachments,s=>(l(),u("div",{key:s.uuid||s.id,class:"pl-attachments__item small"},[m("a",{href:s.download_url,target:"_blank"},[s.preview_url?(l(),u("img",{key:0,src:s.preview_url,alt:"",class:"pl-attachments__item__img"},null,8,zt)):(l(),u(q,{key:1},[m("span",qt,w(s.file_name),1),s.size?(l(),u("span",Wt,w(_(Ut)(s.size)),1)):g("",!0)],64))],8,Ht),o.isFocused?(l(),u("div",{key:0,class:R(["pl-attachments__item__delete",{"pl-attachments__item__delete--preview":s.preview_url}])},[m("a",{class:R(s.preview_url?"button circle white":"custom-ml-8"),onClick:J(n=>e(s.id),["prevent"])},c[0]||(c[0]=[m("i",{class:"fas fa-trash-alt text-red small"},null,-1)]),10,jt)],2)):g("",!0)]))),128))])):g("",!0)}}}),de=x({__name:"UserPic",props:{userId:{}},setup(a){const t=a,e=je(),o=D(()=>e.getItemById(t.userId));return(c,p)=>{var s;return(s=o.value)!=null&&s.photo_url?(l(),u("span",{key:0,class:"icon userpic",style:me({backgroundImage:`url(${o.value.photo_url})`})},null,4)):g("",!0)}}}),Vt={key:0,class:"tw-cursor-pointer"},Qt={key:0,class:"pl-list-item-firedBullet"},Zt={key:1,class:"tw-cursor-pointer"},Jt=x({__name:"TaskListItemBullet",props:{task:{}},emits:["complete"],setup(a,{emit:t}){const e=a,o=t,c=$(e.task.status===1);z(()=>e.task.status,n=>{c.value=n===1});const p=D(()=>Ke(e.task)),s=()=>{c.value=!c.value,o("complete")};return(n,i)=>(l(),u("div",{class:"tw-w-5 tw-flex-none",onClick:s},[M(Ze,{name:"bounce",mode:"out-in"},{default:P(()=>{var d;return[c.value?(l(),u("div",Zt,i[0]||(i[0]=[m("i",{class:"fas fa-check text-light-gray"},null,-1)]))):(l(),u("div",Vt,[p.value===_(Ve)?(l(),u("div",Qt)):(l(),u("div",{key:1,class:"pl-list-item-bullet",style:me(`background-color: ${(d=_(Qe).get(p.value))==null?void 0:d.color}`)},null,4))]))]}),_:1})]))}}),Xt=new WeakMap;function Yt(){const a=Je(),t=ke(),e=()=>{var i;const p=[...a.matched].reverse().find(d=>{var y;return(y=d.meta)==null?void 0:y.isListView})||null,s=((i=p==null?void 0:p.children)==null?void 0:i.find(d=>{var y;return(y=d.meta)==null?void 0:y.isTaskInfoView}))||null,n={listViewRoute:p,taskInfoRoute:s};return Xt.set(a,n),n};return{navigateToTaskInfo:async c=>{const{listViewRoute:p,taskInfoRoute:s}=e();if(!p||!(s!=null&&s.name))return console.warn("Required routes not found"),!1;try{const n=await t.push({name:s.name,params:{taskId:c}});return!Xe(n)}catch(n){return console.error("Navigation failed:",n),!1}}}}const Gt={key:0,class:"pl-list-item-sort-handle sortable-handle tw-cursor-grabbing tw-absolute tw-hidden group-hover:tw-block"},es={class:"hint"},ts={class:"hint"},ss={class:"hint"},as={class:"tw-clear-both tw-inline-block"},ns=["placeholder","data-id","innerHTML"],os=["innerHTML"],ls={class:"flexbox space-8 custom-pt-2 tw-flex-none"},is={key:0},rs={key:1},us={key:2,class:"tw-flex-none"},cs=["title"],ds=["title"],fs={class:"bold small"},ps={key:5,class:"hint tw-flex-none custom-mt-2"},ms={key:6,class:"hint tw-flex-none custom-mt-2"},ks={key:0},vs={key:1},hs={key:7,class:"hint tw-flex-none custom-mt-2"},_s={key:8,class:"flexbox middle tw-flex-none"},ys={key:9,class:"flexbox middle tw-flex-none"},gs={key:10,class:"flexbox middle tw-flex-none"},ws=x({__name:"TaskListItem",props:{task:{},sortable:{type:Boolean},placeholder:{},addableProps:{},showInfoLink:{type:Boolean},isEnterDisabled:{type:Boolean}},emits:["delete","update","insert","insertMany","insertFirst","blur","complete"],setup(a,{emit:t}){const e=a,o=t,c=j(),p=Rt(),{navigateToTaskInfo:s}=Yt(),n=ve($e),i=ve(et),d=$(!1),y=$(!1),C=$(e.task.name),L=$(e.task.status);z(()=>e.task.status,b=>{L.value=b});const T=$();let f=null;z(d,()=>{if(d.value)return;const b=T.value.innerText.trim();if(ie(e.task)&&!b){y.value=!0,o("delete",e.task);return}e.task.name!==b&&o("update",e.task,{name:b})}),Ye(()=>{ie(e.task)&&(T.value.focus(),d.value=!0)}),Ie(()=>{f&&(clearTimeout(f),f=null)});const k=()=>{tt()||(d.value=!1)},r=()=>{o("complete",e.task)},h=()=>{L.value=L.value?0:1,T.value.classList.toggle("opacity-50"),!(f&&(clearTimeout(f),f=null,e.task.status===L.value))&&(f=setTimeout(r,1e3))},I=b=>{if(b.target instanceof HTMLAnchorElement){const v=b.target.href;b.preventDefault(),setTimeout(()=>{window.open(v,"_blank")})}},S=b=>{var O;b.preventDefault();const v=(O=b.clipboardData)==null?void 0:O.getData("text/plain");if(!v)return;if(T.value.innerText){document.execCommand("insertText",!1,v);return}const N=v.split(`
`).filter(A=>A);N.length&&o("insertMany",e.task,N.map(A=>({name:Nt(A),...e.addableProps,...At(A)?{status:1}:{}})))},V=b=>{Y(b.target)===0&&(n==null||n.onLeft(b),y.value=!0,o("delete",e.task))},ae=async b=>{if(b.shiftKey)return;if(b.preventDefault(),e.isEnterDisabled){ne(!0),await st(),o("insertFirst",{...e.addableProps});return}const v=b.target,N=v.innerText.trim(),O=Y(v);let A="",F=!0;O===0&&N||(v.innerText=N.substring(0,O).trim(),A=N.substring(O,N.length).trim(),F=!1),o("insert",e.task,{...e.addableProps,name:A},{isBefore:F}),ne()},te=b=>{C.value=b.target.innerText};function ne(b=!1){const v=()=>{T.value.blur(),d.value=!1};if(b){v();return}setTimeout(()=>{v()})}const De=()=>{o("update",e.task,{favorite:e.task.favorite?0:1})},oe=async b=>{b.target.closest("[contenteditable], .chips li, a")===null&&await s(e.task.id)};return(b,v)=>{var N,O,A;return y.value?g("",!0):(l(),u("div",{key:0,class:R(["pl-list-item flexbox space-12 tw-items-start tw-group tw-relative",{"highlighted tw-bg-[var(--list-item-selected-background-color)]":b.$route.meta.isTaskInfoView&&((N=b.$route.params)==null?void 0:N.taskId)==e.task.id,highlighted:_(c).pinnedTaskUUIDs.has(e.task.uuid)}])},[e.sortable?(l(),u("div",Gt,v[7]||(v[7]=[m("i",{class:"fas fa-grip-vertical text-light-gray"},null,-1)]))):g("",!0),M(Jt,{task:e.task,onComplete:h},null,8,["task"]),m("div",{class:"tw-flex-auto",onClick:oe},[(O=_(i))!=null&&O.is_debug_mode?(l(),u(q,{key:0},[m("span",es,"list_id: "+w(String(e.task.list_id)),1),v[8]||(v[8]=U(" | ")),m("span",ts,"id: "+w(e.task.id),1),v[9]||(v[9]=U(" | ")),m("span",ss,"srank: "+w(String(e.task.sort))+" | "+w(String(e.task.rank)),1)],64)):g("",!0),Te((l(),u("div",null,[m("div",as,[m("div",{ref_key:"contenteditableRef",ref:T,contenteditable:"",class:R(["pl-list-item-title semibold tw-float-left tw-transition tw-duration-200",{"opacity-50":e.task.status===1}]),placeholder:e.placeholder,"data-id":e.task.id,onKeydown:[W(ae,["enter"]),v[0]||(v[0]=W(F=>{var E;(E=_(n))==null||E.onLeft(F,()=>{d.value=!1})},["left"])),v[1]||(v[1]=W(F=>{var E;(E=_(n))==null||E.onUp(F,()=>{d.value=!1})},["up"])),v[2]||(v[2]=W(F=>{var E;(E=_(n))==null||E.onRight(F,()=>{d.value=!1})},["right"])),v[3]||(v[3]=W(F=>{var E;(E=_(n))==null||E.onDown(F,()=>{d.value=!1})},["down"])),W(V,["delete"]),v[4]||(v[4]=W(()=>{ne()},["esc"])),v[5]||(v[5]=W(()=>{d.value=!1},["tab"]))],onMousedown:I,onFocus:v[6]||(v[6]=F=>d.value=!0),onPaste:S,onInput:te,innerHTML:_(ge)(d.value?e.task.name:_(ye)(e.task.name))},null,42,ns)]),e.task.note?(l(),u("div",{key:0,class:"hint break-words tw-whitespace-pre-line tw-line-clamp-4 custom-mb-4",innerHTML:_(ge)(_(ye)(e.task.note))},null,8,os)):g("",!0),M(Dt,{task:b.task,input:C.value,"is-focused":d.value},null,8,["task","input","is-focused"])])),[[_(Pt),k]]),M(Kt,{task:e.task,"is-focused":d.value},null,8,["task","is-focused"])]),m("div",ls,[e.showInfoLink?(l(),u("div",{key:0,class:"tw-flex-none tw-opacity-0 group-hover:tw-opacity-100 tw-cursor-pointer",onClick:J(oe,["prevent"])},v[10]||(v[10]=[m("i",{class:"fas fa-arrow-circle-right text-gray"},null,-1)]))):g("",!0),L.value?g("",!0):(l(),u("div",{key:1,class:R(["tw-flex-none tw-cursor-pointer",{"tw-opacity-0 group-hover:tw-opacity-100":!e.task.favorite}]),onClick:De},[e.task.favorite?(l(),u("span",is,v[11]||(v[11]=[m("i",{class:"fas fa-star text-yellow"},null,-1)]))):(l(),u("span",rs,v[12]||(v[12]=[m("i",{class:"fas fa-star text-ultra-light-gray"},null,-1)])))],2)),_(p).taskErrorMap.get(e.task.id)?(l(),u("div",us,[m("span",{class:"icon",style:{color:"orange"},title:_(p).taskErrorMap.get(e.task.id)},v[13]||(v[13]=[m("i",{class:"fas fa-exclamation-triangle"},null,-1)]),8,cs)])):g("",!0),!_(Ge)(e.task)&&!_(ie)(e.task)?(l(),u("div",{key:3,class:"tw-flex-none",title:b.$t("syncing")},v[14]||(v[14]=[m("i",{class:"fas fa-clock text-light-gray"},null,-1)]),8,ds)):g("",!0),(A=e.task.extended_data)!=null&&A.comments_count?(l(),u("div",{key:4,class:"flexbox middle space-4 tw-flex-none link",onClick:J(oe,["prevent"])},[v[15]||(v[15]=m("i",{class:"fas fa-comment"},null,-1)),m("span",fs,w(e.task.extended_data.comments_count),1)])):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.create_datetime?(l(),u("div",ps,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0),!L.value&&e.task.assigned_contact_id?(l(),u("div",ms,[e.task.update_datetime?(l(),u("span",ks,w(_(H)().to(_(H)(e.task.update_datetime),!0)),1)):e.task.create_datetime?(l(),u("span",vs,w(_(H)().to(_(H)(e.task.create_datetime),!0)),1)):g("",!0)])):g("",!0),e.task.complete_datetime?(l(),u("div",hs,w(_(H)().to(_(H)(e.task.complete_datetime),!0)),1)):g("",!0),!L.value&&!e.task.assigned_contact_id&&e.task.contact_id?(l(),u("div",_s,[M(de,{"user-id":e.task.contact_id},null,8,["user-id"])])):g("",!0),!L.value&&e.task.assigned_contact_id?(l(),u("div",ys,[M(de,{"user-id":e.task.assigned_contact_id},null,8,["user-id"])])):g("",!0),L.value&&e.task.complete_contact_id?(l(),u("div",gs,[M(de,{"user-id":e.task.complete_contact_id},null,8,["user-id"])])):g("",!0)])],2))}}}),bs=x({__name:"ListNavigationProvider",setup(a){const t=$();return at($e,yt(t)),(e,o)=>(l(),u("div",{ref_key:"navigatableRef",ref:t,class:"tw-relative"},[ee(e.$slots,"default")],512))}}),Ls=x({__name:"TaskListItemStoreProvider",setup(a){const t=j(),e=i=>t.completeTask(i),o=(i,d)=>t.updateItem(i,d),c=async(i,d,y)=>{await t.insert(y.isBefore?"before":"after",i,{...d})},p=async(i,d)=>{await t.insertMany(i,d)},s=async i=>{await t.insert("before",null,i,{shouldPinNewTask:!0})},n=async i=>{await t.deleteItem(i)};return(i,d)=>ee(i.$slots,"default",{onComplete:e,onUpdate:o,onInsert:c,onInsertMany:p,onInsertFirst:s,onDelete:n})}}),Cs=x({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(a,{emit:t}){const e=a,o=t,c=$(null),{stop:p}=nt(c,([{isIntersecting:s}])=>{s&&!e.disabled&&o("intersecting")},{rootMargin:"200px"});return Ie(()=>{p()}),(s,n)=>(l(),u("div",{ref_key:"elRef",ref:c},[ee(s.$slots,"default")],512))}}),Is={key:0,class:"skeleton custom-m-24"},Ts={key:0},$s={class:"box custom-py-24 small align-center gray"},fe=30,xs=x({__name:"TaskListLazyLoadFetcher",props:{filter:{},shouldFilterUncompleted:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{}},setup(a){const t=a,e=j(),o=se(),c=lt(),p=$(fe),s=$([]),n=$(!1),i=$(0),d=$(!1),y=D(()=>({list:{source:t.listId?e.getTasksInList(t.listId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.listId?{list_id:t.listId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},upnext:{source:e.getUpnext(),isFetchStream:!0,fetchParams:{filter:"upnext"},disableCheckin:!1},due:{source:e.getDue(),isFetchStream:!0,fetchParams:{filter:"due"},disableCheckin:!1},priority:{source:e.getPriority(),isFetchStream:!0,fetchParams:{filter:"priority"},disableCheckin:!1},nearby:{source:e.getTasksSortedByCurrentDistance(),isFetchStream:!0,fetchParams:{filter:"nearby"},disableCheckin:!1},search:{source:s.value,isFetchStream:!0,fetchParams:{filter:`search/${t.searchQuery}`},disableCheckin:!0},location:{source:t.locationId?e.getTasksInLocation(t.locationId,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:t.locationId?{location_id:t.locationId,status:t.shouldFilterUncompleted?"1":"0"}:{},disableCheckin:!1},user:{source:t.userId?t.shouldFilterUncompleted?e.getTasksCompletedByUser(t.userId):e.getTasksByUser(t.userId):[],isFetchStream:!t.shouldFilterUncompleted,fetchParams:t.userId?t.shouldFilterUncompleted?{complete_contact_id:t.userId,status:"1"}:{filter:`user/${t.userId}`}:{},disableCheckin:!1},completed:{source:e.getTasksCompleted,isFetchStream:!1,fetchParams:{status:1},disableCheckin:!1},date:{source:t.date?e.getTasksInDate(t.date,t.shouldFilterUncompleted):[],isFetchStream:!1,fetchParams:null,disableCheckin:!1},externalApp:{source:t.externalAppId?e.getTasksByApp(t.externalAppId):[],isFetchStream:!1,fetchParams:t.externalAppId?{external_app_id:t.externalAppId}:null,disableCheckin:!1}})[t.filter]),C=D(()=>y.value.source.slice(0,p.value));z(()=>t,()=>{p.value=fe,T()},{deep:!0,immediate:!0});const L=()=>{var k;((k=y.value.source)==null?void 0:k.length)>C.value.length&&(p.value+=fe)};async function T(){const{isFetchStream:k,fetchParams:r,disableCheckin:h}=y.value;if(!r||!f(r))return;if(n.value=!1,s.value=[],t.filter==="list"){const S=c.task.value.get(JSON.stringify({list_id:t.listId})),V=c.task.value.get(JSON.stringify({list_id:t.listId,status:"0"})),ae=c.task.value.get(JSON.stringify({list_id:t.listId,status:"1"})),te=S||V;if(te)if(t.shouldFilterUncompleted){if(ae)return}else delete r.status,r.starting_from=ot(new Date(te))}if(i.value=8,t.filter==="list"){const S=o.getItemById(t.listId);i.value=S==null?void 0:S.extended_data.items_count}d.value=!c.task.value.get(JSON.stringify(y.value.fetchParams))&&("status"in y.value.fetchParams?y.value.fetchParams.status!=="0":!0);const I=await e[k?"fetchStream":"fetch"]({...r},{disableCheckin:h});d.value=!1,I&&I.value&&I.value.status_code==="ok"&&t.filter==="search"&&(s.value=[...s.value,...I.value.data],n.value=!s.value.length)}function f(k){return!(!k||k.list_id&&typeof k.list_id!="number"||k.location_id&&typeof k.location_id!="number")}return(k,r)=>d.value?(l(),u("div",Is,[(l(!0),u(q,null,G(i.value,h=>(l(),u("span",{key:h,class:"skeleton-custom-box",style:{height:"40px"}}))),128))])):(l(),u(q,{key:1},[ee(k.$slots,"default",{tasks:C.value}),t.filter==="search"&&n.value?(l(),u("div",Ts,[m("p",$s,[U(w(k.$t("searchNoMatches"))+" ",1),m("strong",null,w(t.searchQuery),1)])])):g("",!0),(l(),K(Cs,{key:k.$route.fullPath,onIntersecting:L}))],64))}}),Ss=x({__name:"TaskListAddNew",props:{addableProps:{},shouldPinNewTask:{type:Boolean}},setup(a){const t=a,e=j(),o=ke();z(o.currentRoute,async p=>{const s={...p.query};"addNewTask"in s&&(await c(),delete s.addNewTask,o.replace({path:p.path,query:s}))},{immediate:!0});async function c(){await e.insert("before",null,{...t.addableProps},{shouldPinNewTask:t.shouldPinNewTask})}return(p,s)=>(l(),u("div",{class:"text-gray pl-list-item-title",onClick:c},[s[0]||(s[0]=m("i",{class:"fas fa-plus text-light-gray custom-mr-12 custom-ml-4 custom-pl-2"},null,-1)),U(" "+w(p.$t("newToDo")),1)]))}}),Ms=x({__name:"AlertDanger",props:{title:{},text:{},onDelete:{type:Function}},setup(a){return(t,e)=>(l(),K(xe,{title:t.title,"hide-close-icon":!0},{submit:P(()=>[m("button",{class:"danger",onClick:e[0]||(e[0]=(...o)=>t.onDelete&&t.onDelete(...o))}," Delete ")]),default:P(()=>[U(w(t.text)+" ",1)]),_:1},8,["title"]))}}),Ds={class:"tw-w-68"},Ps={class:"menu"},Fs={href:"javascript:void(0);"},Es={class:"menu"},Bs=["onClick"],Ns=["disabled"],As=x({__name:"AlertTransferItems",props:{title:{},text:{},onMove:{type:Function}},setup(a){const t=it(),e=se(),o=$(),c=()=>{o.value&&a.onMove(o.value)};return(p,s)=>(l(),K(xe,{title:p.title,"hide-close-icon":!0},{submit:P(()=>[m("button",{disabled:!o.value,onClick:J(c,["prevent"])}," Move ",8,Ns)]),default:P(()=>[m("div",Ds,[m("ul",Ps,[(l(!0),u(q,null,G(_(t).items,n=>(l(),u("li",{key:n.uuid||n.id},[m("a",Fs,w(n.name),1),m("ul",Es,[(l(!0),u(q,null,G(_(e).getListsInPocket(n.id),i=>(l(),u("li",{key:i.uuid||i.id,class:R(o.value===i.id&&"selected rounded")},[m("a",{href:"#",onClick:J(()=>{o.value=o.value===i.id?void 0:i.id},["prevent"])},w(i.name),9,Bs)],2))),128))])]))),128))])])]),_:1},8,["title"]))}}),Rs={key:0,class:"tw-absolute -tw-translate-y-11 -tw-translate-x-4 width-100 tw-flex tw-gap-2 tw-justify-end"},Us={class:"hint"},Os={class:"hint"},Hs=x({__name:"TaskListMultiselect",setup(a){const t=j(),e=$(new Set),{show:o,hide:c}=he(Ms,{title:"Delete",text:_e(()=>`Delete ${e.value.size} selected items?`),onDelete:async()=>{await t.deleteItems([...e.value]),e.value.clear(),c()}}),{show:p,hide:s}=he(As,{title:"Move Items",text:_e(()=>`Delete ${e.value.size} selected items?`),onMove:async C=>{await t.sort(C,null,[...e.value]),e.value.clear(),s()}}),n=C=>{e.value.add(C)},i=C=>{e.value.delete(C)},d=()=>{p()},y=()=>{o()};return(C,L)=>(l(),u(q,null,[e.value.size?(l(),u("div",Rs,[m("button",{class:"button light-gray smaller",onClick:d},[L[0]||(L[0]=m("i",{class:"fas fa-list text-blue"},null,-1)),U(" "+w(C.$t("Move"))+" ",1),m("span",Us,w(e.value.size),1)]),m("button",{class:"button light-gray smaller",onClick:y},[L[1]||(L[1]=m("i",{class:"fas fa-trash-alt text-red"},null,-1)),U(" "+w(C.$t("Delete"))+" ",1),m("span",Os,w(e.value.size),1)])])):g("",!0),ee(C.$slots,"default",{onSelect:n,onDeselect:i})],64))}}),zs="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.32594%207.70265C7.97656%207.35329%207.41285%207.34569%207.05419%207.68545L0.468799%2013.819C-0.0347521%2014.296%20-0.0455698%2015.0948%200.444949%2015.5853C0.934984%2016.0753%201.73243%2016.0645%202.20909%2015.5614L8.34314%208.97661C8.6834%208.61748%208.67574%208.05242%208.32594%207.70265Z'%20fill='black'/%3e%3cpath%20d='M2.55008%203.99187C2.58461%203.8699%202.75749%203.8699%202.79201%203.99187L3.24893%205.60604C3.29055%205.75306%203.40545%205.86796%203.55246%205.90957L5.16664%206.36649C5.28861%206.40102%205.28861%206.57389%205.16664%206.60842L3.55246%207.06534C3.40545%207.10695%203.29055%207.22186%203.24893%207.36887L2.79201%208.98304C2.75749%209.10501%202.58461%209.10501%202.55008%208.98304L2.09317%207.36887C2.05155%207.22186%201.93665%207.10695%201.78963%207.06534L0.17546%206.60842C0.0534922%206.57389%200.0534924%206.40102%200.175461%206.36649L1.78963%205.90957C1.93665%205.86796%202.05155%205.75306%202.09317%205.60604L2.55008%203.99187Z'%20fill='%23EE6622'/%3e%3cpath%20d='M5.00052%200.122182C5.02707%200.0302363%205.16006%200.0302364%205.18661%200.122182L5.53809%201.33902C5.5701%201.44985%205.65849%201.53647%205.77158%201.56784L7.01325%201.91228C7.10707%201.93831%207.10707%202.06863%207.01325%202.09466L5.77158%202.43911C5.65849%202.47048%205.5701%202.5571%205.53809%202.66792L5.18661%203.88476C5.16006%203.97671%205.02707%203.97671%205.00052%203.88476L4.64904%202.66792C4.61703%202.5571%204.52864%202.47048%204.41555%202.43911L3.17388%202.09466C3.08006%202.06863%203.08006%201.93831%203.17388%201.91228L4.41555%201.56784C4.52864%201.53647%204.61703%201.44985%204.64904%201.33902L5.00052%200.122182Z'%20fill='%2355DDDD'/%3e%3cpath%20d='M8.73211%2011.8502C8.75813%2011.7583%208.88846%2011.7583%208.91448%2011.8502L9.25893%2013.067C9.2903%2013.1779%209.37692%2013.2645%209.48775%2013.2959L10.7046%2013.6403C10.7965%2013.6663%2010.7965%2013.7967%2010.7046%2013.8227L9.48775%2014.1671C9.37692%2014.1985%209.2903%2014.2851%209.25893%2014.3959L8.91448%2015.6128C8.88846%2015.7047%208.75813%2015.7047%208.73211%2015.6128L8.38766%2014.3959C8.35629%2014.2851%208.26967%2014.1985%208.15884%2014.1671L6.94201%2013.8227C6.85006%2013.7967%206.85006%2013.6663%206.94201%2013.6403L8.15884%2013.2959C8.26967%2013.2645%208.35629%2013.1779%208.38766%2013.067L8.73211%2011.8502Z'%20fill='%23F5C400'/%3e%3cpath%20d='M13.3484%209.16196C13.3813%209.04562%2013.5462%209.04562%2013.5791%209.16196L14.015%2010.7016C14.0547%2010.8419%2014.1643%2010.9515%2014.3045%2010.9912L15.8442%2011.427C15.9605%2011.4599%2015.9605%2011.6248%2015.8442%2011.6578L14.3045%2012.0936C14.1643%2012.1333%2014.0547%2012.2429%2014.015%2012.3831L13.5791%2013.9228C13.5462%2014.0391%2013.3813%2014.0391%2013.3484%2013.9228L12.9125%2012.3831C12.8728%2012.2429%2012.7633%2012.1333%2012.623%2012.0936L11.0833%2011.6578C10.967%2011.6248%2010.967%2011.4599%2011.0833%2011.427L12.623%2010.9912C12.7633%2010.9515%2012.8728%2010.8419%2012.9125%2010.7016L13.3484%209.16196Z'%20fill='%2322CC22'/%3e%3cpath%20d='M10.7288%200.228994C10.7952%20-0.00536791%2011.1274%20-0.00536752%2011.1937%200.228994L12.0717%203.33062C12.1516%203.61311%2012.3724%203.83389%2012.6549%203.91386L15.7565%204.79183C15.9909%204.85816%2015.9909%205.19035%2015.7565%205.25669L12.6549%206.13466C12.3724%206.21462%2012.1516%206.4354%2012.0717%206.71789L11.1937%209.81952C11.1274%2010.0539%2010.7952%2010.0539%2010.7288%209.81952L9.85087%206.71789C9.77091%206.4354%209.55012%206.21462%209.26763%206.13466L6.16601%205.25669C5.93164%205.19035%205.93164%204.85816%206.16601%204.79183L9.26763%203.91386C9.55012%203.83389%209.77091%203.61311%209.85087%203.33062L10.7288%200.228994Z'%20fill='%230088EE'/%3e%3c/svg%3e",qs=["src","onClick"],Ws={class:"custom-p-12"},js={class:"small custom-mb-8"},Ks=["placeholder","disabled"],Vs={class:"flexbox middle"},Qs=["disabled"],Zs={key:0,class:"spinner"},Js={key:0,class:"custom-mt-4 text-red"},Xs=x({__name:"TaskListAI",props:{listId:{}},setup(a){const t=a,{t:e}=rt(),o=j(),c=se(),p=$(),s=$(""),n=D(()=>{var f;return((f=c.getItemById(t.listId))==null?void 0:f.name)??void 0}),{data:i,error:d,isFetching:y,execute:C}=ut(D(()=>`pocketlists.ai.gpt?prompt=${s.value||n.value}`),{immediate:!1}).json(),{showIfNotPremium:L}=vt(e("listAIPremiumMessage"),{immediate:!1});z(()=>{var f;return(f=p.value)==null?void 0:f.isOpened},f=>{f&&L()});const T=async()=>{if(!(!s.value&&!n.value)){await C();try{const f=JSON.parse(i.value.data.text);if(!f.length)return;await o.insertToList(t.listId,f.map(k=>({name:k}))),s.value="",p.value.isOpened=!1}catch{}}};return(f,k)=>(l(),K(dt,{ref_key:"dropdownRef",ref:p},{default:P(({handler:r,setRef:h})=>[m("img",{ref:h,src:_(zs),class:"tw-cursor-pointer",onClick:r},null,8,qs)]),body:P(()=>[m("div",Ws,[m("div",js,w(f.$t("listAILabel")),1),Te(m("textarea",{"onUpdate:modelValue":k[0]||(k[0]=r=>s.value=r),class:"width-100 custom-mb-8 small",placeholder:n.value,style:{height:"4rem",resize:"none"},disabled:_(y)},null,8,Ks),[[ct,s.value]]),m("div",Vs,[m("button",{class:"small",disabled:_(y),onClick:J(T,["prevent"])},w(f.$t("write")),9,Qs),_(y)?(l(),u("div",Zs)):g("",!0)]),_(d)?(l(),u("div",Js,w(f.$t("Error")),1)):g("",!0)])]),_:1},512))}}),Ys={class:"pl-bg-block custom-pb-4"},Gs={key:0,class:"custom-pt-16 custom-px-20 custom-pb-4"},ea={key:0,class:"custom-px-20 custom-pt-8 custom-pb-20 gray"},ta={key:1,class:"flexbox middle custom-pt-16 custom-pb-12 custom-px-16 empty:tw-hidden"},sa={class:"wide"},aa={key:2,class:"custom-py-12 tw-cursor-pointer heading"},ra=x({__name:"TaskList",props:{filter:{},shouldFilterUncompleted:{type:Boolean},hideUncompletedLabel:{type:Boolean},listId:{},locationId:{},userId:{},date:{},externalAppId:{},searchQuery:{},addableProps:{},hideAddNewTask:{type:Boolean},disableSort:{type:Boolean},header:{},startMessage:{}},setup(a){const t=a,e=j(),o=D(()=>t.filter!=="list");return(c,p)=>(l(),u("div",Ys,[t.header?(l(),u("div",Gs,[m("h1",null,w(t.header),1)])):g("",!0),M(bs,null,{default:P(()=>[M(xs,{filter:t.filter,"should-filter-uncompleted":t.shouldFilterUncompleted,"list-id":t.listId,"location-id":t.locationId,"user-id":t.userId,date:t.date,"external-app-id":t.externalAppId,"search-query":t.searchQuery},{default:P(({tasks:s})=>[!s.length&&t.startMessage&&_(e).isPreFilled?(l(),u("div",ea,w(t.startMessage),1)):g("",!0),t.hideAddNewTask?g("",!0):(l(),u("div",ta,[m("div",sa,[M(Ss,{"addable-props":t.addableProps,"should-pin-new-task":o.value},null,8,["addable-props","should-pin-new-task"])]),t.listId?(l(),K(Xs,{key:0,"list-id":t.listId},null,8,["list-id"])):g("",!0)])),c.shouldFilterUncompleted&&!c.hideUncompletedLabel&&s.length?(l(),u("div",aa,w(c.$t("completed")),1)):g("",!0),M(Hs,null,{default:P(({onSelect:n,onDeselect:i})=>[M(_t,{items:s,"sortable-list-id":t.disableSort?void 0:t.listId,"sortable-group-name":"tasks",onSort:_(e).sort,onSelect:n,onDeselect:i},{default:P(({item:d})=>[M(Ls,null,{default:P(({onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:f,onDelete:k,onBlur:r})=>[M(ws,{task:d,sortable:!!t.listId&&!t.disableSort,"addable-props":t.addableProps,"is-enter-disabled":!t.listId||t.disableSort,"show-info-link":"",onUpdate:y,onComplete:C,onInsert:L,onInsertMany:T,onInsertFirst:f,onDelete:k,onBlur:r},null,8,["task","sortable","addable-props","is-enter-disabled","onUpdate","onComplete","onInsert","onInsertMany","onInsertFirst","onDelete","onBlur"])]),_:2},1024)]),_:2},1032,["items","sortable-list-id","onSort","onSelect","onDeselect"])]),_:2},1024)]),_:1},8,["filter","should-filter-uncompleted","list-id","location-id","user-id","date","external-app-id","search-query"])]),_:1})]))}});export{ra as _};
