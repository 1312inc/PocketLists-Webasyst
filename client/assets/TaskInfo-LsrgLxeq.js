import{_ as V,t as z,a as K,b as j}from"./textToHtmlWithLinks-qCcNV8Fr.js";import{d as C,u as M,a as U,r as g,c as x,b as H,o as l,e as d,f as e,g as w,h as b,w as T,i as E,t as y,j as $,k as F,n as R,l as S,m as I,p as q,q as G,T as O,s as W,v as Y,x as J,F as D,y as N,z as A,A as P,B as Q,C as X,D as Z,E as ee}from"./index-O8bQfvB8.js";import{C as L}from"./ContenteditableBlock-P9YdZX3M.js";import"./sanitizer-qTkizPqY.js";const te={key:0,class:"tw-hidden group-hover:tw-block"},se={class:"smaller tw-flex tw-items-center tw-gap-2"},ae={key:0},oe={class:"icon userpic"},le=["src"],ne={key:1,class:"tw-truncate"},ce={class:"tw-whitespace-nowrap opacity-60"},ie={key:2,class:"opacity-60"},re=C({__name:"TaskInfoChatItem",props:{message:{}},setup(h){const n=h,m=M(),r=U(),a=g(),u=g(!1),s=x(()=>n.message.contact_id===H.contact_id),c=x(()=>m.getItemById(n.message.contact_id)),p=async()=>{confirm("Are You sure?")&&await r.deleteItem(n.message)},i=async()=>{u.value=!0,await S(),a.value.focus()},f=async o=>{o!==null&&await r.updateItem(n.message,{comment:o})};return(o,t)=>{var _;return l(),d("div",{class:R(["tw-group tw-flex tw-gap-2",{"tw-justify-end":s.value}])},[s.value?(l(),d("div",te,[e("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:p},t[2]||(t[2]=[e("i",{class:"fas fa-trash-alt"},null,-1)])),e("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:i},t[3]||(t[3]=[e("i",{class:"fas fa-edit"},null,-1)]))])):w("",!0),e("div",{class:R(["blank box rounded tw-flex-none tw-w-[80%] tw-flex tw-flex-col tw-gap-2",{"tw-bg-[var(--accent-color)] text-white":s.value}])},[b(L,{ref_key:"contenteditableRef",ref:a,editable:u.value,focusable:!0,value:n.message.comment||"",tag:"div",class:"small",onBlur:t[0]||(t[0]=k=>u.value=!1),onUpdate:f,onKeydown:t[1]||(t[1]=T(E(k=>{var v,B;return(B=(v=k.target)==null?void 0:v.blur)==null?void 0:B.call(v)},["stop"]),["esc"]))},null,8,["editable","value"]),e("div",se,[c.value&&!s.value?(l(),d("div",ae,[e("span",oe,[e("img",{src:(_=c.value)==null?void 0:_.photo_url,alt:""},null,8,le)])])):w("",!0),c.value&&!s.value?(l(),d("div",ne,y(c.value.name),1)):w("",!0),e("div",ce,y($(F)(n.message.create_datetime).format("ll")),1),typeof n.message.id=="number"?(l(),d("div",ie,t[4]||(t[4]=[e("i",{class:"fas fa-check fa-xs"},null,-1)]))):w("",!0)])],2)],2)}}}),ue={class:"tw-flex tw-flex-col tw-h-full"},de={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},me={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},pe={class:"state-with-inner-icon right width-100"},ve=["placeholder"],fe=C({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(h,{emit:n}){const m=n,r=h,a=U(),u=g(),s=g(""),c=x(()=>a.getComentsByTaskId(r.taskId));I(()=>r.taskId,i=>J(i)&&a.fetch({item_id:i}),{immediate:!0}),I(c,async()=>{c.value.length&&(await S(),m("update"))},{immediate:!0}),q(()=>{u.value.focus()}),I(()=>r.taskId,()=>{u.value.focus()});const p=async()=>{if(!s.value)return;const i=await a.insert(r.taskId);i&&(a.updateItem(i,{comment:s.value}),s.value="",u.value.focus())};return(i,f)=>(l(),d("div",ue,[e("div",de,[b(O,{name:"list"},{default:G(()=>[(l(!0),d(D,null,N(c.value,o=>(l(),A(re,{key:o.uuid||o.id,message:o},null,8,["message"]))),128))]),_:1})]),e("div",me,[e("div",pe,[W(e("input",{ref_key:"inputRef",ref:u,"onUpdate:modelValue":f[0]||(f[0]=o=>s.value=o),type:"text",placeholder:i.$t("addComment"),class:"width-100 blank",onKeydown:T(p,["enter"])},null,40,ve),[[Y,s.value,void 0,{trim:!0}]]),e("button",{class:"icon",onClick:p},f[1]||(f[1]=[e("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),_e=C({__name:"ContenteditableBlockClickable",props:{value:{},valueActive:{},placeholder:{}},emits:["update"],setup(h,{emit:n}){const m=h,r=n,a=g(!1),u=g(),s=async()=>{a.value||(a.value=!0,await S(),u.value.focus())},c=async p=>{if(p===null){a.value=!1;return}I(()=>m.value,()=>{a.value=!1},{once:!0}),r("update",p)};return(p,i)=>(l(),A(L,{ref_key:"elementRef",ref:u,tag:"div",value:a.value?m.value:m.valueActive,placeholder:m.placeholder,editable:a.value,focusable:!0,onClick:s,onUpdate:c,onKeydown:i[0]||(i[0]=T(E(f=>{var o,t;return(t=(o=f.target)==null?void 0:o.blur)==null?void 0:t.call(o)},["stop"]),["esc"]))},null,8,["value","placeholder","editable"]))}}),we={key:0,class:"tw-h-full tw-flex tw-flex-col"},he={class:"pl-bg-block tw-flex-none custom-px-20 custom-pt-16"},ke={class:"custom-mb-24"},ye={key:0,class:"custom-mb-12"},ge={class:"flexbox middle space-8 wrap",title:"{{ $t('Created by') }}"},be={class:"wide"},xe={class:"small"},Ie={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},Ce={class:"custom-mb-12"},$e={key:1,class:"custom-mb-12"},Te=["href"],Se=["src"],Be=["href"],Re={class:"hint custom-ml-4"},Ne=C({__name:"TaskInfo",props:{taskId:{}},setup(h){const n=h,m=P(),r=g(),a=Q(),u=M(),s=x(()=>a.getItemById(n.taskId)),c=x(()=>u.getItemById(s.value.contact_id));X(document,"keydown",t=>{t.code==="Escape"&&p()});const p=()=>{var _;const t=(_=[...m.currentRoute.value.matched].reverse().find(k=>k.meta.isListView))==null?void 0:_.name;t?m.push({name:t}):console.error("Cant find back route")},i=()=>{setTimeout(()=>{r.value.scrollTo({top:r.value.scrollHeight})},100)},f=async t=>{await a.updateItem(n.taskId,{note:t.trim()})};function o(t){return new URL(Object.assign({"../assets/apps/shop.svg":K,"../assets/apps/tasks.svg":j})[`../assets/apps/${t}.svg`],import.meta.url).href}return(t,_)=>{var k;return s.value?(l(),d("div",we,[e("div",{class:"tw-flex-none custom-p-12"},[e("a",{class:"back larger",onClick:p},_[0]||(_[0]=[e("i",{class:"fas fa-arrow-circle-left"},null,-1)]))]),e("div",he,[e("h3",null,y(s.value.name),1),e("div",ke,[b(_e,{value:s.value.note||"","value-active":$(z)(s.value.note||""),placeholder:t.$t("addNote"),class:"hint",onUpdate:f},null,8,["value","value-active","placeholder"])]),c.value?(l(),d("div",ye,[e("div",ge,[e("span",{class:"icon userpic userpic-20",style:Z({backgroundImage:`url(${c.value.photo_url})`})},null,4),e("span",be,[e("span",xe,y(c.value.name),1),s.value.create_datetime?(l(),d("span",Ie,y($(ee)(s.value.create_datetime)),1)):w("",!0)])])])):w("",!0),e("div",Ce,[b(V,{task:s.value},null,8,["task"])]),(k=s.value.external_links)!=null&&k.length?(l(),d("div",$e,[(l(!0),d(D,null,N(s.value.external_links,v=>(l(),d("div",{key:v.id},[e("a",{href:v.entity_link,class:"icon size-20",target:"_blank"},[e("img",{src:o(v.app)},null,8,Se)],8,Te),e("a",{class:"custom-ml-4",href:v.entity_link},y(v.entity_title),9,Be),e("span",Re,y(v.app),1)]))),128))])):w("",!0)]),e("div",{ref_key:"containerRef",ref:r,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[b(fe,{"task-id":t.taskId,onUpdate:i},null,8,["task-id"])],512)])):w("",!0)}}});export{Ne as default};
