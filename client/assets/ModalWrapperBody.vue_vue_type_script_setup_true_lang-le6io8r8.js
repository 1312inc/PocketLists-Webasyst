import{h as k,r as m,aC as F,M as P,o as r,j as i,Z as p,u as T,c as I,s as w,P as D,k as o,t as B,Q as g,q as N,v as S,aD as L,F as _,X as M,D as x,C as O,Y as Q,w as R}from"./index-Y48lTc29.js";const U=k({__name:"IntersectionObserver",props:{disabled:{type:Boolean}},emits:["intersecting"],setup(u,{emit:e}){const t=u,n=e,s=m(null),{stop:c}=F(s,([{isIntersecting:l}])=>{l&&!t.disabled&&n("intersecting")},{rootMargin:"200px"});return P(()=>{c()}),(l,d)=>(r(),i("div",{ref_key:"elRef",ref:s},[p(l.$slots,"default")],512))}}),V={key:0},E={class:"skeleton custom-m-24"},C=30,q=k({__name:"TaskListLazyLoadFetcher",props:{filter:{},listId:{},locationId:{},userId:{},searchQuery:{}},setup(u){const e=u,t=T(),n=m(C),s=m([]),c=m(!1),{item:l}=Q(),d=I(()=>({list:{source:e.listId?t.getTasksInList(e.listId):[],isFetchStream:!1,fetchParams:e.listId?{list_id:e.listId}:{}},upnext:{source:t.getUpnext,isFetchStream:!0,fetchParams:{filter:"upnext"}},due:{source:t.getDue,isFetchStream:!0,fetchParams:{filter:"due"}},priority:{source:t.getPriority,isFetchStream:!0,fetchParams:{filter:"priority"}},nearby:{source:t.getTasksSortedByCurrentDistance,isFetchStream:!0,fetchParams:{filter:"nearby"}},search:{source:s.value,isFetchStream:!0,fetchParams:{filter:`search/${e.searchQuery}`}},location:{source:e.locationId?t.getTasksInLocation(e.locationId):[],isFetchStream:!1,fetchParams:e.locationId?{location_id:e.locationId}:{}},user:{source:e.userId?t.getTasksByUser(e.userId):[],isFetchStream:!1,fetchParams:e.userId?{assigned_contact_id:e.userId}:{}}})[e.filter]),v=I(()=>d.value.source.slice(0,n.value));w(()=>e,()=>{c.value=!1,s.value=[],b()},{deep:!0,immediate:!0});const $=()=>{n.value+=C};async function b(){const{isFetchStream:f,fetchParams:a}=d.value;if(a.list_id&&typeof a.list_id!="number")return;const h=l.value.get(JSON.stringify(a)),y=await t[f?"fetchStream":"fetch"]({...a,limit:500,starting_from:h&&M(new Date(h))});y.value&&y.value.status_code==="ok"&&(l.value.set(JSON.stringify(a),Date.now()),e.filter==="search"&&(s.value=[...s.value,...y.value.data],c.value=!s.value.length))}return(f,a)=>(r(),i(_,null,[p(f.$slots,"default",{tasks:v.value}),e.filter==="search"&&c.value?(r(),i("div",V,[a[0]||(a[0]=D(" No matches found for ")),o("strong",null,B(e.searchQuery),1)])):g("",!0),N(L,{name:"fade"},{default:S(()=>[v.value.length&&v.value.length<d.value.source.length?(r(),x(U,{key:0,onIntersecting:$},{default:S(()=>[o("div",E,[(r(),i(_,null,O(5,h=>o("span",{key:h,class:"skeleton-custom-box",style:{height:"40px"}})),64))])]),_:1})):g("",!0)]),_:1})],64))}}),J={class:"dialog-header"},W={class:"dialog-content"},Z={class:"dialog-footer tw-flex tw-gap-2"},z=k({__name:"ModalWrapperBody",props:{title:{},hideCloseButton:{type:Boolean},hideCloseIcon:{type:Boolean}},emits:["close"],setup(u){return(e,t)=>(r(),i(_,null,[o("header",J,[o("h1",null,B(e.$props.title),1),e.hideCloseIcon?g("",!0):(r(),i("a",{key:0,class:"dialog-close",onClick:t[0]||(t[0]=R(n=>e.$emit("close"),["prevent"]))},t[2]||(t[2]=[o("i",{class:"fas fa-times"},null,-1)])))]),o("div",W,[p(e.$slots,"default")]),o("footer",Z,[p(e.$slots,"submit"),e.hideCloseButton?g("",!0):(r(),i("button",{key:0,class:"button light-gray",onClick:t[1]||(t[1]=n=>e.$emit("close"))}," Close "))])],64))}});export{q as _,z as a};
