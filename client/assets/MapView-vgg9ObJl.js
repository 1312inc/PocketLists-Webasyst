import{a5 as B,d as E,A as V,a6 as z,c as I,r as _,a7 as A,m as D,a8 as j,o as m,e as w,f as t,t as n,K as h,s as P,v as R,D as U,y as b,q as x,j as L,b as N,i as v,a9 as q,p as F,M as Y,z as G,J as H,I as O,F as S,x as Z,g as y,h as C,Z as K,aa as J,ab as W,ac as X}from"./index-pf4XoW7F.js";import{a as Q,_ as T}from"./TaskList.vue_vue_type_script_setup_true_lang-Yf-HdSXr.js";import"./textToHtmlWithLinks-ck1ML020.js";import"./sanitizer-TiisBOmJ.js";import"./SortableList.vue_vue_type_style_index_0_lang-yEAGZKgm.js";const tt=async r=>{try{const{response:e}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${B}&geocode=${r}&format=json`)).json();return e?e.GeoObjectCollection.featureMember.map(u=>u.GeoObject):[]}catch(e){return e instanceof Error&&console.error(e.message),[]}};function et(r,e,u){const d=40075016686e-3/(256*Math.pow(2,e))*Math.cos(u*(Math.PI/180));return r/d}const ot={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},st={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},at={class:"pl-bg-block custom-p-16"},lt={class:"small custom-mt-0"},nt={class:"small gray"},it={class:"small"},rt={class:"custom-my-12"},ut={class:"custom-my-12"},dt=["placeholder"],ct=E({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(r){const e=r,u=V(),p=z(),i=I(()=>Math.pow(2,21-e.zoom)*1128.49722*(c.value/1e4)),d=I(()=>Math.round(et(i.value,e.zoom,e.lat))),c=_(50),g=_(""),$=_(!1),k=A([]),s=_("");D(j(g,500),o=>{if($.value){$.value=!1;return}a(o)});const a=async o=>{k.value=await tt(o)},M=async()=>{const o=await p.insert({name:s.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:i.value});o&&(await p.updateItem(o,{name:s.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:i.value}),u.push(`/map/${o.id}`))};return(o,l)=>(m(),w("div",ot,[t("div",st,[t("div",at,[t("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:l[0]||(l[0]=f=>o.$router.replace("/map"))},l[3]||(l[3]=[t("i",{class:"fas fa-times"},null,-1)])),t("p",lt,n(o.$t("adjustLocationHint")),1),t("p",nt,[h(n(o.lat),1),l[4]||(l[4]=t("br",null,null,-1)),h(" "+n(o.lng),1)]),t("div",it,[h(n(o.$t("Radius"))+": ",1),t("b",null,n(i.value&&Math.ceil(i.value))+" "+n(o.$t("m")),1)]),t("div",rt,[P(t("input",{"onUpdate:modelValue":l[1]||(l[1]=f=>c.value=f),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[R,c.value,void 0,{number:!0}]])]),t("div",ut,[P(t("input",{"onUpdate:modelValue":l[2]||(l[2]=f=>s.value=f),type:"text",placeholder:o.$t("name"),class:"width-100"},null,8,dt),[[R,s.value,void 0,{trim:!0}]])]),t("button",{onClick:M},n(o.$t("Save location")),1)])]),t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:U({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:d.value+"px",height:d.value+"px"})},l[5]||(l[5]=[t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[t("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),mt={class:"small"},pt={class:"small"},wt=["href"],ft=E({__name:"ModalPremium",props:{message:{}},emits:["close"],setup(r,{emit:e}){const u=e,p=r;return(i,d)=>(m(),b(Q,{"hide-close-button":!0,"hide-close-icon":!0,title:i.$t("modalPremiumTitle")},{default:x(()=>[t("p",mt,n(p.message),1),t("p",pt,[d[1]||(d[1]=t("i",{class:"fas fa-star text-yellow"},null,-1)),h(" "+n(i.$t("modalPremiumBody")),1)])]),submit:x(()=>[t("a",{class:"button yellow",href:`${L(N).base_url}upgrade/`},n(i.$t("modalPremiumBuy")),9,wt),t("button",{class:"light-gray",onClick:d[0]||(d[0]=v(c=>u("close"),["prevent"]))},n(i.$t("modalPremiumCancel")),1)]),_:1},8,["title"]))}});function vt(r){if(N.is_premium)return;const e=q(ft,{message:r});return F(()=>e.show()),Y(()=>e.remove()),{show:e.show,hide:e.remove}}const ht={class:"pl-map-sidebar"},gt={key:0,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full custom-m-12"},$t={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},_t={class:"menu"},yt=["onClick"],bt={key:1,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full custom-m-12"},kt={class:"tw-flex-none tw-flex tw-items-center tw-gap-4 tw-justify-between"},Mt={class:"bold"},Ct={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},It={key:2,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},St=E({__name:"MapView",props:{locationId:{}},setup(r){const{t:e}=G();H(e("map")),vt(e("modalPremiumMap"));const u=V(),p=z(),i=W(()=>X(()=>import("./MapYandex-3q7rT8dS.js"),__vite__mapDeps([0,1,2]),import.meta.url)),d=A(i),c=I(()=>r.locationId?p.getItemById(r.locationId):null),g=s=>{u.push(`/map/${s}`)},$=()=>{const s={...u.currentRoute.value.query};s.addLocation?delete s.addLocation:s.addLocation="1",u.push({path:"/map",query:s})},k=async s=>{await p.deleteItem(s),u.push("/map")};return(s,a)=>{const M=O("RouterView");return m(),w(S,null,[t("div",ht,[s.$route.name==="map"?(m(),w("div",gt,[t("a",{class:"button custom-m-0",onClick:v($,["prevent"])},[a[2]||(a[2]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),h(" "+n(s.$t("New location")),1)]),t("div",$t,[t("ul",_t,[(m(!0),w(S,null,Z(L(p).items,o=>(m(),w("li",{key:o.id,class:"rounded"},[t("a",{onClick:v(l=>g(o.id),["prevent"])},[a[3]||(a[3]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),t("span",null,n(o.name),1),a[4]||(a[4]=t("span",{class:"count"},[t("i",{class:"fas fa-chevron-right fa-xs"})],-1))],8,yt)]))),128))])])])):y("",!0),s.$route.name==="location"&&c.value?(m(),w("div",bt,[t("div",kt,[t("a",{class:"back larger",onClick:a[0]||(a[0]=v(o=>s.$router.push("/map"),["prevent"]))},a[5]||(a[5]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)])),t("div",Mt,n(c.value.name),1),t("div",null,[t("a",{onClick:a[1]||(a[1]=v(o=>k(c.value),["prevent"]))},a[6]||(a[6]=[t("i",{class:"fas fa-trash-alt text-light-gray"},null,-1)]))])]),t("div",Ct,[C(T,{filter:"location","location-id":c.value.id,"addable-props":{location_id:c.value.id}},null,8,["location-id","addable-props"]),C(T,{filter:"location","location-id":c.value.id,"should-filter-uncompleted":!0,"hide-add-new-task":!0},null,8,["location-id"])])])):y("",!0),s.$route.meta.isTaskInfoView?(m(),w("div",It,[C(M)])):y("",!0)]),(m(),b(J,{to:"#wa-app"},[(m(),b(K(d.value),{places:L(p).items,"selected-location-id":s.locationId,onSelectLocation:g},{default:x(({lng:o,lat:l,zoom:f})=>[s.$route.query.addLocation?(m(),b(ct,{key:0,lng:o,lat:l,zoom:f},null,8,["lng","lat","zoom"])):y("",!0),a[7]||(a[7]=t("div",{id:"map",class:"tw-absolute tw-w-full tw-h-1/2 md:tw-h-full tw-top-0 tw-left-0 z-0"},null,-1))]),_:1},40,["places","selected-location-id"]))]))],64)}}});export{St as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./MapYandex-3q7rT8dS.js","./index-pf4XoW7F.js","./index-9IXkESCG.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
