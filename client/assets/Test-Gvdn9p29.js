import{d as b,c as g,f as s,a as v,r as d,u as T,w as M,n as C,o as u,b as w,e as t,g as y,h as $,F as R,i as B,t as f,j as m,T as S,k as z,v as N,l as V,m as I,p as D}from"./index-FBA1Gy56.js";import{u as O,f as P,l as A,d as h}from"./index-Bam5na4Y.js";import{O as E}from"./dayjs.min-H0nPnS5j.js";const F=async()=>{const i=Array(10).fill(null).map(()=>({id:s.string.uuid(),task_id:s.string.uuid(),title:s.company.buzzPhrase(),created_at:s.date.past().getTime(),message:s.lorem.paragraph(),name:s.internet.displayName()}));await h.chatMessages.bulkPut(i)},K=b("chats",()=>{const i=g(()=>e=>O(P(A(()=>h.chatMessages.where("task_id").notEqual(e).sortBy("created_at"))),{initialValue:[]})),l=async e=>{const a={id:s.string.uuid(),task_id:s.string.uuid(),title:s.company.buzzPhrase(),created_at:new Date().getTime(),message:e,name:s.internet.displayName()};try{return await h.chatMessages.put(a),a}catch(o){console.log(o)}};return F(),{getMessgesByTaskId:i,addMessage:l}}),L={class:"tw-h-full tw-flex tw-flex-col"},j={class:"tw-flex tw-gap-2"},q={class:"hint"},G=t("div",{class:"hint"}," delivered ",-1),H={class:"state-with-inner-icon right tw-w-full"},Q=t("i",{class:"fas fa-arrow-right"},null,-1),U=[Q],W=v({__name:"TaskChat",setup(i){const l=K(),e=d(),a=d(),o=l.getMessgesByTaskId(""),c=d(!1),{y:x}=T(),r=d(""),k=g(()=>128-x.value);M(o,async()=>{await C(),e.value&&(e.value.scrollTop=e.value.scrollHeight),c.value=!0});const _=async()=>{await l.addMessage(r.value),r.value="",a.value.focus()};return(st,p)=>(u(),w("div",L,[t("div",{ref_key:"chatContainerRef",ref:e,class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3 tw-overflow-x-hidden tw-overflow-y-auto"},[y(S,{name:"slide-right",css:c.value},{default:$(()=>[(u(!0),w(R,null,B(m(o),n=>(u(),w("div",{key:n.id,class:"tw-flex tw-flex-col tw-gap-2 tw-bg-background tw-p-4 tw-rounded-lg tw-rounded-tl-0 tw-text-sm tw-mr-4"},[t("div",j,[t("div",null,f(n.name),1),t("div",q,f(m(E)(n.created_at).format("ll")),1)]),t("div",null,f(n.message),1),G]))),128))]),_:1},8,["css"])],512),t("div",{class:"tw-flex-none tw-sticky tw-py-3 pl-bg-block",style:I({bottom:`${k.value}px`})},[t("div",H,[z(t("input",{ref_key:"inputRef",ref:a,"onUpdate:modelValue":p[0]||(p[0]=n=>r.value=n),type:"text",placeholder:"Type a message",class:"tw-w-full",onKeydown:V(_,["enter"])},null,544),[[N,r.value]]),t("button",{class:"icon",onClick:_},U)])],4)]))}}),J={class:"pl-bg-block tw-rounded-xl lg:tw-rounded-r-0 tw-h-full tw-h-full tw-flex tw-flex-col"},X=t("i",{class:"fas fa-times"},null,-1),Y=[X],Z={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-4 tw-overflow-hidden tw-p-3 tw-pb-0"},tt=t("div",{class:"tw-h-32 tw-flex-none"}," Task Info ",-1),et={class:"tw-flex-auto tw-min-h-0"},nt=v({__name:"Test",props:["taskId"],setup(i){const l=D(),e=()=>{var o;const a=(o=l.currentRoute.value.matched.find(c=>c.meta.isListView))==null?void 0:o.name;a?l.push({name:a}):console.error("Cant find back route")};return(a,o)=>(u(),w("div",J,[t("div",{class:"tw-flex-none tw-p-3"},[t("button",{class:"circle gray",onClick:e},Y)]),t("div",Z,[tt,t("div",et,[y(W)])])]))}});export{nt as default};
