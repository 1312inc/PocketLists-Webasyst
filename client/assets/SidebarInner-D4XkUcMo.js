import{h as w,r as k,G as M,K as y,o as d,j as u,L as P,M as N,u as R,E as H,B as z,D as K,v as h,k as t,N as x,q as p,z as V,w as b,O as C,t as g,m as f,P as $,Q as O,R as I,H as q,I as F,F as S,s as U,C as j}from"./index-bqVAhNCn.js";import{C as D}from"./ContenteditableBlock-MIkfxuUe.js";import{u as G,p as J,_ as Q}from"./SortableList.vue_vue_type_style_index_0_lang-IBNy4PW7.js";import{_ as W}from"./SearchForm.vue_vue_type_script_setup_true_lang-jkLSfE45.js";import"./rangy-5rxgwlWZ.js";const Y=w({__name:"WaDropOnElement",props:{draggableEntityName:{}},emits:["drop"],setup(_,{emit:r}){const s=r,i=_,a=k(),{getDraggingEntityName:m}=G();return M(()=>{y(a,"dragenter",e=>{i.draggableEntityName===m()&&e.currentTarget instanceof HTMLElement&&e.currentTarget.classList.add("dragover")}),y(a,"dragleave",e=>{if(e.currentTarget instanceof HTMLElement){if(e.relatedTarget&&e.currentTarget.contains(e.relatedTarget))return;e.currentTarget.classList.remove("dragover")}}),y(a,"dragover",e=>{e.preventDefault()}),y(a,"drop",e=>{if(i.draggableEntityName===m()&&e.currentTarget instanceof HTMLElement&&(e.preventDefault(),e.currentTarget.classList.remove("dragover"),e.dataTransfer))try{const l=JSON.parse(e.dataTransfer.getData("text/plain")).taskIds;s("drop",l)}catch{}})}),(e,l)=>(d(),u("div",{ref_key:"menuItemElementRef",ref:a},[P(e.$slots,"default")],512))}}),A={class:"image sortable-handle"},X={class:"details"},Z={class:"tablebox"},ee={class:"count align-right tw-flex tw-gap-1"},te={key:0,class:"hint tw-flex"},se={class:"tw-w-14 tw-truncate"},ae=w({__name:"ListsListItem",props:{item:{}},setup(_,{expose:r}){const s=_,i=N(),a=R(),m=H(),e=k(),l=k(!1);r({focus:T});const L=async n=>{l.value=!1,await i.updateItemName(s.item,n)},c=async n=>{await a.sort(s.item.id,null,n)},o=async n=>{n.target instanceof HTMLElement&&n.target.innerText&&m.push({name:"list",params:{id:s.item.id},query:{addNewTask:1}})};async function T(){l.value=!0,await z(),e.value.focus()}return(n,E)=>(d(),K(Y,{"draggable-entity-name":"tasks",onDrop:c},{default:h(()=>{var v;return[t("a",A,[t("i",{class:"userpic userpic32",style:x(`background-image: url(${s.item.icon_url||"/wa-apps/pocketlists/img/listicons/li-list@2x.png"})`)},null,4)]),t("a",X,[t("div",Z,[p(D,{ref_key:"contenteditableBlockRef",ref:e,value:n.item.name,editable:l.value,focusable:!0,placeholder:n.$t("newList"),tag:"strong",onUpdate:L,onKeydown:V(b(o,["prevent"]),["enter"])},null,8,["value","editable","placeholder","onKeydown"]),t("span",ee,[C(g(s.item.extended_data.items_count>0?s.item.extended_data.items_count:0)+" ",1),s.item.extended_data.items_priority_count?(d(),u("span",{key:0,class:"badge",style:x(`background-color: ${(v=f(J).get(s.item.extended_data.items_priority_value))==null?void 0:v.color}`)},g(s.item.extended_data.items_priority_count),5)):$("",!0)])]),f(O).is_debug_mode?(d(),u("p",te,[t("span",se,"id: "+g(s.item.id),1),C(" | srank: "+g(s.item.sort)+" | "+g(s.item.rank),1)])):$("",!0)])]}),_:1}))}}),ne={class:"custom-p-12"},oe={class:"heading black custom-m-0 custom-mb-8"},re={class:"pl-bg-block"},ie={key:0,class:"custom-px-16 custom-py-12 gray"},le=w({__name:"ListsList",props:{pocket:{}},setup(_){const r=_,s=I(),i=N(),a=k(!1),m=k(new Set),e=async()=>{U(m,c=>{var o;c.size>0&&((o=[...c].at(-1))==null||o.focus())},{deep:!0,once:!0}),await i.createList({pocket_id:r.pocket.id})},l=async c=>{await s.updateItemName(r.pocket,c)},L=async()=>{await s.deleteItem(r.pocket)};return(c,o)=>{const T=q("router-link");return d(),u(S,null,[t("div",ne,[t("h5",oe,[p(D,{value:r.pocket.name,tag:"span",editable:a.value,focusable:!0,placeholder:c.$t("newPocket"),onBlur:o[0]||(o[0]=n=>a.value=!1),onUpdate:l},null,8,["value","editable","placeholder"]),t("a",{class:"count",onClick:o[1]||(o[1]=b(n=>a.value=!a.value,["prevent"]))},o[2]||(o[2]=[t("i",{class:"fas fa-pen"},null,-1)])),t("a",{class:"count action",onClick:b(e,["prevent"])},o[3]||(o[3]=[t("i",{class:"fas fa-plus-circle"},null,-1)])),t("a",{class:"count action",onClick:b(L,["prevent"])},o[4]||(o[4]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))])]),t("div",re,[p(Q,{items:f(i).getListsInPocket([r.pocket.id]),"sortable-list-id":r.pocket.id,"sortable-group-name":"lists","class-name":"list",onSort:f(i).sort},{default:h(({item:n})=>[p(T,{to:{name:"list",params:{id:n.id}},custom:""},{default:h(({isActive:E,navigate:v})=>[p(ae,{ref:B=>m.value.add(B),item:n,class:F(["item",(E||n.uuid===c.$route.params.id)&&"selected"]),"data-id":n.id,onClick:v},null,8,["item","class","data-id","onClick"])]),_:2},1032,["to"])]),_:1},8,["items","sortable-list-id","onSort"]),f(i).getListsInPocket([r.pocket.id]).length?$("",!0):(d(),u("div",ie," No Lists Yet "))])],64)}}}),ce={class:"custom-m-12"},de={class:"align-center custom-m-12"},ge=w({__name:"SidebarInner",setup(_){const r=I();return(s,i)=>(d(),u(S,null,[t("div",ce,[p(W)]),(d(!0),u(S,null,j(f(r).items,a=>(d(),u("div",{key:a.uuid||a.id,class:"custom-mb-24"},[p(le,{pocket:a},null,8,["pocket"])]))),128)),t("div",de,[t("button",{class:"gray",onClick:i[0]||(i[0]=a=>f(r).createPocket())},i[1]||(i[1]=[t("i",{class:"fa fa-plus"},null,-1)]))])],64))}});export{ge as default};
