import{a4 as V,d as x,A as T,a5 as z,c as k,r as _,a6 as A,m as B,a7 as D,o as p,e as f,f as t,t as n,K as h,s as L,v as E,D as j,z as b,q as C,j as I,b as N,i as v,a8 as U,p as Y,M as q,J as F,F as P,y as G,h as R,Y as H,a9 as O,g as K,aa as Z,ab as J}from"./index-Y5jYPgTk.js";import{a as W,_ as S}from"./TaskList.vue_vue_type_script_setup_true_lang-57-5eXAd.js";import{u as X}from"./useTitle-B-UJ_j2S.js";import"./textToHtmlWithLinks-ZOD550Va.js";import"./sanitizer-qTkizPqY.js";import"./SortableList.vue_vue_type_style_index_0_lang-eFLtLfii.js";const Q=async r=>{try{const{response:e}=await(await fetch(`https://geocode-maps.yandex.ru/1.x/?apikey=${V}&geocode=${r}&format=json`)).json();return e?e.GeoObjectCollection.featureMember.map(u=>u.GeoObject):[]}catch(e){return e instanceof Error&&console.error(e.message),[]}};function tt(r,e,u){const d=40075016686e-3/(256*Math.pow(2,e))*Math.cos(u*(Math.PI/180));return r/d}const et={class:"tw-absolute tw-top-0 tw-left-0 tw-w-full tw-h-1/2 md:tw-h-full"},ot={class:"tw-absolute tw-w-70 tw-flex tw-flex-col tw-gap-2 tw-top-16 tw-right-6 tw-z-50"},st={class:"pl-bg-block custom-p-16"},at={class:"small custom-mt-0"},lt={class:"small gray"},nt={class:"small"},it={class:"custom-my-12"},rt={class:"custom-my-12"},ut=["placeholder"],dt=x({__name:"ChooseLocation",props:{lng:{},lat:{},zoom:{}},setup(r){const e=r,u=T(),m=z(),i=k(()=>Math.pow(2,21-e.zoom)*1128.49722*(c.value/1e4)),d=k(()=>Math.round(tt(i.value,e.zoom,e.lat))),c=_(50),g=_(""),y=_(!1),M=A([]),a=_("");B(D(g,500),s=>{if(y.value){y.value=!1;return}o(s)});const o=async s=>{M.value=await Q(s)},w=async()=>{const s=await m.insert({name:a.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:i.value});s&&(await m.updateItem(s,{name:a.value,location_latitude:e.lat,location_longitude:e.lng,location_radius:i.value}),u.push(`/map/${s.id}`))};return(s,l)=>(p(),f("div",et,[t("div",ot,[t("div",st,[t("div",{class:"tw-absolute tw-top-2 tw-right-3 tw-cursor-pointer gray",onClick:l[0]||(l[0]=$=>s.$router.replace("/map"))},l[3]||(l[3]=[t("i",{class:"fas fa-times"},null,-1)])),t("p",at,n(s.$t("adjustLocationHint")),1),t("p",lt,[h(n(s.lat),1),l[4]||(l[4]=t("br",null,null,-1)),h(" "+n(s.lng),1)]),t("div",nt,[h(n(s.$t("Radius"))+": ",1),t("b",null,n(i.value&&Math.ceil(i.value))+" "+n(s.$t("m")),1)]),t("div",it,[L(t("input",{"onUpdate:modelValue":l[1]||(l[1]=$=>c.value=$),type:"range",min:"10",max:"100",class:"width-100"},null,512),[[E,c.value,void 0,{number:!0}]])]),t("div",rt,[L(t("input",{"onUpdate:modelValue":l[2]||(l[2]=$=>a.value=$),type:"text",placeholder:s.$t("name"),class:"width-100"},null,8,ut),[[E,a.value,void 0,{trim:!0}]])]),t("button",{onClick:w},n(s.$t("Save location")),1)])]),t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-z-40 tw-rounded-full tw-pointer-events-none",style:j({"background-color":"rgba(56, 56, 219, 0.4)",border:"1px solid rgb(14, 194, 219)",width:d.value+"px",height:d.value+"px"})},l[5]||(l[5]=[t("div",{class:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2"},[t("i",{class:"fas fa-map-pin text-purple",style:{"font-size":"2rem"}})],-1)]),4)]))}}),ct={class:"small"},mt={class:"small"},pt=["href"],wt=x({__name:"ModalPremium",props:{message:{}},emits:["close"],setup(r,{emit:e}){const u=e,m=r;return(i,d)=>(p(),b(W,{"hide-close-button":!0,"hide-close-icon":!0,title:i.$t("modalPremiumTitle")},{default:C(()=>[t("p",ct,n(m.message),1),t("p",mt,[d[1]||(d[1]=t("i",{class:"fas fa-star text-yellow"},null,-1)),h(" "+n(i.$t("modalPremiumBody")),1)])]),submit:C(()=>[t("a",{class:"button yellow",href:`${I(N).base_url}upgrade/`},n(i.$t("modalPremiumBuy")),9,pt),t("button",{class:"light-gray",onClick:d[0]||(d[0]=v(c=>u("close"),["prevent"]))},n(i.$t("modalPremiumCancel")),1)]),_:1},8,["title"]))}});function ft(r){if(N.is_premium)return;const e=U(wt,{message:r});return Y(()=>e.show()),q(()=>e.remove()),{show:e.show,hide:e.remove}}const vt={class:"pl-map-sidebar"},ht={key:0,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},gt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},yt={class:"menu"},$t=["onClick"],_t={key:1,class:"tw-flex tw-flex-col tw-gap-4 tw-h-full"},bt={class:"tw-flex-none tw-flex tw-items-center tw-gap-4 tw-justify-between"},Mt={class:"bold"},kt={class:"hide-scrollbar tw-flex-auto tw-overflow-y-auto"},Rt=x({__name:"MapView",props:{locationId:{}},setup(r){const{t:e}=F();X(e("map")),ft(e("modalPremiumMap"));const u=T(),m=z(),i=Z(()=>J(()=>import("./MapYandex-6DD9wt13.js"),__vite__mapDeps([0,1,2]),import.meta.url)),d=A(i),c=k(()=>r.locationId&&m.getItemById(r.locationId)),g=a=>{u.push(`/map/${a}`)},y=()=>{const a={...u.currentRoute.value.query};a.addLocation?delete a.addLocation:a.addLocation="1",u.push({path:"/map",query:a})},M=async a=>{await m.deleteItem(a),u.push("/map")};return(a,o)=>(p(),f(P,null,[t("div",vt,[c.value?(p(),f("div",_t,[t("div",bt,[t("a",{class:"back larger",onClick:o[0]||(o[0]=v(w=>a.$router.push("/map"),["prevent"]))},o[5]||(o[5]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)])),t("div",Mt,n(c.value.name),1),t("div",null,[t("a",{onClick:o[1]||(o[1]=v(w=>M(c.value),["prevent"]))},o[6]||(o[6]=[t("i",{class:"fas fa-trash-alt text-light-gray"},null,-1)]))])]),t("div",kt,[R(S,{filter:"location","location-id":c.value.id,"addable-props":{location_id:c.value.id}},null,8,["location-id","addable-props"]),o[7]||(o[7]=t("div",{class:"custom-px-24 custom-my-24 tw-cursor-pointer"}," Выполненные ",-1)),R(S,{filter:"location","location-id":c.value.id,"should-filter-uncompleted":!0,"hide-add-new-task":!0},null,8,["location-id"])])])):(p(),f("div",ht,[t("a",{class:"button",onClick:v(y,["prevent"])},[o[2]||(o[2]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),h(" "+n(a.$t("New location")),1)]),t("div",gt,[t("ul",yt,[(p(!0),f(P,null,G(I(m).items,w=>(p(),f("li",{key:w.id,class:"rounded"},[t("a",{onClick:v(s=>g(w.id),["prevent"])},[o[3]||(o[3]=t("i",{class:"fas fa-map-marker-alt custom-mr-4"},null,-1)),t("span",null,n(w.name),1),o[4]||(o[4]=t("span",{class:"count"},[t("i",{class:"fas fa-chevron-right fa-xs"})],-1))],8,$t)]))),128))])])]))]),(p(),b(O,{to:"#wa-app"},[(p(),b(H(d.value),{places:I(m).items,"selected-location-id":a.locationId,onSelectLocation:g},{default:C(({lng:w,lat:s,zoom:l})=>[a.$route.query.addLocation?(p(),b(dt,{key:0,lng:w,lat:s,zoom:l},null,8,["lng","lat","zoom"])):K("",!0),o[8]||(o[8]=t("div",{id:"map",class:"tw-absolute tw-w-full tw-h-1/2 md:tw-h-full tw-top-0 tw-left-0 z-0"},null,-1))]),_:1},40,["places","selected-location-id"]))]))],64))}});export{Rt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./MapYandex-6DD9wt13.js","./index-Y5jYPgTk.js","./index-phJujEfv.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
