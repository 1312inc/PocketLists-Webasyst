import{_ as j,t as z,a as A,b as H}from"./textToHtmlWithLinks-HUqvNfVe.js";import{d as B,u as M,a as U,r as x,c as I,b as K,o,e as n,f as t,g as f,h as b,w as D,i as T,t as h,j as S,k as F,n as N,l as E,m as $,p as q,q as G,T as O,s as W,v as Y,F as L,x as V,y as J,z as P,A as Q,B as X,C as Z,D as tt,E as et}from"./index-V0gsrDTQ.js";import{C as st}from"./ContenteditableBlock-qkLcC2k4.js";import{_ as at}from"./ContenteditableBlockClickable.vue_vue_type_script_setup_true_lang-aCV87tyA.js";import"./sanitizer-TiisBOmJ.js";const ot=v=>typeof v=="number"&&Number.isInteger(v),nt={key:0,class:"tw-hidden group-hover:tw-block"},lt={class:"smaller tw-flex tw-items-center tw-gap-2"},it={key:0},ct={class:"icon userpic"},rt=["src"],ut={key:1,class:"tw-truncate"},dt={class:"tw-whitespace-nowrap opacity-60"},mt={key:2,class:"opacity-60"},pt=B({__name:"TaskInfoChatItem",props:{message:{}},setup(v){const u=v,y=M(),d=U(),m=x(),i=x(!1),l=I(()=>u.message.contact_id===K.contact_id),e=I(()=>y.getItemById(u.message.contact_id)),_=async()=>{confirm("Are You sure?")&&await d.deleteItem(u.message)},c=async()=>{i.value=!0,await E(),m.value.focus()},w=async p=>{p!==null&&await d.updateItem(u.message,{comment:p})};return(p,r)=>{var g;return o(),n("div",{class:N(["tw-group tw-flex tw-gap-2",{"tw-justify-end":l.value}])},[l.value?(o(),n("div",nt,[t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:_},r[2]||(r[2]=[t("i",{class:"fas fa-trash-alt"},null,-1)])),t("div",{class:"gray tw-cursor-pointer hover:tw-opacity-60 tw-transition-all",onClick:c},r[3]||(r[3]=[t("i",{class:"fas fa-edit"},null,-1)]))])):f("",!0),t("div",{class:N(["blank box rounded tw-flex-none tw-w-[80%] tw-flex tw-flex-col tw-gap-2",{"tw-bg-[var(--accent-color)] text-white":l.value}])},[b(st,{ref_key:"contenteditableRef",ref:m,editable:i.value,focusable:!0,value:u.message.comment||"",tag:"div",class:"small",onBlur:r[0]||(r[0]=C=>i.value=!1),onUpdate:w,onKeydown:r[1]||(r[1]=D(T(C=>{var s,a;return(a=(s=C.target)==null?void 0:s.blur)==null?void 0:a.call(s)},["stop"]),["esc"]))},null,8,["editable","value"]),t("div",lt,[e.value&&!l.value?(o(),n("div",it,[t("span",ct,[t("img",{src:(g=e.value)==null?void 0:g.photo_url,alt:""},null,8,rt)])])):f("",!0),e.value&&!l.value?(o(),n("div",ut,h(e.value.name),1)):f("",!0),t("div",dt,h(S(F)(u.message.create_datetime).format("ll")),1),typeof u.message.id=="number"?(o(),n("div",mt,r[4]||(r[4]=[t("i",{class:"fas fa-check fa-xs"},null,-1)]))):f("",!0)])],2)],2)}}}),ft={class:"tw-flex tw-flex-col tw-h-full"},vt={class:"tw-flex-auto tw-flex tw-flex-col tw-gap-3"},_t={class:"tw-flex-none tw-sticky tw-bottom-0 custom-py-12 pl-chat-input"},wt={class:"state-with-inner-icon right width-100"},ht=["placeholder"],kt=B({__name:"TaskInfoChat",props:{taskId:{}},emits:["update"],setup(v,{emit:u}){const y=u,d=v,m=U(),i=x(),l=x(""),e=I(()=>m.getComentsByTaskId(d.taskId));$(()=>d.taskId,c=>ot(c)&&m.fetch({item_id:c}),{immediate:!0}),$(e,async()=>{e.value.length&&(await E(),y("update"))},{immediate:!0}),q(()=>{i.value.focus()}),$(()=>d.taskId,()=>{i.value.focus()});const _=async()=>{if(!l.value)return;const c=await m.insert(d.taskId);c&&(m.updateItem(c,{comment:l.value}),l.value="",i.value.focus())};return(c,w)=>(o(),n("div",ft,[t("div",vt,[b(O,{name:"list"},{default:G(()=>[(o(!0),n(L,null,V(e.value,p=>(o(),J(pt,{key:p.uuid||p.id,message:p},null,8,["message"]))),128))]),_:1})]),t("div",_t,[t("div",wt,[W(t("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":w[0]||(w[0]=p=>l.value=p),type:"text",placeholder:c.$t("addComment"),class:"width-100 blank",onKeydown:D(_,["enter"])},null,40,ht),[[Y,l.value,void 0,{trim:!0}]]),t("button",{class:"icon",onClick:_},w[1]||(w[1]=[t("i",{class:"fas fa-arrow-right"},null,-1)]))])])]))}}),yt={key:0,class:"tw-flex tw-flex-col tw-h-full"},gt={class:"tw-flex tw-items-center tw-justify-between tw-flex-none custom-p-12"},bt={class:"pl-bg-block tw-flex-none custom-px-20 custom-pt-16 custom-mx-12"},xt={class:"custom-mb-24"},It={key:0,class:"custom-mb-12"},Ct={class:"flexbox middle space-8 wrap",title:"{{ $t('Created by') }}"},$t={class:"wide"},Tt={class:"small"},St={key:0,class:"hint custom-ml-4 tw-whitespace-nowrap"},Bt={key:1,class:"custom-mb-12"},Rt={key:2,class:"custom-mb-12"},Nt=["href"],Mt=["src"],Ut=["href"],Dt={class:"hint custom-ml-4"},At=B({__name:"TaskInfo",props:{taskId:{}},setup(v){const u=v,{t:y}=P(),d=Q(),m=x(),i=X(),l=M(),e=I(()=>i.getItemById(u.taskId)),_=I(()=>{var s;return(s=e.value)!=null&&s.contact_id?l.getItemById(e.value.contact_id):null});Z(document,"keydown",s=>{s.code==="Escape"&&c()});const c=()=>{const s=g();s&&d.push({name:s})},w=async()=>{var s;if((s=e.value)!=null&&s.id&&confirm(y("deleteTaskConfirmMessage"))){await i.deleteItem(e.value.id);const a=g();if(!a)return;d.replace({name:a})}},p=()=>{setTimeout(()=>{m.value.scrollTo({top:m.value.scrollHeight})},100)},r=async s=>{var a;(a=e.value)!=null&&a.id&&await i.updateItem(e.value.id,{note:s.trim()})};function g(){var s;return(s=[...d.currentRoute.value.matched].reverse().find(a=>a.meta.isListView))==null?void 0:s.name}function C(s){return new URL(Object.assign({"../assets/apps/shop.svg":A,"../assets/apps/tasks.svg":H})[`../assets/apps/${s}.svg`],import.meta.url).href}return(s,a)=>{var R;return e.value?(o(),n("div",yt,[t("div",gt,[t("a",{class:"back larger",onClick:T(c,["prevent"])},a[0]||(a[0]=[t("i",{class:"fas fa-arrow-circle-left"},null,-1)])),t("a",{class:"back custom-mr-4",onClick:T(w,["prevent"])},a[1]||(a[1]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))]),t("div",bt,[t("h3",null,h(e.value.name),1),t("div",xt,[b(at,{value:e.value.note||"","value-active":S(z)(e.value.note||""),placeholder:s.$t("addNote"),class:"hint",onUpdate:r},null,8,["value","value-active","placeholder"])]),_.value?(o(),n("div",It,[t("div",Ct,[t("span",{class:"icon userpic userpic-20",style:tt({backgroundImage:`url(${_.value.photo_url})`})},null,4),t("span",$t,[t("span",Tt,h(_.value.name),1),e.value.create_datetime?(o(),n("span",St,h(S(et)(e.value.create_datetime)),1)):f("",!0)])])])):f("",!0),e.value?(o(),n("div",Bt,[b(j,{task:e.value},null,8,["task"])])):f("",!0),(R=e.value.external_links)!=null&&R.length?(o(),n("div",Rt,[(o(!0),n(L,null,V(e.value.external_links,k=>(o(),n("div",{key:k.id},[t("a",{href:k.entity_link,class:"icon size-20",target:"_blank"},[t("img",{src:C(k.app)},null,8,Mt)],8,Nt),t("a",{class:"custom-ml-4 small bold",target:"_blank",href:k.entity_link},h(k.entity_title),9,Ut),t("span",Dt,h(k.app),1)]))),128))])):f("",!0)]),t("div",{ref_key:"containerRef",ref:m,class:"tw-flex-auto custom-p-12 custom-pb-0 tw-overflow-scroll hide-scrollbar"},[b(kt,{"task-id":e.value.id,onUpdate:p},null,8,["task-id"])],512)])):f("",!0)}}});export{At as default};
