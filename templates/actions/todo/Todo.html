<div class="shadowed">
    <nav class="sidebar left300px">

        <!-- CALENDAR -->
        <div class="pl-inner-sidebar">

            {foreach $days as $year => $months}
            {foreach $months as $month_name => $month}
            <div class="block double-padded align-center">
                <h5 class="heading">
                    [`{$month_name}`] {$year}
                </h5>
            </div>

            <!-- sample from Blog -->
            <table class="pl-calendar">
                <thead>
                <tr class="small">
                    {if $week_first_sunday}<th>{_ws('Sun')}</th>{/if}
                    <th>{_ws('Mon')}</th>
                    <th>{_ws('Tue')}</th>
                    <th>{_ws('Wed')}</th>
                    <th>{_ws('Thu')}</th>
                    <th>{_ws('Fri')}</th>
                    <th>{_ws('Sat')}</th>
                    {if !$week_first_sunday}<th>{_ws('Sun')}</th>{/if}
                </tr>
                </thead>
                <tbody>


                {foreach $month.weeks as $week}
                    <tr>
                    {foreach $week as $day}
                        <td data-pl-todo-date="{$day.date.date}" class="{if $day.date.month != $month.num}pl-not-this-month{/if} {if $day.date.month == $today_month && $day.date.day == $today &&  $month.num == $today_month}pl-today{/if} ui-droppable">
                            <span class="pl-date">{$day.date.day}</span>

                            <div class="pl-dots">
                                {foreach $day.pockets.gray as $pocket_color name=foo}{if $smarty.foreach.foo.index == 3}{break}{/if}<i class="icon10 color pl-dark-none"></i>{/foreach}<!--
                                -->{foreach $day.pockets.color as $pocket_color name=foo}{if $smarty.foreach.foo.index == 3}{break}{/if}<i class="icon10 color pl-dark-{$pocket_color}"></i>{/foreach}
                            </div>
                        </td>
                    {/foreach}
                    </tr>
                {/foreach}
                </tbody>

            </table>
            <!-- end of sample from Blog -->
            {/foreach} {*month*}
            {/foreach} {*year*}
            {*... показывать в календаре здесь 3 месяца подряд в одной таблице ...

            <br><br>

            в календаре сбоку цвет точки соответствует не приоритету, а цвету кармана.
            все выполненные МНОЙ задания вне зависимости от цвета кармана обозначаются точками серого цвета. задания, выполненные другими пользователями, в календарье не отмечаются.

            <br><br>

            в favorites интерфейс тот же, просто показываются только задания, отмеченные звездочкой*}


        </div>

    </nav>

    <!-- ITEMS -->
    <main class="content left300px blank bordered-left pl-items pl-list-items pl-blue pl-todo" id="pl-list-content">

        <header class="pl-title">
            <div class="float-right block half-padded">
                <ul class="menu-h">
                    <li>
                        <a href="#" id="pl-item-add-link"><i class="icon16 add"></i> [`Add to-do`]</a>
                    </li>
                </ul>
            </div>
            <h1 class="not-padded" pl-todo-stream="all">
                [`To-do stream`]
            </h1>
            <h1 class="not-padded" style="display: none;" pl-todo-stream="date">
                <span>December 8, 2015</span> <a href="#" class="back">[`Show stream`]</a>
            </h1>
        </header>

        <div class="pl-list-items" id="pl-list-items">
            <div class="align-center" id="pl-empty-list-msg" {if !empty($undone_items)}style="display:none;"{/if}>
                <h3>[`To-do stream is empty.`]</h3>
                <p>[`Stream automatically collects all important to-dos from your lists, and presents them in priority & due order.`]</p>
            </div>

            <section id="pl-undone-items">
                <ul class="menu-v">
                    {if !empty($undone_items)}
                    {include '../item/ItemCreate.html' parent_id=0 items=$undone_items}
                    {/if}
                </ul>
            </section>

            {if !empty($complete_items)}
            <section id="pl-complete-log" class="pl-logbook">
                <h5 class="heading">[`Logbook`]</h5>
                <ul class="menu-v">
                    {include '../item/ItemCreate.html' parent_id=0 items=$complete_items}
                </ul>
            </section>
            {/if}

        </div>

        <div class="clear-both"></div>

        {include '../../include/deltedialog.html' inline}

        {include '../../include/itemdetails.html' inline}

        {include '../../include/itemadd.html' inline}

    </main>
</div>

<script type="text/javascript">
    (function(){
        var $dates = $('[data-pl-todo-date]'),
            $stream_all_header = $('[pl-todo-stream="all"]'),
            $stream_date_header = $('[pl-todo-stream="date"]'),
            $all_items_wrapper = $('#pl-list-items'),
            $undone_items_wrapper = $('#pl-undone-items'),
            $complete_items_wrapper = $('#pl-complete-log');
        $dates.on('click', function() {
            var $this = $(this),
                date = $this.data('pl-todo-date');

            $dates.removeClass('pl-selected');
            $this.addClass('pl-selected');
            $.get('?module=json&action=getHumandate&date=' + date, function(r){
                if (r.status === 'ok') {
                    $stream_all_header.hide();
                    $stream_date_header.show().find('span').text(r.data);

                    $undone_items_wrapper
                            .find('[data-id]').slideUp().end()
                            .find('[data-pl-due-date="' + date + '"]').slideDown();
                    $complete_items_wrapper
                            .find('[data-id]').slideUp().end()
                            .find('[data-pl-complete-datetime^="' + date + '"]').slideDown();
                    $complete_items_wrapper.show();
                }
            }, 'json');
        });
        $stream_date_header.on('click', 'a', function(e) {
            e.preventDefault();
            $dates.removeClass('pl-selected');
            $stream_all_header.show();
            $stream_date_header.hide();

            $undone_items_wrapper.find('[data-id]').slideDown();
            $complete_items_wrapper.find('[data-id]').slideUp();
            $complete_items_wrapper.hide();
        });
        new $.pocketlists.Items($all_items_wrapper, {
            enableAddLinkOnHover: false,
            enableChangeLevel: false,
            enableSortItems: false,
            assignUser: parseInt('{$wa->user()->getId()}'),
            showMessageOnEmptyList: true
        });
    }());
</script>
