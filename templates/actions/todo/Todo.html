<div class="shadowed">
    <nav class="sidebar left300px">

        <!-- CALENDAR -->
        <div class="pl-inner-sidebar">

            {foreach $days as $year => $months}
            {foreach $months as $month_name => $month}
            <div class="block double-padded align-center">
                <h5 class="heading">
                    {_ws($month_name)} {$year}
                </h5>
            </div>

            <!-- sample from Blog -->
            <table class="pl-calendar">
                <thead>
                <tr class="small">
                    {if $week_first_sunday}<th>{_ws('Sun')}</th>{/if}
                    <th>{_ws('Mon')}</th>
                    <th>{_ws('Tue')}</th>
                    <th>{_ws('Wed')}</th>
                    <th>{_ws('Thu')}</th>
                    <th>{_ws('Fri')}</th>
                    <th>{_ws('Sat')}</th>
                    {if !$week_first_sunday}<th>{_ws('Sun')}</th>{/if}
                </tr>
                </thead>
                <tbody>


                {foreach $month.weeks as $week}
                    <tr>
                    {foreach $week as $day}
                        <td data-pl-todo-date="{$day.date.date}" class="{if $day.date.month != $month.num}pl-not-this-month{/if} {if $day.date.month == $today_month && $day.date.day == $today &&  $month.num == $today_month}pl-today{/if} ui-droppable">
                            <span class="pl-date">{$day.date.day}</span>

                            <div class="pl-dots">
                                {foreach $day.pockets.gray as $pocket_color name=foo}{if $smarty.foreach.foo.index == 3}{break}{/if}<i class="icon10 color pl-dark-none"></i>{/foreach}<!--
                                -->{foreach $day.pockets.color as $pocket_color => $item_dots}{foreach $item_dots as $dot name=foo}{if $smarty.foreach.foo.index == 3}{break}{/if}<i class="icon10 color pl-dark-{$pocket_color}"></i>{/foreach}{/foreach}
                            </div>
                        </td>
                    {/foreach}
                    </tr>
                {/foreach}
                </tbody>

            </table>
            <!-- end of sample from Blog -->
            {/foreach} {*month*}
            {/foreach} {*year*}

        </div>

    </nav>

    <!-- ITEMS -->
    <section id="pl-list-todo-items"></section>

</div>

<script type="text/javascript">
    (function(){
        $.pocketlists.setTitle('[`To-do stream`]');

        var getStream = function (date, filter) {
            $.get('?module=todo&action=date' + (date ? ('&date=' + date) : '') + (filter ? ('&filter=' + filter): ''), function (html) {
                $items_wrapper.html(html);
            });
        };
        getStream();

        var $dates = $('[data-pl-todo-date]'),
            $items_wrapper = $('#pl-list-todo-items');

        $dates.on('click', function() {
            var $this = $(this),
                date = $this.data('pl-todo-date');

            $dates.removeClass('pl-selected');
            $this.addClass('pl-selected');

            getStream(date);
        });
        $items_wrapper.on('click', '[pl-todo-stream="date"] a', function(e) {
            e.preventDefault();
            $dates.removeClass('pl-selected');

            getStream();
        });
    }());
</script>
