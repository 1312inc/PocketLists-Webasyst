<div class="pl-item{if !empty($item.assigned_contact_id) && $item.assigned_contact_id != $wa->user()->getId() && $item.status != 1} pl-item-assigned{/if}{if $item.status == 1} gray{/if}" {if $item.assigned_contact_id}data-pl-assigned-contact="{$item.assigned_contact_id}"{/if}>
    {if !$item.status && empty($item.key_list_id) && !(isset($archive) && $archive)}<div class="pl-item-drag-handle" title="[`Sort`]" data-pl-action="item-sort"></div>{/if}
    {if empty($item.key_list_id)}
    <div class="pl-meta">
        {if !(isset($archive) && $archive)}
            <a href="#" class="pl-favorite" data-pl-action="item-favorite" title="[`Favorite`]"><i class="icon16 star{if empty($item.favorite)}-empty{/if}"></i></a>
        {/if}
        {if $item.status == 1}
            {* completed by *}
            <span class="pl-author" title="{sprintf('[`Completed by %s`]', $item.complete_username|default:'%username%'|escape)}">
                {if isset($item.complete_userpic)}
                    <span class="hint">{$item.complete_datetime|wa_datetime:'humandatetime'}</span>
                    <i class="icon16 userpic20" style="background-image: url({$item.complete_userpic})" alt="{$item.complete_username|escape}"></i>
                {else}
                    <i class="icon16 userpic20"></i>
                {/if}
            </span>
        {else}
            {* item author userpic *}
            {* {if $item.contact_id != $wa->user()->getId()}
                <span class="pl-author" title="{sprintf('%s by %s', $item.create_datetime|wa_datetime:'humandatetime', $item.username|default:'%username%'|escape)}"><i class="icon16 userpic20" style="background-image: url({$item.userpic})" alt="{$item.username|escape}"></i></span>
            {/if} *}

            {* assigned to *}
            {if !empty($item.assigned_contact_id)}<span class="pl-assignee"><i class="icon16 userpic20" style="background-image: url({$item.assigned_userpic})" alt="{$item.assigned_username|escape}" title="{sprintf('[`Assigned to %s`]', $item.assigned_username|escape)}"></i></span>{/if}

        {/if}
        {if !(isset($archive) && $archive == true)}
            <a href="#" class="pl-edit inline-link"><b><i>[`Edit`]</i></b></a>
        {/if}
    </div>
    {/if}
    <label class="pl-done-label">
        {if !empty($item.key_list_id)}
            <i class="listicon48" style="background-image: url({$wa_url}wa-apps/pocketlists/img/listicons/{$item.list_icon|default:'li-list@2x.png'});"></i>
        {else}
            <input type="checkbox" class="pl-done{if isset($item.calc_priority)}{if $item.calc_priority == 1} pl-green{elseif $item.calc_priority == 2} pl-yellow{elseif $item.calc_priority == 3} pl-red{/if}{/if}" {if $item.status == 1}checked="checked"{/if}{if isset($archive) && $archive == true}disabled{/if}>
            <span></span>
        {/if}
    </label>
    <label class="pl-select-label">
        <input type="checkbox" class="pl-is-selected" {if isset($archive) && $archive == true || !empty($item.key_list_id)}disabled{/if}>
        <span class="pl-item-name">
            {if !empty($item.key_list_id)}
                <a href="#/list/{$item.list_id}/"><span class="pl-{$item.list_color}">{$item.name|default:' '|nl2br}</span></a>
            {else}
                {if $item.list_id != NULL}<a href="#/list/{$item.list_id}" class="pl-label pl-dark-{$item.list_color} pl-item-list-name">{$item.list_name|truncate:32|escape}</a>{/if}
                {$item.name|default:' '|nl2br}
                {* if $item.list_id == NULL && (empty($item.assigned_contact_id) || $item.assigned_contact_id == $wa->user()->getId())}<i class="icon10 lock-bw" title="[`Only you can see this item`]"></i>{/if *}
            {/if}
        </span>

        {if empty($item.key_list_id) && !(isset($archive) && $archive == true)}<a href="#" class="pl-comment{if !empty($item.chat.comments)} pl-comment-count{/if}" title="[`Comment`]"><i class="icon16 comments"></i>{if !empty($item.chat.comments)}{count($item.chat.comments)}{/if}</a>{/if}

        {if !empty($item.due_datetime)}
        <br>
        <span class="small bold {if $item.calc_priority == 0}pl-due-someday{elseif $item.calc_priority == 1}pl-due-tomorrow{elseif $item.calc_priority == 2}pl-due-today{elseif $item.calc_priority == 3}pl-due-overdue{/if}">{$item.due_datetime|wa_datetime:'humandatetime'}</span>
        {else if !empty($item.due_date)}
        <br>
        <span class="small bold {if $item.calc_priority == 0}pl-due-someday{elseif $item.calc_priority == 1}pl-due-tomorrow{elseif $item.calc_priority == 2}pl-due-today{elseif $item.calc_priority == 3}pl-due-overdue{/if}">{$item.due_date|wa_date:'humandate'}</span>
        {/if}
        {if $item.status != 1}
            {if !empty($item.assigned_contact_id)}<strong class="hint"><br>{sprintf('[`Assigned to %s`]', $item.assigned_username|escape)}</strong>{/if}
            {* <i class="icon16 userpic20" style="background-image: url({$item.assigned_userpic})" alt="{$item.assigned_username|escape}"></i> *}
            {if !empty($item.note)}<p class="hint">{$item.note|nl2br}</p>{/if}
            {if !empty($item.attachments)}
              <ul class="pl-attachments">
                {foreach $item.attachments as $attachment}
                  {if $attachment.filetype == 'image'}<li><a href="{$attachments_path}/{$item.id}/{$attachment.filename}" target="_blank"><img src="{$attachments_path}/{$item.id}/{$attachment.filename}"></a></li>
                  {else}<li><a href="{$attachments_path}/{$item.id}/{$attachment.filename}" target="_blank"><i class="icon16 download"></i>{$attachment.filename|truncate:128}</a></li>
                  {/if}
                {/foreach}
              </ul>
            {/if}
        {/if}
        <div class="pl-chat" {if empty($item.chat.comments)} style="display:none;"{/if}>
            {foreach $item.chat.comments as $comment}
                {include '../comment/Comment.html' comment=$comment inline}
            {/foreach}
            <div class="pl-reply"{if $item.status} style="display:none;"{/if}>
                <i class="icon16 userpic20" style="background-image: url({$item.chat.current_user.userpic})" alt="{$item.chat.current_user.username|escape}"></i>
                <textarea rows="1" placeholder="[`Add comment`]"></textarea>
            </div>
        </div>
    </label>
</div>
