{if isset($list.id) && $print}
<html>
<head>
    <title>{$list.name} &mdash; {$wa->accountName()}</title>
    <link type="text/css" rel="stylesheet" href="{$wa_app_static_url}css/pocketlists-print.css">
</head>
<body>
    <div class="pl-print-button">
        <button onclick="window.print();">[`Print`]</button>
    </div>
{/if}

{if !$print}
<nav class="pl-inner-sidebar" data-pl="uho">
{if isset($list.id)}
    {if !$archive}
    <a class="pl-link-box bold" href="#" data-pl-action="list-sort">
        <i class="icon16 update"></i> [`Re-sort list`]
    </a>
    <div class="block double-padded">
        {if pocketlistsRBAC::canAssign()}
        <div class="pl-list-access">

            <h5 class="heading">[`Access`]</h5>
            {foreach $list_access_contacts as $list_access_contact_id => $list_access_contact}

                <div class="profile image32px">
                    <div class="image">
                        <a href="{$wa_backend_url}pocketlists/#/{if $list_access_contact.me}todo{else}team/{$list_access_contact.login}{/if}/"><img class="userpic" src="{$list_access_contact.photo_url}"></a>
                    </div>
                    <div class="details">
                        <span class="pl-username">
                            <a href="{$wa_backend_url}pocketlists/#/{if $list_access_contact.me}todo{else}team/{$list_access_contact.login}{/if}/">{$list_access_contact.username|default:'%username%'|escape} {if $list_access_contact.me}([`me`]){/if}</a>
                            <span class="bold">
                                {if $list_access_contact.status == 'online'}
                                    <i class="icon10 online" title="[`Online`]"></i>
                                {/if}
                            </span>
                        </span>
                        <div class="hint">{$list_access_contact.teamrole|escape}</div>
                    </div>
                </div>

            {/foreach}
            <p class="hint">[`Use Team app to configure access to this to-do list: select a user or a group of users and enable access to this particular list.`]</p>
        </div>

        <hr>
        {/if}

        <h5 class="heading">[`To-do list`]</h5>
        <ul class="menu-v with-icons">
            <li>
                <a href="#" data-pl-action="list-email"><i class="icon16 email"></i>[`Email list`]</a>
            </li>
            <li>
                <a href="?module=list&amp;id={$list.id}&amp;print=true" target="_blank"><i class="icon16 print"></i>[`Print list`]</a>
            </li>
            <li>
                <a href="#" data-pl-action="list-archive"><i class="icon16 pl archive"></i>[`Archive list`]</a>
            </li>
            <li>
                <a href="#" data-pl-action="list-edit"><i class="icon16 edit"></i>[`Edit list details`]</a>
            </li>
        </ul>
    </div>

    <a class="pl-link-box pl-delete-box" href="#" data-pl-action="list-delete">
        <i class="icon16 delete"></i> [`Delete list`]
    </a>

    {else}
    <div class="block">
        <div>
            <a href="#" data-pl-action="list-unarchive" class="bold"><i class="icon16 pl archive"></i> [`Unarchive list`]</a>
        </div>
        <div>
            <a href="#" data-pl-action="list-delete"><i class="icon16 delete"></i> [`Delete`]</a>
        </div>
    {/if}
    </div>
{/if}
{include '../../include/listdetails.html' inline}
{include '../../include/itemdetails.html' inline}
</nav>
{/if}

<main id="pl-list-content" class="pl-list-content">

    <div class="pl-inner-content pl-items shadowed pl-{$list.color|default:'none'}">
    <header class="pl-list-title pl-title">

        <div class="float-right">
        <ul class="menu-h">
            {if !$new && !$archive}
                <li>
                    <a href="#" class="pl-edit pl-list-due" title="{sprintf('[`Due %s`]', $list.due_date|wa_date:'humandate')}" data-pl-action="list-edit" {if empty($list.due_date) && empty($list.due_datetime)}style="display:none"{/if}>

                        <i class="icon16 exclamation"></i>
                        <span class="bold {if $list.calc_priority == 0}pl-due-someday{elseif $list.calc_priority == 1}pl-due-tomorrow{elseif $list.calc_priority == 2}pl-due-today{elseif $list.calc_priority == 3}pl-due-overdue{/if}" data-pl-list="due-date">
                            {if !empty($list.due_datetime)}
                                {$list.due_datetime|wa_datetime:'humandatetime'}
                            {else if !empty($list.due_date)}
                                {$list.due_date|wa_date:'humandate'}
                            {/if}
                        </span>

                    </a>

                    <a href="#" class="pl-edit inline-link" data-pl-action="list-edit" {if !empty($list.due_date) || !empty($list.due_datetime)}style="display:none"{/if}><b><i>[`Edit`]</i></b></a>
                </li>
            {/if}
            <li class="pl-list-favorite">
               <a href="#" data-pl-action="list-favorite" title="[`Favorite`]"><i class="icon16 star{if !$list.favorite}-empty{/if}"></i></a>
           </li>
        </ul>
        </div>

        <h1>
            <input type="hidden" value="{$list.id|default:-1}" id="pl-list-id">
            {if !$archive}
            <label class="pl-done-label">
                <input type="checkbox" class="pl-done" id="pl-list-complete"{if $print} disabled="disabled"{/if}>
                <span></span>
            </label>
            {/if}
            {if $new && !$archive}
                <input type="text" placeholder="[`New list`]" id="pl-new-list-input" class="bold" />
            {else}
                <span id="pl-list-name">{$list.name|default:' '|escape}</span>
            {/if}
        </h1>
    </header>
    <div class="pl-list-items" id="pl-list-items">

        <section id="pl-undone-items" data-pl-items="undone">
            <ul class="menu-v">
            {if !empty($items)}
                {include '../item/Item.html' parent_id=0 items=$items}
            {/if}
            </ul>
        </section>

        <!-- completed to-dos log -->
        <section id="pl-complete-log" class="pl-logbook">
            <h5 class="heading">[`Logbook`]</h5>
            <ul class="menu-v">
            {if !empty($items_done)}
                {include '../item/Item.html' items=$items_done}
            {/if}
            </ul>
        </section>

        <a href="#" id="pl-complete-log-link" class="inline-link gray" {if empty($items_done)}style="display:none;"{/if}><b><i>{_w('Show all %d completed to-do', 'Show all %d completed to-dos', $count_items_done)}</i></b></a>
    </div>
    <div class="clear-both"></div>

    {if !$print}

        {include '../../include/archivelistdialog.html' inline}
        {include '../../include/deletelistdialog.html' inline}
        {include '../../include/itemadd.html' inline}

    {/if}
</div>

</main>

{if isset($list.id) && $print}
</body>
</html>
{else}
<script type="text/javascript">
    new $.pocketlists.Items($('#pl-list-items'), {
        enableChangeLevel: false,
        archive: {if $archive}true{else}false{/if},
        list: new $.pocketlists.List(
                $('.pl-list-title'),
                {
                    archive: {if $archive}true{else}false{/if}
                }),
        current_user_id: {$wa->user()->get('id')}
    });
    $.pocketlists.setTitle('{if isset($list.name)}{$list.name|default:" "|escape}{else}[`New list`]{/if}');
</script>
{/if}
