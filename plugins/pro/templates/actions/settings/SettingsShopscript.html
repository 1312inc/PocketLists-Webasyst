<h1>[`Shop-Script`]</h1>
<p>[`Set up the automation rules to make Pocket Lists automatically create and assign to-dos based on actions performed with Shop-Script orders.`]</p>

<h2><em><span style="background: gold;">Скоро!</span> Этот интерфейс заработает в Pocket Lists PRO версии 1.1.0. Релиз — сентябрь/октябрь 2019 года.</em></h2>
<br><br>

<div class="fields form" style="position: relative;">
    {foreach $shopActions as $action}
    <div class="field" data-pl2pro-ss-event="{$action.id}">
        {$action|wa_dumpc}
        <div class="name">
{*            <i class="icon16 color" style="background: #{$action.info.options.style.color|substr:'1'|lower};"></i>*}
            [`{$action.name}`]
        </div>
        <div class="value">
            <div class="block">
                <a href="#" class="inline-link pl2pro-ss-add-rule" data-pl2pro-action="automation-add-rule"><i class="icon16 add"></i><b><i>[`Add rule`]</i></b></a>
            </div>
        </div>
    </div>
{/foreach}
</div>

<hr>

<div class="fields form" style="position: relative;">
    <div class="field">
        <div class="name">
            [`New order`]
        </div>
        <div class="value">
            <div class="pl2pro-rule-baloon">
                <div class="pl2pro-rule-header">
                    <a href="#" class="inline-link pl2pro-label-edit"><i class="icon10 edit"></i> <b><i>[`Edit`]</i></b></a>
                    <span class="pl2pro-rule-if">[`IF`]</span>
                    [`ALL`]
                </div>
                <div class="pl2pro-rule-body">
                    <h4>Позвонить {literal}{$customer_name}{/literal}</h4>
                    <span class="hint">[`Assigned to`]:</span> RANDOM ( Менеджеры )<br>
                    <span class="hint">[`Priority`]:</span> [`Normal`]<br>
                    <span class="hint">[`Due`]:</span> + 5 минут<br>
                    <span class="hint">[`List`]:</span> [`None`]<br>

                </div>
            </div>
        </div>
        <div class="value">
            <div class="pl2pro-rule-baloon">
                <div class="pl2pro-rule-header">
                    <a href="#" class="inline-link pl2pro-label-edit"><i class="icon10 edit"></i> <b><i>[`Edit`]</i></b></a>
                    <span class="pl2pro-rule-if">[`IF`]</span>
                    <strong>
                        [`Amount`] >= 100000 RUB
                    </strong>
                </div>
                <div class="pl2pro-rule-body">
                    <h4>Проверить контрагента {literal}{$customer_name}{/literal}</h4>
                    <span class="hint">[`Assigned to`]:</span> RANDOM ( Бухгалтерия )<br>
                    <span class="hint">[`Priority`]:</span> [`Urgent`]<br>
                    <span class="hint">[`Due`]:</span> [`Now`]<br>
                    <span class="hint">[`List`]:</span> [`None`]<br>

                </div>
            </div>
        </div>
        <div class="value">
            <div class="block">
                <a href="#" class="inline-link pl2pro-ss-add-rule"><i class="icon16 add"></i><b><i>[`Add rule`]</i></b></a>
            </div>
        </div>
    </div>

    <div class="field">
        <div class="name">
                                    <span class="pl2pro-ss-order-action">
                                        <i class="icon16 color" style="background-color: limegreen;"></i>
                                        В обработку
                                    </span>
        </div>
        <div class="value">
            <div class="block gray">
                {sprintf('[`No automation rules are defined for the ‘%s’ order action`]','В обработку')}
            </div>
            <div class="block">
                <a href="#" class="inline-link pl2pro-ss-add-rule"><i class="icon16 add"></i><b><i>[`Add rule`]</i></b></a>
            </div>
        </div>
    </div>

    <div class="field">
        <div class="name">
                                    <span class="pl2pro-ss-order-action">
                                        <i class="icon16 color" style="background-color: #09f;"></i>
                                        Отправлен
                                    </span>
        </div>
        <div class="value">
            <div class="pl2pro-rule-baloon">
                <div class="pl2pro-rule-header"">
                <a href="#" class="inline-link pl2pro-label-edit"><i class="icon10 edit"></i> <b><i>[`Edit`]</i></b></a>
                <span class="pl2pro-rule-if">[`IF`]</span>
                <strong>
                    [`Shipping`] = Почта России
                </strong>
                <span class="pl2pro-rule-if">[`AND`]</span>
                <strong>
                    [`Payment`] = Наложенный платеж
                </strong>
            </div>
            <div class="pl2pro-rule-body">
                <h4>Проверить трек-номер {literal}{$tracking_number}{/literal}</h4>
                <span class="hint">[`Assigned to`]:</span> [`Order action performer`]<br>
                <span class="hint">[`Priority`]:</span> [`Normal`]<br>
                <span class="hint">[`Due`]:</span> + 7 дней<br>
                <span class="hint">[`List`]:</span> [`None`]<br>

            </div>
        </div>
    </div>
    <div class="value">
        <div class="pl2pro-rule-baloon">
            <div class="pl2pro-rule-header"">
            <a href="#" class="inline-link pl2pro-label-edit"><i class="icon10 edit"></i> <b><i>[`Edit`]</i></b></a>
            <span class="pl2pro-rule-if">[`IF`]</span>
            <strong>
                [`Shipping`] = СДЭК
            </strong>
        </div>
        <div class="pl2pro-rule-body">
            <h4>Проверить трек-номер {literal}{$tracking_number}{/literal}</h4>
            <span class="hint">[`Assigned to`]:</span> [`Order action performer`]<br>
            <span class="hint">[`Priority`]:</span> [`Normal`]<br>
            <span class="hint">[`Due`]:</span> + 5 дней<br>
            <span class="hint">[`List`]:</span> [`None`]<br>

        </div>
    </div>
</div>
<div class="value">
    <div class="block">
        <a href="#" class="inline-link pl2pro-ss-add-rule"><i class="icon16 add"></i><b><i>[`Add rule`]</i></b></a>
    </div>
</div>
</div>

<div class="field">
    <div class="name">
                                    <span class="pl2pro-ss-order-action">
                                        <i class="icon16 color" style="background-color: rebeccapurple;"></i>
                                        Выполнен
                                    </span>
    </div>
    <div class="value">
        <div class="block gray">
            {sprintf('[`No automation rules are defined for the ‘%s’ order action`]','Выполнен')}
        </div>
        <div class="block">
            <a href="#" class="inline-link pl2pro-ss-add-rule"><i class="icon16 add"></i><b><i>[`Add rule`]</i></b></a>
        </div>
    </div>
</div>
</div>



<div class="clear-both"></div>

<script>
    $.pocketlists.setTitle();

    $('[data-pl2pro-action="automation-add-rule"]').click(function(){
        $('#pl2pro-dialog').waDialog({
            url: '?plugin=pro&module=settings&action=shopscriptDialog&event='+ $(this).closest('[data-pl2pro-ss-event]').data('pl2pro-ss-event'),
            onLoad: function () {
            },
            onSubmit: function (d) {

                return false;
            },
            onClose: function () {
                this.remove();
            }
        });
        return false;
    });
</script>
