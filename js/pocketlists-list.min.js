(function(){var j=function(p){var n=p.find("#pl-new-list-input"),o=parseInt(p.find("#pl-list-id").val()),u=parseInt($("#pl-pocket-id").val()),k=$("#pl-dialog-delete-confirm"),l=$("#pl-dialog-list-archive-complete-all");var w=function(y){var x={name:n.val().trim(),type:"checklist",pocket_id:u};if(x.name){$.post("?module=list&action=update",{data:x,id:y},function(z){if(z.status==="ok"){if(o===-1){$.wa.setHash("#/pocket/"+u+"/list/"+z.data.id+"/")}}else{}},"json")}};var s=function(){var x=p.find('[class*="star"]');$.post("?module=list&action=favorite",{id:o,status:x.hasClass("star-empty")?1:0},function(y){if(y.status==="ok"){x.toggleClass("star-empty star")}else{alert(y.errors)}},"json")};var t=function(){k.waDialog({height:"150px","min-height":"150px",width:"400px",onLoad:function(){},onSubmit:function(x){$.post("?module=list&action=delete",{list_id:o},function(y){if(y.status==="ok"){x.trigger("close");$.wa.setHash("#/pocket/1/")}else{}},"json");return false}})};var m=function(){$.post("?module=list&action=archive",{list_id:o,archive:1},function(x){if(x.status==="ok"){$.wa.setHash("#/pocket/1/")}else{}},"json")};var r=function(){$.post("?module=list&action=sort",{list_id:o},function(x){if(x.status==="ok"){$.pocketlists_routing.redispatch()}else{}},"json")};var q=function(){p.removeData("pl-clicked")};var v=function(){if(n.length){n.focus();n.on("keydown",function(x){if(x.which===13){x.preventDefault();w(o)}})}p.on("click",function(y){var x=p.data("pl-clicked");if($(y.target).closest(".pl-done-label").length){return}if(x==1){p.data("pl-clicked",2);$.pocketlists.scrollToTop(200,80);f.trigger("show.pl2")}else{if(x==2){f.trigger("hide.pl2");q()}else{p.data("pl-clicked",1)}}}).on("click",'[data-pl-action="list-delete"]',function(x){x.preventDefault();t()}).on("click",'[data-pl-action="list-archive"]',function(x){x.preventDefault();m()}).on("click",'[data-pl-action="list-sort"]',function(x){x.preventDefault();r()}).on("click",'[data-pl-action="list-favorite"]',function(x){x.preventDefault();s()}).find("#pl-list-complete").on("click",function(x){x.stopPropagation();l.waDialog({height:"150px","min-height":"150px",width:"400px",onLoad:function(){var y=$(this);y.on("click","[data-pl-action]",function(B){B.preventDefault();var A=$(this),z=A.data("pl-action");A.after(h);if(z==="list-complete-all"){$.post("?module=item&action=complete",{list_id:o,status:1,id:-1},function(C){if(C.status==="ok"){y.trigger("close");$.pocketlists_routing.redispatch()}else{}},"json")}else{if(z==="list-archive"){$.post("?module=list&action=archive",{list_id:o,archive:1},function(C){if(C.status==="ok"){y.trigger("close");$.wa.setHash("#/pocket/"+u)}else{}},"json")}else{if(z==="cancel"){$("#pl-list-complete").prop("checked",false);y.trigger("close");h.remove()}}}})}})}).on("deleteList.pl2",t).on("deselectList.pl2",q)};v();return{list_id:o,pocket_id:u,$el:p}};var c=function(u){var w=u.find("#pl-undone-items > ul.menu-v"),x=$("#pl-undone-items ul.menu-v"),m=u.find("#pl-complete-log > ul.menu-v"),G=$("#pl-item-add").detach(),p=G.find("textarea"),E=$('<div id="pl-item-add-wrapper-hover" style="display: none;">'),v="[data-parent-id]",s=$("#pl-item-add-link"),F=null;var k=function(){x.sortable({item:v,connectWith:"ul.menu-v",placeholder:"pl-item-placeholder",tolerance:"pointer",stop:function(K,M){var J=M.item.parents(v).first(),L=J.length?parseInt(J.data("id")):0;M.item.data("parent-id",L);n(parseInt(M.item.data("id")))}})};var D=function(J,L){var K=$(this);$.post("?module=item&action=create",{list_id:e.list_id,data:J},function(N){var O=K.closest(v);var M=$(""+N+"");p.data("can_blur",false);if(O.length){if(!O.parents(v).length||G.prev(".pl-item").length){O.after(M)}else{O.before(M)}}else{w.prepend(M)}M.filter(v).last().find(".pl-item").first().after(G);$(".pl-list-empty").removeClass("pl-list-empty");p.val("").trigger("focus").css("height","auto").data("can_blur",true);$.isFunction(L)&&L.call(K);o();n()})};var l=function(){var J=[];w.find(v).each(function(K){var L=$(this);J.push({id:L.data("id"),parent_id:L.data("parent-id"),sort:K,has_children:L.find(v).length?1:0})});return J};var n=function(J){$.post("?module=item&action=sort",{list_id:e.list_id,item_id:J?J:0,data:l()},function(K){if(K.status==="ok"){k()}else{alert(K.errors)}},"json")};var H=function(K,J,M){var L=parseInt(K.data("id"));K.prop("disabled",true);$.post("?module=item&action=complete",{list_id:list_id,id:L,status:J},function(N){if(N.status==="ok"){$.pocketlists.updateAppCounter();K.find("ul.menu-v").find(":checkbox").prop("checked",J);K.find(".pl-done").prop("disabled",false);K.find(".pl-item-name").toggleClass("gray");setTimeout(function(){K.slideToggle(200,function(){K.show();if(J){m.append(K)}else{w.append(K);n()}o();$("#pl-complete-log-link").find("i").text($_("Show all "+m.find("[data-id]").length+" completed to-dos"));M&&$.isFunction(M)&&M.call(K)})},800)}else{alert(N.errors)}h.remove()},"json")};var A=function(J){if(F){J.preventDefault();J.stopPropagation();F.each(function(){var M=$(this),L=M.prev(v);if(L.length){var N=parseInt(L.data("id"));M.data("parent-id",N);var K=L.find("ul.menu-v").first();if(K.length){K.append(M)}else{L.append($('<ul class="menu-v">').html(M))}n(parseInt(M.data("id")))}})}};var z=function(J){if(F){J.preventDefault();J.stopPropagation();F.each(function(){var L=$(this),K=L.parents(v).first();if(K.length){var N=parseInt(K.data("parent-id"));L.data("parent-id",N);var M=L.nextAll(),O=L.find("ul.menu-v");if(!O.length){O=$('<ul class="menu-v">');L.append(O)}O.append(M);K.after(L);n(parseInt(L.data("id")))}})}};var B=function(J){var K=J.find('[class*="star"]'),L=parseInt(J.data("id"));$.post("?module="+type+"&action=favorite",{id:L,status:K.hasClass("star-empty")?1:0},function(M){if(M.status==="ok"){K.toggleClass("star-empty star")}else{alert(M.errors)}},"json")};var r=function(J){F=J;if(F){var K=F.find(".pl-item").first();u.find(".pl-item").removeClass("pl-item-selected");K.addClass("pl-item-selected");F.prop("checked",true)}};var t=function(){if(F){u.find(".pl-item").removeClass("pl-item-selected");F.prop("checked",false);F=null}};var I=function(J){u.find('[data-id="'+J+'"]').remove()};var y=function(J){if(F){F.find(".pl-item").first().replaceWith($(J).addClass("pl-item-selected"))}};var o=function(){$("#pl-lists").find('[data-pl-list-id="'+e.list_id+'"]').find(".count").text(w.find("[data-id]").length)};var q=function(){var K=function(){p.css("height","auto");p.css("height",(p.get(0).scrollHeight-parseInt(p.css("padding-top"))-parseInt(p.css("padding-bottom")))+"px")};var J=function(){G.slideUp(200,function(){G.detach();$(".pl-new-item-wrapper").remove();p.val("")})};var L=function(){s.on("click",function(O){O.preventDefault();O.stopPropagation();function N(){G.prependTo(w).slideDown(200,function(){p.focus()}).wrap('<li class="pl-new-item-wrapper">')}if(G.is(":visible")){G.slideUp(200,function(){G.detach();$(".pl-new-item-wrapper").remove();N()})}else{N()}});if($(".pl-list-empty").length){s.trigger("click")}p.on("change cut keydown drop paste",function(){window.setTimeout(K,0)}).on("keydown",function(Q){var P=$(this);P.data("can_blur",true);if(!Q.shiftKey&&Q.which===13){Q.preventDefault();var O=P.closest(".menu-v").find(v).first().data("parent-id"),N=P.val().trim();if(N){D.call(this,[{name:N,parent_id:O}])}}else{if(Q.which===27){J()}}}).on("paste",function(){var O=$(this).closest(".menu-v").find(v).first().data("parent-id");var N=this;setTimeout(function(){var P=p.val().split(/\n/);var S=[];if(P.length>1){for(var R=0;R<P.length;R++){var Q=$.trim(P[R]);if(Q){S.push({name:Q,parent_id:O})}}D.call(N,S)}},100)}).on("blur",function(){var Q=$(this),P=Q.closest(".menu-v").find(v).first().data("parent-id"),O=Q.val().trim(),N=Q.data("can_blur");if(N){if(O){D.call(this,[{name:O,parent_id:P}],J)}else{J()}}});var M=null;w.on("mouseenter",v+" > .pl-item",function(O){O.stopPropagation();var N=$(this);M=setTimeout(function(){if(!N.find(G).length){N.find(".pl-select-label").append(E.show())}},500)}).on("mouseleave",v+" > .pl-item",function(){clearTimeout(M);E.detach()});E.on("click",function(){var N=$(this);var O=N.closest(v).find(".menu-v");p.data("can_blur",false);if(O.length){O.find(".pl-item").first().before(G)}else{N.closest(v).find(".pl-item").first().after(G)}E.detach();G.slideDown(200);p.focus();p.data("can_blur",true)})};L()};var C=function(){if($.pocketlists_routing.getHash()=="#/todo/"&&$.pocketlists_routing.getHash().indexOf("/team/")>0){G.prependTo(w).slideDown(200).wrap('<li class="pl-new-item-wrapper">');p.focus()}k();new q();u.on("change",".pl-done",function(){var L=$(this),K=L.closest(v),J=L.is(":checked")?1:0;H(K,J)}).on("change",".pl-is-selected",function(M){var L=$(this),J=L.closest(v);var K=b.is(":visible"),N=(F&&F.data("id")==J.data("id"))?true:false;M.preventDefault();if(!J.find("#pl-item-add").length){if(!K&&!N){b.trigger("hide.pl2");r(J)}else{if(!K){b.trigger("show.pl2",[parseInt(J.data("id"))]);r(J)}else{b.trigger("hide.pl2");t()}}}}).on("click",".pl-favorite",function(L){L.preventDefault();var K=$(this),J=K.closest(v);B(J)}).on("increaseSelectedItem.pl2",function(J){A(J)}).on("decreaseSelectedItem.pl2",function(J){z(J)}).on("deselectItem.pl2",t).on("removeItem.pl2",function(J,K){I(K)}).on("replaceSelectedItem.pl2",function(K,J){y(J)})};C();return u};var d=function(o){var r=e.list_id,n=null;var q=function(){o.on("submit","form",function(t){t.preventDefault();var s=$(this);s.find("#pl-list-details-save").after(h);$.post("?module=list&action=save",s.serialize(),function(u){h.remove();if(u.status==="ok"){l();m()}else{o.find(".error").show().delay(3000).hide()}},"json");return false}).on("click","#pl-list-details-cancel",function(s){s.preventDefault();m()}).on("click","#pl-list-color a",function(s){s.preventDefault();$("#pl-list-color").find("input").val($(this).data("pl-list-color"));$(this).addClass("selected").siblings().removeClass("selected")}).on("click","#pl-list-due-datetime-set",function(t){t.preventDefault();var s=$(this);s.hide().siblings().show().filter("select").prop("disabled",false)}).on("click","#pl-list-due-datetime-clear",function(t){t.preventDefault();var s=$(this);s.hide().siblings().show().filter("select").hide().prop("disabled",true)}).on("click","#pl-list-icon-change a",function(t){t.preventDefault();var s=$(this);$("#pl-list-icon-dialog").waDialog({onLoad:function(){var u=$(this);$("#pl-list-icon-dialog").on("click","a[data-pl-list-icon]",function(x){x.preventDefault();var v=$(this).data("pl-list-icon"),w=$(this);o.find("#pl-list-icon-change").find("input").val($(this).data("pl-list-icon"));w.find("input").val(v);o.find("#pl-list-icon-change .listicon48").css("background-image","url("+n+v+")");u.trigger("close");return false})}})}).on("show.pl2",k).on("hide.pl2",m)};var k=function(){$.pocketlists.scrollToTop(200,80);o.html(h).show();i();$.post("?module=list&action=details",{id:r},function(s){o.html(s);p()})};var m=function(){o.hide().empty()};var l=function(){var t=o.find('input[name="list[name]"]').val(),s=o.find("[data-pl-list-color].selected").data("pl-list-color"),u=o.find('input[name="list[icon]"]').val();$("#pl-list-name").text(t);$("#pl-lists").find('[data-pl-list-id="'+r+'"]').removeClass().addClass("pl-"+s).find(".pl-list-name").text(t).end().find(".listicon48").css("background-image","url("+n+u+")");$(".pl-items").removeClass().addClass("pl-items pl-"+s)};var p=function(){var s={changeMonth:true,changeYear:true,shortYearCutoff:2,dateShowWeek:false,showOtherMonths:true,selectOtherMonths:true,stepMonths:1,numberOfMonths:1,gotoCurrent:true,constrainInput:false};o.find("#pl-list-due-datetime").datepicker(s);n=o.find("#pl-list-icon-dialog").find("ul").data("pl-icons-path")};q();return o};var a=function(n){var q=0,k=$("#pl-dialog-delete-confirm");var p=function(){n.on("submit","form",function(s){s.preventDefault();var r=$(this);r.find("#pl-item-details-save").after(h);$.post("?module=item&action=data",r.serialize(),function(t){$.pocketlists.updateAppCounter();h.remove();g.trigger("replaceSelectedItem.pl2",[t]);m()});return false}).on("click","#pl-item-details-cancel",function(r){r.preventDefault();m()}).on("click","#pl-item-priority a",function(r){r.preventDefault();$("#pl-item-priority").find("input").val($(this).data("pl-item-priority"));$(this).addClass("selected").siblings().removeClass("selected")}).on("click","#pl-item-due-datetime-set",function(s){s.preventDefault();var r=$(this);r.hide().siblings().show().filter("select").prop("disabled",false)}).on("click","#pl-item-due-datetime-clear",function(s){s.preventDefault();var r=$(this);r.hide().siblings().show().filter("select").hide().prop("disabled",true)}).on("click",'[data-pl-action="item-delete"]',function(r){r.preventDefault();k.waDialog({height:"150px","min-height":"150px",width:"400px",onLoad:function(){},onSubmit:function(s){$.post("?module=item&action=delete",{id:q,list_id:e.list_id},function(t){if(t.status==="ok"){g.trigger("deselectItem.pl2",[t.data.id]);m();s.trigger("close")}else{}},"json");return false}})}).on("change","#pl-assigned-contact select",function(){var r=$(this).val();$("#pl-assigned-contact").find('[data-pl-contact-id="'+r+'"]').show().siblings().hide()}).on("show.pl2",function(r,s){l(s)}).on("hide.pl2",m)};var m=function(){n.hide().empty();q=0;g.trigger("deselectItem.pl2")};var l=function(r){q=r;n.html(h).show();i();$.post("?module=item&action=details",{id:q},function(s){n.html(s);o()})};var o=function(){var r={changeMonth:true,changeYear:true,shortYearCutoff:2,dateShowWeek:false,showOtherMonths:true,selectOtherMonths:true,stepMonths:1,numberOfMonths:1,gotoCurrent:true,constrainInput:false};n.find("#pl-item-due-datetime").datepicker(r)};p();return n};$(document).on("keydown",function(k){switch(k.which){case 9:if(!b.is(":visible")&&!f.is(":visible")){if(k.shiftKey){g.trigger("decreaseSelectedItem.pl2")}else{g.trigger("increaseSelectedItem.pl2")}}break;case 27:f.is(":visible")&&f.trigger("hide.pl2");b.is(":visible")&&b.trigger("hide.pl2");break}});$("#pl-complete-log-link").click(function(){$("#pl-complete-log").slideDown(200);$(this).slideUp(200);return false});function i(){var n=$("#pl-list-content").offset().top;var m=$(window).scrollTop();var k=$(window).height();if($(".pl-details .fields form").height()>k){return}if(m>n){$(".pl-details").addClass("sticky");var l=$(document).height()-k-m;$(".pl-details").css("bottom",Math.max(0,16-l)+"px")}else{$(".pl-details").removeClass("sticky")}}$(window).scroll(function(){i()});var h=$('<i class="icon16 loading">');var g=new c($("#pl-list-items"));var e=new j($(".pl-list-title"));var b=new a($("#pl-item-details"));var f=new d($("#pl-list-details"))}());