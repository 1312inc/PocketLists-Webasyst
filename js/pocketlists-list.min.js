(function(a){a.pocketlists.List=function(i,r){var f=i.find("#pl-new-list-input"),g=parseInt(i.find("#pl-list-id").val()),n=parseInt(a("#pl-pocket-id").val()),b=a("#pl-dialog-delete-list-confirm"),d=a("#pl-dialog-list-archive-complete-all"),c=a.extend({},{archive:false},r);var m=(function(v){var u=null;var o=function(){a.pocketlists.scrollToTop(200,80);v.html(a.pocketlists.$loading).show().animate({right:"0%"},200);a.pocketlists.stickyDetailsSidebar();a.post("?module=list&action=details",{id:g},function(y){v.html(y);x()})};var t=function(){v.animate({right:"-100%"},200,function(){v.hide().empty()})};var s=function(y){i.find("#pl-list-name").text(y.name);if(y.due_date||y.due_datetime){var z="pl-due-someday";if(y.calc_priority==1){z="pl-due-tomorrow"}else{if(y.calc_priority==2){z="pl-due-today"}else{if(y.calc_priority==3){z="pl-due-overdue"}}}i.find(".pl-list-due").removeClass().addClass("pl-list-due "+z).text(y.due_datetime?y.due_datetime:y.due_date).show()}else{i.find(".pl-list-due").hide()}a("#pl-lists").find('[data-pl-list-id="'+g+'"]').removeClass().addClass("pl-"+y.color).find(".pl-list-name").text(y.name).end().find(".listicon48").css("background-image","url("+u+y.icon+")");a(".pl-items").removeClass().addClass("pl-items pl-"+y.color)};var x=function(){var y={changeMonth:true,changeYear:true,shortYearCutoff:2,dateShowWeek:false,showOtherMonths:true,selectOtherMonths:true,stepMonths:1,numberOfMonths:1,gotoCurrent:true,constrainInput:false,dateFormat:"yy-mm-dd",onClose:function(){if(v.find("#pl-list-due-datetime").val()){if(!v.find("#pl-list-due-datetime-clear").is(":visible")){v.find("#pl-list-due-datetime-set").show()}}else{v.find("#pl-list-due-datetime-set, #pl-list-due-datetime-hours, #pl-list-due-datetime-minutes, #pl-list-due-datetime-clear").hide()}}};v.find("#pl-list-due-datetime").datepicker(y);u=v.find("#pl-list-icon-dialog").find("ul").data("pl-icons-path")};var w=function(){if(v.data("pl-ListDetails")){return}v.data("pl-ListDetails",true);v.on("submit","form",function(z){z.preventDefault();var y=a(this);y.find("#pl-list-details-save").removeClass("yellow").after(a.pocketlists.$loading);a.post("?module=list&action=save",y.serialize(),function(A){a.pocketlists.$loading.remove();if(A.status==="ok"){s(A.data);a.pocketlists.updateAppCounter();t()}else{v.find(".error").show().delay(3000).hide()}},"json");return false}).on("click","#pl-list-details-cancel",function(y){y.preventDefault();t()}).on("click",'[data-pl-action="list-delete"]',function(y){y.preventDefault();l()}).on("click","#pl-list-color a",function(y){y.preventDefault();a("#pl-list-color").find("input").val(a(this).data("pl-list-color")).trigger("change");a(this).addClass("selected").siblings().removeClass("selected")}).on("click","#pl-list-due-datetime-set",function(z){z.preventDefault();var y=a(this);y.hide().siblings().show().filter("select").prop("disabled",false)}).on("click","#pl-list-due-datetime-clear",function(z){z.preventDefault();var y=a(this);y.hide().siblings().show().filter("select").hide().prop("disabled",true)}).on("click","#pl-list-icon-change a",function(y){y.preventDefault();a("#pl-list-icon-dialog").waDialog({onLoad:function(){var z=a(this);a("#pl-list-icon-dialog").on("click","a[data-pl-list-icon]",function(C){C.preventDefault();var A=a(this).data("pl-list-icon"),B=a(this);v.find("#pl-list-icon-change").find("input").val(a(this).data("pl-list-icon"));B.find("input").val(A);v.find("#pl-list-icon-change .listicon48").css("background-image","url("+u+A+")");v.find("#pl-list-details-save").addClass("yellow");z.trigger("close");return false})}})}).on("change paste keyup",":input",function(){v.find("#pl-list-details-save").addClass("yellow")}).on("show.pl2",o).on("hide.pl2",t);a(window).scroll(function(){a.pocketlists.stickyDetailsSidebar()})};w();return{$el:v,trigger:function(y,z){this.$el&&this.$el.trigger(y,z)},isVisible:function(){return this.$el?this.$el.is(":visible"):false}}}(a("#pl-list-details")));var q=function(t){var o=f.val().trim();if(o.length){var s={name:f.val().trim(),type:"checklist",pocket_id:n};if(s.name){a.post("?module=list&action=update",{data:s,id:t},function(u){if(u.status==="ok"){if(g===-1){a.wa.setHash("#/pocket/"+n+"/list/"+u.data.id+"/")}}else{}},"json")}}};var k=function(){var o=i.find('[class*="star"]');a.post("?module=list&action=favorite",{id:g,status:o.hasClass("star-empty")?1:0},function(s){if(s.status==="ok"){o.toggleClass("star-empty star")}else{alert(s.errors)}},"json")};var l=function(){b.waDialog({height:"200px","min-height":"200px",width:"400px",onLoad:function(){},onSubmit:function(o){a.post("?module=list&action=delete",{list_id:g},function(s){if(s.status==="ok"){o.trigger("close");a.wa.setHash("#/pocket/1/")}else{}},"json");return false}})};var e=function(){a.post("?module=list&action=archive",{list_id:g,archive:1},function(o){if(o.status==="ok"){a.wa.setHash("#/pocket/1/")}else{}},"json")};var j=function(){a.post("?module=list&action=sort",{list_id:g},function(o){if(o.status==="ok"){a.pocketlists_routing.redispatch()}else{}},"json")};var h=function(){i.removeData("pl-clicked")};var p=function(){if(f.length){f.focus();f.on("keydown",function(o){f.data("pl-can-add",true);if(o.which===13&&f.data("pl-can-add")){o.preventDefault();q(g)}if(o.which===27){f.data("pl-can-add",false).val("")}}).on("blur",function(){f.data("pl-can-add")&&q(g)})}if(c.archive){i.find(":checkbox").prop("disabled",true)}i.on("click",function(s){if(!c.archive){var o=i.data("pl-clicked");if(a(s.target).closest(".pl-done-label").length){return}if(o==1){i.data("pl-clicked",2);a.pocketlists.scrollToTop(200,80);m.trigger("show.pl2")}else{if(o==2){m.trigger("hide.pl2");h()}else{i.data("pl-clicked",1)}}}}).on("click",'[data-pl-action="list-edit"]',function(o){o.preventDefault();o.stopPropagation();i.data("pl-clicked",2);a.pocketlists.scrollToTop(200,80);m.trigger("show.pl2")}).on("click",'[data-pl-action="list-delete"]',function(o){o.preventDefault();l()}).on("click",'[data-pl-action="list-archive"]',function(o){o.preventDefault();e()}).on("click",'[data-pl-action="list-sort"]',function(o){o.preventDefault();j()}).on("click",'[data-pl-action="list-favorite"]',function(o){o.preventDefault();k()}).on("click","#pl-list-complete",function(o){o.stopPropagation();d.waDialog({height:"150px","min-height":"150px",width:"400px",onLoad:function(){var s=a(this);s.on("click","[data-pl-action]",function(v){v.preventDefault();var u=a(this),t=u.data("pl-action");u.after(a.pocketlists.$loading);if(t==="list-complete-all"){a.post("?module=list&action=complete",{list_id:g,status:1},function(w){if(w.status==="ok"){s.trigger("close");a.pocketlists_routing.redispatch()}else{}},"json")}else{if(t==="list-archive"){a.post("?module=list&action=archive",{list_id:g,archive:1},function(w){if(w.status==="ok"){s.trigger("close");a.wa.setHash("#/pocket/"+n)}else{}},"json")}else{if(t==="cancel"){a("#pl-list-complete").prop("checked",false);s.trigger("close");a.pocketlists.$loading.remove()}}}})}})}).on("click",'[data-pl-action="list-unarchive"]',function(o){o.preventDefault();a.post("?module=list&action=archive",{list_id:g,archive:0},function(s){if(s.status==="ok"){a.pocketlists.updateAppCounter();a.wa.setHash("#/pocket/"+n+"/list/"+g+"/");a.pocketlists.highlightSidebar()}else{}},"json")}).on("deleteList.pl2",l).on("deselectList.pl2",h);a(document).on("keydown",function(o){switch(o.which){case 27:m.isVisible()&&m.trigger("hide.pl2");break}})};p();return{$el:i,list_details:m,list_id:g,pocket_id:n}}}());