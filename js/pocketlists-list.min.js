"use strict";$.pocketlists.List=function(h,q){var e=h.find("#pl-new-list-input"),f=parseInt(h.find("#pl-list-id").val()),m=parseInt($("#pl-pocket-id").val()),a=$("#pl-dialog-delete-list-confirm"),c=$("#pl-dialog-list-archive-complete-all"),b=$.extend({},{archive:false},q);var l=(function(u){var t=null;var o=function(){$.pocketlists.scrollToTop(200,80);u.html($.pocketlists.$loading).show().animate({right:"0%"},200);$.pocketlists.stickyDetailsSidebar();$.post("?module=list&action=details",{id:f},function(x){u.html(x);w()})};var s=function(){u.animate({right:"-100%"},200,function(){u.hide().empty()})};var r=function(x){h.find("#pl-list-name").text(x.name);if(x.due_date||x.due_datetime){var y="pl-due-someday";if(x.calc_priority==1){y="pl-due-tomorrow"}else{if(x.calc_priority==2){y="pl-due-today"}else{if(x.calc_priority==3){y="pl-due-overdue"}}}h.find(".pl-list-due").removeClass().addClass("pl-list-due "+y).text(x.due_datetime?x.due_datetime:x.due_date).show()}else{h.find(".pl-list-due").hide()}$("#pl-lists").find('[data-pl-list-id="'+f+'"]').removeClass().addClass("pl-"+x.color).find(".pl-list-name").text(x.name).end().find(".listicon48").css("background-image","url("+t+x.icon+")");$(".pl-items").removeClass().addClass("pl-items pl-"+x.color)};var w=function(){var x={changeMonth:true,changeYear:true,shortYearCutoff:2,dateShowWeek:false,showOtherMonths:true,selectOtherMonths:true,stepMonths:1,numberOfMonths:1,gotoCurrent:true,constrainInput:false,dateFormat:"yy-mm-dd",onClose:function(){if(u.find("#pl-list-due-datetime").val()){if(!u.find("#pl-list-due-datetime-clear").is(":visible")){u.find("#pl-list-due-datetime-set").show()}}else{u.find("#pl-list-due-datetime-set, #pl-list-due-datetime-hours, #pl-list-due-datetime-minutes, #pl-list-due-datetime-clear").hide()}}};u.find("#pl-list-due-datetime").datepicker(x);t=u.find("#pl-list-icon-dialog").find("ul").data("pl-icons-path")};var v=function(){if(u.data("pl-ListDetails")){return}u.data("pl-ListDetails",true);u.on("submit","form",function(y){y.preventDefault();var x=$(this);x.find("#pl-list-details-save").removeClass("yellow").after($.pocketlists.$loading);$.post("?module=list&action=save",x.serialize(),function(z){$.pocketlists.$loading.remove();if(z.status==="ok"){r(z.data);$.pocketlists.updateAppCounter();s()}else{u.find(".error").show().delay(3000).hide()}},"json");return false}).on("click","#pl-list-details-cancel",function(x){x.preventDefault();s()}).on("click",'[data-pl-action="list-delete"]',function(x){x.preventDefault();k()}).on("click","#pl-list-color a",function(x){x.preventDefault();$("#pl-list-color").find("input").val($(this).data("pl-list-color")).trigger("change");$(this).addClass("selected").siblings().removeClass("selected")}).on("click","#pl-list-due-datetime-set",function(y){y.preventDefault();var x=$(this);x.hide().siblings().show().filter("select").prop("disabled",false)}).on("click","#pl-list-due-datetime-clear",function(y){y.preventDefault();var x=$(this);x.hide().siblings().show().filter("select").hide().prop("disabled",true)}).on("click","#pl-list-icon-change a",function(x){x.preventDefault();$("#pl-list-icon-dialog").waDialog({onLoad:function(){var y=$(this);$("#pl-list-icon-dialog").on("click","a[data-pl-list-icon]",function(B){B.preventDefault();var z=$(this).data("pl-list-icon"),A=$(this);u.find("#pl-list-icon-change").find("input").val($(this).data("pl-list-icon"));A.find("input").val(z);u.find("#pl-list-icon-change .listicon48").css("background-image","url("+t+z+")");u.find("#pl-list-details-save").addClass("yellow");y.trigger("close");return false})}})}).on("change paste keyup",":input",function(){u.find("#pl-list-details-save").addClass("yellow")}).on("show.pl2",o).on("hide.pl2",s);$(window).scroll(function(){$.pocketlists.stickyDetailsSidebar()})};v();return{$el:u,trigger:function(x,y){this.$el&&this.$el.trigger(x,y)},isVisible:function(){return this.$el?this.$el.is(":visible"):false}}}($("#pl-list-details")));var p=function(s){var o=e.val().trim();if(o.length){var r={name:e.val().trim(),type:"checklist",pocket_id:m};if(r.name){$.post("?module=list&action=update",{data:r,id:s},function(t){if(t.status==="ok"){if(f===-1){$.wa.setHash("#/pocket/"+m+"/list/"+t.data.id+"/")}}else{}},"json")}}};var j=function(){var o=h.find('[class*="star"]');$.post("?module=list&action=favorite",{id:f,status:o.hasClass("star-empty")?1:0},function(s){if(s.status==="ok"){o.toggleClass("star-empty star")}else{alert(s.errors)}},"json")};var k=function(){a.waDialog({height:"200px","min-height":"200px",width:"400px",onLoad:function(){},onSubmit:function(o){$.post("?module=list&action=delete",{list_id:f},function(s){if(s.status==="ok"){o.trigger("close");$.wa.setHash("#/pocket/1/")}else{}},"json");return false}})};var d=function(){$.post("?module=list&action=archive",{list_id:f,archive:1},function(o){if(o.status==="ok"){$.wa.setHash("#/pocket/1/")}else{}},"json")};var i=function(){$.post("?module=list&action=sort",{list_id:f},function(o){if(o.status==="ok"){$.pocketlists_routing.redispatch()}else{}},"json")};var g=function(){h.removeData("pl-clicked")};var n=function(){if(e.length){e.focus();e.on("keydown",function(o){e.data("pl-can-add",true);if(o.which===13&&e.data("pl-can-add")){o.preventDefault();p(f)}if(o.which===27){e.data("pl-can-add",false).val("")}}).on("blur",function(){e.data("pl-can-add")&&p(f)})}if(b.archive){h.find(":checkbox").prop("disabled",true)}h.on("click",function(r){if(!b.archive){var o=h.data("pl-clicked");if($(r.target).closest(".pl-done-label").length){return}if(o==1){h.data("pl-clicked",2);$.pocketlists.scrollToTop(200,80);l.trigger("show.pl2")}else{if(o==2){l.trigger("hide.pl2");g()}else{h.data("pl-clicked",1)}}}}).on("click",'[data-pl-action="list-edit"]',function(o){o.preventDefault();o.stopPropagation();h.data("pl-clicked",2);$.pocketlists.scrollToTop(200,80);l.trigger("show.pl2")}).on("click",'[data-pl-action="list-delete"]',function(o){o.preventDefault();k()}).on("click",'[data-pl-action="list-archive"]',function(o){o.preventDefault();d()}).on("click",'[data-pl-action="list-sort"]',function(o){o.preventDefault();i()}).on("click",'[data-pl-action="list-favorite"]',function(o){o.preventDefault();j()}).on("click","#pl-list-complete",function(o){o.stopPropagation();c.waDialog({height:"150px","min-height":"150px",width:"400px",onLoad:function(){var r=$(this);r.on("click","[data-pl-action]",function(u){u.preventDefault();var t=$(this),s=t.data("pl-action");t.after($.pocketlists.$loading);if(s==="list-complete-all"){$.post("?module=list&action=complete",{list_id:f,status:1},function(v){if(v.status==="ok"){r.trigger("close");$.pocketlists_routing.redispatch()}else{}},"json")}else{if(s==="list-archive"){$.post("?module=list&action=archive",{list_id:f,archive:1},function(v){if(v.status==="ok"){r.trigger("close");$.wa.setHash("#/pocket/"+m)}else{}},"json")}else{if(s==="cancel"){$("#pl-list-complete").prop("checked",false);r.trigger("close");$.pocketlists.$loading.remove()}}}})}})}).on("click",'[data-pl-action="list-unarchive"]',function(o){o.preventDefault();$.post("?module=list&action=archive",{list_id:f,archive:0},function(s){if(s.status==="ok"){$.pocketlists.updateAppCounter();$.wa.setHash("#/pocket/"+m+"/list/"+f+"/");$.pocketlists.highlightSidebar()}else{}},"json")}).on("deleteList.pl2",k).on("deselectList.pl2",g);$(document).on("keydown",function(o){switch(o.which){case 27:l.isVisible()&&l.trigger("hide.pl2");break}})};n();return{$el:h,list_details:l,list_id:f,pocket_id:m}};