(function(a){a.storage=new a.store();a.pocketlists_routing={options:{},init:function(b){var c=this;c.options=b;if(typeof(a.History)!="undefined"){a.History.bind(function(){c.dispatch()})}var d=window.location.hash;if(d==="#/"||!d){d=a.storage.get("pocketlists/hash");if(d&&d!=null){a.wa.setHash("#/"+d)}else{this.dispatch()}}else{a.wa.setHash(d)}},prevHash:null,hash:null,getHash:function(){return this.cleanHash()},cleanHash:function(b){if(typeof b=="undefined"){b=window.location.toString().split("#")[1]||""}if(!b){return""}else{if(!b.length){b=""+b}}while(b.length>0&&b[b.length-1]==="/"){b=b.substr(0,b.length-1)}b+="/";if(b[0]!="#"){if(b[0]!="/"){b="/"+b}b="#"+b}else{if(b[1]&&b[1]!="/"){b="#/"+b.substr(1)}}if(b=="#/"){return""}return b},skipDispatch:0,stopDispatch:function(b){this.skipDispatch=b},dispatch:function(j){if(this.skipDispatch>0){this.skipDispatch--;return false}if(j===undefined||j===null){j=window.location.hash}j=j.replace(/(^[^#]*#\/*|\/$)/g,"");if(this.hash!==null){this.prevHash=this.hash}this.hash=j;if(j){j=j.split("/");if(j[0]){var d="";var e=j.length;var k=null;var c=null;for(var f=0;f<j.length;f++){var g=j[f];if(f<2){if(f===0){d=g}else{if(parseInt(g,10)!=g&&g.indexOf("=")==-1){d+=g.substr(0,1).toUpperCase()+g.substr(1)}else{break}}if(typeof(this[d+"Action"])=="function"){k=d;c=f+1}}else{break}}e=f;if(typeof(this[d+"Action"])!=="function"&&k){d=k;e=c}var b=j.slice(e);this.preExecute(d);if(typeof(this[d+"Action"])=="function"){console.info("dispatch",[d+"Action",b]);this[d+"Action"].apply(this,b);a.storage.set("pocketlists/hash",j.join("/"))}else{console.info("Invalid action name:",d+"Action")}this.postExecute(d)}else{this.preExecute();this.defaultAction();this.postExecute()}}else{this.preExecute();this.defaultAction();this.postExecute()}},redispatch:function(){this.prevHash=null;this.dispatch()},preExecute:function(){},postExecute:function(){},defaultAction:function(){this.pocketAction()},listsAction:function(){this.pocketAction()},listAction:function(b){this.load("?module=list&id="+b,function(c){a("#pl-list-content").html(c)})},pocketAction:function(d){var c=decodeURIComponent(this.getHash().substr(("#/pocket/"+d+"/list/").length).replace("/",""))||0;if(c){if(c==="new"){c=-1}}var d=d||0;var b=a("#pl-list-name");if(b.length){b.after('<i class="icon16 loading">')}this.load("?module=pocket&id="+d+"&list_id="+c,function(e){a("#content").html(e)})},archiveAction:function(b){var b=b||0;this.load("?module=archive&id="+b,function(c){a("#content").html(c)})},logbookAction:function(){this.load("?module=logbook",function(b){a("#content").html(b)})},settingsAction:function(){this.load("?module=settings",function(b){a("#content").html(b)})},todoAction:function(){this.load("?module=todo",function(b){a("#content").html(b)})},favoritesAction:function(){this.load("?module=favorites",function(b){a("#content").html(b)})},teamAction:function(b){var b=b||0;this.load("?module=team&teammate="+b,function(c){a("#content").html(c)})},load:function(d,c,e){if(typeof c==="function"){e=c;c={}}else{c=c||{}}var f=Math.random();this.random=f;var b=this;return a.get(d,function(g){if((typeof c.check==="undefined"||c.check)&&b.random!=f){return}if(typeof e==="function"){e.call(this,g)}})}}}(jQuery));